[{"title":"Androidä¸ºä»€ä¹ˆå¡ï¼Ÿå…³äºAndroidç¼–è¯‘","date":"2019-08-22T09:42:11.000Z","path":"post/34316/","text":"9102å¹´äº†ï¼Œè¿˜ä¸çŸ¥é“Androidä¸ºä»€ä¹ˆå¡ï¼Ÿç¬”è®°ï¼ŒåŸæ–‡åœ°å€ï¼šhttps://mp.weixin.qq.com/s/wyN6I4KTNWI-VE3KbjtgUQ åŸºç¡€æ¦‚å¿µç¼–è¯‘&amp;è§£é‡Š æŸäº›ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚Javaï¼‰çš„æºä»£ç é€šè¿‡ç¼–è¯‘-è§£é‡Šçš„æµç¨‹å¯è¢«è®¡ç®—æœºè¯»æ‡‚ å¦‚ 123public static void main(String[] args)&#123; print('Hello World')&#125; å†™å®Œè¿™æ®µä»£ç å¹¶æ‰§è¡Œï¼Œç”µè„‘æˆ–æ‰‹æœºå°±ä¼šæ‰“å°å‡ºHello Worldã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè‹±æ–‡æ˜¯äººç±»ä¸–ç•Œçš„è¯­è¨€ï¼Œè®¡ç®—æœºï¼ˆCPUï¼‰æ˜¯æ€ä¹ˆç†è§£è‹±æ–‡çš„å‘¢ï¼Ÿ ä¼—æ‰€å‘¨çŸ¥ï¼Œ0å’Œ1æ˜¯è®¡ç®—æœºä¸–ç•Œçš„è¯­è¨€ï¼Œå¯ä»¥è¯´è®¡ç®—æœºåªè®¤è¯†0å’Œ1ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æŠŠä¸Šé¢é‚£æ®µè‹±æ–‡ä»£ç åªé€šè¿‡0å’Œ1è¡¨è¾¾ç»™è®¡ç®—æœºï¼Œå°±å¯ä»¥è®©è®¡ç®—æœºè¯»æ‡‚å¹¶æ‰§è¡Œã€‚ image ç»“åˆä¸Šå›¾ï¼ŒJavaæºä»£ç é€šè¿‡ç¼–è¯‘å˜æˆå­—èŠ‚ç ï¼Œç„¶åå­—èŠ‚ç æŒ‰ç…§æ¨¡ç‰ˆä¸­çš„è§„åˆ™è§£é‡Šä¸ºæœºå™¨ç ã€‚ æœºå™¨ç &amp;å­—èŠ‚ç æœºå™¨ç  æœºå™¨ç å°±æ˜¯èƒ½è¢«CPUç›´æ¥è§£è¯»å¹¶æ‰§è¡Œçš„è¯­è¨€ã€‚ ä½†æ˜¯å¦‚æœä½¿ç”¨ä¸Šå›¾ä¸­ç”Ÿæˆçš„æœºå™¨ç è·‘åœ¨å¦å¤–ä¸€å°è®¡ç®—æœºä¸­ï¼Œå¾ˆå¯èƒ½å°±ä¼šè¿è¡Œå¤±è´¥ã€‚ è¿™æ˜¯å› ä¸ºä¸åŒçš„è®¡ç®—æœºï¼Œèƒ½å¤Ÿè§£è¯»çš„æœºå™¨ç å¯èƒ½ä¸åŒã€‚é€šä¿—è€Œè¨€å°±æ˜¯èƒ½åœ¨Aç”µè„‘ä¸Šè¿è¡Œçš„æœºå™¨ç ï¼Œæ”¾åˆ°Bç”µè„‘ä¸Šå°±å¯èƒ½å°±ä¸å¥½ä½¿äº†ã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œä¸­å›½äººAè®¤è¯†ä¸­æ–‡ï¼Œè‹±è¯­ï¼›ä¿„å›½äººBè®¤è¯†ä¿„è¯­ï¼Œè‹±è¯­ã€‚è¿™æ—¶ä»–ä¸¤åŒæ—¶åšä¸€å¼ ä¸­æ–‡è¯•å·ï¼ŒBå¤§æ¦‚è¿å†™åå­—çš„åœ°æ–¹éƒ½æ‰¾ä¸åˆ°ã€‚ æ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å­—èŠ‚ç ã€‚ å­—èŠ‚ç  ä¸­å›½äººAçœ‹ä¸æ‡‚ä¿„æ–‡è¯•å·ï¼Œä¿„å›½äººBçœ‹ä¸æ‡‚ä¸­æ–‡è¯•å·ï¼Œä½†æ˜¯å¤§å®¶éƒ½çœ‹å¾—æ‡‚è‹±æ–‡è¯•å·ã€‚ å­—èŠ‚ç å°±æ˜¯ä¸ªä¸­é—´ç ï¼ŒJavaèƒ½ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼ŒåŒä¸€ä»½å­—èŠ‚ç èƒ½æŒ‰ç…§æŒ‡å®šæ¨¡ç‰ˆçš„è§„åˆ™è§£é‡Šä¸ºæŒ‡å®šçš„æœºå™¨ç ã€‚ å­—èŠ‚ç çš„å¥½å¤„ï¼š å®ç°äº†è·¨å¹³å°ï¼Œä¸€ä»½æºä»£ç åªéœ€è¦ç¼–è¯‘æˆä¸€ä»½å­—èŠ‚ç ï¼Œç„¶åæ ¹æ®ä¸åŒçš„æ¨¡ç‰ˆå°†å­—èŠ‚ç è§£é‡Šæˆå½“å‰è®¡ç®—æœºè®¤è¯†çš„æœºå™¨ç ï¼Œè¿™å°±æ˜¯Javaæ‰€è¯´çš„â€œç¼–è¯‘ä¸€æ¬¡ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚ åŒä¸€ä»½æºç è¢«ç¼–è¯‘æˆçš„å­—èŠ‚ç å¤§å°è¿œè¿œå°äºæœºå™¨ç ã€‚ image ç¼–è¯‘è¯­è¨€&amp;è§£é‡Šè¯­è¨€ç¼–è¯‘è¯­è¨€ æˆ‘ä»¬ç†ŸçŸ¥çš„C/C++è¯­è¨€ï¼Œæ˜¯ç¼–è¯‘è¯­è¨€ï¼Œå³ç¨‹åºå‘˜ç¼–è¯‘ä¹‹åå¯ä»¥ä¸€æ­¥åˆ°ä½ï¼ˆç¼–è¯‘æˆæœºå™¨ç ï¼‰ï¼Œå¯ä»¥è¢«CPUç›´æ¥è§£è¯»å¹¶æ‰§è¡Œã€‚ image å¯èƒ½æœ‰äººä¼šé—®ï¼Œæ—¢ç„¶ä¸Šæ–‡ä¸­è¯´è¿‡å­—èŠ‚ç æœ‰ç§ç§å¥½å¤„ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨å­—èŠ‚ç å‘¢ï¼Ÿ\\ è¿™æ˜¯å› ä¸ºæ¯ç§ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„åˆè¡·ä¸åŒ,æœ‰äº›æ˜¯ä¸ºäº†è·¨å¹³å°è€Œè®¾è®¡çš„ï¼Œå¦‚Javaï¼Œä½†æœ‰äº›æ˜¯é’ˆå¯¹æŸä¸ªæŒ‡å®šæœºå™¨æˆ–æŸæ‰¹æŒ‡å®šå‹å·çš„æœºå™¨è®¾è®¡çš„ã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œè‹¹æœå…¬å¸å¼€å‘çš„OCè¯­è¨€å’ŒSwiftè¯­è¨€ï¼Œå°±æ˜¯é’ˆå¯¹è‡ªå®¶äº§å“è®¾è®¡çš„ï¼Œæˆ‘æ‰ä¸ç®¡ä½ å…¶ä»–äººçš„äº§å“å‘¢ã€‚æ‰€ä»¥OCæˆ–Swiftè¯­è¨€è®¾è®¡åˆè¡·ä¹‹ä¸€å°±æ˜¯å¿«ï¼Œå¯ç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç ä½¿iPhoneæˆ–iPadè§£è¯»å¹¶æ‰§è¡Œã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè‹¹æœæ‰‹æœºçš„åº”ç”¨æ¯”å®‰å“æ‰‹æœºåº”ç”¨å¤§çš„ä¸»è¦åŸå› ã€‚ ç¼–è¯‘-è§£é‡Šè¯­è¨€ æ‹¿å¼€å‘Androidçš„è¯­è¨€Javaä¸ºä¾‹ï¼ŒJavaæ˜¯ç¼–è¯‘-è§£é‡Šè¯­è¨€,å³ç¨‹åºå‘˜ç¼–è¯‘ä¹‹åä¸å¯ä»¥ç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œè€Œæ˜¯ä¼šç¼–è¯‘æˆå­—èŠ‚ç (åœ¨Javaç¨‹åºä¸­ä¸º.classæ–‡ä»¶ï¼Œåœ¨Androidç¨‹åºä¸­ä¸º.dexæ–‡ä»¶)ã€‚ç„¶åæˆ‘ä»¬éœ€è¦å°†å­—èŠ‚ç å†è§£é‡Šæˆæœºå™¨ç ,ä½¿ä¹‹èƒ½è¢«CPUè§£è¯»ã€‚ è¿™ç¬¬äºŒæ¬¡è§£é‡Šï¼Œå³ä»å­—èŠ‚ç è§£é‡Šæˆæœºå™¨ç çš„è¿‡ç¨‹ï¼Œæ˜¯ç¨‹åºå®‰è£…æˆ–è¿è¡Œåï¼Œåœ¨Javaè™šæ‹Ÿæœºä¸­å®ç°çš„ã€‚ é€ æˆAndroidå¡é¡¿çš„ä¸‰å¤§å› ç´ è™šæ‹Ÿæœºâ€”â€”è§£é‡Šè¿‡ç¨‹æ…¢ é€šè¿‡ä¸Šæ–‡æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒiOSä¹‹æ‰€ä»¥ä¸å¡æ˜¯å› ä¸ºä»–ä¸€æ­¥åˆ°ä½ï¼Œçœç•¥äº†ä¸­é—´è§£é‡Šçš„æ­¥éª¤ï¼Œç›´æ¥è·Ÿç¡¬ä»¶å±‚è¿›è¡Œé€šä¿¡ã€‚è€ŒAndroidç”±äºæ²¡æœ‰ä¸€æ­¥åˆ°ä½ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦å®æ—¶è§£é‡Šæˆæœºå™¨ç ï¼Œæ‰€ä»¥æ€§èƒ½è¾ƒiOSæ˜æ˜¾ä½ä¸‹ã€‚ Andorid 1.0 Dalvik(DVM)+è§£é‡Šå™¨ DVMæ˜¯Googleå¼€å‘çš„Androidå¹³å°è™šæ‹Ÿæœº,å¯è¯»å–.dexçš„å­—èŠ‚ç ã€‚ä¸Šæ–‡ä¸­æ‰€è¯´çš„ä»å­—èŠ‚ç è§£é‡Šæˆæœºå™¨ç çš„è¿‡ç¨‹åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œåœ¨Androidå¹³å°ä¸­è™šæ‹ŸæœºæŒ‡çš„å°±æ˜¯è¿™ä¸ªDVMã€‚ åœ¨Android1.0æ—¶æœŸï¼Œç¨‹åºä¸€è¾¹è¿è¡Œï¼ŒDVMä¸­çš„è§£é‡Šå™¨ï¼ˆç¿»è¯‘æœºï¼‰ä¸€è¾¹è§£é‡Šå­—èŠ‚ç ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œè¿™æ ·æ•ˆç‡ç»å¯¹ä½ä¸‹ã€‚ä¸€ä¸ªå­—ï¼Œå¡ã€‚ Android 2.2 DVM+JIT å…¶å®è§£å†³DVMçš„é—®é¢˜æ€è·¯å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬åœ¨ç¨‹åºæŸä¸ªåŠŸèƒ½è¿è¡Œå‰å°±è§£é‡Šå°±å¯ä»¥äº†ã€‚ åœ¨Android2.2æ—¶æœŸï¼Œèªæ˜çš„è°·æ­Œå¼•å…¥äº†JIT(Just In Time)æœºåˆ¶ï¼Œç›´è¯‘å°±æ˜¯å³æ—¶ç¼–è¯‘ã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œæˆ‘ç»å¸¸å»ä¸€å®¶é¤é¦†åƒé¥­ï¼Œè€æ¿å·²ç»çŸ¥é“æˆ‘æƒ³åƒä»€ä¹ˆèœäº†ï¼Œåœ¨æˆ‘åˆ°ä¹‹å‰å°±æŠŠèœå‡†å¤‡å¥½äº†ï¼Œè¿™æ ·æˆ‘å°±çœå»äº†ç­‰èœçš„æ—¶é—´ã€‚ JITå°±ç›¸å½“äºè¿™ä¸ªèªæ˜çš„è€æ¿ï¼Œå®ƒä¼šåœ¨æ‰‹æœºæ‰“å¼€APPæ—¶ï¼Œå°†ç”¨æˆ·ç»å¸¸ä½¿ç”¨çš„åŠŸèƒ½è®°ä¸‹æ¥ã€‚å½“ç”¨æˆ·æ‰“å¼€APPçš„æ—¶å€™ç«‹é©¬å°†è¿™äº›å†…å®¹ç¼–è¯‘å‡ºæ¥ï¼Œè¿™æ ·å½“ç”¨æˆ·æ‰“å¼€è¿™äº›å†…å®¹æ—¶ï¼ŒJITå·²ç»å°†â€™èœâ€™å‡†å¤‡å¥½äº†ã€‚è¿™æ ·å°±æé«˜äº†æ•´ä½“æ•ˆç‡ã€‚ è™½ç„¶JITæŒºèªæ˜çš„ï¼Œä¸”æ€»ä½“æ€è·¯æ¸…æ™°ç†æƒ³ä¸°æ»¡ï¼Œä½†ç°å®æ˜¯ä»ç„¶å¡çš„è¦æ­»ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼š æ‰“å¼€APPçš„æ—¶å€™ä¼šå˜æ…¢ æ¯æ¬¡æ‰“å¼€APPéƒ½è¦é‡å¤åŠ³åŠ¨ï¼Œä¸èƒ½ä¸€åŠ³æ°¸é€¸ã€‚ å¦‚æœæˆ‘çªç„¶ç‚¹äº†ä¸€ç›˜ä¹‹å‰ä»æ¥æ²¡ç‚¹è¿‡çš„èœï¼Œé‚£æˆ‘åªå¥½ç­‰èœäº†ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·æ‰“å¼€äº†JITæ²¡æœ‰å‡†å¤‡å¥½çš„â€™èœâ€™ï¼Œå°±åªèƒ½ç­‰DVMä¸­çš„è§£é‡Šå™¨å»è¾¹æ‰§è¡Œè¾¹è§£é‡Šäº†ã€‚ Android 5.0 ART+AOT èªæ˜çš„è°·æ­Œåˆæƒ³åˆ°ä¸ªæ–¹æ³•ï¼Œæ—¢ç„¶æˆ‘ä»¬èƒ½åœ¨æ‰“å¼€APPçš„æ—¶å€™å°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½•ä¸åœ¨APPå®‰è£…çš„æ—¶å€™å°±æŠŠå­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç å‘¢ï¼Ÿè¿™æ ·æ¯æ¬¡æ‰“å¼€APPä¹Ÿä¸ç”¨é‡å¤åŠ³åŠ¨äº†ï¼Œä¸€åŠ³æ°¸é€¸ã€‚ è¿™ç¡®å®æ˜¯ä¸ªæ€è·¯ï¼Œäºæ˜¯è°·æ­Œæ¨å‡ºäº†ARTæ¥æ›¿ä»£DVMï¼ŒARTå…¨ç§°Android Runtimeï¼Œå®ƒåœ¨DVMçš„åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå®ƒåœ¨åº”ç”¨è¢«å®‰è£…çš„æ—¶å€™å°±å°†åº”ç”¨ç¼–è¯‘æˆæœºå™¨ç ,è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºAOT(Ahead-Of-Time)ï¼Œå³é¢„ç¼–è¯‘ã€‚ ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œæ‰“å¼€APPæ˜¯ä¸å¡äº†ï¼Œä½†æ˜¯å®‰è£…APPæ…¢çš„è¦æ­»ï¼Œå¯èƒ½æœ‰äººä¼šè¯´ï¼Œä¸€ä¸ªAPPåˆä¸æ˜¯ä¼šé¢‘ç¹å®‰è£…ï¼Œå¯ä»¥ç‰ºç‰²ä¸‹è¿™ç‚¹æ—¶é—´ã€‚ä½†æ˜¯ä¸å¥½æ„æ€ï¼Œå®‰å“æ‰‹æœºæ¯æ¬¡OTAå¯åŠ¨ï¼ˆå³ç³»ç»Ÿç‰ˆæœ¬æ›´æ–°æˆ–åˆ·æœºåï¼‰éƒ½ä¼šé‡æ–°å®‰è£…æ‰€æœ‰APPï¼ Android 7.0 æ··åˆç¼–è¯‘ è°·æ­Œæœ€ç»ˆç¥­å‡ºäº†ç»ˆæå¤§æ‹›ï¼ŒDVM+JITä¸å¥½ï¼ŒART+AOTåˆä¸å¥½ã€‚æŠŠä»–ä»¬éƒ½æ··åˆèµ·æ¥ï¼ äºæ˜¯è°·æ­Œåœ¨Android7.0çš„æ—¶å€™ï¼Œå‘å¸ƒäº†æ··åˆç¼–è¯‘ã€‚å³å®‰è£…æ—¶å…ˆä¸ç¼–è¯‘æˆæœºå™¨ç ï¼Œåœ¨æ‰‹æœºä¸è¢«ä½¿ç”¨çš„æ—¶å€™ï¼ŒAOTå·å·çš„æŠŠèƒ½ç¼–è¯‘æˆæœºå™¨ç çš„é‚£éƒ¨åˆ†ä»£ç ç¼–è¯‘äº†ï¼ˆè‡³äºä»€ä¹ˆæ˜¯èƒ½ç¼–è¯‘çš„éƒ¨åˆ†ï¼Œä¸‹æ–‡å­—èŠ‚ç çš„ç¼–è¯‘æ¨¡æ¿è¯¦è¿°ï¼‰ã€‚å…¶å®å°±æ˜¯æŠŠä¹‹å‰APPå®‰è£…æ—¶å€™å¹²çš„æ´»å·å·çš„åœ¨æ‰‹æœºç©ºçš„æ—¶å€™å¹²äº†ã€‚ å¦‚æœæ¥ä¸åŠç¼–è¯‘çš„è¯ï¼Œå†æŠŠJITå’Œè§£é‡Šå™¨è¿™å¯¹éš¾å…„éš¾å¼Ÿå«èµ·æ¥ï¼Œè®©ä»–ä»¬å»ç¼–è¯‘æˆ–å®æ—¶è§£é‡Šã€‚ Android 8.0 æ”¹è¿›è§£é‡Šå™¨ åœ¨Android8.0æ—¶æœŸï¼Œè°·æ­Œåˆç›¯ä¸Šäº†è§£é‡Šå™¨ï¼Œå…¶å®çºµè§‚ä¸Šé¢çš„é—®é¢˜ï¼Œæ ¹æºå°±æ˜¯è¿™ä¸ªè§£é‡Šå™¨è§£é‡Šçš„å¤ªæ…¢äº†ï¼é‚£æˆ‘ä»¬ä½•ä¸è®©è¿™ä¸ªè§£é‡Šå™¨è§£é‡Šçš„å¿«ä¸€ç‚¹å‘¢ï¼Ÿäºæ˜¯è°·æ­Œæ”¹è¿›äº†è§£é‡Šå™¨ï¼Œè§£é‡Šæ¨¡å¼æ‰§è¡Œæ•ˆç‡å¤§å¤§æå‡ã€‚ Android 9.0 æ”¹è¿›ç¼–è¯‘æ¨¡æ¿ ç®€å•è€Œè¨€å°±æ˜¯ï¼Œåœ¨Android9.0ä¸Šæä¾›äº†é¢„å…ˆæ”¾ç½®çƒ­ç‚¹ä»£ç çš„æ–¹å¼ï¼Œåº”ç”¨åœ¨å®‰è£…çš„æ—¶å€™å°±èƒ½çŸ¥é“å¸¸ç”¨ä»£ç ä¼šè¢«æå‰ç¼–è¯‘ã€‚ JNIâ€”â€”Javaå’ŒCäº’ç›¸è°ƒç”¨æ…¢ JNIåˆç§°ä¸º Java Native Interfaceï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯JavaåŸç”Ÿæ¥å£ï¼Œå°±æ˜¯ç”¨æ¥è·ŸC/C++ä»£ç äº¤äº’çš„ã€‚ å¦‚æœä¸åšAndroidå¼€å‘çš„å¯èƒ½ä¸çŸ¥é“ï¼ŒAndroidé¡¹ç›®é‡Œçš„ä»£ç é™¤äº†Java,å¾ˆæœ‰å¯èƒ½è¿˜æœ‰éƒ¨åˆ†Cè¯­è¨€çš„ä»£ç ã€‚ è¿™ä¸ªæ—¶å€™æœ‰ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œé¦–å…ˆä¸Šå›¾ (å›¾ç‰‡å‚è€ƒæ–¹èˆŸç¼–è¯‘å™¨åŸç†PPT)ï¼š image åœ¨å¼€å‘é˜¶æ®µJavaæºä»£ç åœ¨å¼€å‘é˜¶æ®µæ‰“åŒ…æˆ.dexæ–‡ä»¶ï¼ŒCè¯­è¨€ç›´æ¥å°±æ˜¯.soåº“ï¼Œå› ä¸ºCè¯­è¨€æœ¬èº«å°±æ˜¯ç¼–è¯‘è¯­è¨€ã€‚ åœ¨ç”¨æˆ·æ‰‹æœºä¸­ï¼ŒAPKä¸­çš„.dexæ–‡ä»¶ï¼ˆå­—èŠ‚ç ï¼‰ä¼šè¢«è§£é‡Šä¸º.oatæ–‡ä»¶ï¼ˆæœºå™¨ç ï¼‰è¿è¡Œåœ¨ARTè™šæ‹Ÿæœºä¸­ï¼Œ.soåº“åˆ™ä¸ºè®¡ç®—æœºå¯ä»¥ç›´æ¥è¿è¡Œçš„äºŒè¿›åˆ¶ä»£ç ï¼ˆæœºå™¨ç ï¼‰ï¼Œä¸¤ä»½æœºå™¨ç è¦äº’ç›¸è°ƒç”¨è‚¯å®šæ˜¯æœ‰å¼€é”€çš„ã€‚ ä¸‹é¢å°±æ¥é˜è¿°ä¸‹ä¸ºä»€ä¹ˆä¸¤ä»½æœºå™¨ç ä¼šä¸åŒã€‚ è¿™è¾¹éœ€è¦æ·±å…¥ç†è§£å­—èŠ‚ç -&gt;æœºå™¨ç çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œåœ¨å›¾ä¸Šè™½ç„¶éƒ½è¢«ç¼–è¯‘æˆäº†æœºå™¨ç ï¼Œéƒ½èƒ½è¢«ç¡¬ä»¶ç›´æ¥è°ƒç”¨ï¼Œä½†æ˜¯ä¸¤ä»½æœºå™¨ç çš„æ€§èƒ½ï¼Œæ•ˆç‡ï¼Œå®ç°æ–¹å¼ç›¸å·®ç”šå¤šï¼Œè¿™ä¸»è¦æ˜¯ç”±ä»¥ä¸‹ä¸¤ä¸ªç‚¹é€ æˆçš„ï¼š ç¼–ç¨‹è¯­è¨€ä¸åŒå¯¼è‡´ç¼–è¯‘å‡ºçš„å­—èŠ‚ç ä¸åŒå¯¼è‡´ç¼–è¯‘å‡ºçš„æœºå™¨ç ä¸åŒã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œé’ˆå¯¹åŒæ ·æ˜¯é™æ€è¯­è¨€çš„Cå’ŒJavaï¼Œå¯¹int a + b çš„è¿ç®—.Cè¯­è¨€å¯ä»¥ç›´æ¥åŠ è½½å†…å­˜ï¼Œåœ¨å¯„å­˜å™¨ä¸­è®¡ç®—ï¼Œè¿™æ˜¯ç”±äºCè¯­è¨€æ˜¯é™æ€è¯­è¨€ï¼Œaå’Œbæ˜¯ç¡®å®šçš„intå¯¹è±¡ã€‚ åœ¨Javaä¸­è™½ç„¶å®šä¹‰å¯¹è±¡æˆ‘ä»¬ä¹Ÿè¦æ˜ç¡®çš„æŒ‡å‡ºå¯¹è±¡çš„ç±»å‹ï¼Œä¾‹å¦‚int a = 0,ä½†æ˜¯Javaæ‹¥æœ‰åŠ¨æ€æ€§ï¼ŒJavaæ‹¥æœ‰åå°„ï¼Œä»£ç†ï¼Œè°ä¹Ÿä¸æ•¢ä¿è¯aåœ¨è¢«è°ƒç”¨æ—¶è¿˜æ˜¯intç±»å‹ï¼Œæ‰€ä»¥Javaçš„ç¼–è¯‘éœ€è¦è€ƒè™‘ä¸Šä¸‹æ–‡å…³ç³»ï¼Œå³å…·ä½“æƒ…å†µå…·ä½“ç¼–è¯‘ã€‚ æ‰€ä»¥è¿å­—èŠ‚ç å·²ç»ä¸åŒäº†ï¼Œç¼–è¯‘å‡ºçš„æœºå™¨ç è‚¯å®šä¸åŒã€‚ è¿è¡Œç¯å¢ƒä¸åŒå¯¼è‡´ç¼–è¯‘å‡ºçš„æœºå™¨ç ä¸åŒ å›¾ä¸­æ˜æ˜¾çœ‹åˆ°ç”±Javaç¼–è¯‘è€Œæ¥çš„æœºå™¨ç åŒ…è£¹åœ¨ARTä¸­ï¼ŒARTå…¨ç§°Android RunTimeï¼Œå³å®‰å“è¿è¡Œç¯å¢ƒï¼Œè·Ÿè™šæ‹Ÿæœºå·®ä¸å¤šæ˜¯ä¸€ä¸ªæ„æ€ã€‚è€ŒCè¯­è¨€æ‰€åœ¨çš„è¿è¡Œç¯å¢ƒä¸åœ¨ARTä¸­ã€‚ RunTimeæä¾›äº†åŸºæœ¬çš„è¾“å…¥è¾“å‡ºæˆ–æ˜¯å†…å­˜ç®¡ç†ç­‰æ”¯æŒï¼Œå¦‚æœè¦åœ¨ä¸¤ä¸ªä¸åŒçš„RunTimeä¸­äº’ç›¸è°ƒç”¨ï¼Œåˆ™å¿…ç„¶æœ‰é¢å¤–å¼€é”€ã€‚ ä¸¾ä¸ªğŸŒ°ï¼Œç”±äºJavaæœ‰GCï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰ï¼Œåœ¨Javaä¸­çš„ä¸€ä¸ªå¯¹è±¡åœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œæœ‰å¯èƒ½è¢«GCæŒªåŠ¨äº†ã€‚å³åœ¨ARTç¯å¢ƒä¸­è·‘çš„æœºå™¨ç ä¸­çš„å¯¹è±¡çš„åœ°å€ä¸å›ºå®šã€‚å¯æ˜¯Cè¯­è¨€å“ªç®¡é‚£ä¹ˆå¤šå¹ºè›¾å­ï¼ŒCå°±ç›´æ¥é—®Javaè¦ä¸€ä¸ªå¯¹è±¡çš„åœ°å€ï¼Œä½†ä¸‡ä¸€è¿™ä¸ªå¯¹è±¡åœ°å€è¢«æŒªåŠ¨äº†ï¼Œé‚£å°±å®Œè›‹äº†ã€‚è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼šï¼ˆæ­¤å¤„å‚è€ƒçŸ¥ä¹@å¼ é“åœ¨åä¸ºå…¬å¸ƒçš„æ–¹èˆŸç¼–è¯‘å™¨åˆ°åº•å¯¹å®‰å“è½¯ä»¶ç”Ÿæ€ä¼šæœ‰å¤šå¤§å½±å“ï¼Ÿä¸­çš„å›ç­”ï¼‰https://www.zhihu.com/question/319688949 æŠŠè¿™ä¸ªå¯¹è±¡åœ¨Cé‡Œå†æ‹·ä¸€ä»½ã€‚å¾ˆæ˜æ˜¾è¿™é€ æˆäº†å¾ˆå¤§çš„å¼€é”€ã€‚ å‘Šè¯‰ARTï¼Œæˆ‘è¦ç”¨è¿™ä¸ªå¯¹è±¡äº†ï¼ŒGCè¿™ä¸ªå¯¹è±¡çš„åœ°å€ä½ ä¸èƒ½åŠ¨ï¼ä½ å…ˆä¸€è¾¹å‘†ç€å»ã€‚è¿™æ ·ç›¸å¯¹è€Œè¨€å¼€é”€å€’æ˜¯å°äº†ï¼Œä½†å¦‚æœè¿™ä¸ªåœ°å€å¦‚æœä¸€ç›´ä¸èƒ½è¢«å›æ”¶çš„è¯ï¼Œå¯èƒ½é€ æˆOOMã€‚ å­—èŠ‚ç çš„ç¼–è¯‘æ¨¡æ¿â€”â€”æœªé’ˆå¯¹å…·ä½“APPè¿›è¡Œä¼˜åŒ– æˆ‘ä»¬ä¸¾ä¸ªğŸŒ°æ¥ç†è§£ç¼–è¯‘æ¨¡ç‰ˆï¼Œâ€œHello worldâ€å¯ä»¥è¢«ç¿»è¯‘ä¸ºâ€œä½ å¥½ï¼Œä¸–ç•Œâ€ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è¢«ç¿»è¯‘ä¸ºâ€œä¸–ç•Œï¼Œä½ å¥½â€ï¼Œè¿™ä¸ªå·®åˆ«å°±æ˜¯ç¼–è¯‘æ¨¡ç‰ˆä¸åŒå¯¼è‡´çš„ï¼Œ ç»Ÿä¸€çš„ç¼–è¯‘æ¨¡ç‰ˆï¼ˆvmæ¨¡ç‰ˆï¼‰ å­—èŠ‚ç å¯ä»¥é€šè¿‡ä¸åŒçš„ç¼–è¯‘æ¨¡ç‰ˆè¢«ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œè€Œç¼–è¯‘æ¨¡ç‰ˆçš„ä¸åŒå°†ç›´æ¥å¯¼è‡´ç¼–è¯‘å®Œåçš„æœºå™¨ç æ€§èƒ½å¤§ç›¸å¾„åº­ã€‚ image åœ¨å®‰å“ä¸­ï¼ŒARTæœ‰ä¸€å¥—è§„å®šçš„ï¼Œç»Ÿä¸€çš„ç¼–è¯‘æ¨¡ç‰ˆï¼Œæš‚ä¸”ç§°ä¸ºVMæ¨¡ç‰ˆï¼Œè¿™å¥—æ¨¡ç‰ˆè™½ç®—ä¸ä¸Šå·®åŠ²ï¼Œä½†ä¹Ÿç®—ä¸ä¸Šä¼˜ç§€ã€‚ å› ä¸ºå®ƒæ˜¯è°·æ­Œçˆ¸çˆ¸æå‡ºæ¥çš„ï¼Œè‚¯å®šç®—ä¸ä¸Šå·®åŠ²ï¼Œä½†ç”±äºæ²¡æœ‰é’ˆå¯¹æ¯ä¸€ä¸ªAPPè¿›è¡Œç‰¹å®šçš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ä¹Ÿç®—ä¸ä¸Šä¼˜ç§€ã€‚ vmæ¨¡ç‰ˆå­˜åœ¨çš„é—®é¢˜ é—®é¢˜å°±å­˜åœ¨äºæ²¡æœ‰é’ˆå¯¹æ¯ä¸€ä¸ªAPPè¿›è¡Œä¼˜åŒ–ã€‚ åœ¨ä¸Šæ–‡è°·æ­Œå¯¹äºAndroid2.2çš„è™šæ‹Ÿæœºä¼˜åŒ–ä¸­å·²ç»è®²åˆ°è¿‡ï¼Œé‚£æ—¶å€™è°·æ­Œä½¿ç”¨JITå°†ç”¨æˆ·å¸¸ç”¨çš„åŠŸèƒ½è®°ä¸‹æ¥(çƒ­ç‚¹ä»£ç )ï¼Œå½“ç”¨æˆ·æ‰“å¼€APPçš„æ—¶å€™ç«‹é©¬å°†è¿™äº›å†…å®¹ç¼–è¯‘å‡ºæ¥ï¼Œå³ä¼˜å…ˆç¼–è¯‘çƒ­ç‚¹ä»£ç ã€‚ ä½†æ˜¯åˆ°äº†Android7.0çš„æ··åˆç¼–è¯‘æ—¶ä»£ï¼Œç”±äºAOTçš„å­˜åœ¨ï¼Œè¿™ä¸ªåŠŸèƒ½è¢«å¼±åŒ–äº†ï¼Œè¿™æ—¶JITè®°å½•ä¸‹çš„çƒ­ç‚¹ä»£ç å¹¶éæ˜¯æŒä¹…åŒ–çš„ã€‚AOTçš„ç¼–è¯‘ä¼˜å…ˆçº§éµå¾ªäºvmæ¨¡ç‰ˆï¼ŒAOTæ ¹æ®æ¨¡æ¿çš„å†…å®¹å°†ä¸€äº›å­—èŠ‚ç ä¼˜å…ˆç¼–è¯‘ä¸ºæœºå™¨ç ã€‚ é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ã€‚å…ˆä¸¾ä¸ªğŸŒ°ï¼Œä¸€å®¶ä¸­é¤é¦†çš„æ‹›ç‰Œèœæ˜¯ç•ªèŒ„ç‚’è›‹ï¼Œé‚£ä¹ˆç•ªèŒ„ç‚’è›‹çš„å¤‡èœè‚¯å®šå¾ˆè¶³ï¼Œä½†æ˜¯é¡¾å®¢Aç‰¹ç«‹ç‹¬è¡Œï¼Œä»–ååä¸è¦åƒç•ªèŒ„ç‚’è›‹ï¼Œä»–æ¯æ¬¡éƒ½ç‚¹ä¸€ä¸ªå†·é—¨çš„ç‰›æ’å¥—é¤ï¼Œé‚£è¿™æ—¶å€™åªèƒ½è®©é¡¾å®¢ç­‰ç€è€æ¿å°†ç‰›æ’å¥—é¤åšå®Œã€‚ å¦‚æœä¸€ä¸ªAPPçš„çƒ­ç‚¹ä»£ç ï¼ˆå¦‚é¦–é¡µï¼‰ï¼Œåˆšå¥½æ¸¸ç¦»äºVMæ¨¡æ¿ä¹‹å¤–ï¼Œé‚£ä¹ˆAOTå°±å…¶å®å½¢åŒè™šè®¾äº†ã€‚(æ¯”å¦‚vmæ¨¡ç‰ˆä¼˜å…ˆç¼–è¯‘åç§°ä¸å¤§äº15ä¸ªå­—ç¬¦çš„ç±»å’Œæ–¹æ³•ï¼Œä½†æ˜¯é¦–é¡µçš„ç±»ååˆšå¥½é«˜äº15ä¸ªå­—ç¬¦ã€‚æ­¤å¤„ä»…ä¸ºä¸¾ä¾‹å¹¶æ²¡æœ‰å®é™…è®ºè¯è¿‡ï¼‰ ä¸‹é¢ç”¨é¦–é¡µå’Œè®¾ç½®é¡µæ¥ä¸¾ä¾‹ï¼šç”±äºéµå¾ªvmæ¨¡ç‰ˆï¼ŒAOTå› ä¸ºæŸä¸ªåŸå› æ²¡æœ‰ä¼˜å…ˆç¼–è¯‘é¦–é¡µéƒ¨åˆ†ä»£ç ï¼Œè€Œè½¬è€Œå»ç¼–è¯‘äº†ä¸å¤ªé‡è¦çš„è®¾ç½®é¡µä»£ç ï¼š image ä¸Šå›¾çš„æµç¨‹è¯´æ˜äº†åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒAOTç¼–è¯‘å®åˆ™ä¸èµ·ä½œç”¨ï¼Œå®Œå…¨æ˜¯é è§£é‡Šå™¨å’ŒJITåœ¨è¿›è¡Œå®æ—¶ç¼–è¯‘ï¼Œæ•´ä¸ªç¼–è¯‘æ–¹æ¡ˆé€€æ­¥åˆ°äº†Android2.2æ—¶æœŸã€‚ èªæ˜çš„ART è™½ç„¶è¿™ä¸ªé—®é¢˜å­˜åœ¨ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«ä¸¥é‡ã€‚å› ä¸ºARTå¹¶æ²¡æœ‰æˆ‘è¯´çš„é‚£ä¹ˆç¬¨ã€‚åœ¨ä¹‹ååº”ç”¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼ŒARTä¼šè®°å½•å¹¶å­¦ä¹ ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼ˆä¿å­˜çƒ­ç‚¹ä»£ç ï¼‰ï¼Œç„¶åæ›´æ–°é’ˆå¯¹å½“å‰APPçš„å®šåˆ¶åŒ–vmæ¨¡ç‰ˆï¼Œä¸æ–­çš„è¡¥å……çƒ­ç‚¹ä»£ç ï¼Œè¡¥å……å®šåˆ¶åŒ–æ¨¡ç‰ˆã€‚ è¿™æ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Ÿåœ¨æ‰‹æœºå‘å¸ƒå¤§ä¼šä¸Šçš„å®£ä¼ è¯­â€œåŸºäºç”¨æˆ·æ“ä½œä¹ æƒ¯è¿›è¡Œå­¦ä¹ ï¼ŒAPPæ‰“å¼€é€Ÿåº¦ä¸æ–­æé«˜â€çš„éƒ¨åˆ†åŸç†å°±æ˜¯è¿™ä¸ªã€‚ æœ€ç»ˆå¤§æ‹›ï¼Œä¸€åŠ³æ°¸é€¸ å…¶å®è¦ä¸€åŠ³æ°¸é€¸çš„è§£å†³è¿™ä¸ªé—®é¢˜æ€è·¯ä¹Ÿä¸éš¾ï¼šæˆ‘ä»¬åªéœ€è¦åœ¨åƒé¥­å‰è·Ÿè€æ¿æå‰é¢„å®šæƒ³åƒå•¥å°±è¡Œï¼Œè®©è€æ¿å…ˆå‡†å¤‡èµ·æ¥ï¼Œè¿™æ ·ç­‰æˆ‘ä»¬åˆ°äº†å°±ä¸ç”¨ç­‰é¤äº†ã€‚ åœ¨æœ€æ–°çš„Android9.0ç‰ˆæœ¬ä¸­ï¼Œè°·æ­Œæ¨å‡ºäº†è¿™ä¸ªç±»ä¼¼æå‰é¢„å®šçš„åŠŸèƒ½ï¼šç¼–è¯‘ç³»ç»Ÿæ”¯æŒåœ¨å…·æœ‰è“å›¾ç¼–è¯‘è§„åˆ™çš„åŸç”Ÿ Android æ¨¡å—ä¸Šä½¿ç”¨ Clang çš„é…ç½®æ–‡ä»¶å¼•å¯¼ä¼˜åŒ– (PGO)ã€‚è¯´äººè¯ï¼šè°·æ­Œå…è®¸ä½ åœ¨å¼€å‘é˜¶æ®µæ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å†…å¯æŒ‡å®šâ€œçƒ­ç‚¹ä»£ç â€ï¼Œå½“åº”ç”¨å®‰è£…å®Œåï¼ŒARTåœ¨åå°æ‚„æ‚„ç¼–è¯‘APPæ—¶ï¼Œä¼šä¼˜å…ˆç¼–è¯‘é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„â€œçƒ­ç‚¹ä»£ç â€ã€‚ è™½ç„¶è°·æ­Œæ”¯æŒï¼Œä½†æ˜¯è¿™å—æŠ€æœ¯å¯¹äºAPPå¼€å‘äººå‘˜è€Œè¨€å›½å†…èµ„æ–™è¿‡äºç¼ºä¹ï¼Œæ™®åŠé¢ä¸å¹¿ã€‚ç¬”è€…å…ˆè´´ä¸Šå®˜æ–¹é“¾æ¥ï¼Œä»¥åŠè¿™ç¯‡åšå®¢ï¼Œå…¶ä¸­ä»‹ç»çš„è¿˜æ˜¯æŒºè¯¦ç»†çš„ã€‚ï¼ˆéš”å£Xcodeé’ˆå¯¹PGOéƒ½æœ‰UIç•Œé¢äº†ï¼‰ åä¸ºæ–¹èˆŸè§£å†³æ€è·¯ é’ˆå¯¹è™šæ‹Ÿæœºé—®é¢˜ï¼Œæ–¹èˆŸè¯´ï¼šæˆ‘ä¸è¦ä½ è¿™ä¸ªçƒ‚è™šæ‹Ÿæœºäº†ï¼Œæˆ‘ä»¬è£¸å¥” é’ˆå¯¹JNIè°ƒç”¨é—®é¢˜ï¼Œæ–¹èˆŸè¯´ï¼šæˆ‘ä»¬è®©Javaåœ¨ç¼–è¯‘é˜¶æ®µè·ŸCä¸€æ ·ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¹²æ‰è™šæ‹Ÿæœºï¼Œè·Ÿ.soåº“ç›´æ¥è°ƒç”¨ï¼Œæ¯«æ— JNIå¼€é”€é—®é¢˜ é’ˆå¯¹ç¼–è¯‘æ¨¡ç‰ˆé—®é¢˜ï¼Œæ–¹èˆŸè¯´ï¼šæˆ‘ä»¬æ”¯æŒé’ˆå¯¹ä¸åŒAPPè¿›è¡Œä¸åŒçš„ç¼–è¯‘ä¼˜åŒ– æ€»ç»“ä¸€ä¸‹ï¼šæ–¹èˆŸæ”¯æŒåœ¨æ‰“åŒ…ç¼–è¯‘é˜¶æ®µé’ˆå¯¹ä¸åŒAPPè¿›è¡Œä¸åŒçš„ç¼–è¯‘ä¼˜åŒ–ï¼Œç„¶åç›´æ¥æ‰“åŒ…æˆæœºå™¨ç .apk(å¾ˆå¯èƒ½å·²ç»ä¸å«apkäº†)ï¼Œç„¶åç›´æ¥è¿è¡Œã€‚","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"ç¼–è¯‘å™¨","slug":"ç¼–è¯‘å™¨","permalink":"http://sorgs.cn/tags/ç¼–è¯‘å™¨/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-Handlerä¸­çš„IdleHandler","date":"2019-08-19T09:10:44.000Z","path":"post/14041/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8723 IdleHandler1234567891011121314/** * Callback interface for discovering when a thread is going to block * waiting for more messages. */public static interface IdleHandler &#123; /** * Called when the message queue has run out of messages and will now * wait for more. Return true to keep your idle handler active, false * to have it removed. This may be called if there are still messages * pending in the queue, but they are all scheduled to be dispatched * after the current time. */ boolean queueIdle();&#125; æ³¨é‡Šä¸­å¾ˆæ˜ç¡®åœ°æŒ‡å‡ºå½“æ¶ˆæ¯é˜Ÿåˆ—ç©ºé—²æ—¶ä¼šæ‰§è¡ŒIdleHandlerçš„queueIdle()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªbooleanå€¼ï¼Œå¦‚æœä¸ºfalseåˆ™æ‰§è¡Œå®Œæ¯•ä¹‹åç§»é™¤è¿™æ¡æ¶ˆæ¯ï¼Œå¦‚æœä¸ºtrueåˆ™ä¿ç•™ï¼Œç­‰åˆ°ä¸‹æ¬¡ç©ºé—²æ—¶ä¼šå†æ¬¡æ‰§è¡Œï¼Œä¸‹é¢çœ‹ä¸‹MessageQueueçš„next()æ–¹æ³•å¯ä»¥å‘ç°ç¡®å®æ˜¯è¿™æ · 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647Message next() &#123; ...... for (;;) &#123; ...... synchronized (this) &#123; // æ­¤å¤„ä¸ºæ­£å¸¸æ¶ˆæ¯é˜Ÿåˆ—çš„å¤„ç† ...... if (mQuitting) &#123; dispose(); return null; &#125; if (pendingIdleHandlerCount &lt; 0 &amp;&amp; (mMessages == null || now &lt; mMessages.when)) &#123; pendingIdleHandlerCount = mIdleHandlers.size(); &#125; if (pendingIdleHandlerCount &lt;= 0) &#123; // No idle handlers to run. Loop and wait some more. mBlocked = true; continue; &#125; if (mPendingIdleHandlers == null) &#123; mPendingIdleHandlers = new IdleHandler[Math.max(pendingIdleHandlerCount, 4)]; &#125; mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers); &#125; for (int i = 0; i &lt; pendingIdleHandlerCount; i++) &#123; final IdleHandler idler = mPendingIdleHandlers[i]; mPendingIdleHandlers[i] = null; // release the reference to the handler boolean keep = false; try &#123; keep = idler.queueIdle(); &#125; catch (Throwable t) &#123; Log.wtf(TAG, \"IdleHandler threw exception\", t); &#125; if (!keep) &#123; synchronized (this) &#123; mIdleHandlers.remove(idler); &#125; &#125; &#125; pendingIdleHandlerCount = 0; nextPollTimeoutMillis = 0; &#125; &#125; å¤„ç†å®ŒIdleHandleråä¼šå°†nextPollTimeoutMillisè®¾ç½®ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸é˜»å¡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“ç„¶è¦æ³¨æ„è¿™é‡Œæ‰§è¡Œçš„ä»£ç åŒæ ·ä¸èƒ½å¤ªè€—æ—¶ï¼Œå› ä¸ºå®ƒæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœå¤ªè€—æ—¶è‚¯å®šä¼šå½±å“åé¢çš„messageæ‰§è¡Œã€‚ mPendingIdleHandlerså®ƒé‡Œé¢æ”¾çš„IdleHandlerå®ä¾‹éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡ä½¿ç”¨å®Œï¼ˆè°ƒç”¨äº†queueIdleæ–¹æ³•ï¼‰ä¹‹åï¼Œéƒ½ä¼šç½®ç©ºï¼ˆmPendingIdleHandlers[i] = nullï¼‰ åœ¨ä»€ä¹ˆæ—¶å€™ç”¨åˆ°å‘¢ï¼Ÿ å°±åœ¨MessageQueueçš„nextæ–¹æ³•é‡Œé¢ã€‚ å¤§æ¦‚æµç¨‹æ˜¯è¿™æ ·çš„ï¼š å¦‚æœæœ¬æ¬¡å¾ªç¯æ‹¿åˆ°çš„Messageä¸ºç©ºï¼Œæˆ–è€…ï¼è¿™ä¸ªMessageæ˜¯ä¸€ä¸ªå»¶æ—¶çš„æ¶ˆæ¯è€Œä¸”è¿˜æ²¡åˆ°æŒ‡å®šçš„è§¦å‘æ—¶é—´ï¼Œé‚£ä¹ˆï¼Œå°±è®¤å®šå½“å‰çš„é˜Ÿåˆ—ä¸ºç©ºé—²çŠ¶æ€; æ¥ç€å°±ä¼šéå†mPendingIdleHandlersæ•°ç»„(è¿™ä¸ªæ•°ç»„é‡Œé¢çš„å…ƒç´ æ¯æ¬¡éƒ½ä¼šåˆ°mIdleHandlersä¸­å»æ‹¿)æ¥è°ƒç”¨æ¯ä¸€ä¸ªIdleHandlerå®ä¾‹çš„queueIdleæ–¹æ³•; å¦‚æœè¿™ä¸ªæ–¹æ³•è¿”å›falseçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ä¾‹å°±ä¼šä»mIdleHandlersä¸­ç§»é™¤ï¼Œä¹Ÿå°±æ˜¯å½“ä¸‹æ¬¡é˜Ÿåˆ—ç©ºé—²çš„æ—¶å€™ï¼Œä¸ä¼šç»§ç»­å›è°ƒå®ƒçš„queueIdleæ–¹æ³•äº†ã€‚ å®ƒæœ‰ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ èƒ½åŠ›å¤§æ¦‚å°±æ˜¯ä¸Šé¢è®²çš„é‚£æ ·ï¼Œé‚£ä¹ˆèƒ½åŠ›å†³å®šç”¨å¤„ï¼Œç”¨å¤„ä»æœ¬è´¨ä¸Šè®²å°±æ˜¯è¶ç€æ¶ˆæ¯é˜Ÿåˆ—ç©ºé—²çš„æ—¶å€™å¹²ç‚¹äº‹æƒ…ï¼Œå½“ç„¶å…·ä½“çš„ç”¨å¤„è¿˜æ˜¯è¦çœ‹å…·ä½“çš„å¤„ç†ã€‚ è¦ä½¿ç”¨IdleHandleråªéœ€è¦è°ƒç”¨MessageQueue#addIdleHandler(IdleHandler handler)æ–¹æ³•å³å¯1234567Looper.myQueue().addIdleHandler(new MessageQueue.IdleHandler() &#123; @Override public boolean queueIdle() &#123; //do something return false; &#125;&#125;); åˆé€‚åœºæ™¯ æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³ ä¸»çº¿ç¨‹èƒ½å¹²çš„äº‹æƒ… è¿”å›trueå’Œfalseå¸¦æ¥çš„ä¸åŒç»“æœ","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-å¯¹äºSharedPreferencesçš„ä¼˜ç¼ºç‚¹ï¼Ÿ","date":"2019-08-16T03:19:19.000Z","path":"post/42206/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8656 SharedPreferencesï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å­˜å‚¨ç±»ï¼Œç‰¹åˆ«é€‚åˆç”¨äºä¿å­˜è½¯ä»¶é…ç½®å‚æ•° ä¼˜ç‚¹ï¼š è½»é‡çº§ï¼Œä»¥é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œæ˜“äºç†è§£ é‡‡ç”¨çš„æ˜¯xmlæ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç¨‹åºå¸è½½åä¼šä¹Ÿä¼šä¸€å¹¶è¢«æ¸…é™¤ï¼Œä¸ä¼šæ®‹ç•™ä¿¡æ¯ ç¼ºç‚¹ï¼š ç”±äºæ˜¯å¯¹æ–‡ä»¶IOè¯»å–ï¼Œå› æ­¤åœ¨IOä¸Šçš„ç“¶é¢ˆæ˜¯ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºåœ¨æ¯æ¬¡è¿›è¡Œgetå’Œcommitæ—¶éƒ½è¦å°†æ•°æ®ä»å†…å­˜å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–ä»æ–‡ä»¶ä¸­è¯»å– å¤šçº¿ç¨‹åœºæ™¯ä¸‹æ•ˆç‡è¾ƒä½ï¼Œåœ¨getæ“ä½œæ—¶ï¼Œä¼šé”å®šSharedPreferenceså¯¹è±¡ï¼Œäº’æ–¥å…¶ä»–æ“ä½œï¼Œè€Œå½“putï¼Œcommitæ—¶ï¼Œåˆ™ä¼šé”å®šEditorå¯¹è±¡ï¼Œä½¿ç”¨å†™å…¥é”è¿›è¡Œäº’æ–¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•ˆç‡ä¼šé™ä½ ä¸æ”¯æŒè·¨è¿›ç¨‹é€šè®¯4.ç”±äºæ¯æ¬¡éƒ½ä¼šæŠŠæ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤ï¼Œå¦‚æœSharedPreferencesæ–‡ä»¶è¿‡å¤§ï¼Œæˆ–è€…åœ¨å…¶ä¸­çš„é”®å€¼å¯¹æ˜¯å¤§å¯¹è±¡çš„jsonæ•°æ®åˆ™ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œè¯»å–è¾ƒæ…¢æ˜¯ä¸€æ–¹é¢ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•å‘ç¨‹åºé¢‘ç¹GCï¼Œå¯¼è‡´çš„ç•Œé¢å¡é¡¿ã€‚ å»ºè®® å»ºè®®ä¸è¦å­˜å‚¨è¾ƒå¤§æ•°æ®æˆ–è€…è¾ƒå¤šæ•°æ®åˆ°SharedPreferencesä¸­ é¢‘ç¹ä¿®æ”¹çš„æ•°æ®ä¿®æ”¹åç»Ÿä¸€æäº¤ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è¿‡åé©¬ä¸Šæäº¤ åœ¨è·¨è¿›ç¨‹é€šè®¯ä¸­ä¸å»ä½¿ç”¨SharedPreferences é”®å€¼å¯¹ä¸å®œè¿‡å¤š å…³äºSharedPreference.Editorçš„apply()å’Œcommit()æ–¹æ³•å¼‚åŒ åœ¨androidstudioä¸Šcodingç»å¸¸ä¼šæç¤ºä¸€äº›è­¦å‘Šï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½äº†è§£åˆ°ä¸€äº›è‡ªå·±ä¸äº†è§£çš„å¥½çš„ç¼–ç¨‹ä¹ æƒ¯å’Œå°‘ç”¨çš„æ–¹æ³•ï¼Œæœ¬æ¬¡å‘ç°å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”¨ä¹ æƒ¯äº†SharedPreference.Editorçš„commit()æ–¹æ³•ï¼Œä½†æ˜¯åœ¨studioæç¤ºä½¿ç”¨apply()æ–¹æ³•æ›¿æ¢ï¼Œçœ‹åˆ°apply()æ–¹æ³•æœ‰ç‚¹ä¸çŸ¥æ‰€æªï¼Œå› ä¸ºæ ¹æœ¬ä¸äº†è§£è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨éšå³ç¿»é˜…androidçš„apiå’Œgoogleäº†ä¸€ä¸‹apply()å’Œcommit()ä¸¤è€…çš„åŒºåˆ«ã€‚é¦–å…ˆï¼Œä¸¤è€…éƒ½èƒ½å®ç°sharedå­˜å‚¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸¤è€…è¿˜æ˜¯æœ‰ç€ä¸€äº›ä¸åŒ ç®€ä¹¦ applyæ–¹æ³•æ˜¯å°†shareçš„ä¿®æ”¹æäº¤åˆ°å†…å­˜è€Œåå¼‚æ­¥å†™å…¥ç£ç›˜ï¼Œä½†æ˜¯commitæ˜¯ç›´æ¥å†™å…¥ç£ç›˜ï¼Œè¿™å°±é€ æˆä¸¤è€…æ€§èƒ½ä¸Šçš„å·®å¼‚ï¼ŒçŠ¹å¦‚applyä¸ç›´æ¥å†™å…¥ç£ç›˜è€Œshareæœ¬èº«æ˜¯å•ä¾‹åˆ›å»ºï¼Œapplyæ–¹æ³•ä¼šè¦†å†™ä¹‹å‰å†…å­˜ä¸­çš„å€¼ï¼Œå¼‚æ­¥å†™å…¥ç£ç›˜çš„å€¼åªæ˜¯æœ€åçš„å€¼ï¼Œè€Œcommitæ¯æ¬¡éƒ½è¦å†™å…¥ç£ç›˜ï¼Œè€Œç£ç›˜çš„å†™å…¥ç›¸å¯¹æ¥è¯´æ˜¯å¾ˆä½æ•ˆçš„ï¼Œæ‰€ä»¥applyæ–¹æ³•åœ¨é¢‘ç¹è°ƒç”¨æ—¶è¦æ¯”commitæ•ˆç‡é«˜å¾ˆå¤šã€‚ applyè™½ç„¶é«˜æ•ˆä½†æ˜¯commitä¹Ÿæœ‰ç€è‡ªå·±çš„ä¼˜åŠ¿é‚£å°±æ˜¯å®ƒå¯ä»¥è¿”å›æ¯æ¬¡æ“ä½œçš„æˆåŠŸä¸å¦çš„è¿”å›å€¼ï¼Œæ ¹æ®å®ƒæˆ‘ä»¬å°±å¯ä»¥åœ¨æ“ä½œå¤±è´¥æ—¶åšä¸€äº›è¡¥æ•‘æ“ä½œã€‚ç»¼ä¸Šï¼Œstudioæç¤ºæˆ‘ä»¬ä½¿ç”¨applyæ˜¯åœ¨æ•ˆç‡ä¸Šçš„ä¼˜åŒ–è€ƒè™‘ï¼Œä½†æ˜¯å¦‚æœä½ å¾ˆé‡è§†shareæ˜¯å¦æˆåŠŸæ“ä½œï¼Œå¹¶å¸Œæœ›åœ¨å¤±è´¥æ—¶åšç›¸åº”çš„æç¤ºæˆ–è€…è¡¥æ•‘commitè¿˜æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ stack overflow apply() was added in 2.3, it commits without returning a boolean indicating success or failure. commit() returns true if the save works, false otherwise. apply() was added as the Android dev team noticed that almost no one took notice of the return value, so apply is faster as it is asynchronous.","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Android Handlerè¿è¡Œæœºåˆ¶ä»¥åŠé—®é¢˜ç‚¹è§£ç­”","date":"2019-08-14T15:09:18.000Z","path":"post/62013/","text":"Handleræœºåˆ¶ç¬”è®°ï¼ŒåŸæ–‡åœ°å€ï¼šhttps://mp.weixin.qq.com/s/7PAMm_FPrA0P3jf0tn3yy Handler å¦‚ä½•è¿è¡ŒHandlerè§’è‰²åˆ†é… Handlerä¸­å­˜åœ¨å››ç§è§’è‰² Handler Handlerç”¨æ¥å‘Looperå‘é€æ¶ˆæ¯ï¼Œåœ¨Looperå¤„ç†åˆ°å¯¹åº”çš„æ¶ˆæ¯æ—¶ï¼ŒHandlerå†å¯¹æ¶ˆæ¯è¿›è¡Œå…·ä½“çš„å¤„ç†ã€‚ä¸Šå±‚å…³é”®APIä¸ºhandleMessage()ï¼Œç”±å­ç±»è‡ªè¡Œå®ç°å¤„ç†é€»è¾‘ã€‚ Looper Looperè¿è¡Œåœ¨ç›®æ ‡çº¿ç¨‹é‡Œï¼Œä¸æ–­ä»æ¶ˆæ¯é˜Ÿåˆ—MessageQueueè¯»å–æ¶ˆæ¯ï¼Œåˆ†é…ç»™Handlerå¤„ç†ã€‚Looperèµ·åˆ°è¿æ¥çš„ä½œç”¨ï¼Œå°†æ¥è‡ªä¸åŒæ¸ é“çš„æ¶ˆæ¯ï¼Œèšé›†åœ¨ç›®æ ‡çº¿ç¨‹é‡Œå¤„ç†ã€‚ä¹Ÿå› æ­¤Looperéœ€è¦ç¡®ä¿çº¿ç¨‹å”¯ä¸€ã€‚ MessageQueue å­˜å‚¨æ¶ˆæ¯å¯¹è±¡Messageï¼Œå½“Looperå‘MessageQueueè·å–æ¶ˆæ¯ï¼Œæˆ–Handlerå‘å…¶æ’å…¥æ•°æ®æ—¶ï¼Œå†³å®šæ¶ˆæ¯å¦‚ä½•æå–ã€å¦‚ä½•å­˜å‚¨ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒMessageQueueè¿˜ç»´æŠ¤ä¸Nativeç«¯çš„è¿æ¥ï¼Œä¹Ÿæ˜¯è§£å†³Looper.loop() é˜»å¡é—®é¢˜çš„ Java ç«¯çš„æ§åˆ¶å™¨ã€‚ Message MessageåŒ…å«å…·ä½“çš„æ¶ˆæ¯æ•°æ®ï¼Œåœ¨æˆå‘˜å˜é‡targetä¸­ä¿å­˜äº†ç”¨æ¥å‘é€æ­¤æ¶ˆæ¯çš„Handlerå¼•ç”¨ã€‚å› æ­¤åœ¨æ¶ˆæ¯è·å¾—è¿™è¡Œæ—¶æœºæ—¶ï¼Œèƒ½çŸ¥é“å…·ä½“ç”±å“ªä¸€ä¸ªHandlerå¤„ç†ã€‚æ­¤å¤–é™æ€æˆå‘˜å˜é‡sPoolï¼Œåˆ™ç»´æŠ¤äº†æ¶ˆæ¯ç¼“å­˜æ± ä»¥å¤ç”¨ã€‚ è¿è¡Œè¿‡ç¨‹ é¦–å…ˆï¼Œéœ€è¦æ„å»ºæ¶ˆæ¯å¯¹è±¡ã€‚è·å–æ¶ˆæ¯å¯¹è±¡ä»Handler.obtainMessage()ç³»åˆ—æ–¹æ³•å¯ä»¥è·å–Messageï¼Œè¿™ä¸€ç³»åˆ—çš„å‡½æ•°æä¾›äº†ç›¸åº”å¯¹åº”äºMessageå¯¹è±¡å…³é”®æˆå‘˜å˜é‡å¯¹åº”çš„å‡½æ•°å‚æ•°ï¼Œè€Œæ— è®ºä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ³•è·å–ï¼Œæœ€ç»ˆé€šè¿‡Message.obtain()è·å–å…·ä½“çš„Messageå¯¹è±¡ã€‚ 12345678910111213141516171819202122232425// ç¼“å­˜æ±  private static Message sPool; // ç¼“å­˜æ± å½“å‰å®¹é‡ private static int sPoolSize = 0; // ä¸‹ä¸€èŠ‚ç‚¹ Message next; public static Message obtain() &#123; // ç¡®ä¿åŒæ­¥ synchronized (sPoolSync) &#123; if (sPool != null) &#123; // ç¼“å­˜æ± ä¸ä¸ºç©º Message m = sPool; // ç¼“å­˜æ± æŒ‡å‘ä¸‹ä¸€ä¸ªMessageèŠ‚ç‚¹ sPool = m.next; // ä»ç¼“å­˜æ± æ‹¿åˆ°çš„Messageå¯¹è±¡ä¸ç¼“å­˜æ–­å¼€è¿æ¥ m.next = null; m.flags = 0; // clear in-use flag // ç¼“å­˜æ± å¤§å°å‡ä¸€ sPoolSize--; return m; &#125; &#125; // ç¼“å­˜æ± æ²¡æœ‰å¯ç”¨å¯¹è±¡ï¼Œè¿”å›æ–°çš„Message() return new Message(); &#125; Messageæˆå‘˜å˜é‡ä¸­å­˜åœ¨ç±»å‹ä¸ºMessageçš„nextï¼Œå¯ä»¥çœ‹å‡ºMessageä¸ºé“¾è¡¨ç»“æ„ï¼Œè€Œä¸Šé¢ä»£ç ä»ç¼“å­˜æ± é‡Œè·å–æ¶ˆæ¯å¯¹è±¡çš„è¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾æè¿°ï¼š image åˆ›å»ºå‡ºæ¶ˆæ¯ä¹‹åï¼Œé€šè¿‡Handlerå°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‘é€æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€é™ˆåˆ—ã€‚å‘é€æœ‰ä¸¤ç§ï¼š å°†Messageå¯¹è±¡å‘é€åˆ°Looperã€‚åˆ©ç”¨sendMessage() å‘é€Runnableï¼Œé€šè¿‡getPostMessage()å°†RunnableåŒ…è£…åœ¨Messageé‡Œï¼Œè¡¨ç°ä¸ºæˆå‘˜å˜é‡callback1234567private static Message getPostMessage(Runnable r) &#123; // è·å–Message Message m = Message.obtain(); // è®°ä½Runnaleï¼Œç­‰æ¶ˆæ¯è·å¾—æ‰§è¡Œæ—¶å›è°ƒ m.callback = r; return m; &#125; ä¸ç®¡å“ªç§æ–¹å¼å‘é€ï¼Œæœ€ç»ˆæ¶ˆæ¯é˜Ÿåˆ—MessageQueueåªæ¥å—åˆ°äº†æ¶ˆæ¯å¯¹è±¡Messageã€‚è€Œå°†æ¶ˆæ¯åŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ€ç»ˆé€šè¿‡enqueueMessage()åŠ å…¥ã€‚ åœ¨å°†æ¶ˆæ¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œæœ‰æ—¶éœ€è¦æä¾›å»¶è¿Ÿä¿¡æ¯delayTimeï¼Œä»¥æœŸæœªæ¥å¤šä¹…åæ‰§è¡Œï¼Œè¿™ä¸ªå€¼å­˜äº uptimeMillisã€‚ 123456789private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; // Message.target è®°ä½ Handler ä»¥æ˜ç¡®æ˜¯ç”±å“ªä¸€ä¸ªHandleræ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„ msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; // æ¶ˆæ¯å…¥é˜Ÿ return queue.enqueueMessage(msg, uptimeMillis); &#125; ä¹‹åï¼Œç­‰å¾…Looperè½®è¯¢ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚è§Looper.loop()ã€‚ 123456789101112131415161718192021222324252627public static void loop() &#123; // æ‹¿åˆ°Looper final Looper me = myLooper(); if (me == null) &#123; // æ²¡è°ƒç”¨prepareåˆå§‹åŒ–Looperï¼ŒæŠ¥é”™ throw new RuntimeException(\"No Looper; Looper.prepare() wasn't called on this thread.\"); &#125; // æ‹¿åˆ°æ¶ˆæ¯é˜Ÿåˆ— final MessageQueue queue = me.mQueue; ...... for (;;) &#123; // ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºä¸‹ä¸€ä¸ªä¿¡æ¯ Message msg = queue.next(); if (msg == null) &#123; // æ¶ˆæ¯ä¸ºç©ºï¼Œè¿”å› return; &#125; ....... try &#123; // åˆ†å‘æ¶ˆæ¯åˆ°Handler msg.target.dispatchMessage(msg); end = (slowDispatchThresholdMs == 0) ? 0 : SystemClock.uptimeMillis(); &#125; // æ¶ˆæ¯å›æ”¶ï¼Œæ”¾å…¥ç¼“å­˜æ±  msg.recycleUnchecked(); &#125; Looperä»MessageQueueé‡Œå–å‡ºMessageï¼ŒMessage.targetåˆ™æ˜¯å…·ä½“çš„Handerï¼ŒHandler.dispatchMessage()å°†è§¦å‘å…·ä½“åˆ†é…é€»è¾‘ã€‚æ­¤åï¼Œå°†Messageå›æ”¶ï¼Œæ”¾å…¥ç¼“å­˜æ± ã€‚ 123456789101112131415public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; // è¿™ä¸ªæƒ…å†µè¯´æ˜äº†æœ¬æ¬¡æ¶ˆæ¯ä¸ºRunnableï¼Œè§¦å‘Runnable.run() handleCallback(msg); &#125; else &#123; if (mCallback != null) &#123; // æŒ‡å®šäº†Handlerçš„mCallback if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; // æ™®é€šæ¶ˆæ¯å¤„ç† handleMessage(msg); &#125;&#125; Handleråˆ†é…æ¶ˆæ¯åˆ†ä¸‰ç§æƒ…å†µï¼š å¯ä»¥é€šè¿‡Handlerå‘é€Runnableæ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå› æ­¤handleCallback()å¤„ç†è¿™ç§æƒ…å†µ å¯ä»¥ç»™Handlerè®¾ç½®Callbackï¼Œå½“åˆ†é…æ¶ˆæ¯ç»™Handleræ—¶ï¼ŒCallbackå¯ä»¥ä¼˜å…ˆå¤„ç†æ­¤æ¶ˆæ¯ï¼Œå¦‚æœCallback.handleMessage()è¿”å›äº†trueï¼Œä¸å†æ‰§è¡ŒHandler.handleMessage() Handler.handleMessage()å¤„ç†å…·ä½“é€»è¾‘ å›æ”¶Messageåˆ™æ˜¯é€šè¿‡Message.recycleUnchecked()ã€‚ 123456789101112131415void recycleUnchecked() &#123; // è¿™é‡Œæ˜¯å°†Messageå„ç§å±æ€§é‡ç½®æ“ä½œ ...... synchronized (sPoolSync) &#123; if (sPoolSize &lt; MAX_POOL_SIZE) &#123; // ç¼“å­˜æ± è¿˜èƒ½è£…ä¸‹ï¼Œå›æ”¶åˆ°ç¼“å­˜æ±  // ä¸‹é¢æ“ä½œå°†æ­¤MessageåŠ å…¥åˆ°ç¼“å­˜æ± å¤´éƒ¨ next = sPool; sPool = this; sPoolSize++; &#125; &#125; &#125; é€šè¿‡ä¸Šé¢çš„åˆ†æï¼ŒHandlerçš„è¿è¡Œå¦‚ä¸‹å›¾: image Handler ä»ç¼“å­˜æ± è·å–Messageï¼Œå‘é€åˆ°MessageQueue Looperä¸æ–­ä»MessageQueueè¯»å–æ¶ˆæ¯ï¼Œé€šè¿‡Message.target.dispatchMessage()è§¦å‘Handlerå¤„ç†é€»è¾‘ å›æ”¶Messageåˆ°ç¼“å­˜æ±  Javaç«¯ä¸Nativeç«¯å»ºç«‹è¿æ¥ å®é™…ä¸Šï¼Œä¸ä»…ä»…æ˜¯Javaç«¯å­˜åœ¨Handleræœºåˆ¶ï¼Œåœ¨Nativeç«¯åŒæ ·å­˜åœ¨Handleræœºåˆ¶ã€‚ä»–ä»¬é€šè¿‡MessageQueueå»ºç«‹äº†è¿æ¥ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒLooperé€šè¿‡prepare()è¿›è¡Œåˆå§‹åŒ–ã€‚ 12345678private static void prepare(boolean quitAllowed) &#123; // ä¿è¯Looperåœ¨çº¿ç¨‹å”¯ä¸€ if (sThreadLocal.get() != null) &#123; throw new RuntimeException(\"Only one Looper may be created per thread\"); &#125; // å°†Looperæ”¾å…¥ThreadLocal sThreadLocal.set(new Looper(quitAllowed)); &#125; åœ¨å®ä¾‹åŒ–Looperæ—¶ï¼Œéœ€è¦ç¡®ä¿Looperåœ¨çº¿ç¨‹é‡Œæ˜¯å”¯ä¸€çš„ã€‚HandlerçŸ¥é“è‡ªå·±çš„å…·ä½“Looperå¯¹è±¡ï¼Œè€ŒLooperè¿è¡Œåœ¨å…·ä½“çš„çº¿ç¨‹é‡Œå¹¶åœ¨æ­¤çº¿ç¨‹é‡Œå¤„ç†æ¶ˆæ¯ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆLooperèƒ½è¾¾åˆ°åˆ‡æ¢çº¿ç¨‹çš„ç›®çš„ã€‚Looperçº¿ç¨‹å”¯ä¸€éœ€è¦ThreadLocalæ¥ç¡®ä¿ï¼ŒThreadLocalçš„åŸç†ï¼Œç®€å•æ¥è¯´Threadé‡Œæœ‰ç±»å‹ä¸ºThreadLocalMapçš„æˆå‘˜threadLocalsï¼Œé€šè¿‡ThreadLocalèƒ½å°†ç›¸åº”å¯¹è±¡æ”¾å…¥threadLocalsé‡Œé€šè¿‡K/Vå­˜å‚¨ï¼Œå¦‚æ­¤èƒ½ä¿è¯å˜é‡åœ¨çº¿ç¨‹èŒƒå›´å†…å­˜å‚¨ï¼Œå…¶ä¸­Keyä¸ºThreadLocal&lt; T &gt; ã€‚ 12345678910111213private Looper(boolean quitAllowed) &#123; // åˆå§‹åŒ–MessageQueue mQueue = new MessageQueue(quitAllowed); // è®°ä½å½“å‰çº¿ç¨‹ mThread = Thread.currentThread(); &#125; MessageQueue(boolean quitAllowed) &#123; mQuitAllowed = quitAllowed; // ä¸Nativeå»ºç«‹è¿æ¥ mPtr = nativeInit(); &#125; åœ¨MessageQueueåˆ›å»ºæ—¶ï¼Œé€šè¿‡nativeæ–¹æ³•nativeInit()ä¸Nativeç«¯å»ºç«‹äº†è¿æ¥ï¼ŒmPträ¸ºlongå‹å˜é‡ï¼Œå­˜å‚¨ä¸€ä¸ªåœ°å€ã€‚æ–¹æ³•å®ç°æ–‡ä»¶ä½äºframeworks/base/core/jni/android_os_MessageQueue.cpp 1234567891011121314151617181920212223static jlong android_os_MessageQueue_nativeInit(JNIEnv* env, jclass clazz) &#123; NativeMessageQueue* nativeMessageQueue = new NativeMessageQueue(); if (!nativeMessageQueue) &#123; jniThrowRuntimeException(env, \"Unable to allocate native queue\"); return 0; &#125; nativeMessageQueue-&gt;incStrong(env); // è¿”å›ç»™Javaå±‚çš„mPtr, NativeMessageQueueåœ°å€å€¼ return reinterpret_cast&lt;jlong&gt;(nativeMessageQueue);&#125;NativeMessageQueue::NativeMessageQueue() : mPollEnv(NULL), mPollObj(NULL), mExceptionObj(NULL) &#123; mLooper = Looper::getForThread(); // æ£€æŸ¥Looper æ˜¯å¦åˆ›å»º if (mLooper == NULL) &#123; mLooper = new Looper(false); // ç¡®ä¿Looperå”¯ä¸€ Looper::setForThread(mLooper); &#125;&#125; åœ¨Nativeç«¯åˆ›å»ºäº†NativeMessageQueueï¼ŒåŒæ ·ä¹Ÿåˆ›å»ºäº†Nativeç«¯çš„Looperã€‚åœ¨åˆ›å»ºNativeMessageQueueåï¼Œå°†å®ƒçš„åœ°å€å€¼è¿”å›ç»™äº†Javaå±‚MessageQueue.mPtrã€‚å®é™…ä¸Šï¼ŒNativeç«¯Looperå®ä¾‹åŒ–æ—¶åšäº†æ›´å¤šäº‹æƒ…ã€‚Nativç«¯Looperæ–‡ä»¶ä½äºsystem/core/libutils/Looper.cppã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546Looper::Looper(bool allowNonCallbacks) : mAllowNonCallbacks(allowNonCallbacks), mSendingMessage(false), mPolling(false), mEpollFd(-1), mEpollRebuildRequired(false), mNextRequestSeq(0), mResponseIndex(0), mNextMessageUptime(LLONG_MAX) &#123; // æ·»åŠ åˆ°epollçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œçº¿ç¨‹å”¤é†’äº‹ä»¶çš„fd mWakeEventFd = eventfd(0, EFD_NONBLOCK | EFD_CLOEXEC); LOG_ALWAYS_FATAL_IF(mWakeEventFd &lt; 0, \"Could not make wake event fd: %s\", strerror(errno)); AutoMutex _l(mLock); rebuildEpollLocked();&#125;void Looper::rebuildEpollLocked() &#123; ..... // Allocate the new epoll instance and register the wake pipe. // åˆ›å»ºepolleå®ä¾‹ï¼Œå¹¶æ³¨å†Œwakeç®¡é“ mEpollFd = epoll_create(EPOLL_SIZE_HINT); LOG_ALWAYS_FATAL_IF(mEpollFd &lt; 0, \"Could not create epoll instance: %s\", strerror(errno)); struct epoll_event eventItem; // æ¸…ç©ºï¼ŒæŠŠæœªä½¿ç”¨çš„æ•°æ®åŒºåŸŸè¿›è¡Œç½®0æ“ä½œ memset(&amp; eventItem, 0, sizeof(epoll_event)); // zero out unused members of data field union // ç›‘å¬å¯è¯»äº‹ä»¶ eventItem.events = EPOLLIN; // è®¾ç½®ä½œä¸ºå”¤é†’è¯„åˆ¤çš„fd eventItem.data.fd = mWakeEventFd; // å°†å”¤é†’äº‹ä»¶ï¼ˆmWakeEventFdï¼‰æ·»åŠ åˆ°epollå®ä¾‹ï¼Œæ„ä¸ºæ”¾ç½®ä¸€ä¸ªå”¤é†’æœºåˆ¶ int result = epoll_ctl(mEpollFd, EPOLL_CTL_ADD, mWakeEventFd, &amp; eventItem); LOG_ALWAYS_FATAL_IF(result != 0, \"Could not add wake event fd to epoll instance: %s\", strerror(errno)); // æ·»åŠ å„ç§äº‹ä»¶çš„fdåˆ°epollå®ä¾‹ï¼Œå¦‚é”®ç›˜ã€ä¼ æ„Ÿå™¨è¾“å…¥ç­‰ for (size_t i = 0; i &lt; mRequests.size(); i++) &#123; const Request&amp; request = mRequests.valueAt(i); struct epoll_event eventItem; request.initEventItem(&amp;eventItem); int epollResult = epoll_ctl(mEpollFd, EPOLL_CTL_ADD, request.fd, &amp; eventItem); if (epollResult &lt; 0) &#123; ALOGE(\"Error adding epoll events for fd %d while rebuilding epoll set: %s\", request.fd, strerror(errno)); &#125; &#125;&#125; å¦‚ä½•ç†è§£epollæœºåˆ¶ï¼Ÿ æ–‡ä»¶ã€socketã€pipe(ç®¡é“)ç­‰å¯ä»¥è¿›è¡ŒI/Oæ“ä½œçš„å¯¹è±¡å¯ä»¥è§†ä¸ºæµã€‚æ—¢ç„¶æ˜¯I/Oæ“ä½œï¼Œåˆ™æœ‰readç«¯è¯»å…¥æ•°æ®ï¼Œæœ‰writeç«¯å†™å…¥æ•°æ®ã€‚ä½†æ˜¯ä¸¤ç«¯å¹¶ä¸çŸ¥é“å¯¹æ–¹è¿›è¡Œæ“ä½œçš„æ—¶æœºã€‚è€Œepollåˆ™èƒ½è§‚å¯Ÿåˆ°å“ªä¸ªæµå‘ç”Ÿäº†äº†I/Oäº‹ä»¶ï¼Œå¹¶è¿›è¡Œé€šçŸ¥ã€‚ è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¥½æ¯”ä½ åœ¨ç­‰å¿«é€’ï¼Œä½†ä½ ä¸çŸ¥é“å¿«é€’ä»€ä¹ˆæ—¶å€™æ¥ï¼Œé‚£è¿™æ—¶ä½ å¯ä»¥å»ç¡è§‰ï¼Œå› ä¸ºä½ çŸ¥é“å¿«é€’é€æ¥æ—¶ä¸€å®šä¼šæ‰“ä¸ªç”µè¯å«é†’ä½ ï¼Œè®©ä½ æ‹¿å¿«é€’ï¼Œæ¥ç€åšä½ æƒ³çš„äº‹æƒ…ã€‚ epollæœ‰æ•ˆåœ°é™ä½äº†CPUçš„ä½¿ç”¨ï¼Œåœ¨çº¿ç¨‹ç©ºé—´æ—¶ä»¤å…¶ä¼‘çœ ï¼Œç­‰æœ‰äº‹ä»¶åˆ°æ¥æ—¶å†è®²å®ƒå”¤é†’ã€‚ åœ¨çŸ¥é“äº†epollä¹‹åï¼Œå†æ¥çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå°±å¯ä»¥ç†è§£äº†ã€‚åœ¨Nativeç«¯åˆ›å»ºLooperæ—¶ï¼Œä¼šåˆ›å»ºç”¨æ¥å”¤é†’çº¿ç¨‹çš„fd â€”â€” mWakeEventFdï¼Œåˆ›å»ºepollå®ä¾‹å¹¶æ³¨å†Œç®¡é“ï¼Œæ¸…ç©ºç®¡é“æ•°æ®ï¼Œç›‘å¬å¯è¯»äº‹ä»¶ã€‚å½“æœ‰æ•°æ®å†™å…¥mWakeEventFdæè¿°çš„æ–‡ä»¶æ—¶ï¼Œepollèƒ½ç›‘å¬åˆ°æ­¤äº‹ä»¶ï¼Œå¹¶é€šçŸ¥å°†ç›®æ ‡çº¿ç¨‹å”¤é†’ã€‚ åœ¨Javaç«¯MessageQueue.mPrtå­˜å‚¨äº†Nativeç«¯NativeMassageQueueçš„åœ°å€ï¼Œå¯ä»¥åˆ©ç”¨NativeMassageQueueäº«ç”¨æ­¤æœºåˆ¶ã€‚ å‘é€æ•°æ®çš„å…·ä½“è¿‡ç¨‹ Handlerå‘é€æ¶ˆæ¯æ—¶ï¼Œæœ€ç»ˆé€šè¿‡MessageQueue.enqueueMessageå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥æ¶ˆæ¯ï¼Œä¸‹é¢ä¸ºå…·ä½“ä»£ç : 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051boolean enqueueMessage(Message msg, long when) &#123; ...... synchronized (this) &#123; ...... // è®°å½•æ¶ˆæ¯å¤„ç†çš„æ—¶é—´ msg.when = when; Message p = mMessages; // å”¤é†’çº¿ç¨‹çš„æ ‡å¿—ä½ boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; // è¿™é‡Œä¸‰ç§æƒ…å†µï¼š // 1ã€ç›®æ ‡æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç©ºé˜Ÿåˆ— // 2ã€æ’å…¥çš„æ¶ˆæ¯å¤„ç†æ—¶é—´ç­‰äº0 // 3ã€æ’å…¥çš„æ¶ˆæ¯å¤„ç†æ—¶é—´å°äºä¿å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—å¤´çš„æ¶ˆæ¯å¤„ç†æ—¶é—´ // è¿™ä¸‰ç§æƒ…å†µéƒ½æ’å…¥åˆ—è¡¨å¤´ msg.next = p; mMessages = msg; // mBlocked è¡¨ç¤ºå½“å‰çº¿ç¨‹æ˜¯å¦ç¡çœ  needWake = mBlocked; &#125; else &#123; // è¿™é‡Œåˆ™è¯´æ˜æ¶ˆæ¯å¤„ç†æ—¶é—´å¤§äºæ¶ˆæ¯åˆ—è¡¨å¤´çš„å¤„ç†æ—¶é—´ï¼Œå› æ­¤éœ€è¦æ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½® needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; // è¿™é‡Œçš„å¾ªç¯æ˜¯æ‰¾åˆ°æ¶ˆæ¯çš„æ’å…¥ä½ç½® for (;;) &#123; prev = p; p = p.next; // åˆ°é“¾è¡¨å°¾ï¼Œæˆ–å¤„ç†æ—¶é—´æ—©äºpçš„æ—¶é—´ if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; // å¦‚æœæ’å…¥çš„æ¶ˆæ¯åœ¨ç›®æ ‡é˜Ÿåˆ—ä¸­é—´ï¼Œæ˜¯ä¸éœ€è¦æ£€æŸ¥æ”¹å˜çº¿ç¨‹å”¤é†’çŠ¶æ€çš„ needWake = false; &#125; &#125; // æ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ— msg.next = p; prev.next = msg; &#125; if (needWake) &#123; // å”¤é†’çº¿ç¨‹ nativeWake(mPtr); &#125; &#125; return true; &#125; æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ä¹Ÿæ˜¯ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ï¼Œå­˜å‚¨é¡ºåºåˆ™æŒ‰ç…§å¤„ç†çš„æ—¶é—´é¡ºåºã€‚é‚£ä¹ˆåœ¨å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ’å…¥æ•°æ®æ—¶ï¼Œå­˜åœ¨å››ç§æƒ…å†µï¼š ç›®æ ‡æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç©ºé˜Ÿåˆ— æ’å…¥çš„æ¶ˆæ¯å¤„ç†æ—¶é—´ç­‰äº0 æ’å…¥çš„æ¶ˆæ¯å¤„ç†æ—¶é—´å°äºä¿å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—å¤´çš„æ¶ˆæ¯å¤„ç†æ—¶é—´ æ’å…¥çš„æ¶ˆæ¯å¤„ç†æ—¶é—´å¤§äºæ¶ˆæ¯é˜Ÿåˆ—å¤´çš„æ¶ˆæ¯å¤„ç†æ—¶é—´ å‰ä¸‰ç§æƒ…å†µï¼Œå°†æ¶ˆæ¯æ’å…¥æ¶ˆæ¯é˜Ÿåˆ—å¤´çš„ä½ç½®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºä¸èƒ½ä¿è¯å½“å‰æ¶ˆæ¯æ˜¯å¦è¾¾åˆ°äº†å¯ä»¥å¤„ç†çš„çŠ¶æ€ï¼Œä¸”å¦‚æœæ­¤æ—¶çº¿ç¨‹æ˜¯ç¡çœ çš„ï¼Œåˆ™éœ€è¦è°ƒç”¨nativeWake()å°†å…¶çº¿ç¨‹å”¤é†’ã€‚åä¸€ç§æƒ…å†µï¼Œåˆ™éœ€è¦æ‰¾åˆ°æ¶ˆæ¯çš„æ’å…¥ä½ç½®ï¼Œå› ä¸å½±å“çº¿ç¨‹çŠ¶æ€è€Œéœ€è¦æ”¹å˜çº¿ç¨‹çŠ¶æ€ã€‚æ’å…¥æ¶ˆæ¯å¦‚å›¾: image mPträ¿å­˜äº†NativeMessageQueueçš„åœ°å€ï¼Œæ‰€ä»¥Nativeå¯ä»¥çŸ¥é“å…·ä½“æ“ä½œçš„NativeMessageQueueï¼Œå½“å‰ç”¨å®ƒæ¥å”¤é†’çº¿ç¨‹ï¼Œå®é™…è°ƒç”¨é“¾ä¸ºMessageQueue.cpp.nativeWake()åˆ°MessageQueue.cpp.wake()åˆ°Looper.cpp.wake()ã€‚ 123456789101112131415void Looper::wake() &#123;#if DEBUG_POLL_AND_WAKE ALOGD(\"%p ~ wake\", this);#endif uint64_t inc = 1; // å‘ç®¡é“å†™å…¥ä¸€ä¸ªæ–°æ•°æ®ï¼Œè¿™æ ·ç®¡é“å› ä¸ºå‘ç”Ÿäº†IOäº‹ä»¶è¢«å”¤é†’ ssize_t nWrite = TEMP_FAILURE_RETRY(write(mWakeEventFd, &amp;inc, sizeof(uint64_t))); if (nWrite != sizeof(uint64_t)) &#123; if (errno != EAGAIN) &#123; LOG_ALWAYS_FATAL(\"Could not write wake signal to fd %d: %s\", mWakeEventFd, strerror(errno)); &#125; &#125;&#125; å®ç°ä¹Ÿç®€å•ï¼Œå‘mWakeEventFdæ–‡ä»¶é‡Œå†™å…¥ä¸€ä¸ªæ•°æ®ï¼Œæ ¹æ®epollæœºåˆ¶ç›‘å¬åˆ°æ­¤æ¬¡I/Oäº‹ä»¶ï¼Œå°†çº¿ç¨‹å”¤é†’ã€‚ æ¶ˆæ¯è¯»å– Looperä¸æ–­ä»MessageQueueè¯»å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡MessageQueue.next()è¿›è¡Œè¯»å–ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110Message next() &#123; final long ptr = mPtr; if (ptr == 0) &#123; // è·å–NativeMessageQueueåœ°å€å¤±è´¥ï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨epollæœºåˆ¶ return null; &#125; // ç”¨æ¥ä¿å­˜æ³¨å†Œåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ç©ºé—²æ¶ˆæ¯å¤„ç†å™¨ï¼ˆIdleHandlerï¼‰çš„ä¸ªæ•° int pendingIdleHandlerCount = -1; // å¦‚æœè¿™ä¸ªå˜é‡ç­‰äº0ï¼Œè¡¨ç¤ºå³ä¾¿æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ–°çš„æ¶ˆæ¯éœ€è¦å¤„ç†ï¼Œå½“å‰ // çº¿ç¨‹ä¹Ÿä¸è¦è¿›å…¥ç¡çœ ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå€¼ç­‰äº-1ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ–°çš„æ¶ˆæ¯ // éœ€è¦å¤„ç†æ—¶ï¼Œå½“å‰çº¿ç¨‹éœ€è¦æ— é™åœ°å¤„äºä¼‘çœ ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å®ƒè¢«å…¶å®ƒçº¿ç¨‹å”¤é†’ä¸ºæ­¢ int nextPollTimeoutMillis = 0; for (;;) &#123; ...... // æ£€æŸ¥å½“å‰çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯éœ€è¦å¤„ç†ï¼Œå°è¯•è¿›å…¥ä¼‘çœ  nativePollOnce(ptr, nextPollTimeoutMillis); synchronized (this) &#123; // å½“å‰æ—¶é—´ final long now = SystemClock.uptimeMillis(); Message prevMsg = null; // mMessages è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦å¤„ç†çš„æ¶ˆæ¯ Message msg = mMessages; if (msg != null &amp;&amp; msg.target == null) &#123; // æ‰¾åˆ°æœ‰æ•ˆçš„Message do &#123; prevMsg = msg; msg = msg.next; &#125; while (msg != null &amp;&amp; !msg.isAsynchronous()); &#125; if (msg != null) &#123; /** * æ£€æŸ¥å½“å‰æ—¶é—´å’Œæ¶ˆæ¯è¦è¢«å¤„ç†çš„æ—¶é—´ï¼Œå¦‚æœå°äºå½“å‰æ—¶é—´ï¼Œè¯´æ˜é©¬ä¸Šè¦è¿›è¡Œå¤„ç† */ if (now &lt; msg.when) &#123; // è¿˜æ²¡è¾¾åˆ°ä¸‹ä¸€ä¸ªæ¶ˆæ¯éœ€è¦è¢«å¤„ç†çš„æ—¶é—´ï¼Œè®¡ç®—éœ€è¦ä¼‘çœ çš„æ—¶é—´ nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE); &#125; else &#123; // æœ‰æ¶ˆæ¯éœ€è¦å¤„ç† // ä¸è¦è¿›å…¥ä¼‘çœ  mBlocked = false; if (prevMsg != null) &#123; prevMsg.next = msg.next; &#125; else &#123; // æŒ‡å‘ä¸‹ä¸€ä¸ªéœ€è¦å¤„ç†çš„æ¶ˆæ¯ mMessages = msg.next; &#125; msg.next = null; if (DEBUG) Log.v(TAG, \"Returning message: \" + msg); msg.markInUse(); return msg; &#125; &#125; else &#123; // æ²¡æœ‰æ›´å¤šæ¶ˆæ¯ï¼Œä¼‘çœ æ—¶é—´æ— é™ nextPollTimeoutMillis = -1; &#125; ...... if (pendingIdleHandlerCount &lt; 0 &amp;&amp; (mMessages == null || now &lt; mMessages.when)) &#123; // è·å–IdleHandleræ•° pendingIdleHandlerCount = mIdleHandlers.size(); &#125; if (pendingIdleHandlerCount &lt;= 0) &#123; // æ²¡æœ‰IdleHandleréœ€è¦å¤„ç†ï¼Œå¯ç›´æ¥è¿›å…¥ä¼‘çœ  mBlocked = true; continue; &#125; if (mPendingIdleHandlers == null) &#123; mPendingIdleHandlers = new IdleHandler[Math.max(pendingIdleHandlerCount, 4)]; &#125; mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers); &#125; // å¦‚æœæ²¡æœ‰æ›´å¤šè¦è¿›è¡Œå¤„ç†çš„æ¶ˆæ¯ï¼Œåœ¨ä¼‘çœ ä¹‹å‰ï¼Œå‘é€çº¿ç¨‹ç©ºé—²æ¶ˆæ¯ç»™å·²æ³¨å†Œåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„IdleHandlerå¯¹è±¡æ¥å¤„ç† for (int i = 0; i &lt; pendingIdleHandlerCount; i++) &#123; final IdleHandler idler = mPendingIdleHandlers[i]; mPendingIdleHandlers[i] = null; // release the reference to the handler boolean keep = false; try &#123; // å¤„ç†å¯¹åº”é€»è¾‘ï¼Œå¹¶ç”±è‡ªå·±å†³å®šæ˜¯å¦ä¿æŒæ¿€æ´»çŠ¶æ€ keep = idler.queueIdle(); &#125; catch (Throwable t) &#123; Log.wtf(TAG, \"IdleHandler threw exception\", t); &#125; if (!keep) &#123; // ä¸éœ€è¦å­˜æ´»ï¼Œç§»é™¤ synchronized (this) &#123; mIdleHandlers.remove(idler); &#125; &#125; &#125; // é‡ç½®IdleHandleræ•°é‡ pendingIdleHandlerCount = 0; /** * è¿™é‡Œç½®0ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡å¾ªç¯ä¸èƒ½é©¬ä¸Šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œå› ä¸ºIdleHandleråœ¨å¤„ç†äº‹ä»¶çš„æ—¶é—´é‡Œï¼Œ * æœ‰å¯èƒ½æœ‰æ–°çš„æ¶ˆæ¯å‘é€æ¥è¿‡æ¥ï¼Œéœ€è¦é‡æ–°æ£€æŸ¥ã€‚ */ nextPollTimeoutMillis = 0; &#125; &#125; åˆ†ä¸ºä¸¤ç§æƒ…å†µå¤„ç†ï¼š å–åˆ°æ¶ˆæ¯Messageæ—¶: éœ€è¦æŸ¥çœ‹å½“å‰æ—¶é—´æ˜¯å¦è¾¾åˆ°äº†Messageå¤„ç†çš„æ—¶é—´ï¼Œå¦‚æœè¾¾åˆ°äº†åˆ™è¿”å›ï¼Œæ”¹å˜mMessagesæŒ‡å‘ä¸‹ä¸€æ¶ˆæ¯ã€‚å¦‚æœæ²¡è¾¾åˆ°ï¼Œåˆ™è®¡ç®—è¦è¾¾åˆ°å¤„ç†çš„æ—¶é—´ï¼Œè¿˜éœ€è¦ä¼‘çœ å¤šä¹…ï¼Œå¹¶è¿›è¡Œä¼‘çœ ã€‚ æ²¡æœ‰æ›´å¤šMessageæ—¶: å½“æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œåˆ™ä¼šæ£€æŸ¥æ˜¯å¦æœ‰IdleHandleréœ€è¦å¤„ç†ã€‚åœ¨Handleræœºåˆ¶é‡Œï¼Œå…è®¸æ·»åŠ ä¸€äº›äº‹ä»¶ï¼Œåœ¨çº¿ç¨‹ç©ºé—²æ—¶è¿›è¡Œå¤„ç†ï¼Œè¡¨ç°ä¸ºIdleHandlerï¼Œå¯ä»¥é€šè¿‡MessageQueue.addIdleHandleræ·»åŠ ã€‚å½“æœ‰IdleHandleréœ€è¦å¤„ç†ï¼Œåˆ™åœ¨IdleHandlerå¤„ç†å®Œåï¼Œçº¿ç¨‹ä¸èƒ½é©¬ä¸Šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œåœ¨æ­¤æœŸé—´å¯èƒ½å·²æœ‰æ–°æ¶ˆæ¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéœ€è¦é‡æ–°åšæ£€æŸ¥ã€‚å¦‚æœæ²¡æœ‰IdleHandlerï¼Œåˆ™å¯ä»¥è¿›å…¥ä¼‘çœ ã€‚ çº¿ç¨‹ä¼‘çœ è°ƒç”¨é“¾ä¸ºNativeMessageQueue.nativePollOnce()åˆ°NativeMessageQueue.pollOnce()åˆ°Looper.pollOnce()åˆ°Looper.pollInner()ã€‚ 12345678910111213141516171819202122232425int Looper::pollInner(int timeoutMillis) &#123;...... // è¿™ä¸ªæ˜¯ç”¨æ¥ç›‘å¬å®ä¾‹åŒ–æ—¶åˆ›å»ºçš„epollå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦çš„IOè¯»å†™äº‹ä»¶ struct epoll_event eventItems[EPOLL_MAX_EVENTS]; // å¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œè¿›å…¥ä¼‘çœ ï¼ŒtimeoutMillisä¸ºä¼‘çœ äº‹ä»¶ int eventCount = epoll_wait(mEpollFd, eventItems, EPOLL_MAX_EVENTS, timeoutMillis); ...... /** * æ£€æµ‹æ˜¯å“ªä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†IOè¯»å†™äº‹ä»¶ */ for (int i = 0; i &lt; eventCount; i++) &#123; int fd = eventItems[i].data.fd; uint32_t epollEvents = eventItems[i].events; if (fd == mWakeEventFd) &#123; if (epollEvents &amp; EPOLLIN) &#123; // å¦‚æœæ–‡ä»¶æè¿°ç¬¦ä¸ºmWakeEventFdï¼Œå¹¶ä¸”è¯»å†™äº‹ä»¶ç±»å‹ä¸ºEPOLLINï¼Œè¯´æ˜ // å½“å‰çº¿ç¨‹æ‰€å…³è”çš„ä¸€ä¸ªç®¡é“è¢«å†™å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ® // å”¤é†’ awoken(); &#125; &#125; ...... &#125;&#125; Javaå±‚æä¾›äº†çº¿ç¨‹ä¼‘çœ æ—¶é—´timeoutMillisï¼Œé€šè¿‡epoll_wait()è®©çº¿ç¨‹è¿›è¡Œä¼‘çœ ã€‚å½“çº¿ç¨‹è¢«å”¤é†’åï¼ŒæŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœä¸ºmWakeEventFdå¹¶ä¸”ä¸ºI/Oäº‹ä»¶ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹æ‰€å…³è”çš„ä¸€ä¸ªç®¡é“è¢«å†™å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®ï¼Œé€šè¿‡awoken()å¤„ç†ã€‚å½“å‰çº¿ç¨‹å·²æ˜¯å”¤é†’çŠ¶æ€ï¼Œawoken()åˆ™æ˜¯å°†ç®¡é“ä¸­çš„æ•°æ®è¯»å‡ºè¾¾åˆ°æ¸…ç†ç›®çš„ï¼Œä½†å¹¶ä¸å…³å¿ƒæ•°æ®ä»€ä¹ˆã€‚æ ¸å¿ƒç›®çš„æ˜¯å”¤é†’çº¿ç¨‹ã€‚ æ€»ç»“ Handleræœºåˆ¶æ›´å…·ä½“çš„åŸç†å¦‚å›¾ï¼š image Looperé€šè¿‡prepare()åˆ›å»ºï¼Œå€ŸåŠ©ThreadLocalä¿è¯çº¿ç¨‹å”¯ä¸€ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œprepare()ï¼Œè°ƒç”¨Loop()ä¼šæŠ›å‡ºå¼‚å¸¸; Looperåœ¨å®ä¾‹åŒ–æ—¶åˆ›å»ºMessageQueueï¼ŒMessageQueueä¸NativeMessageQueueå»ºç«‹è¿æ¥ï¼ŒNativeMessageQueueå­˜å‚¨åœ°å€å­˜äºMessageQueue.mPtrã€‚Nativeç«¯ä¹Ÿå»ºç«‹äº†Handleræœºåˆ¶ï¼Œä½¿ç”¨epollæœºåˆ¶ã€‚Javaç«¯å€Ÿç”±NativeMessageQueueèƒ½è¾¾åˆ°ä½¿ç”¨epollæœºåˆ¶çš„ç›®çš„; ä»Messageç¼“å­˜é‡Œè·å–Messageï¼Œç¼“å­˜ä¸ºé“¾è¡¨å­˜å‚¨ï¼Œä»å¤´å‡ºå–å‡ºï¼Œå¹¶ä¸”Messageåœ¨å›æ”¶æ—¶ä¹Ÿæ˜¯æ’å…¥å¤´éƒ¨ã€‚å¦‚æœå­˜ç¼“å­˜é‡Œå–ä¸åˆ°ï¼Œåˆ™æ–°å»º; Handlerå‘MessageQueueæ’å…¥æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æ’å…¥æ¶ˆæ¯é˜Ÿåˆ—å¤´éƒ¨ï¼Œéœ€è¦å”¤é†’çº¿ç¨‹ï¼›å¦‚æœæ’å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ— éœ€æ”¹å˜çº¿ç¨‹çŠ¶æ€; Looper.loop() ä¸æ–­ä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯æ—¶ä¼šå‡ºç°ä¸¤ç§æƒ…å†µã€‚å¦‚æœå–åˆ°æ¶ˆæ¯ï¼Œä½†æ²¡è¾¾åˆ°å¤„ç†æ—¶é—´ï¼Œåˆ™è®©çº¿ç¨‹ä¼‘çœ ï¼›å¦‚æœæ²¡æœ‰æ›´å¤šæ¶ˆæ¯ï¼Œåˆ™åœ¨å¤„ç†IdleHandleräº‹åï¼Œåœ¨è€ƒè™‘è®©çº¿ç¨‹è¿›å…¥ä¼‘çœ ; Messageè¾¾åˆ°äº†å¯å¤„ç†çŠ¶æ€ï¼Œåˆ™æœ‰Handlerå¤„ç†ï¼Œå¤„ç†æ—¶è€ƒè™‘ä¸‰ç§æƒ…å†µï¼Œæ¶ˆæ¯å†…å®¹ä¸ºRunnableæ—¶ã€è®¾ç½®äº†Handle.Callbackæ—¶ã€æ™®é€šæ¶ˆæ¯æ—¶ï¼Œå¯¹åº”è°ƒç”¨ä¸ºMessage.callback.run() ã€ Callback.handleMessage()ã€Handler.handleMessage(); ä»Handleræœºåˆ¶é‡Œï¼Œepollå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå½“Handleræœºåˆ¶æ²¡æœ‰æ¶ˆæ¯è¦å¤„ç†æ—¶ï¼Œè®©çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼Œå½“Handleræœºåˆ¶æœ‰æ¶ˆæ¯è¦å¤„ç†æ—¶ï¼Œå°†çº¿ç¨‹å”¤èµ·ã€‚é€šè¿‡Nativeç«¯ç›‘å¬mWakeEventFdçš„I/Oäº‹ä»¶å®ç°ã€‚ ç–‘é—®ç‚¹Handlerå¦‚ä½•ä¿è¯è¿è¡Œåœ¨ç›®æ ‡çº¿ç¨‹ Looperåœ¨å®ä¾‹åŒ–æ—¶é€šè¿‡ThreadLocalä¿è¯çº¿ç¨‹å”¯ä¸€ã€‚Looperè¿è¡Œåœ¨ç›®æ ‡çº¿ç¨‹ä¸­ï¼Œæ¥æ”¶Handlerå‘é€çš„æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚Messageåˆ›å»ºæ—¶ä¸å…·ä½“çš„Handlerè¿›è¡Œäº†å…³è”ï¼Œå› æ­¤èƒ½çŸ¥é“ç”±å“ªä¸€ä¸ªHandlerè¿›è¡Œç›¸åº”ã€‚ Handlerå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼çš„åŸå›  Message.targetå­˜æœ‰Handlerçš„å¼•ç”¨ï¼Œä»¥çŸ¥é“è‡ªèº«ç”±å“ªä¸€ä¸ªHandleræ¥å¤„ç†ã€‚å› æ­¤ï¼Œå½“Handlerä¸ºéé™æ€å†…éƒ¨ç±»ã€æˆ–æŒæœ‰å…³é”®å¯¹è±¡çš„å…¶å®ƒè¡¨ç°å½¢å¼æ—¶ï¼ˆå¦‚Activityå¸¸è¡¨ç°ä¸ºContextï¼‰ï¼Œå°±å¼•ç”¨äº†å…¶å®ƒå¤–éƒ¨å¯¹è±¡ã€‚å½“Messageå¾—ä¸åˆ°å¤„ç†æ—¶ï¼Œè¢«HandleræŒæœ‰çš„å¤–éƒ¨å¯¹è±¡ä¼šä¸€ç›´å¤„äºå†…å­˜æ³„æ¼çŠ¶æ€ã€‚ loop()ä¸ºä»€ä¹ˆä¸ä¼šé˜»å¡ï¼ŒCPUä¸ºä»€ä¹ˆä¸ä¼šå¿™ç­‰ é€šè¿‡epollæœºåˆ¶ç›‘å¬æ–‡ä»¶I/Oæ—¶é—´ï¼Œåœ¨æœ‰Messageéœ€è¦å¤„ç†æ—¶ï¼Œå†™å…¥æ•°æ®ä»¥å”¤é†’çº¿ç¨‹ï¼›åœ¨æ²¡æœ‰Messageè¦å¤„ç†æ—¶ï¼Œè®©çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚ MessageQueueå¦‚ä½•å­˜å‚¨ ä»¥é“¾è¡¨å­˜å‚¨ï¼ŒMessageQueue.mMessagesæŒ‡å‘å¤´èŠ‚ç‚¹ã€‚ Messageå¦‚ä½•ç¼“å­˜ ä»¥é“¾è¡¨ç¼“å­˜ï¼Œå–å‡ºæ—¶ä»å¤´éƒ¨å–å‡ºï¼Œå›æ”¶æ—¶æ’å…¥å¤´éƒ¨ã€‚ ä»€ä¹ˆæ˜¯çº¿ç¨‹ç©ºé—²æ¶ˆæ¯ Handleræä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æ·»åŠ IdleHandleräº‹ä»¶ã€‚å¹¶åœ¨æ²¡æœ‰æ›´å¤šMessageè¦å¤„ç†ï¼Œè¦è¿›å…¥ä¼‘çœ å‰ï¼Œè®©IdleHandleråšå…·ä½“äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç©ºé—´æ—¶å¤„ç†çš„äº‹ä»¶ã€‚ å­çº¿ç¨‹å¦‚ä½•ä½¿ç”¨Handleræœºåˆ¶ åªè¦ä¿è¯åœ¨å­çº¿ç¨‹å…ˆæ‰§è¡ŒLooper.prepare()å†ä½¿ç”¨Looper.Loop()å³å¯ï¼Œä½†å®é™…åº”ç”¨åœºæ™¯ä¸å¤šã€‚é¡ºä¾¿æä¸€å¥ï¼Œä¸»çº¿ç¨‹åˆå§‹åŒ–Looperæ“ä½œåœ¨ActivityTread.main()é‡Œè§¦å‘ï¼Œç®€å•äº†è§£å³å¯ã€‚","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"Handler","slug":"Handler","permalink":"http://sorgs.cn/tags/Handler/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-å“ªäº› Contextè°ƒç”¨ startActivity éœ€è¦è®¾ç½®NEW_TASK","date":"2019-08-05T12:58:49.000Z","path":"post/3427/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8697ä»¥åŠnanchençš„æ–‡ç«  ä½¿ç”¨é Activity çš„ startActivity()çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æŒ‡å®šIntent.FLAG_ACTIVITY_NEW_TASKï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œç›´æ¥è¿›è¡Œæ“ä½œåˆ™ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ ä½¿ç”¨ applicationContext æ¥åš startActivity() æ“ä½œï¼Œå´æ²¡æœ‰æŒ‡å®šä»»ä½•çš„ FLAGï¼Œä½†æ˜¯ï¼Œåœ¨ 8.0 çš„æ‰‹æœºä¸Šï¼Œä½ ä¸€å®šä¼šæƒŠè®¶çš„å‘ç°ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç­‰åˆ°æ„æ–™å†…çš„å´©æºƒæ—¥å¿—ï¼Œè€Œä¸”è·³è½¬ä¹Ÿæ˜¯éå¸¸æ­£å¸¸ï¼Œè¿™ä¸ç”±å¾—å’Œæˆ‘ä»¬å°è±¡ä¸­å¿…é¡»åŠ  FLAG çš„ç»“è®ºå¤§ç›¸å¾„åº­ã€‚ç„¶åå†æ‹¿ä¸€ä¸ª 9.0 çš„æ‰‹æœºæ¥å°è¯•ï¼Œé©¬ä¸Šå°±å‡ºç°äº†ä¸Šé¢çš„å´©æºƒ 123456789101112131415161718192021222324252627282930313233343536373839404142434445//SDK 26@Overridepublic void startActivity(Intent intent, Bundle options) &#123; warnIfCallingFromSystemProcess(); // Calling start activity from outside an activity without FLAG_ACTIVITY_NEW_TASK is // generally not allowed, except if the caller specifies the task id the activity should // be launched in. if ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == 0 &amp;&amp; options != null &amp;&amp; ActivityOptions.fromBundle(options).getLaunchTaskId() == -1) &#123; throw new AndroidRuntimeException( \"Calling startActivity() from outside of an Activity \" + \" context requires the FLAG_ACTIVITY_NEW_TASK flag.\" + \" Is this really what you want?\"); &#125; mMainThread.getInstrumentation().execStartActivity( getOuterContext(), mMainThread.getApplicationThread(), null, (Activity) null, intent, -1, options);&#125;//SDK 28@Overridepublic void startActivity(Intent intent, Bundle options) &#123; warnIfCallingFromSystemProcess(); // Calling start activity from outside an activity without FLAG_ACTIVITY_NEW_TASK is // generally not allowed, except if the caller specifies the task id the activity should // be launched in. A bug was existed between N and O-MR1 which allowed this to work. We // maintain this for backwards compatibility. final int targetSdkVersion = getApplicationInfo().targetSdkVersion; if ((intent.getFlags() &amp; Intent.FLAG_ACTIVITY_NEW_TASK) == 0 &amp;&amp; (targetSdkVersion &lt; Build.VERSION_CODES.N || targetSdkVersion &gt;= Build.VERSION_CODES.P) &amp;&amp; (options == null || ActivityOptions.fromBundle(options).getLaunchTaskId() == -1)) &#123; throw new AndroidRuntimeException( \"Calling startActivity() from outside of an Activity \" + \" context requires the FLAG_ACTIVITY_NEW_TASK flag.\" + \" Is this really what you want?\"); &#125; mMainThread.getInstrumentation().execStartActivity( getOuterContext(), mMainThread.getApplicationThread(), null, (Activity) null, intent, -1, options);&#125; ä½¿ç”¨ Context.startActivity() çš„æ—¶å€™æ˜¯ä¸€å®šè¦åŠ ä¸Š FLAG_ACTIVITY_NEW_TASK çš„ï¼Œä½†æ˜¯åœ¨ Android N åˆ° O-MR1ï¼Œå³ 24~27 ä¹‹é—´å´å‡ºç°äº† bugï¼Œå³ä½¿æ²¡æœ‰åŠ ä¹Ÿä¼šæ­£ç¡®è·³è½¬ã€‚ é Activity è°ƒç”¨ startActivity() çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿™ä¸ª optionsé€šå¸¸æ˜¯ null çš„ï¼Œæ‰€ä»¥åœ¨ 24~27 ä¹‹é—´çš„æ—¶å€™ï¼Œè¯¯æŠŠåˆ¤æ–­æ¡ä»¶ options == null å†™æˆäº†options != null å¯¼è‡´è¿›ä¸å» ifï¼Œä»è€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"åˆ©ç”¨Retrofit+RxJavaç®€å•å°è£…ç½‘ç»œè¯·æ±‚åº“","date":"2019-08-01T08:13:35.000Z","path":"post/15217/","text":"ç½‘ç»œè¯·æ±‚åœ¨ç§»åŠ¨ç«¯æ˜¯æä¸ºå¸¸è§å’Œé‡è¦ï¼Œéšå¤„å¯è§ã€‚ä¸ºæ­¤ï¼Œä¸ºäº†é¿å…åˆ°å¤„ä½¿ç”¨å¢åŠ å†…å­˜å’Œæ€§èƒ½ï¼Œä»¥åŠæ–¹ä¾¿ä½¿ç”¨å’Œè§£è€¦ï¼Œè¿›è¡Œç½‘ç»œåº“çš„ç®€å•å°è£…ã€‚ ç‰¹ç‚¹ è§£è€¦ï¼šå¯¹ä¸‹é¢ä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶å’Œä¸Šå±‚ç½‘ç»œè¿›è¡Œè§£è€¦ã€‚æ–¹ä¾¿åº•å±‚å¯ä»¥æ ¹æ®ä¸šåŠ¡è¦æ±‚æ¢æ›´ç½‘ç»œè¯·æ±‚ç½‘ç»œä¹Ÿä¸å½±å“åˆ°ä¸Šå±‚ä¸šåŠ¡é€»è¾‘ã€‚ æ–¹ä¾¿ï¼šå¯¹ä½¿ç”¨çš„åœºæ™¯æä¸ºæ–¹ä¾¿ï¼Œä»…ä»…5è¡Œå·¦å³ä»£ç ï¼Œå³å¯å®Œæˆä¸€æ¬¡ç½‘ç»œè¯·æ±‚ä»¥åŠæ•°æ®å¤„ç†ã€‚ è§£æ”¾ï¼šè§£æ”¾ç¹ççš„çº¿ç¨‹åˆ‡æ¢ï¼Œé”™è¯¯å¤„ç†å’Œåˆ¤æ–­ï¼Œæ•°æ®å¤„ç†ï¼ŒJsonçš„è½¬æ¢ç­‰ï¼Œä½¿è°ƒç”¨æ–¹ä¸å¿…è€ƒè™‘ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„äº‹æƒ…ã€‚ é€æ˜ï¼šè°ƒç”¨æ–¹å¯¹è°ƒç”¨çš„å‡½æ•°ä½¿ç”¨èµ·æ¥ç®€å•ï¼Œä¾¿äºç†è§£ Retrofitç®€ä»‹ Retrofitï¼Œä¸€ä¸ªè¿œè¿‘é—»åçš„ç½‘ç»œæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±Squareå…¬å¸å¼€æºçš„ã€‚Squareå…¬å¸ï¼Œæ˜¯æˆ‘ä»¬çš„è€ç†Ÿäººäº†ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½æ˜¯ä»–å¼€æºçš„ï¼Œæ¯”å¦‚OkHttpï¼Œpicassoï¼Œleakcanaryç­‰ç­‰ã€‚ä»–ä»¬å…¬å¸çš„å¾ˆå¤šå¼€æºåº“ï¼Œå‡ ä¹å·²ç»æˆä¸ºç°åœ¨å¼€å‘Android APPçš„æ ‡é…ã€‚ ç®€å•æ¥è¯´ï¼ŒRetrofitå…¶å®æ˜¯åº•å±‚è¿˜æ˜¯ç”¨çš„OkHttpæ¥è¿›è¡Œç½‘ç»œè¯·æ±‚çš„ï¼Œåªä¸è¿‡ä»–åŒ…è£…äº†ä¸€ä¸‹ï¼Œä½¿å¾—å¼€å‘è€…åœ¨ä½¿ç”¨è®¿é—®ç½‘ç»œçš„æ—¶å€™æ›´åŠ æ–¹ä¾¿ç®€å•é«˜æ•ˆã€‚ ä¸€å¥è¯æ€»ç»“ï¼šRetrofitå°†æ¥å£åŠ¨æ€ç”Ÿæˆå®ç°ç±»ï¼Œè¯¥æ¥å£å®šä¹‰äº†è¯·æ±‚æ–¹å¼+è·¯å¾„+å‚æ•°ç­‰æ³¨è§£ï¼ŒRetrofitå¯ä»¥æ–¹ä¾¿å¾—ä»æ³¨è§£ä¸­è·å–è¿™äº›å‚æ•°ï¼Œç„¶åæ‹¼æ¥èµ·æ¥ï¼Œé€šè¿‡OkHttpè®¿é—®ç½‘ç»œã€‚ Retrofitç®€å•ä½¿ç”¨å¼•å…¥ä¾èµ– å¼•å…¥retrofit2ä»¥åŠéœ€è¦è½¬åŒ–ä½¿ç”¨çš„Gson 12implementation &apos;com.squareup.retrofit2:retrofit:2.3.0&apos;implementation &apos;com.squareup.retrofit2:converter-gson:2.3.0&apos; APIçš„interfaceæ¥å£ éœ€è¦å…ˆå®šä¹‰å‡ºæ³¨è§£çš„æ¥å£ 1234567891011interface Request &#123; companion object &#123; val HOST = \"http://42.157.129.91/\" &#125; @POST(\"user/sorgs\") fun getSorgs(@Query(\"id\") id: String): Observable&lt;ResponseData&lt;JavaBean&gt;&gt; @POST(\"user/sorgs\") fun getCallTest(@Query(\"id\") id: String): Call&lt;ResponseData&lt;JavaBean&gt;&gt;&#125; å®šä¹‰å‡ºé™æ€å­—ç¬¦ä¸²HOSTï¼Œç”¨æ¥é™å®šè¯·æ±‚çš„æœåŠ¡å™¨ï¼Œå³BaseUrl å®šä¹‰å‡ºæ¥å£æ–¹æ³•ï¼Œ@POSTç”¨äºæŒ‡å®šè¯·æ±‚çš„æ–¹å¼ï¼ŒåŒ…æ‹¬POSTï¼ŒGETç­‰ã€‚ æ–¹æ³•éœ€è¦å®šä¹‰å‡ºè¿”å›å€¼ä»¥åŠæ¥å—çš„å‚æ•° åˆ›å»ºRetrofitå®ä¾‹ é€šè¿‡æ„é€ è€…æ–¹å¼ï¼Œåˆ›å»ºå‡ºRetrofitå®ä¾‹ baseUrlå³ä¼ å…¥æœåŠ¡å™¨åœ°å€ addConverterFactoryä¸ºè½¬åŒ–å·¥å‚ï¼Œæˆ‘ä»¬éœ€è¦å°†è·å–çš„Jsonç›´æ¥é€šè¿‡Gsonè½¬åŒ–ä¸ºBeanå¯¹è±¡ 123456// åˆå§‹åŒ–Retrofitval request = Retrofit.Builder() .client(client) .baseUrl(Request.HOST) .addConverterFactory(GsonConverterFactory.create()) .build() APIæ¥å£è½¬æ¢æˆå®ä¾‹ å°†åˆšå®šä¹‰çš„interfaceæ–‡ä»¶å¼•å…¥è½¬åŒ–ä¸ºå®ä¾‹ 1val callApi = request.create(Request::class.java) è¿›è¡Œç½‘ç»œè¯·æ±‚ ç›´æ¥è°ƒç”¨interfaceå®šä¹‰çš„è¯·æ±‚æ–¹æ³•ï¼Œè°ƒç”¨enqueueæ–¹æ³•è¿›è¡Œå›è°ƒCallbackè¿”å›è¯·æ±‚æˆåŠŸä»¥åŠå¤±è´¥ 123456789callApi.getCallTest(\"1\").enqueue(object : Callback&lt;ResponseData&lt;JavaBean&gt;&gt; &#123; override fun onFailure(call: Call&lt;ResponseData&lt;JavaBean&gt;&gt;, t: Throwable) &#123; Log.e(\"sorgs\", \"btnTest3 e:$&#123;t.message&#125;\") &#125; override fun onResponse(call: Call&lt;ResponseData&lt;JavaBean&gt;&gt;, responseData: Response&lt;ResponseData&lt;JavaBean&gt;&gt;) &#123; Log.i(\"sorgs\", \"btnTest3 JavaBean:$&#123;(responseData.body()?.data as JavaBean).name&#125;\") &#125;&#125;) å°è£…ç½‘ç»œåº“ ä¸Šè¯‰ç®€å•ä½¿ç”¨ä»…ä»…æ˜¯demoå¦‚æ­¤å†™ï¼Œå¦‚æœæ”¾åˆ°å®é™…ä¸šåŠ¡ä¸­ï¼Œè¿˜éœ€è€ƒè™‘requestçš„åˆ›å»ºå•ä¾‹åŒ–ï¼Œæ—¥å¿—æ‹¦æˆªæŸ¥çœ‹ï¼Œçº¿ç¨‹åˆ‡æ¢ï¼Œæ•°æ®å¤„ç†ä»¥åŠé”™è¯¯å¤„ç† åº”ç”¨ä¾èµ–å•ä¾‹å»ºç«‹NetWorkManager é€šè¿‡å•ä¾‹æ„å»ºretrofitç­‰ 123456private var retrofit: Retrofit? = null//å•ä¾‹è·å–NetWorkManagerval instant: NetWorkManager by lazy(mode = LazyThreadSafetyMode.SYNCHRONIZED) &#123; NetWorkManager() &#125;val request: Request? by lazy(mode = LazyThreadSafetyMode.SYNCHRONIZED) &#123; retrofit?.create(Request::class.java)&#125; è¿›è¡Œåˆå§‹åŒ– 1234567891011121314151617181920212223242526/** * åˆå§‹åŒ–å¿…è¦å¯¹è±¡å’Œå‚æ•° * @param baseUrl åŸºç¡€è¿æ¥ */fun init(baseUrl: String) &#123; val logging = HttpLoggingInterceptor() logging.level = if (BuildConfig.DEBUG) &#123; HttpLoggingInterceptor.Level.BODY &#125; else &#123; HttpLoggingInterceptor.Level.NONE &#125; /* val logging2 = HttpLoggingInterceptor() logging2.level = HttpLoggingInterceptor.Level.HEADERS*/ // åˆå§‹åŒ–okhttp val client = OkHttpClient.Builder() //.addInterceptor(logging2) .addInterceptor(logging) .build() // åˆå§‹åŒ–Retrofit retrofit = Retrofit.Builder() .client(client) .baseUrl(baseUrl) .addCallAdapterFactory(RxJava2CallAdapterFactory.create()) .addConverterFactory(GsonConverterFactory.create()) .build()&#125; åœ¨åˆå§‹åŒ–æ—¶å€™ï¼Œæ„å»ºHttpLoggingInterceptorï¼Œç”¨äºæ—¥å¿—æ‹¦æˆªã€‚å¹¶åˆ©ç”¨BuildConfig.DEBUGè¿›è¡ŒåŒºåˆ†ï¼Œå› ä¸ºä¸å¸Œæœ›åœ¨æ­£å¼åŒ…é‡Œé¢ä¹Ÿæš´éœ²å‡ºè¯·æ±‚ä¿¡æ¯ æ—¥å¿—æ‹¦æˆªåˆ†ä¸ºNONEã€BASICã€HEADERSä»¥åŠBODYï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨BASICä»¥åŠBODYï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•å’ŒæŸ¥çœ‹ï¼Œä½¿ç”¨BODYæ›´åŠ æ–¹ä¾¿ã€‚ åŒæ—¶addInterceptoræ˜¯å¯ä»¥æ·»åŠ å¤šä¸ªçš„ï¼Œå¯ä»¥åŒæ—¶æŠŠBASICå’ŒBODYæ·»åŠ ä¸Šè¿›è¡Œæ‰“å°è¾“å‡ºã€‚é€šè¿‡client()æ„å»ºåˆ°retrofitä¸­ã€‚ retrofitçš„æ„é€ ï¼ŒåŒæ—¶åŠ å…¥addCallAdapterFactory(RxJava2CallAdapterFactory.create()),ç›´æ¥æŠŠRxJavaå¼•å…¥ï¼Œæ–¹ä¾¿é”™è¯¯å¤„ç†ï¼Œæ•°æ®å¤„ç†ï¼Œçº¿ç¨‹åˆ‡æ¢ç­‰ æ¥å£è¿”å›æ•°æ®å°è£… æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸¥æ ¼çš„æ ¼å¼ï¼Œåˆ†ä¸ºcodeã€msgå’Œdataã€‚çœŸå®æ•°æ®åŒ…å«åœ¨dataä¸­ï¼Œcodeå’Œmsgæ˜¯ç”¨æ¥è¿›è¡Œåˆ¤æ–­è¿™æ¬¡è¯·æ±‚çš„ç»“æœï¼Œè¿™äº›åˆ¤æ–­æˆ‘ä»¬å°±éœ€è¦åœ¨åº•å±‚ç›´æ¥å¤„ç†å¥½ï¼Œæ‰€ä»¥ç›´æ¥å°è£…èµ·æ¥ã€‚ 123456789101112131415/** * description: æ¥å£è¿”å›æ•°æ®å°è£…. * &#123;code:0,data:\"\",msg:\"\"&#125; * codeï¼šæ¥å£è¿”å›çš„code ä¸€å®šä¸èƒ½ä¸ºç©º * dataï¼šæ¥å£è¿”å›å…·ä½“çš„æ•°æ®ç»“æœ å¯èƒ½ä¸ºç©º * msgï¼šmessage å¯ç”¨æ¥è¿”å›æ¥å£çš„è¯´æ˜ å¯èƒ½ä¸ºç©º * * @author Sorgs. * Created date: 2019/7/30. */data class ResponseData&lt;T&gt;( var code: Int, var data: T?, var msg: String?) é”™è¯¯å¤„ç† é”™è¯¯å¤„ç†åˆ†ä¸ºäº†æœåŠ¡å™¨å¼‚å¸¸å’Œæœ¬åœ°å¼‚å¸¸ æœåŠ¡å™¨å¼‚å¸¸åŒ…æ‹¬404,500ç­‰ æœ¬åœ°å¼‚å¸¸æƒ…å†µæ›´å¤šï¼ŒåŒ…æ‹¬ç½‘ç»œé”™è¯¯ï¼Œè¿æ¥å¼‚å¸¸ç­‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110/** * description: éæœåŠ¡å™¨äº§ç”Ÿçš„å¼‚å¸¸ï¼Œæ¯”å¦‚æœ¬åœ°æ— æ— ç½‘ç»œè¯·æ±‚ï¼ŒJsonæ•°æ®è§£æé”™è¯¯ç­‰ç­‰. * @author Sorgs. * Created date: 2019/7/30. */class ErrorResumeFunction&lt;T&gt; : Function&lt;Throwable, ObservableSource&lt;out ResponseData&lt;T&gt;&gt;&gt; &#123; override fun apply(throwable: Throwable): ObservableSource&lt;out ResponseData&lt;T&gt;&gt; &#123; return Observable.error(CustomException.handleException(throwable)) &#125;&#125;/** * description: è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼ŒåŒ…æ‹¬è§£æå¼‚å¸¸ç­‰å…¶ä»–å¼‚å¸¸. * * @author Sorgs. * Created date: 2019/7/30. */object CustomException &#123; /** * æœªçŸ¥é”™è¯¯ */ const val UNKNOWN = 1000 /** * è§£æé”™è¯¯ */ const val PARSE_ERROR = 1001 /** * ç½‘ç»œé”™è¯¯ */ const val NETWORK_ERROR = 1002 /** * åè®®é”™è¯¯ */ const val HTTP_ERROR = 1003 fun handleException(e: Throwable): LocalException &#123; val ex: LocalException if (e is JsonParseException || e is JSONException || e is ParseException ) &#123; //è§£æé”™è¯¯ ex = LocalException(PARSE_ERROR, e.message) return ex &#125; else if (e is ConnectException) &#123; //ç½‘ç»œé”™è¯¯ ex = LocalException(NETWORK_ERROR, e.message) return ex &#125; else if (e is UnknownHostException || e is SocketTimeoutException) &#123; //è¿æ¥é”™è¯¯ ex = LocalException(NETWORK_ERROR, e.message) return ex &#125; else &#123; //æœªçŸ¥é”™è¯¯ ex = LocalException(UNKNOWN, e.message) return ex &#125; &#125;&#125;``` - æŠŠå¼‚å¸¸è¿›è¡Œå°è£…æˆè‡ªå·±çš„å¼‚å¸¸å¤„ç†ã€‚æå‰æŠŠJsonè½¬åŒ–å‡ºé”™ï¼Œç½‘ç»œé”™è¯¯ï¼Œè¿æ¥å¼‚å¸¸å¤„ç†å‡ºæ¥- å†åˆ©ç”¨ç»§æ‰¿ResponseFunctionè¿›è¡Œå¤„ç†æœåŠ¡å™¨å¼‚å¸¸å¤„ç†ï¼Œç„¶åæŠŠå¼‚å¸¸è¿›è¡Œå°è£…ã€‚æ­£ç¡®çš„æ•°æ®å‘é€åˆ°ä¸‹æ¸¸```java/** * description: æœåŠ¡å…¶è¿”å›çš„æ•°æ®è§£æ * æ­£å¸¸æœåŠ¡å™¨è¿”å›æ•°æ®å’ŒæœåŠ¡å™¨å¯èƒ½è¿”å›çš„exception. * @author Sorgs. * Created date: 2019/7/30. */class ResponseFunction&lt;T&gt; : Function&lt;ResponseData&lt;T&gt;, ObservableSource&lt;T&gt;&gt; &#123; override fun apply(tResponseData: ResponseData&lt;T&gt;): ObservableSource&lt;T&gt; &#123; val code = tResponseData.code val message = tResponseData.msg return if (code == 200) &#123; Observable.just(tResponseData.data) &#125; else &#123; Observable.error(LocalException(code, message)) &#125; &#125;&#125;/** * description: å¼‚å¸¸å¤„ç†. * * @author Sorgs. * Created date: 2019/7/30. */class LocalException : Exception &#123; var code: Int = 0 var displayMessage: String? = null constructor(code: Int, displayMessage: String?) &#123; this.code = code this.displayMessage = displayMessage &#125; constructor(code: Int, message: String, displayMessage: String?) : super(message) &#123; this.code = code this.displayMessage = displayMessage &#125;&#125; çº¿ç¨‹åˆ‡æ¢ ç½‘ç»œè¯·æ±‚æ˜¯éœ€è¦è¿›è¡Œæ”¾åˆ°å­çº¿ç¨‹è¿›è¡Œå¤„ç†é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ï¼Œç­‰å¾…ç½‘ç»œè¯·æ±‚ç»“æœå›æ¥ä¹‹åï¼Œå†è¿›è¡Œè½¬åŒ–åˆ°UIçº¿ç¨‹å¤„ç†æ•°æ® å®šä¹‰åˆ‡çº¿æ¥å£,ç„¶åè¿›è¡Œçº¿ç¨‹åˆ‡æ¢ 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * description: åˆ‡æ¢çº¿ç¨‹çš„çº¿ç¨‹å®šä¹‰ * @author Sorgs. * Created date: 2019/7/30. */interface BaseSchedulerProvider &#123; fun computation(): Scheduler fun io(): Scheduler fun ui(): Scheduler fun &lt;T&gt; applySchedulers(): ObservableTransformer&lt;T, T&gt;&#125;/** * description: å®Œæˆå¤„ç†çº¿ç¨‹åˆ‡æ¢. * @author Sorgs. * Created date: 2019/7/30. */class SchedulerProvider : BaseSchedulerProvider &#123; override fun computation(): Scheduler &#123; return Schedulers.computation() &#125; override fun io(): Scheduler &#123; return Schedulers.io() &#125; override fun ui(): Scheduler &#123; return AndroidSchedulers.mainThread() &#125; override fun &lt;T&gt; applySchedulers(): ObservableTransformer&lt;T, T&gt; &#123; return ObservableTransformer &#123; observable -&gt; observable.subscribeOn(io()).observeOn(ui()) &#125; &#125; companion object &#123; val schedulerProvider: SchedulerProvider by lazy( mode = LazyThreadSafetyMode.SYNCHRONIZED) &#123; SchedulerProvider() &#125; &#125;&#125; è°ƒç”¨æ–¹ä½¿ç”¨123456789NetWorkManager.request ?.getSorgs(\"1\") ?.compose(ResponseTransformer.handleResult()) ?.compose(SchedulerProvider.schedulerProvider.applySchedulers()) ?.subscribe(&#123; javabean -&gt; Log.i(\"sorgs\", \"btnTest1 name:$&#123;javabean?.name&#125;\") &#125;, &#123; t -&gt; Log.e(\"sorgs\", \"btnTest1 e:$&#123;(t as LocalException).displayMessage&#125;\") &#125;) ç›´æ¥åˆ©ç”¨subscribeè¿”å›å¾—åˆ°å¤„ç†æ•°æ®åçš„ç»“æœï¼Œæ‹¿åˆ°æ•°æ®ç›´æ¥è¿›è¡Œä¸šåŠ¡é€»è¾‘ä»£ç è¾¹å†™ã€‚å¯¹äºé”™è¯¯ï¼Œç›´æ¥å°†æœåŠ¡å™¨é”™è¯¯å’Œæœ¬åœ°å¼‚å¸¸éƒ½æŠ›å‡ºæ¥ï¼Œç”±è°ƒç”¨æ–¹é€‰æ‹©è¿›è¡Œå¤„ç† ç»“è¯­ å°è£…æˆåº“çš„å¥½å¤„å°±æ˜¯æ–¹ä¾¿è°ƒç”¨è€…ï¼Œåˆ©ç”¨æœ€ç®€å•çš„æ–¹å¼è¿›è¡Œå¤æ‚è€Œå¸¸ç”¨çš„æ“ä½œã€‚ åŒæ—¶å¯¹æ¥å£é€æ˜ï¼Œå¯¹å®ç°å°è£…ï¼Œå®ç°å¯¹è°ƒç”¨è€…æœ€å¤§çš„å‹å¥½ demoï¼šhttps://github.com/sorgs/Network","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"ç½‘ç»œè¯·æ±‚","slug":"ç½‘ç»œè¯·æ±‚","permalink":"http://sorgs.cn/tags/ç½‘ç»œè¯·æ±‚/"},{"name":"Retorfit","slug":"Retorfit","permalink":"http://sorgs.cn/tags/Retorfit/"},{"name":"Rxjava","slug":"Rxjava","permalink":"http://sorgs.cn/tags/Rxjava/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-Looper.loopä¸ºä»€ä¹ˆä¸ä¼šé˜»å¡æ‰UIçº¿ç¨‹ï¼Ÿ","date":"2019-07-27T09:32:03.000Z","path":"post/35154/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8685 Androidä¸­ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸ä¼šå› ä¸ºLooper.loop()é‡Œçš„æ­»å¾ªç¯å¡æ­»ï¼Ÿ è¿™é‡Œæ¶‰åŠçº¿ç¨‹ï¼Œå…ˆè¯´è¯´è¯´è¿›ç¨‹/çº¿ç¨‹ è¿›ç¨‹ï¼šæ¯ä¸ªappè¿è¡Œæ—¶å‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹æ˜¯ç”±Zygote forkå‡ºæ¥çš„ï¼Œç”¨äºæ‰¿è½½Appä¸Šè¿è¡Œçš„å„ç§Activity/Serviceç­‰ç»„ä»¶ã€‚è¿›ç¨‹å¯¹äºä¸Šå±‚åº”ç”¨æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œè¿™ä¹Ÿæ˜¯googleæœ‰æ„ä¸ºä¹‹ï¼Œè®©Appç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨Android Runtimeã€‚å¤§å¤šæ•°æƒ…å†µä¸€ä¸ªAppå°±è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œé™¤éåœ¨AndroidManifest.xmlä¸­é…ç½®Android:processå±æ€§ï¼Œæˆ–é€šè¿‡nativeä»£ç forkè¿›ç¨‹ã€‚ çº¿ç¨‹ï¼šçº¿ç¨‹å¯¹åº”ç”¨æ¥è¯´éå¸¸å¸¸è§ï¼Œæ¯”å¦‚æ¯æ¬¡new Thread().startéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚è¯¥çº¿ç¨‹ä¸Appæ‰€åœ¨è¿›ç¨‹ä¹‹é—´èµ„æºå…±äº«ï¼Œä»Linuxè§’åº¦æ¥è¯´è¿›ç¨‹ä¸çº¿ç¨‹é™¤äº†æ˜¯å¦å…±äº«èµ„æºå¤–ï¼Œå¹¶æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œéƒ½æ˜¯ä¸€ä¸ªtask_structç»“æ„ä½“ï¼Œåœ¨CPUçœ‹æ¥è¿›ç¨‹æˆ–çº¿ç¨‹æ— éå°±æ˜¯ä¸€æ®µå¯æ‰§è¡Œçš„ä»£ç ï¼ŒCPUé‡‡ç”¨CFSè°ƒåº¦ç®—æ³•ï¼Œä¿è¯æ¯ä¸ªtaskéƒ½å°½å¯èƒ½å…¬å¹³çš„äº«æœ‰CPUæ—¶é—´ç‰‡ã€‚ æœ‰äº†è¿™ä¹ˆå‡†å¤‡ï¼Œå†è¯´è¯´æ­»å¾ªç¯é—®é¢˜ï¼š å¯¹äºçº¿ç¨‹æ—¢ç„¶æ˜¯ä¸€æ®µå¯æ‰§è¡Œçš„ä»£ç ï¼Œå½“å¯æ‰§è¡Œä»£ç æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¾¿è¯¥ç»ˆæ­¢äº†ï¼Œçº¿ç¨‹é€€å‡ºã€‚è€Œå¯¹äºä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æ˜¯ç»ä¸å¸Œæœ›ä¼šè¢«è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œè‡ªå·±å°±é€€å‡ºï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯èƒ½ä¸€ç›´å­˜æ´»å‘¢ï¼Ÿç®€å•åšæ³•å°±æ˜¯å¯æ‰§è¡Œä»£ç æ˜¯èƒ½ä¸€ç›´æ‰§è¡Œä¸‹å»çš„ï¼Œæ­»å¾ªç¯ä¾¿èƒ½ä¿è¯ä¸ä¼šè¢«é€€å‡ºï¼Œä¾‹å¦‚ï¼Œbinderçº¿ç¨‹ä¹Ÿæ˜¯é‡‡ç”¨æ­»å¾ªç¯çš„æ–¹æ³•ï¼Œé€šè¿‡å¾ªç¯æ–¹å¼ä¸åŒä¸Binderé©±åŠ¨è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“ç„¶å¹¶éç®€å•åœ°æ­»å¾ªç¯ï¼Œæ— æ¶ˆæ¯æ—¶ä¼šä¼‘çœ ã€‚ä½†è¿™é‡Œå¯èƒ½åˆå¼•å‘äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶æ˜¯æ­»å¾ªç¯åˆå¦‚ä½•å»å¤„ç†å…¶ä»–äº‹åŠ¡å‘¢ï¼Ÿé€šè¿‡åˆ›å»ºæ–°çº¿ç¨‹çš„æ–¹å¼ã€‚ çœŸæ­£ä¼šå¡æ­»ä¸»çº¿ç¨‹çš„æ“ä½œæ˜¯åœ¨å›è°ƒæ–¹æ³•onCreate/onStart/onResumeç­‰æ“ä½œæ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´æ‰å¸§ï¼Œç”šè‡³å‘ç”ŸANRï¼Œlooper.loopæœ¬èº«ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­» æ²¡çœ‹è§å“ªé‡Œæœ‰ç›¸å…³ä»£ç ä¸ºè¿™ä¸ªæ­»å¾ªç¯å‡†å¤‡äº†ä¸€ä¸ªæ–°çº¿ç¨‹å»è¿è½¬ï¼Ÿ äº‹å®ä¸Šï¼Œä¼šåœ¨è¿›å…¥æ­»å¾ªç¯ä¹‹å‰ä¾¿åˆ›å»ºäº†æ–°binderçº¿ç¨‹ï¼Œåœ¨ä»£ç ActivityThread.main()ä¸­ï¼š 1234567891011121314public static void main(String[] args) &#123; .... //åˆ›å»ºLooperå’ŒMessageQueueå¯¹è±¡ï¼Œç”¨äºå¤„ç†ä¸»çº¿ç¨‹çš„æ¶ˆæ¯ Looper.prepareMainLooper(); //åˆ›å»ºActivityThreadå¯¹è±¡ ActivityThread thread = new ActivityThread(); //å»ºç«‹Binderé€šé“ (åˆ›å»ºæ–°çº¿ç¨‹) thread.attach(false); Looper.loop(); //æ¶ˆæ¯å¾ªç¯è¿è¡Œ throw new RuntimeException(\"Main thread loop unexpectedly exited\"); &#125; thread.attach(false)ï¼›ä¾¿ä¼šåˆ›å»ºä¸€ä¸ªBinderçº¿ç¨‹ï¼ˆå…·ä½“æ˜¯æŒ‡ApplicationThreadï¼ŒBinderçš„æœåŠ¡ç«¯ï¼Œç”¨äºæ¥æ”¶ç³»ç»ŸæœåŠ¡AMSå‘é€æ¥çš„äº‹ä»¶ï¼‰ï¼Œè¯¥Binderçº¿ç¨‹é€šè¿‡Handlerå°†Messageå‘é€ç»™ä¸»çº¿ç¨‹ï¼Œå…·ä½“è¿‡ç¨‹å¯æŸ¥çœ‹ startServiceæµç¨‹åˆ†æï¼Œè¿™é‡Œä¸å±•å¼€è¯´ï¼Œç®€å•è¯´Binderç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼Œé‡‡ç”¨C/Sæ¶æ„ã€‚å…³äºbinderæ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯æŸ¥çœ‹æˆ‘å›ç­”çš„å¦ä¸€ä¸ªçŸ¥ä¹é—®é¢˜ï¼šä¸ºä»€ä¹ˆAndroidè¦é‡‡ç”¨Binderä½œä¸ºIPCæœºåˆ¶ï¼Ÿ - Gityuançš„å›ç­” å¦å¤–ï¼ŒActivityThreadå®é™…ä¸Šå¹¶éçº¿ç¨‹ï¼Œä¸åƒHandlerThreadç±»ï¼ŒActivityThreadå¹¶æ²¡æœ‰çœŸæ­£ç»§æ‰¿Threadç±»ï¼Œåªæ˜¯å¾€å¾€è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œè¯¥äººä»¥çº¿ç¨‹çš„æ„Ÿè§‰ï¼Œå…¶å®æ‰¿è½½ActivityThreadçš„ä¸»çº¿ç¨‹å°±æ˜¯ç”±Zygote forkè€Œåˆ›å»ºçš„è¿›ç¨‹ã€‚ ä¸»çº¿ç¨‹çš„æ­»å¾ªç¯ä¸€ç›´è¿è¡Œæ˜¯ä¸æ˜¯ç‰¹åˆ«æ¶ˆè€—CPUèµ„æºå‘¢ï¼Ÿ å…¶å®ä¸ç„¶ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°Linux pipe/epollæœºåˆ¶ï¼Œç®€å•è¯´å°±æ˜¯åœ¨ä¸»çº¿ç¨‹çš„MessageQueueæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œä¾¿é˜»å¡åœ¨loopçš„queue.next()ä¸­çš„nativePollOnce()æ–¹æ³•é‡Œï¼Œè¯¦æƒ…è§Androidæ¶ˆæ¯æœºåˆ¶1-Handler(Javaå±‚)ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹ä¼šé‡Šæ”¾CPUèµ„æºè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°ä¸‹ä¸ªæ¶ˆæ¯åˆ°è¾¾æˆ–è€…æœ‰äº‹åŠ¡å‘ç”Ÿï¼Œé€šè¿‡å¾€pipeç®¡é“å†™ç«¯å†™å…¥æ•°æ®æ¥å”¤é†’ä¸»çº¿ç¨‹å·¥ä½œã€‚è¿™é‡Œé‡‡ç”¨çš„epollæœºåˆ¶ï¼Œæ˜¯ä¸€ç§IOå¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œå¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªæè¿°ç¬¦ï¼Œå½“æŸä¸ªæè¿°ç¬¦å°±ç»ª(è¯»æˆ–å†™å°±ç»ª)ï¼Œåˆ™ç«‹åˆ»é€šçŸ¥ç›¸åº”ç¨‹åºè¿›è¡Œè¯»æˆ–å†™æ“ä½œï¼Œæœ¬è´¨åŒæ­¥I/Oï¼Œå³è¯»å†™æ˜¯é˜»å¡çš„ã€‚ æ‰€ä»¥è¯´ï¼Œä¸»çº¿ç¨‹å¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¹¶ä¸ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºã€‚ Activityçš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€ä¹ˆå®ç°åœ¨æ­»å¾ªç¯ä½“å¤–èƒ½å¤Ÿæ‰§è¡Œèµ·æ¥çš„ï¼Ÿ ActivityThreadçš„å†…éƒ¨ç±»Hç»§æ‰¿äºHandlerï¼Œé€šè¿‡handleræ¶ˆæ¯æœºåˆ¶ï¼Œç®€å•è¯´Handleræœºåˆ¶ç”¨äºåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹é—´é€šä¿¡ã€‚ Activityçš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ä¾é ä¸»çº¿ç¨‹çš„Looper.loopï¼Œå½“æ”¶åˆ°ä¸åŒMessageæ—¶åˆ™é‡‡ç”¨ç›¸åº”æªæ–½ï¼šåœ¨H.handleMessage(msg)æ–¹æ³•ä¸­ï¼Œæ ¹æ®æ¥æ”¶åˆ°ä¸åŒçš„msgï¼Œæ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ¯”å¦‚æ”¶åˆ°msg=H.LAUNCH_ACTIVITYï¼Œåˆ™è°ƒç”¨ActivityThread.handleLaunchActivity()æ–¹æ³•ï¼Œæœ€ç»ˆä¼šé€šè¿‡åå°„æœºåˆ¶ï¼Œåˆ›å»ºActivityå®ä¾‹ï¼Œç„¶åå†æ‰§è¡ŒActivity.onCreate()ç­‰æ–¹æ³•ï¼› å†æ¯”å¦‚æ”¶åˆ°msg=H.PAUSE_ACTIVITYï¼Œåˆ™è°ƒç”¨ActivityThread.handlePauseActivity()æ–¹æ³•ï¼Œæœ€ç»ˆä¼šæ‰§è¡ŒActivity.onPause()ç­‰æ–¹æ³•ã€‚ ä¸Šè¿°è¿‡ç¨‹ï¼Œæˆ‘åªæŒ‘æ ¸å¿ƒé€»è¾‘è®²ï¼ŒçœŸæ­£è¯¥è¿‡ç¨‹è¿œæ¯”è¿™å¤æ‚ã€‚ ä¸»çº¿ç¨‹çš„æ¶ˆæ¯åˆæ˜¯å“ªæ¥çš„å‘¢ï¼Ÿå½“ç„¶æ˜¯Appè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹é€šè¿‡Handlerå‘é€ç»™ä¸»çº¿ç¨‹ï¼Œè¯·çœ‹æ¥ä¸‹æ¥çš„å†…å®¹ï¼š æœ€åï¼Œä»è¿›ç¨‹ä¸çº¿ç¨‹é—´é€šä¿¡çš„è§’åº¦ï¼Œé€šè¿‡ä¸€å¼ å›¾åŠ æ·±å¤§å®¶å¯¹Appè¿è¡Œè¿‡ç¨‹çš„ç†è§£ï¼š image system_serverè¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼Œjava frameworkæ¡†æ¶çš„æ ¸å¿ƒè½½ä½“ï¼Œé‡Œé¢è¿è¡Œäº†å¤§é‡çš„ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚è¿™é‡Œæä¾›ApplicationThreadProxyï¼ˆç®€ç§°ATPï¼‰ï¼ŒActivityManagerServiceï¼ˆç®€ç§°AMSï¼‰ï¼Œè¿™ä¸ªä¸¤ä¸ªæœåŠ¡éƒ½è¿è¡Œåœ¨system_serverè¿›ç¨‹çš„ä¸åŒçº¿ç¨‹ä¸­ï¼Œç”±äºATPå’ŒAMSéƒ½æ˜¯åŸºäºIBinderæ¥å£ï¼Œéƒ½æ˜¯binderçº¿ç¨‹ï¼Œbinderçº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯éƒ½æ˜¯ç”±binderé©±åŠ¨æ¥å†³å®šçš„ã€‚ Appè¿›ç¨‹åˆ™æ˜¯æˆ‘ä»¬å¸¸è¯´çš„åº”ç”¨ç¨‹åºï¼Œä¸»çº¿ç¨‹ä¸»è¦è´Ÿè´£Activity/Serviceç­‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠUIç›¸å…³æ“ä½œéƒ½è¿è¡Œåœ¨è¿™ä¸ªçº¿ç¨‹ï¼› å¦å¤–ï¼Œæ¯ä¸ªAppè¿›ç¨‹ä¸­è‡³å°‘ä¼šæœ‰ä¸¤ä¸ªbinderçº¿ç¨‹ ApplicationThread(ç®€ç§°AT)å’ŒActivityManagerProxyï¼ˆç®€ç§°AMPï¼‰ï¼Œé™¤äº†å›¾ä¸­ç”»çš„çº¿ç¨‹ï¼Œå…¶ä¸­è¿˜æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæ¯”å¦‚signal catcherçº¿ç¨‹ç­‰ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ã€‚ Binderç”¨äºä¸åŒè¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œç”±ä¸€ä¸ªè¿›ç¨‹çš„Binderå®¢æˆ·ç«¯å‘å¦ä¸€ä¸ªè¿›ç¨‹çš„æœåŠ¡ç«¯å‘é€äº‹åŠ¡ï¼Œæ¯”å¦‚å›¾ä¸­çº¿ç¨‹2å‘çº¿ç¨‹4å‘é€äº‹åŠ¡ï¼›è€Œhandlerç”¨äºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ä¸åŒçº¿ç¨‹çš„é€šä¿¡ï¼Œæ¯”å¦‚å›¾ä¸­çº¿ç¨‹4å‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚ ç»“åˆå›¾è¯´è¯´Activityç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚æš‚åœActivityï¼Œæµç¨‹å¦‚ä¸‹ï¼š çº¿ç¨‹1çš„AMSä¸­è°ƒç”¨çº¿ç¨‹2çš„ATPï¼›ï¼ˆç”±äºåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹é—´èµ„æºå…±äº«ï¼Œå¯ä»¥ç›¸äº’ç›´æ¥è°ƒç”¨ï¼Œä½†éœ€è¦æ³¨æ„å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼‰ çº¿ç¨‹2é€šè¿‡binderä¼ è¾“åˆ°Appè¿›ç¨‹çš„çº¿ç¨‹4ï¼› çº¿ç¨‹4é€šè¿‡handleræ¶ˆæ¯æœºåˆ¶ï¼Œå°†æš‚åœActivityçš„æ¶ˆæ¯å‘é€ç»™ä¸»çº¿ç¨‹ï¼› ä¸»çº¿ç¨‹åœ¨looper.loop()ä¸­å¾ªç¯éå†æ¶ˆæ¯ï¼Œå½“æ”¶åˆ°æš‚åœActivityçš„æ¶ˆæ¯æ—¶ï¼Œä¾¿å°†æ¶ˆæ¯åˆ†å‘ç»™ActivityThread.H.handleMessage()æ–¹æ³•ï¼Œå†ç»è¿‡æ–¹æ³•çš„è°ƒç”¨ï¼Œæœ€åä¾¿ä¼šè°ƒç”¨åˆ°Activity.onPause()ï¼Œå½“onPause()å¤„ç†å®Œåï¼Œç»§ç»­å¾ªç¯loopä¸‹å»ã€‚","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-Handlerç®€è¿°","date":"2019-07-26T11:52:08.000Z","path":"post/5343/","text":"åŸºäºæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚nanchençš„æ–‡ç«  Handler çš„ç®€å•ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) setContentView(R.layout.activity_main3) // è¯·æ±‚ç½‘ç»œ subThread.start()&#125;override fun onDestroy() &#123; subThread.interrupt() super.onDestroy()&#125;private val handler by lazy(LazyThreadSafetyMode.NONE) &#123; MyHandler() &#125;private val subThread by lazy(LazyThreadSafetyMode.NONE) &#123; SubThread(handler) &#125;private class MyHandler : Handler() &#123; override fun handleMessage(msg: Message) &#123; super.handleMessage(msg) // ä¸»çº¿ç¨‹å¤„ç†é€»è¾‘ï¼Œä¸€èˆ¬è¿™é‡Œéœ€è¦ä½¿ç”¨å¼±å¼•ç”¨æŒæœ‰ Activity å®ä¾‹ï¼Œä»¥å…å†…å­˜æ³„æ¼ &#125;&#125;private class SubThread(val handler: Handler) : Thread() &#123; override fun run() &#123; super.run() // è€—æ—¶æ“ä½œ æ¯”å¦‚åšç½‘ç»œè¯·æ±‚ // ç½‘ç»œè¯·æ±‚å®Œæ¯•ï¼Œå’±ä»¬å°±å¾—å“—å“—å“—é€šçŸ¥ UI åˆ·æ–°äº†ï¼Œç›´æ¥ç›´æ¥è€ƒè™‘ Handler å¤„ç†ï¼Œå…¶ä»–æ–¹æ¡ˆæš‚æ—¶ä¸åšè€ƒè™‘ // ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¸€èˆ¬è¿™ä¸ª data æ˜¯è¯·æ±‚ç»“æœè§£æçš„å†…å®¹ handler.obtainMessage(1,data).sendToTarget() // ç¬¬äºŒç§æ–¹æ³• val message = Message.obtain() // å°½é‡ä½¿ç”¨ Message.obtain() åˆå§‹åŒ– message.what = 1 message.obj = data // ä¸€èˆ¬è¿™ä¸ª data æ˜¯è¯·æ±‚ç»“æœè§£æçš„å†…å®¹ handler.sendMessage(message) // ç¬¬ä¸‰ç§æ–¹æ³• handler.post(object : Thread() &#123; override fun run() &#123; super.run() // å¤„ç†æ›´æ–°æ“ä½œ &#125; &#125;) &#125;&#125; ä¸Šè¿°ä»£ç éå¸¸ç®€å•ï¼Œå› ä¸ºç½‘ç»œè¯·æ±‚æ˜¯ä¸€ä¸ªè€—æ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–°å¼€äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨ç½‘ç»œè¯·æ±‚ç»“æŸè§£æå®Œæ¯•åé€šè¿‡ Handler æ¥é€šçŸ¥ä¸»çº¿ç¨‹å»æ›´æ–° UIï¼Œç®€å•é‡‡ç”¨äº† 3 ç§æ–¹å¼ï¼Œç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½ä¼šå‘ç°ï¼Œå…¶å®ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚å°±æ˜¯åˆ©ç”¨ Handler æ¥å‘é€äº†ä¸€ä¸ªæºå¸¦äº†å†…å®¹ Message å¯¹è±¡ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼šæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°ä½¿ç”¨ Message.obtain() è€Œä¸æ˜¯ new Message() è¿›è¡Œ Message çš„åˆå§‹åŒ–ï¼Œä¸»è¦æ˜¯ Message.obtain() å¯ä»¥å‡å°‘å†…å­˜çš„ç”³è¯· 123456789101112131415161718public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; MessageQueue queue = mQueue; if (queue == null) &#123; RuntimeException e = new RuntimeException( this + \" sendMessageAtTime() called with no mQueue\"); Log.w(\"Looper\", e.getMessage(), e); return false; &#125; return enqueueMessage(queue, msg, uptimeMillis);&#125;private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) &#123; msg.target = this; if (mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis);&#125; ä»£ç å‡ºç°äº†ä¸€ä¸ª MessageQueueï¼Œå¹¶ä¸”æœ€ç»ˆè°ƒç”¨äº† MessageQueue#enqueueMessageæ–¹æ³•è¿›è¡Œæ¶ˆæ¯çš„å…¥é˜Ÿ MessageQueue MessageQueue å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå³å­˜æ”¾å¤šæ¡æ¶ˆæ¯ Message çš„å®¹å™¨ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯å•å‘é“¾è¡¨æ•°æ®ç»“æ„ï¼Œè€Œéé˜Ÿåˆ—ã€‚å®ƒçš„ next() æŒ‡å‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ª Message å…ƒç´ ã€‚ä»å…¥é˜Ÿæ¶ˆæ¯ enqueueMessage() çš„å®ç°æ¥çœ‹ï¼Œå®ƒçš„ä¸»è¦æ“ä½œå…¶å®å°±æ˜¯å•é“¾è¡¨çš„æ’å…¥æ“ä½œ. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889boolean enqueueMessage(Message msg, long when) &#123; // ... çœç•¥ä¸€äº›æ£€æŸ¥ä»£ç  synchronized (this) &#123; // ... çœç•¥ä¸€äº›æ£€æŸ¥ä»£ç  msg.markInUse(); msg.when = when; Message p = mMessages; boolean needWake; if (p == null || when == 0 || when &lt; p.when) &#123; // New head, wake up the event queue if blocked. msg.next = p; mMessages = msg; needWake = mBlocked; &#125; else &#123; // Inserted within the middle of the queue. Usually we don't have to wake // up the event queue unless there is a barrier at the head of the queue // and the message is the earliest asynchronous message in the queue. needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous(); Message prev; for (;;) &#123; prev = p; p = p.next; if (p == null || when &lt; p.when) &#123; break; &#125; if (needWake &amp;&amp; p.isAsynchronous()) &#123; needWake = false; &#125; &#125; msg.next = p; // invariant: p == prev.next prev.next = msg; &#125; // We can assume mPtr != 0 because mQuitting is false. if (needWake) &#123; nativeWake(mPtr); &#125; &#125; return true;&#125;Message next() &#123; // ... int nextPollTimeoutMillis = 0; for (;;) &#123; // ... nativePollOnce(ptr, nextPollTimeoutMillis); synchronized (this) &#123; // Try to retrieve the next message. Return if found. final long now = SystemClock.uptimeMillis(); Message prevMsg = null; Message msg = mMessages; if (msg != null &amp;&amp; msg.target == null) &#123; // Stalled by a barrier. Find the next asynchronous message in the queue. do &#123; prevMsg = msg; msg = msg.next; &#125; while (msg != null &amp;&amp; !msg.isAsynchronous()); &#125; if (msg != null) &#123; if (now &lt; msg.when) &#123; // Next message is not ready. Set a timeout to wake up when it is ready. nextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE); &#125; else &#123; // Got a message. mBlocked = false; if (prevMsg != null) &#123; prevMsg.next = msg.next; &#125; else &#123; mMessages = msg.next; &#125; msg.next = null; if (DEBUG) Log.v(TAG, \"Returning message: \" + msg); msg.markInUse(); return msg; &#125; &#125; else &#123; // No more messages. nextPollTimeoutMillis = -1; &#125; //... &#125; //... // While calling an idle handler, a new message could have been delivered // so go back and look again for a pending message without waiting. nextPollTimeoutMillis = 0; &#125;&#125; next() æ–¹æ³•å…¶å®å¾ˆé•¿ï¼Œä¸è¿‡æˆ‘ä»¬ä»…ä»…è´´äº†æå°‘çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢ä¸è¿‡æ˜¯æœ‰ä¸€ä¸ªfor (;;)çš„æ— é™å¾ªç¯ï¼Œå¾ªç¯ä½“å†…éƒ¨è°ƒç”¨äº†ä¸€ä¸ª nativePollOnce(long, int) æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ª Native æ–¹æ³•ï¼Œå®é™…ä½œç”¨æ˜¯é€šè¿‡ Native å±‚çš„ MessageQueue é˜»å¡å½“å‰è°ƒç”¨æ ˆçº¿ç¨‹ nextPollTimeoutMillis æ¯«ç§’çš„æ—¶é—´ã€‚ ä¸‹é¢æ˜¯ nextPollTimeoutMillis å–å€¼çš„ä¸åŒæƒ…å†µçš„é˜»å¡è¡¨ç°ï¼š å°äº 0ï¼Œä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¢«å”¤é†’ï¼› ç­‰äº 0ï¼Œä¸ä¼šé˜»å¡ï¼› å¤§äº 0ï¼Œæœ€é•¿é˜»å¡ nextPollTimeoutMillis æ¯«ç§’ï¼ŒæœŸé—´å¦‚è¢«å”¤é†’ä¼šç«‹å³è¿”å›ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæœ€å¼€å§‹ nextPollTimeoutMillis çš„åˆå§‹åŒ–å€¼æ˜¯ 0ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡ï¼Œä¼šç›´æ¥å»å– Message å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å–åˆ° Message å¯¹è±¡æ•°æ®ï¼Œåˆ™ç›´æ¥ä¼šæŠŠ nextPollTimeoutMillis ç½®ä¸º -1ï¼Œæ­¤æ—¶æ»¡è¶³å°äº 0 çš„æ¡ä»¶ï¼Œä¼šè¢«ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°å…¶ä»–åœ°æ–¹è°ƒç”¨å¦å¤–ä¸€ä¸ª Native æ–¹æ³• nativeWake(long) è¿›è¡Œå”¤é†’ã€‚å¦‚æœå–åˆ°å€¼çš„è¯ï¼Œä¼šç›´æ¥æŠŠå¾—åˆ°çš„ Message å¯¹è±¡è¿›è¡Œè¿”å›ã€‚ nativeWake(long) æ–¹æ³•åœ¨å‰é¢çš„ MessageQueue#enqueueMessage æ–¹æ³•æœ‰ä¸ªè°ƒç”¨ï¼Œè°ƒç”¨æ—¶æœºæ˜¯åœ¨ MessageQueue å…¥é˜Ÿæ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ Handler å‘é€äº† Messageï¼Œæ¶ˆæ¯ç”¨MessageQueueè¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨MessageQueue#enqueueMessage æ–¹æ³•è¿›è¡Œå…¥é˜Ÿï¼Œä½¿ç”¨MessageQueue#nextæ–¹æ³•è¿›è¡Œè½®è®­æ¶ˆæ¯ã€‚è¿™å°±ä¸å…æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼ŒMessageQueue#next æ–¹æ³•æ˜¯è°è°ƒç”¨çš„ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯ Looperã€‚Looper Looper åœ¨ Android çš„æ¶ˆæ¯æœºåˆ¶ä¸­æ‰®æ¼”ç€æ¶ˆæ¯å¾ªç¯çš„è§’è‰²ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å®ƒä¼šä¸åœåœ°ä» MessageQueue é€šè¿‡ next() æŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ–°æ¶ˆæ¯å°±ç«‹åˆ»å¤„ç†ï¼Œå¦åˆ™å°±ä»»ç”± MessageQueue é˜»å¡åœ¨é‚£é‡Œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException(\"No Looper; Looper.prepare() wasn't called on this thread.\"); &#125; // ... for (;;) &#123; Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; //... try &#123; // åˆ†å‘æ¶ˆæ¯ç»™ handler å¤„ç† msg.target.dispatchMessage(msg); dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : 0; &#125; finally &#123; // ... &#125; // ... &#125;&#125;public void dispatchMessage(Message msg) &#123; if (msg.callback != null) &#123; handleCallback(msg); &#125; else &#123; if (mCallback != null) &#123; if (mCallback.handleMessage(msg)) &#123; return; &#125; &#125; handleMessage(msg); &#125;&#125;private static void handleCallback(Message message) &#123; message.callback.run();&#125;public static @Nullable Looper myLooper() &#123; return sThreadLocal.get();&#125;static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;(); å…ˆä¼šé€šè¿‡ myLooper() æ–¹æ³•å¾—åˆ° Looper å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ª Looper è¿”å›ä¸ºç©ºçš„è¯ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚å¦åˆ™è¿›å…¥åˆ°ä¸€ä¸ª for (;;) å¾ªç¯ä¸­ï¼Œè°ƒç”¨ MessageQueue#next() æ–¹æ³•è¿›è¡Œè½®è®­è·å– Message å¯¹è±¡ï¼Œå¦‚æœè·å–çš„ Message å¯¹è±¡ä¸ºç©ºï¼Œåˆ™ç›´æ¥é€€å‡º loop() æ–¹æ³•ã€‚å¦åˆ™ç›´æ¥é€šè¿‡ msg.targetæ‹¿åˆ° Handler å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ Handler#dispatchMessage() æ–¹æ³•ã€‚ å¦‚æœ Message è®¾ç½®äº† callback åˆ™ï¼Œç›´æ¥è°ƒç”¨ message.callback.run()ï¼Œå¦åˆ™åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–äº† mCallbackThreadLocal ThreadLocal æ˜¯ç”¨æ¥å­˜å‚¨æŒ‡å®šçº¿ç¨‹çš„æ•°æ®çš„ï¼Œå½“æŸäº›æ•°æ®çš„ä½œç”¨åŸŸæ˜¯è¯¥æŒ‡å®šçº¿ç¨‹å¹¶ä¸”è¯¥æ•°æ®éœ€è¦è´¯ç©¿è¯¥çº¿ç¨‹çš„æ‰€æœ‰æ‰§è¡Œè¿‡ç¨‹æ—¶å°±å¯ä»¥ä½¿ç”¨ ThreadnLocal å­˜å‚¨æ•°æ®ï¼Œå½“æŸçº¿ç¨‹ä½¿ç”¨ ThreadnLocal å­˜å‚¨æ•°æ®åï¼Œåªæœ‰è¯¥çº¿ç¨‹å¯ä»¥è¯»å–åˆ°å­˜å‚¨çš„æ•°æ®ï¼Œé™¤æ­¤çº¿ç¨‹ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹æ˜¯æ²¡åŠæ³•è¯»å–åˆ°è¯¥æ•°æ®çš„ã€‚ ä¸¾ä¸ªæ —å­ï¼š 1234567891011121314151617181920212223ThreadLocal&lt;Boolean&gt; local = new ThreadLocal&lt;&gt;();// è®¾ç½®åˆå§‹å€¼ä¸ºtrue.local.set(true);Boolean bool = local.get();Logger.i(\"MainThreadè¯»å–çš„å€¼ä¸ºï¼š\" + bool);new Thread() &#123; @Override public void run() &#123; Boolean bool = local.get(); Logger.i(\"SubThreadè¯»å–çš„å€¼ä¸ºï¼š\" + bool); // è®¾ç½®å€¼ä¸ºfalse. local.set(false); &#125;&#125;.start():// ä¸»çº¿ç¨‹ç¡1ç§’ï¼Œç¡®ä¿ä¸Šæ–¹å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚Thread.sleep(1000);Boolean newBool = local.get();Logger.i(\"MainThreadè¯»å–çš„æ–°å€¼ä¸ºï¼š\" + newBool); ç¬¬ä¸€æ¡ Log æ— å¯ç½®ç–‘ï¼Œå› ä¸ºè®¾ç½®äº†å€¼ä¸º trueï¼Œå› ä¸ºæ‰“å°ç»“æœæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚å¯¹äºç¬¬äºŒæ¡ Logï¼Œæ ¹æ®ä¸Šæ–¹ä»‹ç»ï¼ŒæŸçº¿ç¨‹ä½¿ç”¨ ThreadLocal å­˜å‚¨çš„æ•°æ®ï¼Œåªèƒ½è¢«è¯¥çº¿ç¨‹è¯»å–ï¼Œå› æ­¤ç¬¬äºŒæ¡ Log çš„ç»“æœæ˜¯ï¼šnullã€‚ç´§æ¥ç€åœ¨å­çº¿ç¨‹ä¸­è®¾ç½®äº† ThreadLocal çš„å€¼ä¸º falseï¼Œç„¶åç¬¬ä¸‰æ¡ Log å°†è¢«æ‰“å°ï¼ŒåŸç†åŒä¸Šï¼Œå­çº¿ç¨‹ä¸­è®¾ç½®äº† ThreadLocal çš„å€¼å¹¶ä¸å½±å“ä¸»çº¿ç¨‹çš„æ•°æ®ï¼Œæ‰€ä»¥æ‰“å°æ˜¯ trueã€‚ å®éªŒç»“æœè¯å®ï¼šå°±ç®—æ˜¯åŒä¸€ä¸ª ThreadLocal å¯¹è±¡ï¼Œä»»ä¸€çº¿ç¨‹å¯¹å…¶çš„ set() å’Œ get() æ–¹æ³•çš„æ“ä½œéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹äº’ä¸å½±å“çš„ã€‚ Looper.myLooper()12345678910public static void prepare() &#123; prepare(true);&#125;private static void prepare(boolean quitAllowed) &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException(\"Only one Looper may be created per thread\"); &#125; sThreadLocal.set(new Looper(quitAllowed));&#125; è¿™å°±æ˜¯åœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨ Handler å‰ï¼Œå¿…é¡»è¦è°ƒç”¨ Looper.prepare() çš„åŸå› ã€‚ å¯èƒ½ä½ ä¼šç–‘é—®ï¼Œæˆ‘åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨çš„æ—¶å€™ï¼Œæ²¡æœ‰è¦æ±‚ Looper.prepare() å‘€ã€‚åŸæ¥ï¼Œæˆ‘ä»¬åœ¨ ActivityThread ä¸­ï¼Œæœ‰å»æ˜¾ç¤ºè°ƒç”¨ Looper.prepareMainLooper()ï¼š 1234567891011public static void main(String[] args) &#123; // ... Looper.prepareMainLooper(); // ... if (sMainThreadHandler == null) &#123; sMainThreadHandler = thread.getHandler(); &#125; //... Looper.loop(); // ... &#125; æˆ‘ä»¬çœ‹çœ‹ Looper.prepareMainLooper()ï¼š 123456789public static void prepareMainLooper() &#123; prepare(false); synchronized (Looper.class) &#123; if (sMainLooper != null) &#123; throw new IllegalStateException(\"The main Looper has already been prepared.\"); &#125; sMainLooper = myLooper(); &#125;&#125;","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-Viewä¸­çš„getContextä¸€å®šè¿”å›çš„æ˜¯Activityå¯¹è±¡å—ï¼Ÿ","date":"2019-07-25T11:29:13.000Z","path":"post/39723/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8626ä»¥åŠnanchençš„æ–‡ç«  ä¸ä¸€å®šæ˜¯ é‚£ä¹ˆï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¸æ˜¯å‘¢ï¼š é™¤äº†è‡ªå·±æ‰‹åŠ¨ä¼ ä¸æ˜¯Activityçš„Contextè¿›å»ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯:å½“ä½¿ç”¨AppCompatActivity æ—¶ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨è¿™ä¸ªActivityé‡Œçš„åŸç”Ÿæ§ä»¶(å¦‚TextView, ImageViewç­‰ç­‰)ï¼Œå½“åœ¨LayoutInflaterä¸­æŠŠxmlè§£ææˆViewçš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šç»è¿‡AppCompatViewInflaterçš„createViewæ–¹æ³•ï¼š æŠŠè¿™äº›åŸç”Ÿæ§ä»¶éƒ½å˜æˆAppCompatXXXä¸€ç±»çš„ï¼æ¯”å¦‚TextViewçš„è¯ï¼Œå°±ä¼šå˜æˆAppCompatTextViewï¼Œ ImageViewä¼šå˜æˆAppCompatImageView ã€‚ å½“ç„¶äº†ï¼Œè¿™äº›AppCompatå¼€å¤´çš„ï¼Œéƒ½æ˜¯ç»§æ‰¿äºè¢«è½¬æ¢çš„é‚£ä¸ªå¯¹è±¡çš„ã€‚ é‚£é‡ç‚¹å°±åœ¨è¿™äº›AppCompatå¼€å¤´çš„æ§ä»¶äº†ï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªä»–ä»¬æºç ï¼Œæ¯”å¦‚AppCompatImageView æ‰“å¼€ä¹‹åä¼šçœ‹åˆ°ï¼š å½“å®ƒä»¬è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•æ—¶ï¼Œè°ƒç”¨äº†TintContextWrappe çœ‹è¿™ä¸ªæ–¹æ³•çš„åå­—, wrapå¾ˆæ˜æ˜¾å°±æ˜¯åŒ…è£…çš„æ„æ€å˜›ï¼Œç‚¹è¿›å»wrapæ–¹æ³•çœ‹ï¼Œè¿˜ä¼šçœ‹åˆ°é¦–å…ˆè°ƒç”¨äº†shouldWrapæ–¹æ³•ï¼š æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªcontextåº”ä¸åº”è¯¥è¢«åŒ…è£…ã€‚ å¦‚æœæ–¹æ³•è¿”å›true, ä¼šåˆ›å»ºä¸€ä¸ªTintContextWrapperå¯¹è±¡(æŠŠContextä¼ è¿›å»)ï¼Œç„¶åè¿”å›ï¼Œé‚£ä¹ˆï¼Œè¿™æ—¶å€™ï¼Œå½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªViewçš„getContextæ–¹æ³•ï¼Œè‡ªç„¶å°±ä¸æ˜¯Activityäº†ï¼Œè€Œæ˜¯å®ƒä¼ è¿›å»çš„TintContextWrapperã€‚ é‚£ä¹ˆï¼Œç©¶ç«Ÿä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒshouldWrapæ–¹æ³•ä¼šè¿”å›trueå‘¢(Contextä¼šè¢«åŒ…è£…), ç‚¹å¼€çœ‹ä¸‹æºç ï¼š å¦‚æœå®ƒå·²ç»è¢«åŒ…è£…è¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç»§ç»­åŒ…è£…ï¼Œå³è¿”å›falseäº†ã€‚ å¦‚æœæ²¡æœ‰è¢«åŒ…è£…è¿‡ï¼Œå¹¶ä¸”Build.VERSION.SDK_INT&lt;21ï¼ˆä¹Ÿå°±æ˜¯5.0ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰ï¼Œå°±ä¼šè¿”å›trueã€‚ å¾—å‡ºç»“è®ºï¼š å½“è¿è¡Œåœ¨5.0ç³»ç»Ÿç‰ˆæœ¬ä»¥ä¸‹çš„æ‰‹æœºï¼Œå¹¶ä¸”Activityæ˜¯ç»§æ‰¿è‡ªAppCompatActivityçš„ï¼Œé‚£ä¹ˆViewçš„getConextæ–¹æ³•ï¼Œè¿”å›çš„å°±ä¸æ˜¯Activityè€Œæ˜¯TintContextWrapper. é¦–å…ˆï¼Œæ˜¾è€Œæ˜“è§è¿™ä¸ªé—®é¢˜æœ‰ä¸å°‘é™·é˜±ï¼Œæ¯”å¦‚è¿™ä¸ªViewæ˜¯æˆ‘ä»¬è‡ªå·±æ„é€ å‡ºæ¥çš„ï¼Œé‚£è‚¯å®šå®ƒçš„getContext()è¿”å›çš„æ˜¯æˆ‘ä»¬æ„é€ å®ƒçš„æ—¶å€™ä¼ å…¥çš„ Context ç±»å‹ã€‚ ä½†æ˜¯View.getContext()å®ƒä¹Ÿå¯èƒ½è¿”å›çš„æ˜¯TintContextWrapper ç›´æ¥ç»§æ‰¿ Activity çš„ Activity æ„é€ å‡ºæ¥çš„View.getContext()è¿”å›çš„æ˜¯å½“å‰ Activityã€‚ä½†æ˜¯ï¼šå½“ View çš„ Activity æ˜¯ç»§æ‰¿è‡ª AppCompatActivityï¼Œå¹¶ä¸”åœ¨ 5.0 ä»¥ä¸‹ç‰ˆæœ¬çš„æ‰‹æœºä¸Šï¼ŒView.getContext() å¾—åˆ°çš„å¹¶éæ˜¯ Activityï¼Œè€Œæ˜¯ TintContextWrapperã€‚ image Activity.setContentView() çœ‹çœ‹Activity.setContentView()æ–¹æ³•ã€‚ä¸è¿‡æ˜¯ç›´æ¥è°ƒç”¨ Window çš„å®ç°ç±» PhoneWindow çš„ setContentView() æ–¹æ³• 1234public void setContentView(@LayoutRes int layoutResID) &#123; getWindow().setContentView(layoutResID); initWindowDecorActionBar();&#125; çœ‹çœ‹ PhoneWindow çš„ setContentView() æ˜¯æ€æ ·çš„ 12345678910111213141516171819202122232425@Overridepublic void setContentView(int layoutResID) &#123; // Note: FEATURE_CONTENT_TRANSITIONS may be set in the process of installing the window // decor, when theme attributes and the like are crystalized. Do not check the feature // before this happens. if (mContentParent == null) &#123; installDecor(); &#125; else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) &#123; mContentParent.removeAllViews(); &#125; if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) &#123; final Scene newScene = Scene.getSceneForLayout(mContentParent, layoutResID, getContext()); transitionTo(newScene); &#125; else &#123; mLayoutInflater.inflate(layoutResID, mContentParent); &#125; mContentParent.requestApplyInsets(); final Callback cb = getCallback(); if (cb != null &amp;&amp; !isDestroyed()) &#123; cb.onContentChanged(); &#125; mContentParentExplicitlySet = true;&#125; å‡å¦‚æˆ‘ä»¬æ²¡æœ‰FEATURE_CONTENT_TRANSITIONSæ ‡è®°çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡mLayoutInflater.inflate()åŠ è½½å‡ºæ¥ã€‚è¿™ä¸ªå¦‚æœæœ‰ mLayoutInflater çš„æ˜¯åœ¨PhoneWindow çš„æ„é€ æ–¹æ³•ä¸­è¢«åˆå§‹åŒ–çš„ã€‚è€Œ PhoneWindow çš„åˆå§‹åŒ–æ˜¯åœ¨ Activityçš„attach() æ–¹æ³•ä¸­ï¼š 1234567891011121314151617final void attach(Context context, ActivityThread aThread, Instrumentation instr, IBinder token, int ident, Application application, Intent intent, ActivityInfo info, CharSequence title, Activity parent, String id, NonConfigurationInstances lastNonConfigurationInstances, Configuration config, String referrer, IVoiceInteractor voiceInteractor, Window window, ActivityConfigCallback activityConfigCallback) &#123; attachBaseContext(context); mFragments.attachHost(null /*parent*/); mWindow = new PhoneWindow(this, window, activityConfigCallback); mWindow.setWindowControllerCallback(this); mWindow.setCallback(this); mWindow.setOnWindowDismissedCallback(this); mWindow.getLayoutInflater().setPrivateFactory(this); // æ­¤å¤„çœç•¥éƒ¨åˆ†ä»£ç ...&#125; æ‰€ä»¥ PhoneWindow çš„ Context å®é™…ä¸Šå°±æ˜¯ Activity æœ¬èº« å›åˆ°æˆ‘ä»¬å‰é¢åˆ†æçš„ PhoneWindow çš„ setContentView() æ–¹æ³•ï¼Œå¦‚æœæœ‰ FEATURE_CONTENT_TRANSITIONS æ ‡è®°ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº†ä¸€ä¸ª transitionTo() æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627private void transitionTo(Scene scene) &#123; if (mContentScene == null) &#123; scene.enter(); &#125; else &#123; mTransitionManager.transitionTo(scene); &#125; mContentScene = scene;&#125;public void enter() &#123; // Apply layout change, if any if (mLayoutId &gt; 0 || mLayout != null) &#123; // empty out parent container before adding to it getSceneRoot().removeAllViews(); if (mLayoutId &gt; 0) &#123; LayoutInflater.from(mContext).inflate(mLayoutId, mSceneRoot); &#125; else &#123; mSceneRoot.addView(mLayout); &#125; &#125; // Notify next scene that it is entering. Subclasses may override to configure scene. if (mEnterAction != null) &#123; mEnterAction.run(); &#125; setCurrentScene(mSceneRoot, this);&#125; è¿˜æ˜¯é€šè¿‡è¿™ä¸ª mContext çš„ LayoutInflater å» inflate çš„å¸ƒå±€ã€‚è¿™ä¸ª mContext åˆå§‹åŒ–çš„åœ°æ–¹æ˜¯ï¼š 12345678910111213141516public static Scene getSceneForLayout(ViewGroup sceneRoot, int layoutId, Context context) &#123; SparseArray&lt;Scene&gt; scenes = (SparseArray&lt;Scene&gt;) sceneRoot.getTag( com.android.internal.R.id.scene_layoutid_cache); if (scenes == null) &#123; scenes = new SparseArray&lt;Scene&gt;(); sceneRoot.setTagInternal(com.android.internal.R.id.scene_layoutid_cache, scenes); &#125; Scene scene = scenes.get(layoutId); if (scene != null) &#123; return scene; &#125; else &#123; scene = new Scene(sceneRoot, layoutId, context); scenes.put(layoutId, scene); return scene; &#125;&#125; å³ Context æ¥æºäºæˆ‘ä»¬å¤–é¢ä¼ å…¥çš„ getContext()ï¼Œè¿™ä¸ª getContext() è¿”å›çš„å°±æ˜¯åˆå§‹åŒ–çš„ Context ä¹Ÿå°±æ˜¯ Activity æœ¬èº«ã€‚ AppCompatActivity.setContentView() AppCompatActivity çš„ setContentView() å®ç°ã€‚è¿™ä¸ª mDelegate å®é™…ä¸Šæ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œç”± AppCompatDelegate æ ¹æ®ä¸åŒçš„ SDK ç‰ˆæœ¬ç”Ÿæˆä¸åŒçš„å®é™…æ‰§è¡Œç±»ï¼Œå°±æ˜¯ä»£ç†ç±»çš„å…¼å®¹æ¨¡å¼ï¼š123456789101112131415161718192021222324252627282930313233343536373839public void setContentView(@LayoutRes int layoutResID) &#123; this.getDelegate().setContentView(layoutResID);&#125;@NonNullpublic AppCompatDelegate getDelegate() &#123; if (this.mDelegate == null) &#123; this.mDelegate = AppCompatDelegate.create(this, this); &#125; return this.mDelegate;&#125;/** * Create a &#123;@link android.support.v7.app.AppCompatDelegate&#125; to use with &#123;@code activity&#125;. * * @param callback An optional callback for AppCompat specific events */public static AppCompatDelegate create(Activity activity, AppCompatCallback callback) &#123; return create(activity, activity.getWindow(), callback);&#125;private static AppCompatDelegate create(Context context, Window window, AppCompatCallback callback) &#123; final int sdk = Build.VERSION.SDK_INT; if (BuildCompat.isAtLeastN()) &#123; return new AppCompatDelegateImplN(context, window, callback); &#125; else if (sdk &gt;= 23) &#123; return new AppCompatDelegateImplV23(context, window, callback); &#125; else if (sdk &gt;= 14) &#123; return new AppCompatDelegateImplV14(context, window, callback); &#125; else if (sdk &gt;= 11) &#123; return new AppCompatDelegateImplV11(context, window, callback); &#125; else &#123; return new AppCompatDelegateImplV9(context, window, callback); &#125;&#125; ç®€å•æ€»ç»“ ä¹‹æ‰€ä»¥èƒ½å¾—åˆ°ä¸Šé¢çš„ç»“è®º,æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ AppCompatActivity é‡Œé¢çš„ layout.xml æ–‡ä»¶é‡Œé¢ä½¿ç”¨åŸç”Ÿæ§ä»¶ï¼Œæ¯”å¦‚ TextViewã€ImageView ç­‰ç­‰ï¼Œå½“åœ¨ LayoutInflater ä¸­æŠŠ XML è§£ææˆ View çš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šç»è¿‡ AppCompatViewInflater çš„ createView() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠè¿™äº›åŸç”Ÿçš„æ§ä»¶éƒ½å˜æˆ AppCompatXXX ä¸€ç±»ã€‚ åŒ…å«äº†ï¼š RatingBar CheckedTextView MultiAutoCompleteTextView TextView ImageButton SeekBar Spinner RadioButton ImageView AutoCompleteTextView CheckBox EditText Button é‚£ä¹ˆé‡ç‚¹è‚¯å®šå°±æ˜¯åœ¨ AppCompatè¿™äº›å¼€å¤´çš„æ§ä»¶äº†ï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªæºç .å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®æ˜¯super(TintContextWrapper.wrap(context), attrs, defStyleAttr);è¿™è¡Œä»£ç ã€‚shouldWrap() è¿™ä¸ªæ–¹æ³•è¿”å›ä¸º true çš„æ—¶å€™ï¼Œå°±ä¼šé‡‡ç”¨äº† TintContextWrapper è¿™ä¸ªå¯¹è±¡æ¥åŒ…è£¹äº†æˆ‘ä»¬çš„ Contextã€‚å¦‚æœæ˜¯ 5.0 ä»¥å‰ï¼Œå¹¶ä¸”æ²¡æœ‰åŒ…è£…çš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å› trueã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public AppCompatTextView(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(TintContextWrapper.wrap(context), attrs, defStyleAttr); this.mBackgroundTintHelper = new AppCompatBackgroundHelper(this); this.mBackgroundTintHelper.loadFromAttributes(attrs, defStyleAttr); this.mTextHelper = new AppCompatTextHelper(this); this.mTextHelper.loadFromAttributes(attrs, defStyleAttr); this.mTextHelper.applyCompoundDrawablesTints();&#125;public static Context wrap(@NonNull Context context) &#123; if (shouldWrap(context)) &#123; Object var1 = CACHE_LOCK; synchronized(CACHE_LOCK) &#123; if (sCache == null) &#123; sCache = new ArrayList(); &#125; else &#123; int i; WeakReference ref; for(i = sCache.size() - 1; i &gt;= 0; --i) &#123; ref = (WeakReference)sCache.get(i); if (ref == null || ref.get() == null) &#123; sCache.remove(i); &#125; &#125; for(i = sCache.size() - 1; i &gt;= 0; --i) &#123; ref = (WeakReference)sCache.get(i); TintContextWrapper wrapper = ref != null ? (TintContextWrapper)ref.get() : null; if (wrapper != null &amp;&amp; wrapper.getBaseContext() == context) &#123; return wrapper; &#125; &#125; &#125; TintContextWrapper wrapper = new TintContextWrapper(context); sCache.add(new WeakReference(wrapper)); return wrapper; &#125; &#125; else &#123; return context; &#125;&#125;private static boolean shouldWrap(@NonNull Context context) &#123; if (!(context instanceof TintContextWrapper) &amp;&amp; !(context.getResources() instanceof TintResources) &amp;&amp; !(context.getResources() instanceof VectorEnabledTintResources)) &#123; return VERSION.SDK_INT &lt; 21 || VectorEnabledTintResources.shouldBeUsed(); &#125; else &#123; return false; &#125;&#125; å½“è¿è¡Œåœ¨ 5.0 ç³»ç»Ÿç‰ˆæœ¬ä»¥ä¸‹çš„æ‰‹æœºï¼Œå¹¶ä¸” Activity æ˜¯ç»§æ‰¿è‡ª AppCompatActivity çš„ï¼Œé‚£ä¹ˆView çš„ getConext() æ–¹æ³•ï¼Œè¿”å›çš„å°±ä¸æ˜¯ Activity è€Œæ˜¯ TintContextWrapperã€‚ å…¶å®ƒæƒ…å†µä¹ˆ ä¸Šé¢è®²è¿°äº†ä¸¤ç§é Activity çš„æƒ…å†µï¼š ç›´æ¥æ„é€  View çš„æ—¶å€™ä¼ å…¥çš„ä¸æ˜¯ Activityï¼› ä½¿ç”¨ AppCompatActivity å¹¶ä¸”è¿è¡Œåœ¨ 5.0 ä»¥ä¸‹çš„æ‰‹æœºä¸Šï¼ŒXML é‡Œé¢çš„ View çš„ getContext() æ–¹æ³•è¿”å›çš„æ˜¯ TintContextWrapperã€‚ å®é™…ä¸Šï¼ŒView.getContext() å’Œ inflate è¿™ä¸ª View çš„ LayoutInflater æ¯æ¯ç›¸å…³ï¼Œæ¯”å¦‚ Activity çš„ setContentView() é‡Œé¢çš„ LayoutInflater å°±æ˜¯å®ƒæœ¬èº«ï¼Œæ‰€ä»¥è¯¥ layoutRes é‡Œé¢çš„ View.getContext() è¿”å›çš„å°±æ˜¯ Activityã€‚ä½†åœ¨ä½¿ç”¨ AppCompatActivity çš„æ—¶å€™ï¼Œå€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œ layoutRes é‡Œé¢çš„åŸç”Ÿ View ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸º AppCompatXXXï¼Œè€Œè¿™ä¸ªè½¬æ¢åœ¨ 5.0 ä»¥ä¸‹çš„æ‰‹æœºç³»ç»Ÿä¸­ï¼Œä¼šæŠŠ Context è½¬æ¢ä¸ºå…¶åŒ…è£…ç±» TintThemeWrapperï¼Œæ‰€ä»¥åœ¨è¿™æ ·çš„æƒ…å†µä¸‹çš„ View.getContext() è¿”å›æ˜¯ TintThemeWrapperã€‚","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Androidæ¯æ—¥ä¸€é—®ç¬”è®°-å¯¹äºäº‹ä»¶åˆ†å‘ï¼ŒåµŒå¥—æ»šåŠ¨çš„äº†è§£","date":"2019-07-16T09:31:01.000Z","path":"post/35340/","text":"åŸºäºhttps://www.wanandroid.comæ¯æ—¥ä¸€é—®çš„ç¬”è®°ï¼Œåšä¸€äº›æ•´ç†ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡ŒæŸ¥çœ‹å’Œè®°å¿†ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.wanandroid.com/wenda/show/8463ä»¥åŠnanchençš„æ–‡ç«  äº‹ä»¶åˆ†å‘åŸç† äº‹ä»¶åˆ†å‘ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªè´£ä»»é“¾çš„å˜ç§ï¼Œè¿™ä¸ªè´£ä»»é“¾ï¼Œæ˜¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚ åœ¨Androidä¸­ï¼Œå½“æœ€é¡¶å±‚çš„Viewæ”¶åˆ°äº‹ä»¶ä¹‹åï¼Œä¼šä¸€çº§ä¸€çº§åœ°å¾€ä¸‹ä¼ ï¼Œåœ¨æ¯ä¸€çº§Viewä¸­ï¼Œå®ƒä»¬å„è‡ªéƒ½æœ‰æƒåˆ©å»å¤„ç†(ä¹Ÿå°±æ˜¯æ‹¦æˆª)è¿™ä¸ªäº‹ä»¶ï¼Œå¦‚æœè¿™æ¬¡çš„äº‹ä»¶ä¼ åˆ°äº†æœ€åº•å±‚çš„Viewï¼Œä¹Ÿæ²¡èƒ½å¤„ç†çš„è¯ï¼Œå°±ä¼šä»è¿™ä¸ªæœ€åº•å±‚çš„Viewä¸€çº§ä¸€çº§åœ°å‘ä¸Šä¼ å›å»ã€‚åµŒå¥—æ»šåŠ¨ è¿™ä¸ªåµŒå¥—æ»šåŠ¨ï¼Œè¯´çš„åº”è¯¥ä¸æ˜¯æ™®é€šçš„åµŒå¥—æ»šåŠ¨(æ¯”å¦‚ScrollViewå¥—ListView)ï¼Œè€Œæ˜¯è¯´NestedScrollingParentå’ŒNestedScrollingChildï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œå‡ºæ¥æŒºä¹…äº†ï¼Œå¯èƒ½å¥½å¤šåŒå­¦è¿˜æ˜¯è§‰å¾—æœ‰ç‚¹é™Œç”Ÿï¼Œä½†æˆ‘ä»¬åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå·²ç»åœ¨ä¸è¯†ä¸è§‰ä¸­ä½¿ç”¨å®ƒäº†ï¼Œæ¯”å¦‚è¯´CoordinatorLayoutï¼Œå®ƒæ˜¯ä¸€ä¸ªNestedScrollingParentï¼Œè¿˜æœ‰RecycleViewï¼Œå®ƒæ˜¯ä¸€ä¸ªNestedScrollingChildã€‚ä¸€ä¸ªæœ€å¸¸è§çš„æ•ˆæœï¼šåˆ—è¡¨å‘ä¸Šæ»šåŠ¨ï¼ŒToolBaræ”¶èµ·ï¼Œåä¹‹ï¼Œå½“åˆ—è¡¨å‘ä¸‹æ»šåŠ¨æ—¶ï¼ŒToolBaréšç€åˆ—è¡¨çš„æ»šåŠ¨å‡ºç°ã€‚è¿™ä¸ªæ•ˆæœï¼Œç”¨NestedScrollingæ¥å®ç°ï¼Œå¯ä»¥éå¸¸ç®€å•ã€‚åµŒå¥—æ»šåŠ¨åŸç† å®ƒçš„åŸç†ï¼Œå¾ˆç®€å•ï¼šåœ¨NestedScrollingChildæ»šåŠ¨è¿‡ç¨‹ä¸­ï¼Œå®ƒå’ŒNestedScrollingParentä¼šä¸€ç›´â€ä¿æŒé€šè®¯â€ï¼Œæ¯”å¦‚ï¼š å½“Childæ»šåŠ¨ä¹‹å‰ï¼Œä¼šé€šçŸ¥Parent:â€æˆ‘è¦å¼€å§‹æ»šåŠ¨å•¦ï¼Œä½ çœ‹ä½ è¦ä¸è¦åšç‚¹ä»€ä¹ˆâ€ã€‚ å½“Childåœ¨æ»šåŠ¨çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¯æ¬¡é€šçŸ¥Parent:â€æˆ‘è¿™æ¬¡æ¶ˆè´¹äº†xxxï¼Œä½ çœ‹ä½ è¿˜è¦åšä»€ä¹ˆâ€ã€‚ å½“Childæ»šåŠ¨å®Œæˆï¼ŒParentä¹Ÿä¼šæ”¶åˆ°é€šçŸ¥ï¼šâ€æˆ‘æ»šåŠ¨å®Œæˆäº†â€ã€‚ é™¤äº†æ‰‹æŒ‡è§¦æ‘¸æ»šåŠ¨çš„ï¼Œè¿˜æœ‰æƒ¯æ€§æ»šåŠ¨ï¼Œä½†åŸç†å’Œæµç¨‹æ˜¯ä¸€æ ·çš„ã€‚ è‡³äºä¸ºä»€ä¹ˆåµŒå¥—æ»šåŠ¨æœ‰å¿…è¦å­˜åœ¨ï¼Œæˆ‘è§‰å¾—æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š å‡å°‘å·¥ä½œé‡ï¼Œæ¯”å¦‚è¯´ä¸€äº›çœ‹ä¼¼å¾ˆå¤æ‚æ»šåŠ¨æ•ˆæœï¼Œåœ¨ä½¿ç”¨NestedScrollingæœºåˆ¶ä¹‹åï¼Œå°±å˜å¾—ç®€å•èµ·æ¥äº†ã€‚ é™ä½è€¦åˆåº¦ï¼Œåœ¨NestedScrollingæœºåˆ¶å‡ºç°ä¹‹å‰ï¼Œå¾ˆå¤šä¸å­Viewæœ‰æ»šåŠ¨äº¤äº’çš„ViewGroupï¼Œå¤§éƒ¨åˆ†å¤„ç†æ»šåŠ¨çš„ä»£ç ï¼Œéƒ½å †ç§¯è¿™ä¸ªViewGroupä¸­ã€‚è€Œæ¨å‡ºäº†NestedScrollingä¹‹åï¼Œè¿™ä¸ªæ»šåŠ¨çš„å­Viewï¼Œç”±è¢«åŠ¨æ–¹ï¼Œå˜æˆäº†ä¸»åŠ¨æ–¹(æ»šåŠ¨çš„çŠ¶æ€éƒ½æ˜¯ç”±è¿™ä¸ªå­Viewå»å†³å®šï¼Œä¸å†éœ€è¦ViewGroupå»ä¸»åŠ¨åˆ¤æ–­)ã€‚ å¢åŠ çµæ´»æ€§ï¼ŒCoordinatorLayoutçš„å¼ºå¤§ï¼Œç›¸ä¿¡åŒå­¦ä»¬éƒ½ä½“ä¼šåˆ°äº†ï¼Œå®ƒå¯ä»¥é€šè¿‡è®¾ç½®å„ç§ä¸åŒçš„Behaviorï¼Œæ¥å®šåˆ¶å®ƒçš„äº¤äº’æ•ˆæœã€‚ ç®€å•ä»‹ç» View çš„æ—¶é—´åˆ†å‘æœºåˆ¶ å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç®€å•åœ°æä¸€ä¸‹ï¼ŒåŸºæœ¬çš„æµç¨‹å°±æ˜¯ä¸‹é¢çš„ä¼ªä»£ç ã€‚ 123456789public boolean dispatchTouchEvent(MotionEvent ev) &#123; boolean consume = false; if (onInterceptTouchEvent(ev)) &#123; consume = onTouchEvent(ev); &#125;else&#123; consume = child.dispatchTouchEvent(ev); &#125; return consume;&#125; å½“ä¸€ä¸ª ViewGroup æ¥æ”¶åˆ°ä¸€ä¸ªäº‹ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè°ƒç”¨ dispatchTouchEvent() æ–¹æ³•è¿›è¡Œäº‹ä»¶åˆ†å‘ï¼Œå¦‚æœ onInterceptTouchEvent() è¿”å› trueï¼Œåˆ™ä»£è¡¨å½“å‰ View ä¼šæ‹¦æˆªäº‹ä»¶ï¼Œåˆ™ç›´æ¥å›è°ƒ onTouchEvent() æ–¹æ³•è¿›è¡Œäº‹ä»¶å¤„ç†ã€‚å¦‚æœä¸æ‹¦æˆªï¼Œåˆ™ç›´æ¥å›è°ƒå­ View çš„ dispatchTouchEvent() æ–¹æ³•ï¼Œå¦‚æ­¤åå¤ï¼Œä¸€ç›´åˆ°æœ€é‡Œé¢çš„å­ Viewã€‚ å½“ä¸€ä¸ªç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œå®ƒçš„ä¼ é€’è¿‡ç¨‹éµå¾ªä»¥ä¸‹é¡ºåºï¼šActivity =&gt; Window =&gt; Viewï¼Œå³äº‹ä»¶æ€»æ˜¯å…ˆä¼ é€’ç»™ Activityï¼ŒActivity å†ä¼ é€’ç»™ Windowï¼Œæœ€å Window å†ä¼ é€’ç»™é¡¶å±‚ DocorViewï¼Œç„¶åéµå¾ªä¸Šé¢çš„æ–¹å¼ä¸€ç›´åœ¨æœ€é‡Œå±‚ Viewã€‚ è€Œå¤„ç†äº‹ä»¶åˆ™ä»æœ€é‡Œå±‚ View ä¸æ–­å›ä¼ ç»™è‡ªå·±çš„å¤–å±‚ Viewï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰ View è¿›è¡Œå¤„ç†ï¼Œåˆ™ç›´æ¥ä¼šå›ä¼ åˆ° Activity ä¸­ã€‚1onTouchEvent() è¿”å› true ä»£è¡¨è‡ªå·±è¦å¤„ç†ã€‚ æ—¢ç„¶éƒ½æäº†è¿™ä¹ˆä¸€ç‚¹ï¼Œä¹Ÿå°±çªç„¶æƒ³ç»™å‡ºä¸€äº›ç»“è®ºï¼Œå‚è€ƒè‡ª Android å¼€å‘è‰ºæœ¯æ¢ç´¢ï¼š åŒä¸€ä¸ªäº‹ä»¶åºåˆ—æ˜¯æŒ‡ä»æ‰‹æŒ‡æ¥è§¦å±å¹•ï¼ˆACTION_DOWNï¼‰çš„é‚£ä¸€åˆ»èµ·ï¼Œåˆ°æ‰‹æŒ‡ç¦»å¼€å±å¹•ï¼ˆACTION_UPï¼‰çš„é‚£ä¸€åˆ»ç»“æŸï¼Œä¸­é—´å«ä¸å®šæ•°é‡çš„ ACTION_MOVE äº‹ä»¶ã€‚ æŸä¸ª View ä¸€æ—¦å†³å®šæ‹¦æˆªäº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸€ä¸ªäº‹ä»¶åºåˆ—éƒ½åªèƒ½ç”±å®ƒå¤„ç†ï¼Œå¹¶ä¸”å®ƒçš„ onInterceptTouchEvent() æ–¹æ³•ä¹Ÿä¸ä¼šå†è°ƒç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ¯”å¦‚ä¸€ä¸ª ViewGroup é‡Œé¢æœ‰æ•°ä¸ªå­ Viewï¼Œä¸€æ—¦ ACTION_DOWN äº‹ä»¶ä» Activity ä¼ åˆ°è¿™ä¸ª ViewGroup è¢«å…¶æ‹¦æˆªï¼Œåˆ™åç»­çš„ MOVE å’Œ UP ç­‰äº‹ä»¶ä¹Ÿä¸ä¼šä¼ é€’åˆ°é‡Œé¢çš„å­ View ä¸­ã€‚ å¦‚æœä¸€ä¸ª View ä¸€æ—¦å¼€å§‹å¤„ç†äº‹ä»¶ï¼Œå¦‚æœå®ƒä¸æ¶ˆè€— ACTION_DOWN äº‹ä»¶ï¼Œå³ onTouchEvent() è¿”å›ä¸º falseï¼Œé‚£ä¹ˆåŒä¸€äº‹ä»¶åºåˆ—ä¸­çš„å…¶ä»–äº‹ä»¶ä¹Ÿä¸ä¼šå†äº¤ç»™å®ƒå¤„ç†ï¼Œç›´æ¥ä¼šè°ƒç”¨å…¶çˆ¶ View çš„ onTouchEvent()ã€‚ å¦‚æœ View ä¸æ¶ˆè€—é™¤ ACTION_DOWN ä»¥å¤–çš„å…¶ä»–äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å‡»äº‹ä»¶ä¼šæ¶ˆå¤±ï¼Œæ­¤æ—¶çˆ¶å…ƒç´ çš„ onTouchEvent() å¹¶ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”å½“ç„¶ View å¯ä»¥æŒç»­æ”¶åˆ°åç»­çš„äº‹ä»¶ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆå¤±çš„ç‚¹å‡»äº‹ä»¶ä¼šä¼ é€’ç»™ Activity å¤„ç†ã€‚ ViewGroup é»˜è®¤ä¸æ‹¦æˆªäº‹ä»¶ï¼ŒView æ²¡æœ‰ onInterceptTouchEvent() æ–¹æ³•ï¼Œä¸€æ—¦æœ‰äº‹ä»¶ä¼ é€’ç»™å®ƒï¼Œåˆ™ç›´æ¥ä¼šè°ƒç”¨ onTouchEvent()ï¼Œå¹¶ä¸”èµ·é»˜è®¤éƒ½ä¼šæ¶ˆè€—æ‰äº‹ä»¶ã€‚é™¤éå®ƒæ˜¯ä¸å¯ç‚¹å‡»çš„ï¼ˆå³ clickable å’Œ longClickable å‡ä¸º falseï¼‰ã€‚View çš„ longClickable é»˜è®¤éƒ½ä¸º falseï¼Œè€Œ clickable åˆ†æƒ…å†µï¼Œæ¯”å¦‚ Button é»˜è®¤ä¸º trueï¼ŒTextView é»˜è®¤ä¸º falseã€‚ View çš„ enable å±æ€§ä¸ä¼šå½±å“ onTouchEvent() çš„é»˜è®¤è¿”å›å€¼ï¼Œå“ªæ€•ä¸€ä¸ª View æ˜¯ disable çŠ¶æ€çš„ï¼Œåªè¦å®ƒçš„ clickable æˆ–è€… longClickable æœ‰ä¸€ä¸ªä¸º trueï¼Œé‚£ä¹ˆå®ƒçš„ onTouchEvent() å°±ä¼šè¿”å› trueã€‚ requestDisallowInterceptTouchEvent() å¯ä»¥åœ¨å­å…ƒç´ ä¸­å¹²é¢„çˆ¶å…ƒç´ çš„äº‹ä»¶åˆ†å‘è¿‡ç¨‹ï¼Œä½†æ˜¯æ— æ³•å¹²é¢„ ACTION_DOWN äº‹ä»¶ã€‚ äº‹ä»¶ä¼˜å…ˆé¡ºåºï¼šsetOnTouchListener() =&gt; onTouchEvent() =&gt; onClickListener()å¤„ç†è‡ªå®šä¹‰ View ä¸­çš„æ»‘åŠ¨å†²çªâ€” å¯¹äºå¤§å¤šæ•° Android å¼€å‘æ¥è¯´ï¼Œå¤„ç†æ»‘åŠ¨å†²çªå¥½åƒå¾ˆéš¾ï¼Œä½†å®æˆ˜ä¸€ä¸‹åˆå‘ç°ï¼Œå¥½åƒä¹ŸæŒºç®€å•ï¼Œå› ä¸ºè¿™ä¸ªå®é™…ä¸Šæ˜¯æœ‰å¥—è·¯å¯å¾ªçš„ã€‚åŸºæœ¬å°±ä¸¤ç§æ–¹æ¡ˆï¼šå¤–éƒ¨æ‹¦æˆªæ³• &amp;&amp; å†…éƒ¨æ‹¦æˆªæ³•å¤–éƒ¨æ‹¦æˆªæ³• æ‰€è°“å¤–éƒ¨æ‹¦æˆªæ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç›´æ¥åœ¨çˆ¶å®¹å™¨ä¸­ç›´æ¥æ‹¦æˆªæ‰æˆ‘ä»¬çš„æ»‘åŠ¨äº‹ä»¶ï¼Œè®©å…¶ä¸èƒ½è¿›å…¥åˆ°å­å…ƒç´ ä¸­ï¼Œè¿™ä¼¼ä¹å’Œæˆ‘ä»¬ RecyclerView åµŒå¥— RecyclerView æ—¶ç¦ç”¨å†…éƒ¨ RecyclerView æ»‘åŠ¨æœ‰é‚£ä¹ˆä¸€ä¸ç›¸ä¼¼ä¹‹å¤„ï¼Œå°±æ˜¯å†…éƒ¨ä¸å¤„ç†å°±å®Œäº‹å„¿äº†ã€‚ä½†ç»†ç»†å“æ¥åˆå®Œå…¨ä¸ä¸€æ ·ï¼Œè¿™é‡Œçš„å¤–éƒ¨æ‹¦æˆªæ³•ä¼šè®©å†…éƒ¨å…ƒç´ æ ¹æœ¬å°±æ”¶ä¸åˆ°æ»‘åŠ¨äº‹ä»¶ã€‚ è¿™ç§æ–¹æ³•æ˜æ˜¾éå¸¸é€‚åˆæˆ‘ä»¬ä¸Šé¢è®²çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ã€‚æˆ‘ä»¬åœ¨æ¥æ”¶ ACTION_MOVE äº‹ä»¶çš„æ—¶å€™ï¼Œç›´æ¥é€šè¿‡ä½¿ onInterceptTouchEvent() æ–¹æ³•è¿”å› true æ¥ç›´æ¥æ‹¦æˆªæ‰äº‹ä»¶å°±å¯ä»¥äº†ï¼Œä¼ªä»£ç æƒ³å¿…å¤§å®¶ä¹ŸçŸ¥é“äº†ï¼š 12345678override fun onInterceptTouchEvent(ev: MotionEvent?): Boolean &#123; ev?.run &#123; if (action == MotionEvent.ACTION_MOVE &amp;&amp; çˆ¶å®¹å™¨éœ€è¦ç‚¹å‡»äº‹ä»¶)&#123; return true &#125; &#125; return super.onInterceptTouchEvent(ev)&#125; ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦åœ¨äº‹ä»¶ACTION_MOVEæ—¶å»å¤„ç†æˆ‘ä»¬çš„é€»è¾‘å°±å¥½äº†ï¼Œå½“æ»¡è¶³æˆ‘ä»¬çš„é€»è¾‘çš„æ—¶å€™ï¼Œå°±æ‹¦æˆªæ‰ ACTION_MOVE äº‹ä»¶ç»™è‡ªå·±å¤„ç†ã€‚ è‡³äºä¸ºä»€ä¹ˆä¸å»æ‹¦æˆª ACTION_DOWN å’Œ ACTION_UPï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿæ¸…æ¥šäº†ã€‚ä¸Šé¢è¯´äº†ï¼Œå¦‚æœæ‹¦æˆªäº† ACTION_DOWN äº‹ä»¶ï¼Œé‚£åç»­çš„ ACTION_MOVEã€ACTION_UP ç­‰å…¶å®ƒäº‹ä»¶å‡ä¸ä¼šåœ¨è°ƒç”¨ onInterceptTouchEvent() æ–¹æ³•ï¼Œä¼šç›´æ¥äº¤ç»™å½“å‰å®¹å™¨å¤„ç†ã€‚è€Œå¦‚æœæˆ‘ä»¬æ‹¦æˆªæ‰ ACTION_UP çš„è¯ï¼Œè‚¯å®šä¼šå¯¼è‡´å­å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶æ— æ³•è¢«å¤„ç†ï¼Œå› ä¸ºå¤§å®¶è‚¯å®šéƒ½çŸ¥é“ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ä» ACTION_DOWN å¼€å§‹ï¼Œä» ACTION_UP ç»“æŸï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚å†…éƒ¨æ‹¦æˆªæ³• å†…éƒ¨æ‹¦æˆªæ³•ç›¸å¯¹å¤–éƒ¨æ‹¦æˆªæ³•ä¼šå¤æ‚ä¸€äº›ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸æ¥è¯´ï¼Œéƒ½æ›´åŠ æ¨èç”¨å¤–éƒ¨æ‹¦æˆªæ³•è¿›è¡Œå¤„ç†ã€‚ä¸è¿‡ï¼Œå†…éƒ¨æ‹¦æˆªæ³•ä¾ç„¶æœ‰ç€å®ƒéå¸¸é‡è¦çš„åœ°ä½ï¼Œå…·ä½“æƒ…å†µæœ‰å¯èƒ½ä¼šé‡åˆ°ã€‚ å†…éƒ¨æ‹¦æˆªæ³•çš„è¯ï¼Œéœ€è¦ requestDisallowInterceptTouchEvent() æ–¹æ³•çš„æ”¯æŒï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œè¯·æ±‚æ˜¯å¦ä¸å…è®¸æ‹¦æˆªäº‹ä»¶ï¼Œå…¶æ¥æ”¶ä¸€ä¸ª boolean å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸å…è®¸æ‹¦æˆªã€‚ æˆ‘ä»¬ç›´æ¥é‡å†™å­å…ƒç´ çš„ dispatchTouchEvent() æ–¹æ³•ï¼Œå¾—åˆ°ä¼ªä»£ç å¦‚ä¸‹ï¼š 12345678910111213override fun dispatchTouchEvent(ev: MotionEvent?): Boolean &#123; ev?.run &#123; when(action)&#123; MotionEvent.ACTION_DOWN -&gt; parent.requestDisallowInterceptTouchEvent(true) MotionEvent.ACTION_MOVE -&gt;&#123; if(æ»¡è¶³éœ€è¦è®©å¤–éƒ¨å®¹å™¨æ‹¦æˆªäº‹ä»¶)&#123; parent.requestDisallowInterceptTouchEvent(false) &#125; &#125; &#125; &#125; return super.dispatchTouchEvent(ev)&#125; æˆ‘ä»¬ç»™çˆ¶å®¹å™¨çš„ requestDisallowInterceptTouchEvent() ä¼ é€’çš„å‚æ•°ä»£è¡¨æ˜¯å¦ä¸å…è®¸å…¶æ‹¦æˆªäº‹ä»¶ï¼Œå½“å‚æ•°ä¸º true çš„æ—¶å€™ä»£è¡¨ä¸å…è®¸æ‹¦æˆªï¼Œä¸º false çš„æ—¶å€™ä»£è¡¨æ‹¦æˆªã€‚æ‰€ä»¥çœ‹èµ·æ¥å’Œå¤–éƒ¨æ‹¦æˆªæ³•ä¹Ÿå°±å¦‚å‡ºä¸€è¾™äº†ã€‚ ä¸è¿‡ä»…ä»…æœ‰è¿™ç‚¹ä¿®æ”¹è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬é€šè¿‡å‰é¢çš„ç†è®ºåŸºç¡€çŸ¥é“ï¼Œå½“æˆ‘ä»¬çš„çˆ¶å®¹å™¨æ‹¦æˆªæ‰ ACTION_DOWN äº‹ä»¶çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ— æ³•å†ä¼ é€’åˆ°å­å…ƒç´ ä¸­ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šè°ƒç”¨ä¸Šé¢æˆ‘ä»¬å†™çš„ dispatchTouchEvent() æ–¹æ³•äº†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å†…éƒ¨æ‹¦æˆªæ³•çš„æ—¶å€™è¿˜éœ€è¦é‡å†™çˆ¶å®¹å™¨çš„ onInterceptTouchEvent() æ–¹æ³•ã€‚12345678 override fun onInterceptTouchEvent(ev: MotionEvent?): Boolean &#123; ev?.run &#123; if (action == MotionEvent.ACTION_DOWN)&#123; return false &#125; &#125; return super.onInterceptTouchEvent(ev)&#125;","tags":[{"name":"æ¯æ—¥ä¸€é—®ç¬”è®°","slug":"æ¯æ—¥ä¸€é—®ç¬”è®°","permalink":"http://sorgs.cn/tags/æ¯æ—¥ä¸€é—®ç¬”è®°/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://sorgs.cn/tags/é¢è¯•/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"http://sorgs.cn/tags/ç¬”è®°/"}]},{"title":"Androidä¸­JNIè°ƒç”¨ç¬¬ä¸‰æ–¹soä»¥åŠå¤´æ–‡ä»¶æ–¹å¼","date":"2019-05-19T13:05:57.000Z","path":"post/7510/","text":"å¼•è¨€æœ‰æ—¶å€™æˆ‘ä»¬åœ¨androidå¼€å‘JNIçš„æ—¶å€™ï¼Œä¼šæ¶‰åŠåˆ°å¼•ç”¨ç¬¬ä¸‰æ–¹çš„soå’Œå¤´æ–‡ä»¶å¼•ç”¨ã€‚ç°åœ¨ç½‘ä¸Šä¹Ÿæœ‰ç›¸åº”çš„èµ„æ–™ï¼Œä½†æ˜¯è¿˜æ˜¯æ„Ÿè§‰ä¸å…¨å’Œæè¿°ä¸æ¸…æ™°ã€‚è¿™é‡Œè¿›è¡Œæ•´ç†ä¸€äº›ï¼Œæ–¹ä¾¿å¤§å®¶å‚è€ƒã€‚ å‡†å¤‡å·¥ä½œ NDKï¼Œè¿›è¡ŒJNIå¼€å‘ï¼ŒAndroid studioä¸­çš„NDKè‚¯å®šæ˜¯éœ€è¦é…å¥½çš„ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœä¸Šæ¯”è¾ƒæ–°çš„NDKç‰ˆæœ¬çš„è¯ï¼Œåœ¨toolchainsç›®å½•ä¼šå°‘å‡ ç§ï¼Œéœ€è¦å»ä¸‹è½½æ¯”è¾ƒæ—§çš„ç‰ˆæœ¬æŠŠç¼ºå¤±çš„æ”¾è¿›å»ã€‚åŸå› å¤§æ¦‚æ˜¯Googleå·²ç»æ”¾å¼ƒå“ªå‡ ç§äº†ã€‚è¿™ä¸ªä¸»è¦æ˜¯é’ˆå¯¹æ¯”è¾ƒè€çš„å·¥ç¨‹ä¼šé‡å¾—åˆ°ï¼Œä¹Ÿä¼šæœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæœä¸€ä¸‹å¾ˆå®¹æ˜“å°±çŸ¥é“äº†ï¼Œå°±ä¸å±•å¼€è¯´äº†ã€‚ cMakeå’Œcppã€‚ä¸€èˆ¬æ¥è¯´è¿›è¡Œäº†JNIå¼€å‘äº†ï¼Œè¿™äº›åº”è¯¥æ˜¯æœ‰äº†ï¼Œä¸å†ç»†è¯´ã€‚åªè¯´ä¸‹ç›®å½•ï¼Œcppå¯ä»¥å»ºä¸€ä¸ªcppæ–‡ä»¶å¤¹æ”¾åœ¨mainæ–‡ä»¶å¤¹ä¸‹é¢ï¼ŒcMakeéœ€è¦æ”¾åœ¨appç›®å½•ä¸‹é¢ã€‚è¯¦æƒ…ç›®å½•ç»“æ„å¯ä»¥å‚è€ƒDemoã€‚ build.gradle é¦–å…ˆæ˜¯åœ¨defaultConfigé—­åŒ…ç±»æ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚æˆ‘è¿™è¾¹æ˜¯ç”Ÿæˆäº†armeabi-v7açš„æ ¼å¼ï¼Œå¦‚éœ€è¦å…¶ä»–æ ¼å¼ï¼Œè‡ªè¡Œæ·»åŠ å³å¯ã€‚ 123456externalNativeBuild &#123; cmake &#123; cppFlags &quot;&quot; abiFilters &apos;armeabi-v7a&apos; &#125;&#125; åœ¨androidé—­åŒ…ä¸‹é¢ï¼Œå³æœ€å¤§çš„é—­åŒ…ä¸‹é¢æ·»åŠ  12345678910111213externalNativeBuild &#123; cmake &#123; path &quot;CMakeLists.txt&quot; version &quot;3.10.2&quot; &#125;&#125;sourceSets &#123; main &#123; // let gradle pack the shared library into apk jniLibs.srcDirs = [&apos;src/main/jniLibs&apos;] &#125;&#125; æ–‡ä»¶æ”¾ç½®æ”¾ç½® soæ–‡ä»¶ï¼šåœ¨mainç›®å½•ä¸‹é¢å»ºç«‹jniLibsæ–‡ä»¶å¤¹ã€‚ç„¶ååœ¨ä¸‹é¢åœ¨å»ºç«‹armeabi-v7aæ–‡ä»¶å¤¹ï¼ŒæŠŠç›¸åº”çš„soæ–‡ä»¶æ”¾åˆ°é‡Œé¢ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è‡ªå·±éœ€è¦ç”Ÿæˆä»€ä¹ˆç±»å‹çš„soï¼Œå°±éœ€è¦å»ºç«‹ä»€ä¹ˆç±»çš„æ–‡ä»¶å¤¹ï¼Œç„¶åæ‹·å…¥ç›¸åº”ç±»å‹ç¬¬ä¸‰æ–¹soæ–‡ä»¶ã€‚ å¤´æ–‡ä»¶ï¼šåœ¨cppç›®å½•ä¸‹é¢å»ºç«‹includeæ–‡ä»¶å¤¹ï¼Œæ”¾å…¥ç¬¬ä¸‰æ–¹å¤´æ–‡ä»¶å³å¯ã€‚ cMakeç¼–å†™1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465# For more information about using CMake with Android Studio, read the# documentation: https://d.android.com/studio/projects/add-native-code.html# Sets the minimum version of CMake required to build the native library.cmake_minimum_required(VERSION 3.4.1)# Creates and names a library, sets it as either STATIC# or SHARED, and provides the relative paths to its source code.# You can define multiple libraries, and CMake builds them for you.# Gradle automatically packages shared libraries with your APK.add_library( # Sets the name of the library. native-lib # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). src/main/cpp/native-lib.cpp)#åŠ¨æ€æ–¹å¼åŠ è½½ STATICï¼šè¡¨ç¤ºé™æ€çš„.açš„åº“ SHAREDï¼šè¡¨ç¤º.soçš„åº“ã€‚add_library(gmpfprojectorfocusmanager_hidl SHARED IMPORTED)add_library(utils SHARED IMPORTED)add_library(hidlbase SHARED IMPORTED)add_library(hwbinder SHARED IMPORTED)add_library(hidltransport SHARED IMPORTED)add_library(hidlmemory SHARED IMPORTED)#è®¾ç½®è¦è¿æ¥çš„soçš„ç›¸å¯¹è·¯å¾„ $&#123;CMAKE_SOURCE_DIR&#125;ï¼šè¡¨ç¤ºCMake.txtçš„å½“å‰æ–‡ä»¶å¤¹è·¯å¾„ $&#123;ANDROID_ABI&#125;ï¼šç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨æ ¹æ®CPUæ¶æ„å»é€‰æ‹©ç›¸åº”çš„åº“set_target_properties(gmpfprojectorfocusmanager_hidl PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libgmpfprojectorfocusmanager_hidl.so)set_target_properties(utils PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libutils.so)set_target_properties(hidlbase PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libhidlbase.so)set_target_properties(hwbinder PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libhwbinder.so)set_target_properties(hidltransport PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libhidltransport.so)set_target_properties(hidlmemory PROPERTIES IMPORTED_LOCATION $&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;/libhidlmemory.so)#æ·»åŠ ç¬¬ä¸‰æ–¹å¤´æ–‡ä»¶target_include_directories(native-lib PRIVATE $&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/include)# Searches for a specified prebuilt library and stores the path as a# variable. Because CMake includes system libraries in the search path by# default, you only need to specify the name of the public NDK library# you want to add. CMake verifies that the library exists before# completing its build.find_library( # Sets the name of the path variable. log-lib # Specifies the name of the NDK library that # you want CMake to locate. log)# Specifies libraries CMake should link to your target library. You# can link multiple libraries, such as libraries you define in this# build script, prebuilt third-party libraries, or system libraries.target_link_libraries( # Specifies the target library. native-lib # Links the target library to the log library gmpfprojectorfocusmanager_hidl utils hidlbase hwbinder hidltransport hidlmemory # included in the NDK. $&#123;log-lib&#125;) add_library:è¿™é‡Œä¸»è¦æ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹çš„soæ–¹å¼ï¼Œæ¯ä¸ªsoéƒ½è¦å†™ä¸€å¥ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯soçš„æ–‡ä»¶ã€‚ä¾‹å¦‚libutils.soï¼Œåˆ™éœ€è¦å¡«å†™utilsï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºSTATICï¼šè¡¨ç¤ºé™æ€çš„.açš„åº“æˆ–è€…SHAREDï¼šè¡¨ç¤º.soçš„åº“ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å›ºå®šIMPORTED set_target_propertiesï¼šé“¾æ¥soçš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¾ç„¶æ˜¯soçš„åå­—ï¼›ç¬¬äºŒä¸ªå‚æ•°å¡«å†™PROPERTIESå³å¯ï¼›ç¬¬ä¸‰ä¸ªå¡«å†™IMPORTED_LOCATIONå³å¯ï¼›ç¬¬å››ä¸ªåˆ™éœ€è¦å¡«å†™soçš„è·¯å¾„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¼šæ ¹æ®è‡ªå·±çš„éœ€è¦ç”Ÿæˆsoçš„ç±»å‹å»æŸ¥æ‰¾ç›¸åº”ç±»å‹çš„soã€‚ target_include_directoriesï¼šæ·»åŠ ç¬¬ä¸‰æ–¹å¤´æ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¡«å†™native-libï¼›ç¬¬äºŒä¸ªå‚æ•°PRIVATEï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å³å¤´æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚ target_link_librariesï¼šæœ€åéœ€è¦åœ¨è¿™é‡ŒæŠŠç¬¬ä¸‰æ–¹soåå­—åŠ å…¥å³å¯ã€‚ å¼•ç”¨ åœ¨è‡ªå·±çš„cppé‡Œé¢å°±åªç›´æ¥é€šè¿‡includeå¼•ç”¨ç¬¬ä¸‰çš„æ–‡ä»¶å¤¹äº†ï¼Œä»¥åŠè°ƒç”¨ç¬¬ä¸‰æ–¹çš„soæ–‡ä»¶ ç»“è¯­ å»ºè®®æŒ‰ç…§è¿™æ ·çš„è·¯å¾„æ¥æ”¾ç½®ï¼Œé˜²æ­¢å‡ºç°é—®é¢˜ã€‚ demoå·²ç»æ”¾åˆ°äº†githubä¸Šé¢ï¼Œå¯ä»¥è¿›è¡Œå‚è€ƒé…ç½®ã€‚https://github.com/sorgs/NDKTest","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"so","slug":"so","permalink":"http://sorgs.cn/tags/so/"},{"name":"NDK","slug":"NDK","permalink":"http://sorgs.cn/tags/NDK/"},{"name":"JNI","slug":"JNI","permalink":"http://sorgs.cn/tags/JNI/"}]},{"title":"githubå‘å¸ƒå’Œç»´æŠ¤å±äºè‡ªå·±çš„åŸºç¡€å·¥ç¨‹è¿œç¨‹åº“","date":"2019-03-24T10:34:24.000Z","path":"post/9217/","text":"å¼•è¨€è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„è¿œç¨‹åŸºç¡€ä»“åº“ ä¸ç®¡æ˜¯å¼€å‘æ–°é¡¹ç›®äº¦æˆ–è€…æ˜¯è‡ªå·±å†™demoç»ƒç»ƒæ‰‹ä¹‹ç±»çš„ã€‚éƒ½éœ€è¦å»ºç«‹å·¥ç¨‹ï¼Œç„¶åå¼€å§‹æ‹·è´å·¥å…·ç±»ï¼Œç„¶ååœ¨å•ªå•¦å•ªå•¦å¼•ç”¨å¿…é¡»çš„ä¸‰æ–¹åº“ï¼Œå»ºç«‹BaseåŸºç±»ç­‰ç­‰ã€‚ æäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œè§‰å¾—å®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸å»ºç«‹ä¸€ä¸ªåŸºç¡€å·¥ç¨‹ã€‚ç„¶ååšæˆä¸€ä¸ªè¿œç¨‹åº“ï¼Œæ¯æ¬¡å»ºç«‹æ–°çš„å·¥ç¨‹ä¹‹åï¼Œç›´æ¥å°±å¼•ç”¨è¿™ä¸ªåº“ã€‚ä¸€ä¸‹å­è‡ªå·±ç†Ÿæ‰‹çš„å·¥å…·ç±»ï¼ŒBaseåŸºç±»ï¼Œç”šè‡³å¸¸ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“éƒ½OKäº†ã€‚ åœ¨å¹³æ—¶å†™ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿæ³¨æ„æ”¶é›†ï¼Œæ¯”è¾ƒé¡ºæ‰‹çš„ä¸œè¥¿ï¼Œç›´æ¥æ”¾åˆ°åŸºç¡€åº“å½“ä¸­å»ï¼Œä»¥åå¯¹æ–°å·¥ç¨‹ç®€ç›´å¤ªæ–¹ä¾¿äº†ã€‚ è¿™é‡Œåªè¯´ç®€å•è¯´ä¸‹æµç¨‹é‡åˆ°å‘ï¼Œ å»ºç«‹åŸºç¡€åº“ å»ºç«‹å·¥ç¨‹ï¼Œå†newä¸€ä¸ªmoduleï¼Œé€‰æ‹©android Libraryï¼Œç„¶åå¼€å§‹ç¼–å†™å’Œæ­å»ºè‡ªå·±æƒ³æ”¾åˆ°åŸºç¡€å·¥ç¨‹çš„ä¸œè¥¿ã€‚ å‘å¸ƒåˆ°githubä¸Šé¢ åœ¨githubä¸Šé¢é¦–é¡µç‚¹å‡»release-create a new releases(åç»­å‘å¸ƒæ–°ç‰ˆæœ¬ç‚¹å‡»draft a new release),ç›¸å½“äºæ˜¯æ‰“ä¸€ä¸ªtagã€‚åœ¨Tag versionå†™ä¸Šç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ V1.0ä¹‹ç±»çš„ã€‚ä¸‹é¢å¯ä»¥è‡ªå·±éšä¾¿å†™ç‚¹æè¿°ã€‚ ä¸Šhttps://jitpack.io/ ,è¾“å…¥è‡ªå·±çš„gitä»“åº“ï¼Œç‚¹å‡»look upå³å¯ã€‚é€‰æ‹©è‡ªå·±å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œç‚¹å‡»get itå³å¯ã€‚ ç„¶ååœ¨è‡ªå·±æ–°å»ºå·¥ç¨‹å¼•ç”¨å°±å¯ä»¥å¼€å¿ƒä½¿ç”¨äº†ã€‚ é‰´äºç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹ï¼Œè¿™é‡Œä¸å†ç»†è¯´è¿‡ç¨‹ï¼Œå¯ä»¥ç›´æ¥åˆ°https://www.jianshu.com/p/49ea4fa47037 é—®é¢˜ è¿™é‡Œæƒ³ç®€å•è¯´ä¸‹è‡ªå·±é‡åˆ°çš„ä¸€äº›é—®é¢˜ æ—¢ç„¶æ˜¯è‡ªå·±å»ºç«‹çš„åŸºç¡€å·¥ç¨‹ï¼Œå°±ä¸éœ€è¦appç›®å½•ç­‰å…¶ä»–moduleä¹‹ç±»çš„ ä¸€å®šä¸è¦åœ¨build.gradleé‡Œé¢é…ç½®ä¼˜åŒ–å‹ç¼©ç­‰1234567891011121314151617buildTypes &#123; release &#123; //Zipalignä¼˜åŒ– zipAlignEnabled true //å»é™¤æ— ç”¨èµ„æº shrinkResources true //ç­¾å signingConfig signingConfigs.release //æ··æ·† minifyEnabled true proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos; &#125; debug &#123; //ç­¾å signingConfig signingConfigs.release &#125; &#125; è¿™äº›æ˜¯ä¸éœ€è¦çš„ã€‚å°¤å…¶æ˜¯æœ€ä¼˜åŒ–ä¹‹ç±»çš„ï¼Œå¾ˆå®¹æ˜“é€ æˆçš„é—®é¢˜å°±æ˜¯ï¼Œæ‰“aaråŒ…æ²¡æœ‰éƒ¨åˆ†ä»£ç æ‰“è¿›å»ï¼Œå› ä¸ºåœ¨ä¼˜åŒ–ä¹‹åï¼Œæ²¡æœ‰è¢«è°ƒç”¨çš„å‡½æ•°å’Œç±»æ˜¯ä¼šè¢«å¿½ç•¥çš„ï¼Œè€Œå·¥å…·ç±»å°±å¾ˆå®¹æ˜“è¢«ä¼˜åŒ–å¤„ç†äº†ã€‚æ··æ·†çš„ä¹Ÿæ˜¯ä¸å¤ªéœ€è¦é…ç½®ï¼Œå¦‚æœä¸€å®šè¦é…ç½®æ··æ·†ï¼Œåˆ™éœ€è¦æ³¨æ„ï¼ŒæŠŠæ··æ·†ä¸­å‹ç¼©ä¼˜åŒ–ç­‰å»é™¤æ‰ã€‚ ç»“è¯­ è‡ªå·±ç®€å•çš„æ­å»ºäº†ä¸€ä¸ªåŸºç¡€å·¥ç¨‹ï¼Œç›®å‰é‡Œé¢åŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒBaseActivityï¼ŒBaseFragmentç­‰ã€‚è¿˜æœ‰ä¸€äº›å¸¸ç”¨å·¥å…·ç±»ç­‰ï¼Œæ¯”å¦‚Logï¼ŒToastç­‰ æ¬¢è¿å¤§å®¶ä¸€èµ·ç»´æŠ¤å’Œä¼˜åŒ–ï¼Œhttps://github.com/sorgs/project ã€‚å¦‚æœèƒ½å¤Ÿä»»ä½•åœ°æ–¹èƒ½å¤Ÿå¸®åŠ©åˆ°æ‚¨ï¼Œå¸Œæœ›å¯ä»¥ç»™ä¸ªstarté¼“åŠ±é¼“åŠ±ã€‚æ„Ÿè°¢ï¼","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"åŸºç¡€å·¥ç¨‹","slug":"åŸºç¡€å·¥ç¨‹","permalink":"http://sorgs.cn/tags/åŸºç¡€å·¥ç¨‹/"},{"name":"è¿œç¨‹åº“","slug":"è¿œç¨‹åº“","permalink":"http://sorgs.cn/tags/è¿œç¨‹åº“/"}]},{"title":"æ•´ç†ç³»ç±»-JavaåŸºç¡€-Javaå…³é”®å­—æ±‡æ€»","date":"2019-01-02T15:03:09.000Z","path":"post/60878/","text":"æ•´ç†ç³»ç±»-JavaåŸºç¡€ æ•´ç†äºYCBlogs å¸¸è§çš„å…³é”®å­— ç”¨äºå®šä¹‰æ•°æ®ç±»å‹çš„å…³é”®å­— class interface byte short int long float double char boolean void ç”¨äºå®šä¹‰æ•°æ®ç±»å‹å€¼çš„å…³é”®å­— true false null ç”¨äºå®šä¹‰æµç¨‹æ§åˆ¶çš„å…³é”®å­— if else switch case default while do for break continue return ç”¨äºå®šä¹‰è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„å…³é”®å­— private protected public ç”¨äºå®šä¹‰ç±»ï¼Œå‡½æ•°ï¼Œå˜é‡ä¿®é¥°ç¬¦çš„å…³é”®å­— abstract final static synchronized ç”¨äºå®šä¹‰ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„å…³é”®å­— extends implements ç”¨äºå®šä¹‰å»ºç«‹å®ä¾‹åŠå¼•ç”¨å®ä¾‹ï¼Œåˆ¤æ–­å®ä¾‹çš„å…³é”®å­— new this super instanceof ç”¨äºå¼‚å¸¸å¤„ç†çš„å…³é”®å­— try catch finally throw throws ç”¨äºåŒ…çš„å…³é”®å­— package import å…¶ä»–ä¿®é¥°ç¬¦å…³é”®å­— native strictfp transient volatile assert å…³é”®å­—çš„ä½œç”¨è¯´æ˜ break ç”¨åœ¨ switch æˆ–è€…å¾ªç¯è¯­å¥ä¸­ï¼Œè¡¨ç¤ºä¸­æ–­ç»“æŸçš„æ„æ€ï¼Œè·³å‡ºå¾ªç¯ç›´æ¥å¯ä»¥ç»“æŸè¯¥è¯­å¥ continue ç”¨åœ¨å¾ªç¯è¯­å¥ä¸­ï¼Œè¡¨ç¤ºä¸­æ–­ç»“æŸçš„æ„æ€ï¼Œä¸è¿‡è·Ÿ break æœ‰åŒºåˆ«ï¼Œå®ƒæ˜¯é€€å‡ºæœ¬æ¬¡å¾ªç¯åç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ return å¸¸ç”¨åŠŸèƒ½æ˜¯ç»“æŸä¸€ä¸ªæ–¹æ³•ï¼ˆé€€å‡ºä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œè·³è½¬åˆ°ä¸Šå±‚è°ƒç”¨çš„æ–¹æ³• interface æ¥å£çš„æ„æ€ï¼Œç”¨æ¥å®šä¹‰æ¥å£ã€‚ static é™æ€ä¿®é¥°ç¬¦ï¼Œè¢«ä¿®é¥°åæˆå‘˜è¢«è¯¥ç±»æ‰€æœ‰çš„å¯¹è±¡æ‰€å…±æœ‰ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç±»åè°ƒç”¨ private æƒé™ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ï¼Œè¢«ä¿®é¥°çš„æˆå‘˜åªèƒ½åœ¨æœ¬ç±»ä¸­è¢«è®¿é—®ã€‚éšè—å…·ä½“å®ç°ç»†èŠ‚ï¼Œæä¾›å¯¹å¤–å…¬å…±è®¿é—®æ–¹æ³•ï¼Œæé«˜å®‰å…¨æ€§ this å½“æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡åç§°ä¸€æ ·æ—¶ï¼Œéœ€è¦ç”¨ this ä¿®é¥°ï¼Œè°è°ƒç”¨è¿™ä¸ªæ–¹æ³•,é‚£ä¹ˆè¯¥æ–¹æ³•çš„å†…éƒ¨çš„thiså°±ä»£è¡¨è°ï¼Œå¦‚æœä¸é€‚ç”¨ this ï¼Œé‚£ä¹ˆå±€éƒ¨å˜é‡éšè—äº†æˆå‘˜å˜é‡ super ä»£è¡¨çš„æ˜¯çˆ¶ç±»å­˜å‚¨ç©ºé—´çš„æ ‡è¯†(å¯ä»¥ç†è§£æˆçˆ¶ç±»çš„å¼•ç”¨,å¯ä»¥æ“ä½œçˆ¶ç±»çš„æˆå‘˜) final ç”±äºç»§æ‰¿ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•é‡å†™çš„ç°è±¡,è€Œæœ‰æ—¶å€™æˆ‘ä»¬ä¸æƒ³è®©å­ç±»å»é‡å†™çˆ¶ç±»çš„æ–¹æ³•.è¿™å¯¹è¿™ç§æƒ…å†µjavaå°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå…³é”®å­—: finalã€‚å¯ä»¥ä¿®é¥°ç±»ï¼Œå˜é‡ï¼Œæˆå‘˜æ–¹æ³•ã€‚ è¢«ä¿®é¥°ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼› è¢«ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼› è¢«ä¿®é¥°çš„å˜é‡ä¸èƒ½è¢«é‡æ–°èµ‹å€¼,å› ä¸ºè¿™ä¸ªé‡å…¶å®æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚ ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒæŒ‡çš„æ˜¯å€¼ä¸èƒ½è¢«æ”¹å˜ï¼› ä¿®é¥°å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒæŒ‡çš„æ˜¯åœ°å€å€¼ä¸èƒ½è¢«æ”¹å˜ finally è¢«finallyæ§åˆ¶çš„è¯­å¥ä½“ä¸€å®šä¼šæ‰§è¡Œï¼›ç‰¹æ®Šæƒ…å†µï¼šåœ¨æ‰§è¡Œåˆ°finallyä¹‹å‰jvmé€€å‡ºäº†(æ¯”å¦‚System.exit(0)) finallyçš„ä½œç”¨: ç”¨äºé‡Šæ”¾èµ„æºï¼Œåœ¨IOæµæ“ä½œå’Œæ•°æ®åº“æ“ä½œä¸­ä¼šè§åˆ° abstract æŠ½è±¡çš„æ„æ€ï¼Œç”¨æ¥ä¿®é¥°æŠ½è±¡ç±»ä¸æŠ½è±¡æ–¹æ³• abstract ä¸èƒ½å’Œå“ªäº›å…³é”®å­—å…±å­˜? privateï¼šå†²çªï¼Œè¢«privateä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«å­ç±»ç»§æ‰¿,å°±ä¸èƒ½è¢«é‡å†™,è€Œæˆ‘ä»¬çš„æŠ½è±¡æ–¹æ³•è¿˜éœ€è¦è¢«å­ç±»é‡å†™ finalï¼šå†²çªï¼Œè¢«finalä¿®é¥°çš„æ–¹æ³•,ä¸èƒ½è¢«å­ç±»é‡å†™ï¼Œè€Œæˆ‘ä»¬çš„æŠ½è±¡æ–¹æ³•è¿˜éœ€è¦è¢«å­ç±»é‡å†™ staticï¼šæ— æ„ä¹‰ï¼Œå› ä¸ºè¢«staticä¿®é¥°çš„æ–¹æ³•å¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®,ä½†æ˜¯æˆ‘ä»¬çš„æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“,æ‰€ä»¥è¿™æ ·è®¿é—®æ²¡æœ‰æ„æ€ extends ç»§æ‰¿çš„æ„æ€ï¼Œé€šè¿‡å®ƒå¯ä»¥ç±»ä¸ç±»ä¹‹é—´äº§ç”Ÿç»§æ‰¿å…³ç³»ã€‚ implements å®ç°çš„æ„æ€ï¼Œé€šè¿‡å®ƒå¯ä»¥è®©ç±»ä¸æ¥å£ä¹‹é—´äº§ç”Ÿå®ç°å…³ç³»ã€‚ instanceof æµ‹è¯•å®ƒå·¦è¾¹çš„å¯¹è±¡æ˜¯å¦æ˜¯å®ƒå³è¾¹çš„ç±»çš„å®ä¾‹ï¼Œè¿”å›booleanç±»å‹çš„æ•°æ® é‡è¦å…³é”®å­—è¯´æ˜ instanceof instanceofæ˜¯Javaçš„ä¸€ä¸ªäºŒå…ƒæ“ä½œç¬¦ï¼Œå’Œ==ï¼Œ&gt;ï¼Œ&lt;æ˜¯åŒä¸€ç±»ä¸œè¥¿ã€‚ç”±äºå®ƒæ˜¯ç”±å­—æ¯ç»„æˆçš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯Javaçš„ä¿ç•™å…³é”®å­—ã€‚å®ƒçš„ä½œç”¨æ˜¯æµ‹è¯•å®ƒå·¦è¾¹çš„å¯¹è±¡æ˜¯å¦æ˜¯å®ƒå³è¾¹çš„ç±»çš„å®ä¾‹ï¼Œè¿”å›booleanç±»å‹çš„æ•°æ®ã€‚ finalï¼Œfinallyï¼Œfinalizeæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ finalå¯ä»¥ä¿®é¥°ç±»ï¼Œæ–¹æ³•ï¼Œå˜é‡ finalä¿®é¥°ç±»ä»£è¡¨ç±»ä¸å¯ä»¥ç»§æ‰¿æ‹“å±• finalä¿®é¥°å˜é‡è¡¨ç¤ºå˜é‡ä¸å¯ä»¥ä¿®æ”¹ finalä¿®é¥°æ–¹æ³•è¡¨ç¤ºæ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™ finallyåˆ™æ˜¯Javaä¿è¯é‡ç‚¹ä»£ç ä¸€å®šè¦è¢«æ‰§è¡Œçš„ä¸€ç§æœºåˆ¶ å¯ä»¥ä½¿ç”¨ try-finally æˆ–è€… try-catch-finally æ¥è¿›è¡Œç±»ä¼¼å…³é—­ JDBCè¿æ¥ã€ä¿è¯ unlock é”ç­‰åŠ¨ä½œã€‚ finalize æ˜¯åŸºç¡€ç±» java.lang.Objectçš„ä¸€ä¸ªæ–¹æ³• å®ƒçš„è®¾è®¡ç›®çš„æ˜¯ä¿è¯å¯¹è±¡åœ¨è¢«åƒåœ¾æ”¶é›†å‰å®Œæˆç‰¹å®šèµ„æºçš„å›æ”¶ã€‚finalize æœºåˆ¶ç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ JDK 9å¼€å§‹è¢«æ ‡è®°ä¸º deprecatedã€‚ final å…³é”®å­—æ·±å…¥ç†è§£ å¯ä»¥å°†æ–¹æ³•æˆ–è€…ç±»å£°æ˜ä¸º finalï¼Œè¿™æ ·å°±å¯ä»¥æ˜ç¡®å‘ŠçŸ¥åˆ«äººï¼Œè¿™äº›è¡Œä¸ºæ˜¯ä¸è®¸ä¿®æ”¹çš„ã€‚ å¦‚æœä½ å…³æ³¨è¿‡ Java æ ¸å¿ƒç±»åº“çš„å®šä¹‰æˆ–æºç ï¼Œ æœ‰æ²¡æœ‰å‘ç°java.lang åŒ…ä¸‹é¢çš„å¾ˆå¤šç±»ï¼Œç›¸å½“ä¸€éƒ¨åˆ†éƒ½è¢«å£°æ˜æˆä¸ºfinal classï¼Ÿåœ¨ç¬¬ä¸‰æ–¹ç±»åº“çš„ä¸€äº›åŸºç¡€ç±»ä¸­åŒæ ·å¦‚æ­¤ï¼Œè¿™å¯ä»¥æœ‰æ•ˆé¿å… API ä½¿ç”¨è€…æ›´æ”¹åŸºç¡€åŠŸèƒ½ï¼ŒæŸç§ç¨‹åº¦ä¸Šï¼Œè¿™æ˜¯ä¿è¯å¹³å°å®‰å…¨çš„å¿…è¦æ‰‹æ®µã€‚ ä½¿ç”¨ final ä¿®é¥°å‚æ•°æˆ–è€…å˜é‡ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šåœ°é¿å…æ„å¤–èµ‹å€¼å¯¼è‡´çš„ç¼–ç¨‹é”™è¯¯ï¼Œç”šè‡³ï¼Œæœ‰äººæ˜ç¡®æ¨èå°†æ‰€æœ‰æ–¹æ³•å‚æ•°ã€æœ¬åœ°å˜é‡ã€æˆå‘˜å˜é‡å£°æ˜æˆ finalã€‚ final å˜é‡äº§ç”Ÿäº†æŸç§ç¨‹åº¦çš„ä¸å¯å˜ï¼ˆimmutableï¼‰çš„æ•ˆæœï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ç”¨äºä¿æŠ¤åªè¯»æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå› ä¸ºæ˜ç¡®åœ°ä¸èƒ½å†èµ‹å€¼ final å˜é‡ï¼Œæœ‰åˆ©äºå‡å°‘é¢å¤–çš„åŒæ­¥å¼€é”€ï¼Œä¹Ÿå¯ä»¥çœå»ä¸€äº›é˜²å¾¡æ€§æ‹·è´çš„å¿…è¦ã€‚ static å¯ä»¥ç”¨æ¥ä¿®é¥°ï¼šæˆå‘˜å˜é‡ï¼Œæˆå‘˜æ–¹æ³•ï¼Œä»£ç å—ï¼Œå†…éƒ¨ç±»ç­‰ã€‚å…·ä½“å¦‚ä¸‹æ‰€ç¤º ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³• è¢« static ä¿®é¥°çš„æˆå‘˜å±äºç±»ï¼Œä¸å±äºå•ä¸ªè¿™ä¸ªç±»çš„æŸä¸ªå¯¹è±¡ï¼Œè¢«ç±»ä¸­æ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œå¯ä»¥å¹¶ä¸”å»ºè®®é€šè¿‡ç±»åè°ƒç”¨ã€‚ è¢«static å£°æ˜çš„æˆå‘˜å˜é‡å±äºé™æ€æˆå‘˜å˜é‡ï¼Œé™æ€å˜é‡å­˜æ”¾åœ¨Javaå†…å­˜åŒºåŸŸçš„æ–¹æ³•åŒºã€‚ é™æ€ä»£ç å— é™æ€ä»£ç å—å®šä¹‰åœ¨ç±»ä¸­æ–¹æ³•å¤–,é™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œ(é™æ€ä»£ç å—â€”&gt;éé™æ€ä»£ç å—â€”&gt;æ„é€ æ–¹æ³•) è¯¥ç±»ä¸ç®¡åˆ›å»ºå¤šå°‘å¯¹è±¡ï¼Œé™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡. é™æ€å†…éƒ¨ç±»ï¼ˆstaticä¿®é¥°ç±»çš„è¯åªèƒ½ä¿®é¥°å†…éƒ¨ç±»ï¼‰ é™æ€å†…éƒ¨ç±»ä¸éé™æ€å†…éƒ¨ç±»ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«: éé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´å†…ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚æ²¡æœ‰è¿™ä¸ªå¼•ç”¨å°±æ„å‘³ç€ï¼š1.å®ƒçš„åˆ›å»ºæ˜¯ä¸éœ€è¦ä¾èµ–å¤–å›´ç±»çš„åˆ›å»ºã€‚2.å®ƒä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–å›´ç±»çš„éstaticæˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚ é™æ€å¯¼åŒ…(ç”¨æ¥å¯¼å…¥ç±»ä¸­çš„é™æ€èµ„æºï¼Œ1.5ä¹‹åçš„æ–°ç‰¹æ€§): è¿™ä¸¤ä¸ªå…³é”®å­—è¿ç”¨å¯ä»¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„æŒ‡å®šé™æ€èµ„æºï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ç±»åè°ƒç”¨ç±»ä¸­é™æ€æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚","tags":[{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","permalink":"http://sorgs.cn/tags/JavaåŸºç¡€/"},{"name":"Javaå…³é”®å­—","slug":"Javaå…³é”®å­—","permalink":"http://sorgs.cn/tags/Javaå…³é”®å­—/"},{"name":"æ•´ç†è½¬è½½","slug":"æ•´ç†è½¬è½½","permalink":"http://sorgs.cn/tags/æ•´ç†è½¬è½½/"}]},{"title":"kotliné…åˆdagger2å‡ºç°çš„é—®é¢˜","date":"2018-10-14T05:12:03.000Z","path":"post/2500/","text":"æœ€è¿‘æ²¡äº‹ç©ç©kotlinï¼Œéšä¾¿å­¦ä¹ äº†ä¸€æ³¢dagger2ï¼Œæ‰“é…åˆä½¿ç”¨ä¸‹ï¼Œä½†æ˜¯å‡ºç°äº†äº›é—®é¢˜ï¼Œè®°å½•å‡ºæ¥ é—®é¢˜ Unresolved reference: DaggerAddFavoriteComponent Compilation error. See log for more details Caused by: org.gradle.api.GradleException: Compilation error. See log for more details org.gradle.api.tasks.TaskExecutionException: Execution failed for task â€˜:app:compileDebugKotlinâ€™.é…ç½® kotlinæ’ä»¶ File-&gt;Settings-&gt;Plugins image è®°ä½ç‰ˆæœ¬å· 1.2.71 projectçš„build.gradle 1234567891011 buildscript &#123; ext.kotlin_version = &apos;1.2.71&apos; repositories &#123; google() jcenter() &#125; dependencies &#123; classpath &apos;com.android.tools.build:gradle:3.2.0&apos; classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot; &#125;&#125; appç›®å½•build.gradle1234567891011121314 apply plugin: &apos;kotlin-android&apos;apply plugin: &apos;kotlin-android-extensions&apos;apply plugin: &apos;kotlin-kapt&apos;kapt &#123; generateStubs = true&#125;...dependencies &#123;implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot; //ä¸€å®šéœ€è¦ç”¨annotationProcessor annotationProcessor &quot;com.google.dagger:dagger-compiler:2.15&quot; implementation &apos;com.google.dagger:dagger:2.15&apos;&#125;","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"kotlin","slug":"kotlin","permalink":"http://sorgs.cn/tags/kotlin/"},{"name":"dagger2","slug":"dagger2","permalink":"http://sorgs.cn/tags/dagger2/"}]},{"title":"è‡ªå®šä¹‰ç­¾åˆ°çš„æ­¥éª¤View","date":"2018-08-19T07:46:52.000Z","path":"post/388/","text":"*æœ¬ç¯‡æ–‡ç« å·²æˆæƒå¾®ä¿¡å…¬ä¼—å· guolin_blog ï¼ˆéƒ­éœ–ï¼‰ç‹¬å®¶å‘å¸ƒ å¼•è¨€æ¶‰åŠåˆ°ä¸€ä¸ªç­¾åˆ°çš„æ­¥éª¤view éœ€æ±‚ï¼šä»¥ä¸ƒå¤©ä¸ºå‘¨å¤©ï¼Œæ‰§è¡Œå½“å¤©ç­¾åˆ°éœ€è¦ä¸€ä¸ªåŠ¨ç”»æ•ˆæœï¼›ç­¾åˆ°å‰ç°è‰²ï¼Œç­¾åˆ°åå˜ä¸ºç»¿è‰²ï¼›æ¯å¤©åŠ çš„åˆ†æ•°ä¸ä¸€å®šï¼Œç¬¬ä¸‰å¤©å’Œç¬¬ä¸ƒå¤©åŠ çš„æ¯”è¾ƒå¤šï¼Œåˆ†æ•°ç­¾åˆ°å®Œæˆä¸ºæ©™è‰²ï¼Œæœ‰upæ ‡ç­¾ã€‚ æ•ˆæœå›¾ï¼š - åˆ†æ é¦–å…ˆæ˜¯æŠŠè¯¥ç»˜åˆ¶çš„ä¸œè¥¿ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šï¼Œè¿™ç‚¹æ²¡ä»€ä¹ˆå¥½è¯´ï¼Œä¸Šä¸€éåšå®¢å·®ä¸å¤šè¯´äº†æ€ä¹ˆå»ç»˜åˆ¶ã€‚ å…ˆæ ¹æ®æ•°æ®ç»˜åˆ¶å‡ºé™æ€çš„ä¸œè¥¿ã€‚æŠŠæœªç­¾åˆ°çš„ä¸œè¥¿å…¨éƒ¨ç»˜åˆ¶å®Œæ¯•ã€‚ ç„¶åå¼€å§‹ç»˜åˆ¶åŠ¨ç”»ã€‚å¤„ç†åŠ¨ç”»çš„æ–¹å¼ï¼Œåˆ©ç”¨postInvalidate()å¼•èµ·é‡ç»˜ï¼Œæ¯æ¬¡ç”»ä¸€ç‚¹ç‚¹çš„æ©™è‰²è¿›åº¦ï¼Œåé¢éƒ¨åˆ†ç»˜åˆ¶ä¸ºæœªç­¾åˆ°çš„ç°è‰²ã€‚æ¯æ¬¡æ›´æ–°å¢åŠ ä¸€ç‚¹ç‚¹æ©™è‰²çš„è¿›åº¦ï¼Œè¿™æ ·åœ¨å¿«é€Ÿçš„æƒ…å†µä¸‹ï¼Œå°±æ˜¯ä¸€ä¸ªè¿ç»­çš„åŠ¨ç”»æ•ˆæœ å°è£…çŠ¶æ€bean1234public StepBean(int state, int number) &#123; this.state = state; this.number = number;&#125; stateï¼šå°è£…äº†3ä¸ªçŠ¶æ€ï¼Œä»£è¡¨å·²å®Œæˆç­¾åˆ°ï¼Œå½“å‰è¿›è¡Œçš„ç­¾åˆ°ï¼Œå’Œæœªç­¾åˆ° numberï¼šå°è£…æ·»åŠ çš„åˆ†æ•° åˆå§‹åŒ– æŠŠä¸€äº›å…·ä½“çš„ç”»ç¬”ï¼Œèµ„æºæ–‡ä»¶ç­‰åˆå§‹åŒ–å‡ºæ¥12345678//å·²ç»å®Œæˆçš„iconmCompleteIcon = ContextCompat.getDrawable(getContext(), R.drawable.ic_sign_finish);//æ­£åœ¨è¿›è¡Œçš„iconmAttentionIcon = ContextCompat.getDrawable(getContext(), R.drawable.ic_sign_unfinish);//æœªå®Œæˆçš„iconmDefaultIcon = ContextCompat.getDrawable(getContext(), R.drawable.ic_sign_unfinish);//UPçš„iconmUpIcon = ContextCompat.getDrawable(getContext(), R.drawable.ic_sign_up); åˆå§‹åŒ–ä¸€äº›paintå°±ä¸å†ä»‹ç»ï¼Œè¿™é‡Œå°±è¯´ä¸‹åˆå§‹åŒ–Drawableæ–‡ä»¶ï¼Œåˆ©ç”¨ContextCompat.getDrawable()æŠŠèµ„æºæ–‡ä»¶å¼•å…¥ã€‚å› ä¸ºæœªç­¾åˆ°å’Œå½“å‰ç­¾åˆ°éƒ½æ˜¯å±äºè¿˜æ²¡æœ‰ç­¾åˆ°ï¼Œæ‰€ä»¥éƒ½æ˜¯å±•ç¤ºæ²¡æœ‰ç­¾åˆ°çš„å›¾æ ‡ã€‚ æµ‹é‡ onMeasure():è¿™é‡Œæ²¡æœ‰å¤ªå¤šæ“ä½œï¼Œä»…ä»…æŠŠå€¼è®¾ç½®ä¸‹ 1setMeasuredDimension(MeasureSpec.getSize(widthMeasureSpec), MeasureSpec.getSize(heightMeasureSpec)); onSizeChangedï¼ˆï¼‰:è¿™é‡Œæ“ä½œå°±å¤šäº†ä¸€äº›ï¼Œä¸»è¦æ˜¯éœ€è¦ç¡®å®šä¸‹æ¥å›¾æ ‡ç»˜åˆ¶çš„ä½ç½®ï¼Œå·²ç»çº¿æ®µçš„ä½ç½®ã€‚ï¼ˆè¿™é‡Œçš„è¯´æ˜¯çº¿æ®µï¼Œå…¶å®å°±æ˜¯å½“çŸ©å½¢æ¥ç»˜åˆ¶ï¼‰ï¼Œæ³¨é‡Šå·²ç»å†™äº†å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œä¸å¤šåšè¯´æ˜äº† 12345678910111213141516//å›¾æ ‡çš„ä¸­ä¸­å¿ƒYç‚¹mCenterY = CalcUtils.dp2px(getContext(), 28f) + mIconHeight / 2;//è·å–å·¦ä¸Šæ–¹Yçš„ä½ç½®ï¼Œè·å–è¯¥ç‚¹çš„æ„ä¹‰æ˜¯ä¸ºäº†æ–¹ä¾¿ç”»çŸ©å½¢å·¦ä¸Šçš„Yä½ç½®mLeftY = mCenterY - (mCompletedLineHeight / 2);//è·å–å³ä¸‹æ–¹Yçš„ä½ç½®ï¼Œè·å–è¯¥ç‚¹çš„æ„ä¹‰æ˜¯ä¸ºäº†æ–¹ä¾¿ç”»çŸ©å½¢å³ä¸‹çš„Yä½ç½®mRightY = mCenterY + mCompletedLineHeight / 2;//è®¡ç®—å›¾æ ‡ä¸­å¿ƒç‚¹mCircleCenterPointPositionList.clear();//ç¬¬ä¸€ä¸ªç‚¹è·ç¦»çˆ¶æ§ä»¶å·¦è¾¹14.5dpfloat size = mIconWeight / 2 + CalcUtils.dp2px(getContext(), 14.5f);mCircleCenterPointPositionList.add(size);for (int i = 1; i &lt; mStepNum; i++) &#123; //ä»ç¬¬äºŒä¸ªç‚¹å¼€å§‹ï¼Œæ¯ä¸ªç‚¹è·ç¦»ä¸Šä¸€ä¸ªç‚¹ä¸ºå›¾æ ‡çš„å®½åº¦åŠ ä¸Šçº¿æ®µçš„23dpçš„é•¿åº¦ size = size + mIconWeight + mLineWeight; mCircleCenterPointPositionList.add(size);&#125; ä¼ å€¼è¿™é‡Œå¯¹å¤–ç•Œæš´éœ²äº†ä¸€ä¸ªæ–¹æ³•ï¼Œä¼ å…¥å°è£…å¥½çš„beançš„List12345678910111213141516/** * è®¾ç½®æµç¨‹æ­¥æ•° * * @param stepsBeanList æµç¨‹æ­¥æ•° */public void setStepNum(List&lt;StepBean&gt; stepsBeanList) &#123; if (stepsBeanList == null) &#123; return; &#125; mStepBeanList = stepsBeanList; mStepNum = mStepBeanList.size(); //æ‰¾å‡ºæœ€å¤§çš„ä¸¤ä¸ªå€¼çš„ä½ç½® mMax = CalcUtils.findMax(stepsBeanList); //å¼•èµ·é‡ç»˜ postInvalidate();&#125; å€¼ä¼ é€’è¿›æ¥ä¹‹åè°ƒç”¨postInvalidate()æ–¹æ³•,å¼•èµ·é‡ç»˜ï¼Œè°ƒç”¨draw()æ–¹æ³•ï¼Œè¿›è¡Œå†æ¬¡ç»˜åˆ¶ã€‚å¹¶ä¸”æŠŠListé‡Œé¢çš„æœ€å¤§ä¸¤ä¸ªå€¼çš„ä½ç½®æ‰¾å‡ºæ¥ï¼Œåœ¨åé¢æ–¹ä¾¿è®¾ç½®UPæ ‡å¿—ã€‚1234567891011121314151617181920212223242526/** * å¯»åˆ°æœ€å¤§ä¸¤ä¸ªå€¼çš„ä½ç½® */public static int[] findMax(List&lt;StepBean&gt; steps) &#123; int[] value = new int[2]; int[] position = new int[2]; int temValue; int temPosition; for (int i = 0; i &lt; steps.size(); i++) &#123; if (steps.get(i).getNumber() &gt; value[1]) &#123; //æ¯”è¾ƒå‡ºå¤§çš„æ”¾åˆ°value[0]ä¸­ value[1] = steps.get(i).getNumber(); position[1] = i; &#125; if (value[1] &gt; value[0]) &#123; //æŠŠæœ€å¤§çš„æ”¾åˆ°value[0]ä¸­,äº¤æ¢ä½ç½® temValue = value[0]; value[0] = value[1]; value[1] = temValue; temPosition = position[0]; position[0] = position[1]; position[1] = temPosition; &#125; &#125; return position;&#125; å¯»æ‰¾æœ€å¤§å€¼ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€æ¬¡å¾ªç¯æ‰¾å‡ºæ¥ï¼Œé‡‡ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨çš„æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚å¯èƒ½æ–¹æ³•å¹¶éæœ€ä¼˜ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼çš„æ¬¢è¿æŒ‡æ•™~ï¼ ç»˜åˆ¶ ç»˜åˆ¶æˆ‘è¿™é‡Œåˆ†ä¸ºäº†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ï¼Œæ˜¯ä¼ å…¥å€¼ä¹‹åï¼Œä¾¿ç»˜åˆ¶å‡ºç­¾åˆ°ä¹‹å‰çš„Viewï¼Œä¹Ÿå°±æ˜¯é™æ€çš„ã€‚ç„¶åæä¾›ä¸€ä¸ªæ–¹æ³•æš´éœ²å‡ºå»ï¼Œå¾…è°ƒç”¨çš„æ—¶å€™å¼€å§‹æ‰§è¡Œç­¾åˆ°åŠ¨ç”»ï¼Œå®ŒæˆåŠ¨æ€çš„ç»˜åˆ¶ ç»˜åˆ¶ç­¾åˆ°ä¹‹å‰çš„View12345if (isAnimation) &#123; drawSign(canvas);&#125; else &#123; drawUnSign(canvas);&#125; åœ¨onDraw()æ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä½¿ç”¨isAnimationï¼Œé»˜è®¤ä¸ºfalseï¼Œè°ƒç”¨ç»˜åˆ¶æœªç­¾åˆ°çŠ¶æ€çš„Viewï¼Œå¾…è°ƒç”¨æ‰§è¡ŒåŠ¨ç”»æ–¹æ³•æ—¶å€™ä¸ºtrueï¼Œæ‰§è¡Œå¦ä¸€ä¸ªæ–¹æ³•ã€‚ ç»˜åˆ¶çº¿æ®µ123456789101112131415161718192021222324252627282930313233343536//ç»˜åˆ¶çº¿æ®µfloat preComplectedXPosition = mCircleCenterPointPositionList.get(i) + mIconWeight / 2;if (i != mCircleCenterPointPositionList.size() - 1) &#123; //æœ€åä¸€æ¡ä¸éœ€è¦ç»˜åˆ¶ if (mStepBeanList.get(i + 1).getState() == StepBean.STEP_COMPLETED) &#123; //ä¸‹ä¸€ä¸ªæ˜¯å·²å®Œæˆï¼Œå½“å‰æ‰éœ€è¦ç»˜åˆ¶ç»¿è‰² canvas.drawRect(preComplectedXPosition, mLeftY, preComplectedXPosition + mLineWeight, mRightY, mCompletedPaint); &#125; else &#123; //å…¶ä½™ç»˜åˆ¶ç°è‰² canvas.drawRect(preComplectedXPosition, mLeftY, preComplectedXPosition + mLineWeight, mRightY, mUnCompletedPaint); &#125;&#125;``` æˆ‘ä»¬åœ¨mCircleCenterPointPositionListé‡Œé¢å­˜å‚¨äº†ç­¾åˆ°æ¯ä¸ªæ­¥éª¤çš„å›¾æ ‡ä¸­å¿ƒç‚¹Xåæ ‡ã€‚é‚£ä¹ˆå°±æ‹¿å‡ºæ¥ï¼Œè¿›è¡Œç»˜åˆ¶ã€‚ - çº¿æ®µæ˜¯æ¯”å›¾æ ‡å°‘ä¸€ä¸ªçš„ï¼Œé‚£ä¹ˆå¯ä»¥å°‘ç”»ç¬¬ä¸€æ¡æˆ–è€…å°‘ç”»æœ€åä¸€æ¡(ç›¸å¯¹å›¾æ ‡)ã€‚æˆ‘é‡‡å–çš„æ˜¯æœ€åä¸€æ¡ä¸ç»˜åˆ¶ã€‚é‚£ä¹ˆæ¯æ¡çº¿æ®µå°±åœ¨æ¯ä¸ªæ­¥éª¤å›¾æ ‡çš„åé¢ï¼Œè·å–åˆ°å›¾æ ‡çš„ä¸­çº¿ç‚¹Xåæ ‡ï¼ŒåŠ ä¸Šå›¾æ ‡å®½åº¦çš„ä¸€èˆ¬ï¼Œå°±æ˜¯è¯¥çº¿æ®µçš„Xåæ ‡ã€‚å…¶ä½™çš„æ ¹æ®å·²ç»å›ºå®šçš„Yåæ ‡å’Œçº¿æ®µé•¿åº¦ç»˜åˆ¶ä¾¿å¯ã€‚è¿™é‡Œä¸»è¦æ˜¯æ ¹æ®å½“å‰çŠ¶æ€ï¼Œä¸æ˜¯å·²ç»ç­¾åˆ°äº†ï¼Œåˆ™ç»˜åˆ¶ä¸ºç°è‰²ï¼Œå·²ç»ç­¾åˆ°æ‰ç»˜åˆ¶ä¸ºç»¿è‰²ã€‚ - ç»˜åˆ¶å›¾æ ‡``` Java//ç»˜åˆ¶å›¾æ ‡float currentComplectedXPosition = mCircleCenterPointPositionList.get(i);Rect rect = new Rect((int) (currentComplectedXPosition - mIconWeight / 2), (int) (mCenterY - mIconHeight / 2), (int) (currentComplectedXPosition + mIconWeight / 2), (int) (mCenterY + mIconHeight / 2));StepBean stepsBean = mStepBeanList.get(i);if (stepsBean.getState() == StepBean.STEP_UNDO) &#123; mDefaultIcon.setBounds(rect); mDefaultIcon.draw(canvas);&#125; else if (stepsBean.getState() == StepBean.STEP_CURRENT) &#123; mAttentionIcon.setBounds(rect); mAttentionIcon.draw(canvas);&#125; else if (stepsBean.getState() == StepBean.STEP_COMPLETED) &#123; mCompleteIcon.setBounds(rect); mCompleteIcon.draw(canvas);&#125; å¯¹äºå›¾æ ‡çš„ç»˜åˆ¶ï¼Œä¹Ÿæ˜¯éå¸¸ç®€å•çš„è®¡ç®—ï¼Œæ—¢ç„¶å·²ç»è·å–åˆ°äº†æ¯ä¸ªå›¾æ ‡çš„ä¸­å¿ƒXåæ ‡ï¼Œé‚£ä¹ˆæ ¹æ®å›¾æ ‡çš„å¤§å°è®¡ç®—å‡ºå·¦ä¸Šè§’å’Œå³ä¸‹è§’ï¼Œç„¶åæ ¹æ®stateç»˜åˆ¶å³å¯ã€‚ ç»˜åˆ¶åˆ†æ•°123456789101112131415161718//ç»˜åˆ¶å¢åŠ çš„åˆ†æ•°æ•°ç›®if (stepsBean.getState() == StepBean.STEP_COMPLETED) &#123; //å·²ç»å®Œæˆäº† if (i == mMax[0] || i == mMax[1]) &#123; //æ˜¯upçš„éœ€è¦æ©™è‰² mTextNumberPaint.setColor(mCurrentTextColor); &#125; else &#123; //æ™®é€šå®Œæˆçš„é¢œè‰² mTextNumberPaint.setColor(mCompletedLineColor); &#125;&#125; else &#123; //è¿˜æ²¡ç­¾åˆ°çš„ï¼Œé¢œè‰²å‡ä¸ºç°è‰² mTextNumberPaint.setColor(mUnCompletedLineColor);&#125;canvas.drawText(\"+\" + stepsBean.getNumber(), currentComplectedXPosition + CalcUtils.dp2px(getContext(), 2f), mCenterY - mIconHeight / 2 - CalcUtils.dp2px(getContext(), 0.5f), mTextNumberPaint); å¯¹äºåˆ†æ•°ï¼Œå°±ä¾é™„åœ¨æ¯ä¸ªå›¾æ ‡çš„ä¸Šæ–¹ï¼Œæ ¹æ®è®¾è®¡å¸ˆç»™çš„æ ‡æ³¨ï¼Œæ‰¾å‡ºæ–‡æœ¬çš„å·¦ä¸‹è§’åæ ‡(é»˜è®¤æ–‡æœ¬ç»˜åˆ¶æ˜¯æ–‡æœ¬çš„å·¦ä¸‹è§’åæ ‡)ç»˜åˆ¶ã€‚æ³¨æ„çš„æ˜¯ï¼Œè¦æ ¹æ®æ‰¾å‡ºæœ€å¤§ä¸¤ä¸ªå€¼çš„ä½ç½®ï¼Œå¦‚æœæ˜¯è¾ƒå¤§çš„ä¸¤ä¸ªï¼Œæœ€éœ€è¦ä¸ºæ©™è‰² ç»˜åˆ¶UPå›¾æ ‡1234567891011//ç»˜åˆ¶UPif (i == mMax[0] || i == mMax[1]) &#123; //éœ€è¦UPæ‰è¿›è¡Œç»˜åˆ¶ Rect rectUp = new Rect((int) (currentComplectedXPosition - mUpWeight / 2), (int) (mCenterY - mIconHeight / 2 - CalcUtils.dp2px(getContext(), 8f) - mUpHeight), (int) (currentComplectedXPosition + mUpWeight / 2), (int) (mCenterY - mIconHeight / 2 - CalcUtils.dp2px(getContext(), 8f))); mUpIcon.setBounds(rectUp); mUpIcon.draw(canvas);&#125; Upå›¾æ ‡çš„ç»˜åˆ¶ä¾é™„åœ¨å¢åŠ çš„åˆ†æ•°ä¸Šé¢ï¼Œä¹Ÿæ˜¯æ ¹æ®è¾ƒå¤§ä¸¤ä¸ªå€¼çš„ä½ç½®ç»˜åˆ¶ï¼Œè®¡ç®—å‡ºå·¦ä¸Šè§’å’Œå³ä¸‹è§’è¿›è¡Œç»˜åˆ¶ã€‚ é™æ€ç»˜åˆ¶å®Œæ¯•ï¼Œå°±å·²ç»å±•ç¤ºå‡ºæ¥äº†æœªç­¾åˆ°çŠ¶æ€çš„Viewã€‚123456789101112/** * æ‰§è¡Œç­¾åˆ°åŠ¨ç”» * * @param position æ‰§è¡Œçš„ä½ç½® */public void startSignAnimation(int position) &#123; //çº¿æ¡ä»ç°è‰²å˜ä¸ºç»¿è‰² isAnimation = true; mPosition = position; //å¼•èµ·é‡ç»˜ postInvalidate();&#125; æˆ‘è¿™é‡Œæš´éœ²å‡ºæ‰§è¡ŒåŠ¨ç”»çš„æ–¹æ³•ï¼Œå°†è¦æ‰§è¡ŒåŠ¨ç”»çš„ä½ç½®ä¼ å…¥ã€‚ï¼ˆè¿™é‡Œè¦ä¼ ä½ç½®æ˜¯å› ä¸ºåå°æ•°æ®æ‰€è‡´ï¼Œä¹Ÿæ˜¯å¯ä»¥æ ¹æ®stateä½ç½®è‡ªè¡Œæ‰¾å‡ºï¼‰ã€‚å°†isAnimationèµ‹å€¼true,è°ƒç”¨postInvalidate()ï¼Œå†æ¬¡è°ƒç”¨Drwa()æ–¹æ³•è¿›è¡Œç»˜åˆ¶ã€‚ ç»˜åˆ¶çº¿æ®µåŠ¨ç”» 12345678910111213141516171819202122232425//ç»˜åˆ¶çº¿æ®µfloat preComplectedXPosition = mCircleCenterPointPositionList.get(i) + mIconWeight / 2;if (i != mCircleCenterPointPositionList.size() - 1) &#123; //æœ€åä¸€æ¡ä¸éœ€è¦ç»˜åˆ¶ if (mStepBeanList.get(i + 1).getState() == StepBean.STEP_COMPLETED) &#123; //ä¸‹ä¸€ä¸ªæ˜¯å·²å®Œæˆï¼Œå½“å‰æ‰éœ€è¦ç»˜åˆ¶ç»¿è‰² canvas.drawRect(preComplectedXPosition, mLeftY, preComplectedXPosition + mLineWeight, mRightY, mCompletedPaint); &#125; else &#123; //å…¶ä½™ç»˜åˆ¶ç°è‰² //å½“å‰ä½ç½®æ‰§è¡ŒåŠ¨ç”» if (i == mPosition - 1) &#123; //ç»¿è‰²å¼€å§‹ç»˜åˆ¶çš„åœ°æ–¹, float endX = preComplectedXPosition + mAnimationWeight * (mCount / ANIMATION_INTERVAL); //ç»˜åˆ¶ç»¿è‰² canvas.drawRect(preComplectedXPosition, mLeftY, endX, mRightY, mCompletedPaint); //ç»˜åˆ¶ç°è‰² canvas.drawRect(endX, mLeftY, preComplectedXPosition + mLineWeight, mRightY, mUnCompletedPaint); &#125; else &#123; canvas.drawRect(preComplectedXPosition, mLeftY, preComplectedXPosition + mLineWeight, mRightY, mUnCompletedPaint); &#125; &#125;&#125; å¯¹äºæœªç­¾åˆ°å’Œå·²ç»ç­¾åˆ°çš„å’Œä¸Šé¢çš„ç»˜åˆ¶æ²¡æœ‰å¤ªå¤šå˜ï¼Œä»…ä»…åœ¨å½“å‰ç­¾åˆ°ä½ç½®æ‰§è¡ŒåŠ¨ç”»æ•ˆæœ å®šä¹‰mCountä¸ºæ•´ä¸ªåŠ¨ç”»æ‰§è¡Œåˆ†æ®µçš„æ¬¡æ•°è®°å½•ï¼›ANIMATION_INTERVALä¸ºæ¯æ¬¡åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´é—´éš”ï¼Œæš‚å®š10msï¼›mAnimationWeightä¸ºæ¯æ¬¡é—´éš”ä¸­å¢åŠ çš„é•¿åº¦ã€‚ç„¶åæ¯æ¬¡ç”¨æ ¹æ®æ˜¯åˆ†åº¦ç»˜åˆ¶çš„ç¬¬å‡ æ¬¡ç®—å‡ºç»˜åˆ¶æ©™è‰²çš„é•¿åº¦ï¼Œç„¶åæ ¹æ®çº¿æ®µé•¿åº¦å‡å»è¿™æ®µé•¿åº¦ç®—å‡ºç°è‰²çš„é•¿åº¦ï¼Œè¿›è¡Œç»˜åˆ¶ã€‚ ç»˜åˆ¶å›¾æ ‡ï¼Œæ–‡å­—ï¼ŒupåŠ¨ç”» 12345if (i == mPosition &amp;&amp; mCount == ANIMATION_TIME) &#123; //å½“å‰éœ€è¦ç»˜åˆ¶æˆç»¿è‰²äº† mCompleteIcon.setBounds(rect); mCompleteIcon.draw(canvas);&#125; å¯¹äºè¿™éƒ¨åˆ†çš„ç»˜åˆ¶ï¼Œå˜åŒ–ä¸å¤ªå¤šï¼Œå› ä¸ºéœ€æ±‚æ˜¯çº¿æ®µåŠ¨ç”»æ‰§è¡Œå®Œæ¯•ï¼Œå°±æŠŠæ–‡æœ¬ã€å›¾æ ‡å˜ä¸ºç»¿è‰²ï¼Œå¦‚æœæ˜¯è¾ƒå¤§ä¸¤ä¸ªå€¼çš„åœ°æ–¹ï¼Œåˆ™å˜ä¸ºæ©™è‰²(è¿™éƒ¨åˆ†ä»£ç æ²¡æœ‰å¤ªå¤šç²˜è´´ï¼Œè¯¦æƒ…è¯·è§demoé¡¹ç›®) è®¡ç®—åŠ¨ç”»æ‰§è¡Œçš„æ¬¡æ•°12345678910//è®°å½•é‡ç»˜æ¬¡æ•°mCount = mCount + ANIMATION_INTERVAL;if (mCount &lt;= ANIMATION_TIME) &#123; //å¼•èµ·é‡ç»˜ postInvalidate();&#125; else &#123; //é‡ç»˜å®Œæˆ isAnimation = false; mCount = 0;&#125; ç»´æŠ¤äº†ä¸€ä¸ªmCountï¼Œè®°å½•åŠ¨ç”»åˆ†æ®µæ‰§è¡Œçš„æ¬¡æ•°ï¼Œå½“å€¼è¾¾åˆ°äº†è¦æ±‚çš„åŠ¨ç”»æ‰§è¡Œæ—¶é—´ï¼Œå˜åœæ­¢é‡ç»˜ï¼Œå¦åˆ™ï¼Œè°ƒç”¨postInvalidate()è¿›è¡Œé‡ç»˜ï¼Œå¢åŠ mCountçš„å€¼ã€‚ è°ƒç”¨ åœ¨activityæˆ–è€…dialogç­‰é‡Œé¢å°è£…Listï¼Œè°ƒç”¨12345678910111213141516171819private void initData() &#123; mStepBeans.add(new StepBean(StepBean.STEP_COMPLETED, 2)); mStepBeans.add(new StepBean(StepBean.STEP_COMPLETED, 4)); mStepBeans.add(new StepBean(StepBean.STEP_CURRENT, 10)); mStepBeans.add(new StepBean(StepBean.STEP_UNDO, 2)); mStepBeans.add(new StepBean(StepBean.STEP_UNDO, 4)); mStepBeans.add(new StepBean(StepBean.STEP_UNDO, 4)); mStepBeans.add(new StepBean(StepBean.STEP_UNDO, 30)); mStepView.setStepNum(mStepBeans);&#125;private void initListener() &#123; mTvSign.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; mStepView.startSignAnimation(2); &#125; &#125;);&#125; ç»“è¯­ è¿™éƒ¨åˆ†çš„è‡ªå®šä¹‰è¿˜æ˜¯å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å¯¹å¾…åŠ¨ç”»å¤„ç†ä¸Šã€‚ä¹‹å‰æ‹¿åˆ°è¿™ä¸ªéœ€æ±‚ï¼Œå®Œå…¨ä¸çŸ¥é“æ€ä¹ˆå»å®ŒæˆåŠ¨ç”»æ•ˆæœï¼Œè¯·æ•™ä¹‹åæ‰æ˜ç™½ï¼Œå°±æ˜¯ä¸åœçš„å¼•èµ·é‡ç»˜å®Œæˆã€‚åœ¨åŸç†ä¸Šæ˜¯æ¯æ¬¡å¤šç»˜åˆ¶ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨è§†è§‰ä¸Šå› ä¸ºå¿«é€Ÿï¼ˆä½äº16msï¼‰å½¢æˆäº†åŠ¨ç”»(æˆ–è®¸è¿˜æœ‰å…¶ä»–æ–¹å¼)ã€‚æ¯”å¦‚æ­Œè¯åŒæ­¥ä¹Ÿæ˜¯å·®ä¸å¤šæ˜¯è¿™ä¸ªåŸç†ã€‚ è¯¥éƒ¨åˆ†è‡ªå®šä¹‰Viewå¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰åˆ°è‡ªå·±é€šè¿‡ä¸æ–­çš„å­¦ä¹ æ…¢æ…¢åœ¨äº†è§£åˆ°æ›´å¤šçš„æ–¹å¼ï¼Œæ¬¢è¿å„ä½å°è¯•ï¼ ä»£ç å·²ç»æ”¾åœ¨GitHubï¼Œå¦‚æœæœ‰å¸®åŠ©åˆ°æ‚¨ï¼Œå¸Œæœ›ä¸è¦å¿˜è®°ç‚¹é¢—å°æ˜Ÿæ˜Ÿã€‚https://github.com/sorgs/StepView","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"è‡ªå®šä¹‰View","slug":"è‡ªå®šä¹‰View","permalink":"http://sorgs.cn/tags/è‡ªå®šä¹‰View/"},{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"http://sorgs.cn/tags/åŠ¨ç”»/"}]},{"title":"ä¸€æ­¥æ­¥è‡ªå®šä¹‰ä¸€ä¸ªå°é¢é€‰æ‹©æ¡†","date":"2018-05-28T13:59:04.000Z","path":"post/45123/","text":"*æœ¬ç¯‡æ–‡ç« å·²æˆæƒå¾®ä¿¡å…¬ä¼—å· guolin_blog ï¼ˆéƒ­éœ–ï¼‰ç‹¬å®¶å‘å¸ƒ å¼•è¨€å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ‹æ‘„è§†é¢‘ç”¨æˆ·æ˜¯ç«–å±æ‹æ‘„ï¼Œä½†æ˜¯ä¸€ä¸ªè§†é¢‘çš„å°é¢éœ€è¦ä¸€ä¸ª16:9çš„å›¾ç‰‡ï¼Œå¹¶ä¸”å…è®¸ç”¨æˆ·è‡ªå·±é€‰æ‹©ï¼Œäºæ˜¯åšäº†ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰Viewï¼Œè¿›è¡Œå±•ç¤ºå°é¢é€‰æ‹©ã€‚ å…ˆçœ‹çœ‹å¼•å…¥åˆ°é¡¹ç›®çš„æ•ˆæœï¼š - è‡ªå®šä¹‰Viewçš„å‡†å¤‡ é¦–å…ˆæ¥è¯´è‡ªå®šä¹‰Viewå°±æ˜¯è¿›è¡Œç»˜åˆ¶ï¼Œç»˜åˆ¶è‚¯å®šä¼šéœ€è¦ç¡®å®šå¤§å°ï¼Œä½ç½®ä»¥åŠç»˜åˆ¶çš„å†…å®¹ã€‚å¯¹åº”çš„æ—¢æ˜¯onMeasure()ã€onLayoutï¼ˆï¼‰å’ŒonDrawï¼ˆï¼‰æ¥çœ‹ä¸€å¼ è‡ªå®šä¹‰Viewçš„æµç¨‹å›¾ï¼Œå¯¹ç…§å›¾è¿›è¡Œç¼–å†™ï¼Œå˜ä¼šè½»æ¾å¾ˆå¤šã€‚ æœ¬æ¬¡ä¸»è¦æ˜¯åœ¨æ»‘åŠ¨ç›‘å¬ä¸ŠåšåŠŸå¤«è¿›è¡Œç»˜åˆ¶ï¼Œå³onTouchEvent() åˆ†æ1.å½“çœ‹åˆ°è¿™è‡ªå®šä¹‰Viewçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ã€‚ç„¶åæ…¢æ…¢çš„æ€è€ƒã€‚å…ˆç»˜åˆ¶ä¸€ä¸ªä¸œè¥¿ä¸Šå»ï¼Œè®©å®ƒè·Ÿç€æ‰‹æŒ‡åŠ¨èµ·æ¥å°±å¥½ï¼Œäºæ˜¯æœ‰äº†è¿™æ ·çš„ä»£ç  123456789101112131415161718public boolean onTouchEvent(MotionEvent event) &#123; switch (event.getAction()) &#123; case MotionEvent.ACTION_DOWN: moveX = event.getX(); moveY = event.getY(); break; case MotionEvent.ACTION_MOVE: setTranslationX(getX() + (event.getX() - moveX)); setTranslationY(getY() + (event.getY() - moveY)); break; case MotionEvent.ACTION_UP: break; case MotionEvent.ACTION_CANCEL: break; &#125; return true; &#125; 2.åŠ¨èµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­å†çœ‹ç›®æ ‡ï¼Œå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Yè½´ä¸Šç§»åŠ¨ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸€ä¸ªé•¿çŸ©å½¢ä¸­é—´æ»‘åŠ¨ä¸€ä¸ªå°çš„çŸ©å½¢ã€‚äºæ˜¯å°±ç»˜åˆ¶ä¸€ä¸ªé•¿çŸ©å½¢ï¼Œå’Œä¸€ä¸ªå°çŸ©å½¢ï¼Œä¿®æ”¹onTouchEvent()ä¸­çš„æ–¹æ³•ï¼Œåˆ é™¤å’Œxè½´ç›¸å…³çš„ä»£ç ã€‚ç»˜åˆ¶çŸ©å½¢ä½¿ç”¨drawRectå‡½æ•°ï¼Œä¼ å…¥ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼ˆå·¦ä¸Šè§’å’Œå³ä¸‹è§’ï¼‰å’Œç”»ç¬”ã€‚ 1canvas.drawRect(mC1X1, mC1Y1, mC1X2, mC1Y2, mChildPaint); 3.è¿™ä¸€æ­¥ä¹Ÿä¸ç®—å¾ˆéš¾ã€‚ç»§ç»­ç»˜åˆ¶ï¼Œå‘ç°èƒŒæ™¯éœ€è¦ç»˜åˆ¶ä¸€å¼ å›¾ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åœ¨è°ƒç”¨è¿™ä¸ªViewçš„åœ°æ–¹ä¼ é€’ä¸€å¼ Bitmapè¿‡æ¥ã€‚äºæ˜¯æœ‰äº†è¿™æ ·çš„ä»£ç ï¼š 12345678910/** * è®¾ç½®å›¾ç‰‡ */public void setData(Bitmap bitmap) &#123; if (bitmap == null) &#123; throw new RuntimeException(\"bitmap can't null\"); &#125; mParentBg = bitmap; invalidate();&#125; invalidate()è¿›è¡Œé‡æ–°ç»˜åˆ¶ï¼Œè°ƒç”¨ä¹‹åï¼Œæµç¨‹è¿›è¡ŒonDraw()ï¼Œè°ƒç”¨ç»˜åˆ¶bitmapçš„å‡½æ•° 12345// æŒ‡å®šå›¾ç‰‡ç»˜åˆ¶åŒºåŸŸRect src = new Rect(0, 0, mParentBg.getWidth(), mParentBg.getHeight());// æŒ‡å®šå›¾ç‰‡åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„åŒºåŸŸRect dst = new Rect(mPX1, mPY1, mPX2, mPY2);canvas.drawBitmap(mParentBg, src, dst, null); å…ˆç®€å•è¯´æ˜ä¸€ä¸‹ï¼ŒmParentBgå³ä¸ºBitmapå¯¹è±¡ï¼Œå…ˆè·å–è¦ç»˜åˆ¶çš„èƒŒæ™¯å›¾ç‰‡çš„å¤§å°ï¼Œè¿™é‡Œå½“ç„¶æ˜¯æŠŠæ•´ä¸ªèƒŒæ™¯å›¾ç»˜åˆ¶è¿›è¡Œï¼Œç„¶åæ˜¾ç¤ºçš„ä½ç½®ï¼Œå³ä¸ºçŸ©å½¢çš„ä½ç½®ï¼Œä¾ç„¶æ˜¯å·¦ä¸Šè§’å’Œå³ä¸‹è§’ã€‚æˆ‘ä»¬ä¸éœ€è¦ç»™å›¾ç‰‡ç€è‰²ï¼Œæ‰€ä»¥paintä¼ nullå³å¯ã€‚ å®Œæˆè¿™å‡ éƒ¨ä¹‹åï¼Œè§‰å¾—å¾ˆä¸é”™ï¼Œå¤§åŠŸå‘Šæˆï¼Œè¿™ç¯‡æ–‡ç« åˆ°æ­¤ä¸ºæ­¢äº†ã€‚é—®é¢˜æ¥äº†ï¼Œæœ¬æƒ³ä¸­é—´çš„é€‰æ‹©çŸ©å½¢ç»˜åˆ¶ä¸ºé€æ˜çš„ï¼Œé•¿çŸ©å½¢å³çˆ¶æ§ä»¶çŸ©å½¢ç»˜åˆ¶ä¸€ä¸ªåŠé€æ˜çš„ã€‚ä½†æ˜¯å‘ç°ï¼Œæ ¹æœ¬æ²¡æœ‰ä½œç”¨ï¼Œç»˜åˆ¶é€æ˜çš„å°±å¥½åƒæ²¡æœ‰ç»˜åˆ¶ä¸€æ ·ã€‚ äºæ˜¯ï¼Œåˆå¼€å§‹è®¤çœŸæ€è€ƒã€‚ä¸­é—´é€‰æ‹©éƒ¨åˆ†æ˜¯é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ²¡æœ‰ç»˜åˆ¶ã€‚é‚£ä¹ˆå°±æŠŠçˆ¶æ§ä»¶åˆ†ä¸ºä¸¤ä¸ªå˜åŒ–çš„å­æ§ä»¶çŸ©å½¢ï¼Œæ ¹æ®ä¸­é—´é€‰æ‹©åŒºåŸŸçš„å˜åŒ–ï¼Œè°ƒæ•´ä¸Šä¸‹ä¸¤ä¸ªå­æ§ä»¶çŸ©å½¢çš„å¤§å°ã€‚ ç¼–ç 1.åˆå§‹åŒ–ã€‚æ ¹æ®ä¸Šé¢çš„åˆ†æä¹‹åï¼Œå¼€å§‹ç¼–ç ã€‚é¦–å…ˆæ˜¯è¦å®šä¹‰ä¸€äº›åˆå§‹åŒ–çš„ä¸œè¥¿ï¼Œäºæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨initï¼š 12345678private void init(Context context) &#123; mContext = context; mChildPaint = new Paint(); mChildPaint.setColor(context.getResources().getColor(R.color.colorT)); mChildPaint.setStyle(Paint.Style.FILL);&#125; å®šä¹‰äº†ç»˜åˆ¶ä¸¤ä¸ªå­æ§ä»¶çš„ç”»ç¬”ï¼Œè®¾ç½®äº†æŠ—é”¯é½¿å’ŒåŠé€æ˜å¸¦é»‘è‰²è’™å±‚çš„é¢œè‰² 2.å¤§å°ç¡®å®šã€‚æ ¹æ®æµç¨‹è‚¯å®šæ˜¯æµ‹é‡å‡ºè‡ªå®šä¹‰Viewçš„å¤§å°ï¼š 12345678910protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; super.onMeasure(widthMeasureSpec, heightMeasureSpec); mParentHeight = MeasureSpec.getSize(heightMeasureSpec); mScreenWidth = MeasureSpec.getSize(widthMeasureSpec); //çˆ¶æ§ä»¶å®½åº¦ 16:9çš„å®½ mParentWidth = mParentHeight * 9 / 16f; //é€‰ä¸­åŒºåŸŸé«˜åº¦ mChildHeight = mParentWidth * 9 / 16f; initCalc();&#125; æˆ‘ä»¬é¦–å…ˆè·å–åˆ°äº†viewçš„å®½é«˜ï¼Œç„¶åå»è¿›è¡Œçˆ¶æ§ä»¶çš„å®½é«˜å’Œå­æ§ä»¶çš„å®½é«˜ é¦–å…ˆæ¥è¯´ï¼Œçˆ¶æ§ä»¶çš„é«˜åº¦è‚¯å®šå°±æ˜¯æ•´ä¸ªviewçš„é«˜åº¦ï¼Œè€Œå®½åº¦çš„è¯ï¼Œå› ä¸ºè¦æ±‚æ˜¯16:9ï¼Œæ‰€ä»¥æ ¹æ®é«˜åº¦è®¡ç®—å‡ºå®½åº¦ æœ‰äº†çˆ¶æ§ä»¶çš„å®½åº¦ï¼Œä¹Ÿä¾¿æœ‰äº†ä¸­é—´é€‰æ‹©çŸ©å½¢çš„å®½åº¦ï¼Œä¹Ÿæ˜¯è¦æ±‚16:9,æ‰€ä»¥æ ¹æ®æ¯”ä¾‹è®¡ç®—å‡ºæ¥é«˜åº¦å¤§å° è·å–åˆ°ä¸€äº›å®½é«˜ä¹‹åï¼Œä¾¿é©¬ä¸Šè¿›è¡Œå¯¹åæ ‡ç‚¹çš„è®¡ç®—ã€‚é¦–å…ˆæ¥çœ‹ä¸€å¼ å›¾ è¿™æ˜¯æˆ‘ä¼˜åŒ–ä¹‹å‰çš„ä¸€å¼ è‰å›¾ã€‚é¦–å…ˆæ¥è¯´ï¼Œç»˜åˆ¶çŸ©å½¢åªéœ€è¦çŸ¥é“å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„åæ ‡ã€‚ å¦‚å›¾ï¼Œç¬¬ä¸€ä¸ªçŠ¶æ€ï¼Œæ˜¯å­æ§ä»¶1æ˜¯0ï¼Œä¹Ÿå°±æ˜¯å·¦ä¸Šè§’å³ä¸ºçˆ¶æ§ä»¶çš„å·¦ä¸Šè§’ï¼Œå³ä¸‹è§’å³ä¸ºçˆ¶æ§ä»¶çš„å·¦ä¸Šè§’ï¼Œè€Œè¿™ä¸ªçŠ¶æ€ä¸­ï¼Œå­æ§ä»¶2å‘ˆç°æœ€å¤§çš„çŠ¶æ€ï¼Œå·¦ä¸Šè§’çš„ä»…ä»…ä¸ºçˆ¶æ§ä»¶çš„å‡å»ä¸€ä¸ªé€‰æ‹©åŒºåŸŸçš„å¤§å°ï¼Œå³ä¸‹è§’å³ä¸ºçˆ¶æ§ä»¶çš„å³ä¸‹è§’ã€‚ ä¸­é—´çš„çŠ¶æ€è¿›è¡Œå˜åŒ–ï¼Œå­æ§ä»¶1çš„å·¦ä¸Šè§’å’Œå­æ§ä»¶2çš„å³ä¸‹è§’å§‹ç»ˆå’Œçˆ¶æ§ä»¶ä¸€æ ·ï¼Œä¸è¿›è¡Œå˜åŒ–ã€‚è€Œè¿™é‡Œåªæœ‰ä¸Šä¸‹æ»‘åŠ¨ï¼Œæ‰€ä»¥ï¼Œå˜åŒ–çš„ä»…ä»…ä¸ºYè½´ä¸Šé¢ã€‚æ ¹æ®Androidçš„åæ ‡ç³»æ¥è¯´ï¼ŒYè½´å‘ä¸‹ä¸ºæ­£æ–¹å‘ã€‚ä¹Ÿå°±æ˜¯å­æ§ä»¶1çš„å³ä¸‹è§’çš„Yåæ ‡å’Œå­æ§ä»¶2çš„å·¦ä¸Šè§’çš„Yåæ ‡è¿›è¡ŒåŠ å‡æ‰‹æŒ‡æ»‘åŠ¨çš„è·ç¦»ï¼Œç„¶åè¿›è¡Œé‡ç»˜ï¼Œå³å¯è¾¾åˆ°ç»˜åˆ¶æ•ˆæœã€‚ ç¬¬ä¸‰ä¸ªçŠ¶æ€ä¾¿æ˜¯å½“æ»‘åˆ°æœ€åº•éƒ¨çš„æ—¶å€™ï¼ŒåŸç†å’Œç¬¬ä¸€ä¸ªçŠ¶æ€ç±»ä¼¼ï¼Œå­æ§ä»¶1è¾¾åˆ°æœ€å¤§ï¼Œå·¦ä¸‹è§’çš„åæ ‡ä»…ä»…å‡å»é€‰æ‹©åŒºåŸŸçš„é«˜åº¦ï¼›å­æ§ä»¶2ä¸º0ï¼Œå·¦ä¸Šè§’ä¸ºçˆ¶æ§ä»¶çš„å·¦ä¸‹è§’ï¼Œå³ä¸‹è§’ä¸ºçˆ¶æ§ä»¶çš„å³ä¸‹è§’ã€‚ ææ¸…æ¥šè¿™äº›ä¹‹åï¼Œå¼€å§‹è®¡ç®—åˆå§‹åŒ–çš„åæ ‡ç‚¹ï¼š 1234567891011121314151617181920212223242526272829303132333435 /** * åæ ‡ç‚¹çš„è®¡ç®— * Xè½´åŸºæœ¬ä¸å˜ï¼Œå˜åŒ–çš„æ˜¯Yè½´ */ private void initCalc() &#123; //è®¡ç®—çˆ¶æ§ä»¶çš„ä½ç½®ç‚¹ mPX1 = (int) (mScreenWidth / 2f - mParentWidth / 2f); mPY1 = 0; mPX2 = (int) (mScreenWidth / 2f + mParentWidth / 2f); mPY2 = (int) (mParentHeight); //åˆšå¼€å§‹å­æ§ä»¶1çš„ä½ç½®ç‚¹ mC1X1 = mPX1; mC1Y1 = mPY1; mC1X2 = mPX2; mC1Y2 = mPY1; //åˆšå¼€å§‹å­æ§ä»¶2çš„ä½ç½®ç‚¹ mC2X1 = mPX1; mC2Y1 = (int) (mChildHeight); mC2X2 = mPX2; mC2Y2 = mPY2; &#125;``` - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ§ä»¶æ‘†æ”¾åˆ°å±å¹•ä¸­é—´ï¼Œæ‰€ä»¥ï¼Œå·¦ä¸Šè§’çš„Xä¾¿æ˜¯å±å¹•å®½åº¦é™¤ä»¥2å‡å»è®¡ç®—å‡ºæ¥çš„çˆ¶æ§ä»¶å®½åº¦é™¤ä»¥2ã€‚å³ä¸‹è§’åŒç†æ˜¯åŠ ä¸Šçˆ¶æ§ä»¶å®½åº¦é™¤ä»¥2ã€‚3.ä½ç½®ç¡®å®šã€‚åæ ‡è®¡ç®—å®Œæ¯•ï¼Œè¿›è¡Œè®¾ç½®viewçš„å¤§å°ï¼š``` Java protected void onSizeChanged(int w, int h, int oldw, int oldh) &#123; super.onSizeChanged(w, h, oldw, oldh); setMeasuredDimension((int) mParentWidth, (int) mParentHeight); &#125; è¿™é‡Œè°ƒç”¨setMeasuredDimensionï¼ˆï¼‰å°†æˆ‘ä»¬è®¡ç®—å¥½çš„å®½é«˜è®¾ç½®ä¸Šå» 5.ç»˜åˆ¶ã€‚å› ä¸ºæˆ‘ä»¬è¿™è¾¹å·²ç»é€šè¿‡åæ ‡æ¥è¿›è¡Œäº†ä½ç½®çš„ç¡®å®šï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨onDraw()è¿›è¡Œç»˜åˆ¶ï¼š 123456789101112131415161718protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); //ç»˜åˆ¶çˆ¶æ§ä»¶ // æŒ‡å®šå›¾ç‰‡ç»˜åˆ¶åŒºåŸŸ Rect src = new Rect(0, 0, mParentBg.getWidth(), mParentBg.getHeight()); // æŒ‡å®šå›¾ç‰‡åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„åŒºåŸŸ Rect dst = new Rect(mPX1, mPY1, mPX2, mPY2); canvas.drawBitmap(mParentBg, src, dst, null); //ç»˜åˆ¶å­æ§ä»¶1 canvas.drawRect(mC1X1, mC1Y1, mC1X2, mC1Y2, mChildPaint); //ç»˜åˆ¶å­æ§ä»¶2 canvas.drawRect(mC2X1, mC2Y1, mC2X2, mC2Y2, mChildPaint);&#125; è¿™é‡Œçš„åŸºæœ¬éƒ½åœ¨åˆ†æçš„æ—¶å€™å·²ç»è¿›è¡Œäº†è¯´æ˜ï¼Œæ²¡æœ‰å¤ªå¤šè¦è¯´çš„åœ°æ–¹ã€‚mParentBgå³ä¸ºä¼ å…¥Bitmapå¯¹è±¡ã€‚ 6.åˆ’åŠ¨äº‹ä»¶ã€‚è¦è¿›è¡Œåˆ’åŠ¨äº†ï¼Œå¿ƒé‡Œå¼€å§‹è«åçš„ç´§å¼ ï¼Œè¿™éƒ¨åˆ†æ˜¯æœ€ä¸å¥½è¿›è¡Œæ§åˆ¶ã€‚è¿˜æ˜¯å…ˆçœ‹å›¾ï¼š MotionEvent.ACTION_DOWN: é¦–å…ˆæˆ‘ä»¬è‚¯å®šæ˜¯æœ‰ä¸€ä¸ªæ‹–æ‹½èŒƒå›´çš„ã€‚å› ä¸ºæˆ‘ä»¬åªèƒ½æ‹–é€‰æ‹©æ¡†çš„åœ°æ–¹æ‰èƒ½æœ‰æ•ˆã€‚æ‰€ä»¥ï¼Œå›¾ä¸Šå³è¾¹ç´«è‰²æˆ‘å†™äº†å¯é€‰ä¸­èŒƒå›´ã€‚ åœ¨Xè½´ä¸Šé¢ï¼Œæ²¡çš„è¯´ï¼Œå¾ˆå¥½åŠï¼Œå°±åœ¨çˆ¶æ§ä»¶çš„å®½åº¦å†…ã€‚ ä½†æ˜¯åœ¨Yè½´ä¸Šé¢çš„è¯ï¼Œéœ€è¦åŠ¨æ€æ ¹æ®é€‰æ‹©æ¡†çš„ä½ç½®è¿›è¡Œå˜åŒ–äº†ã€‚ ä¸€å¼€å§‹ï¼Œæˆ‘è¿›è¡Œåˆ¤æ–­åˆ’åŠ¨çš„æ—¶å€™ï¼Œå†™æ­»äº†åŒºåŸŸã€‚ä¸åœ¨è¿™ä¸ªåŒºåŸŸç›´æ¥ä¸è¿›è¡Œåˆ’åŠ¨ç›‘å¬ã€‚è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥åšåˆ°ï¼Œä½†æ˜¯æ•ˆæœå¹¶ä¸å¥½ã€‚ç¬¬ä¸€ç‚¹ï¼Œå½“æ‰‹æŒ‡ä»ä¸å¯é€‰ä¸­åŒºåŸŸåˆ’å…¥åˆ°å¯é€‰ä¸­çš„æ—¶å€™ï¼Œè¿™æ ·ä¼šå“åº”äº‹ä»¶ï¼Œè¡¨ç°å‡ºæ¥çš„ä¾¿æ˜¯é€‰æ‹©åŒºåŸŸçªç„¶è·³åˆ°æ‰‹æŒ‡æœ€å¼€å§‹è½ä¸‹çš„åœ°æ–¹(ä»ä¸Šå¾€ä¸‹åˆ’åŠ¨)ï¼›ç¬¬äºŒç‚¹ï¼Œä»å¯é€‰ä¸­åŒºåŸŸåˆ’åŠ¨åˆ°ä¸å¯é€‰ä¸­åŒºåŸŸï¼Œè¿™æ ·ä¸ä¼šå“åº”æ—¶é—´ï¼Œæ•ˆæœè¡¨ç°å‡ºæ¥å¥½åƒåˆ’ä¸åŠ¨ä¸€æ ·ã€‚ 12345678910//æ‰‹æŒ‡æŒ‰ä¸‹//è®°å½•æŒ‰ä¸‹çš„è·ç¦»float beginY = event.getY();if (beginY &lt; mC1Y2) &#123; //èµ·å§‹ç‚¹åœ¨é€‰æ‹©æ¡†ä¸Šéƒ¨ï¼Œä¸åšååº” return false;&#125; else if (beginY &gt; mC1Y2 + mChildHeight) &#123; //èµ·å§‹ç‚¹åœ¨é€‰æ‹©æ¡†ä¸‹éƒ¨ï¼Œä¸åšååº” return false;&#125; - æˆ‘ä»¬è®°å½•æ‰‹æŒ‡æŒ‰ä¸‹çš„Yåæ ‡ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå°äºäº†å­æ§ä»¶1çš„å³ä¸‹è§’Yåæ ‡ï¼Œè¯´æ˜æŒ‰ä¸‹çš„æ—¶å€™åœ¨é€‰æ‹©æ¡†çš„ä¸Šé¢ï¼Œé‚£ä¹ˆä¸åšååº”ï¼Œé’ˆå¯¹ä¸Šè¿°ç¬¬ä¸€ç‚¹ã€‚å¦‚æœæŒ‰ä¸‹è·ç¦»åœ¨å­æ§ä»¶2çš„å³ä¸‹è§’åŠ ä¸Šä¸€ä¸ªå¯é€‰å–ä¸çš„é«˜åº¦ï¼Œé‚£ä¹ˆè¯´æ˜æŒ‰ä¸‹çš„ç‚¹å†é€‰æ‹©æ¡†çš„ä¸‹éƒ¨ï¼Œé‚£å·²ç»è¶…å‡ºäº†å¯é€‰èŒƒå›´ï¼Œä¹Ÿä¸åšååº”ã€‚ è¯´å®Œäº†å¯æ‹–æ‹½åŒºåŸŸï¼Œç°åœ¨æ¥çœ‹ä¸€ä¸‹åˆ’åŠ¨çš„è·ç¦»å˜åŒ–ã€‚å…¶å®è¿™éƒ¨åˆ†åœ¨åˆ†æçš„æ—¶å€™ä¹Ÿè¯´äº†ï¼Œä¸»è¦æ˜¯å°±æ˜¯åŠ å‡æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»ä¾¿å¯ã€‚ è¦è®¡ç®—è·ç¦»ï¼Œè¿™é‡Œéœ€è¦å‡å»ä¸€ä¸ªæŒ‰ä¸‹çš„è·ç¦»å’Œå¯é€‰åŒºåŸŸçš„ä¸Šè¾¹æ¡†çš„å·®å€¼ï¼Œå¦åˆ™ï¼Œé€‰æ‹©æ¡†ä¼šè·³ä¸€ä¸‹ï¼Œç„¶åä»¥ä¸Šè¾¹æ¡†ä¸ºåŸºå‡†çº¿è¿›è¡Œæ”¹å˜ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š 12//è®°å½•æŒ‰ä¸‹çš„ä½ç½®å’Œé€‰æ‹©åŒºåŸŸçš„ä¸Šè¾¹è·çš„å·®mDistanceY = beginY - mC1Y2; MotionEvent.ACTION_MOVE: æˆ‘ä»¬æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»ä¸ºevent.getY() - beginYã€‚è€Œæˆ‘ä»¬å®é™…è¦è®¡ç®—çš„æ˜¯ç”»åœ¨å›¾ä¸­å³è¾¹ä¸€ç‚¹çš„å®é™…ç§»åŠ¨çš„æ”¹å˜å€¼ï¼Œä¾¿æ˜¯event.getY() - mDistanceYã€‚event.getY()æ˜¯æŒ‡è·ç¦»çˆ¶æ§ä»¶çš„ä¸Šè¾¹è·ï¼Œå‡å»ä¹‹å‰ç®—å¥½çš„mDistanceYï¼Œä¾¿å¯ä»¥æ¯”è¾ƒç²¾ç¡®å¾—å‡ºå®é™…ç§»åŠ¨çš„è·ç¦»ã€‚å¯èƒ½è¿˜æ˜¯ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¡ç®—å‡ºæ¥çš„è·ç¦»ä¼šå¤šä¸€éƒ¨åˆ†æ‰‹æŒ‡æŒ‰ä¸‹çš„è·ç¦»å’Œå¯é€‰åŒºåŸŸä¸Šè¾¹è·çš„è·ç¦»ã€‚å› ä¸ºæˆ‘ä»¬è¿™è¾¹æ˜¯æ”¹å˜çš„å­æ§ä»¶1å’Œ2çš„å¤§å°ï¼Œå­æ§ä»¶1æ˜¯ä»¥å³ä¸‹è§’çš„Yï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯é€‰åŒºåŸŸä¸Šè¾¹è¿™æ ¹çº¿ç»˜åˆ¶ã€‚å¦‚æœä¸ç®—æ‰‹æŒ‡å’Œå¯é€‰åŒºåŸŸä¸Šè¾¹è·çš„è·ç¦»ï¼Œé‚£ä¹ˆæ•ˆæœå°±æ˜¯åˆ’åŠ¨èµ·æ¥ï¼Œå¯é€‰åŒºåŸŸå°±ä¼šè·³ä¸€ä¸‹ï¼Œç„¶åä»¥å¯é€‰åŒºåŸŸä¸Šè¾¹è¿™æ ¹çº¿åœ¨åˆ’åŠ¨ï¼Œè€Œæ‰‹æŒ‡æŒ‰ä¸‹çš„æ—¶å€™æ˜æ˜å’Œä¸Šè¾¹æ˜¯æœ‰ä¸€å®šè·ç¦»çš„ã€‚è¿™éƒ¨åˆ†å¯ä»¥å°è¯•å»æ‰è¿›è¡Œæ„Ÿå—ã€‚ï¼ˆæ„Ÿè§‰æ–‡å­—åŠŸåº•ä¸å¥½ï¼Œæœ‰ç‚¹æ‰¯ä¸æ¸…ï¼Œé€ƒ~ï¼‰ç®€å•æ¥è¯´ï¼Œåæ­£å°±æ˜¯è¦è®°å½•ä¸‹æ‰‹æŒ‡æŒ‰ä¸‹è·ç¦»å¯é€‰åŒºåŸŸä¸Šè¾¹çš„è·ç¦»ï¼Œåœ¨ç§»åŠ¨å®Œä¹‹åï¼Œæ‰‹æŒ‡è¿˜æ˜¯è¦è·ç¦»å¯é€‰åŒºåŸŸåŒæ ·çš„è·ç¦»ã€‚å—¯ï¼Œå°±æ˜¯è¿™æ ·ï¼Œå–µã€‚ è¿™æ ·å°±å®Œå·¥äº†ã€‚ç­‰ç­‰ï¼Œä¸æ€¥ã€‚æˆ‘ä»¬çš„å¯é€‰åŒºåŸŸè‚¯å®šæ˜¯ä¸èƒ½åˆ’å‡ºçˆ¶æ§ä»¶å“’ã€‚ä¹Ÿå°±æ˜¯è¯´å¯é€‰åŒºåŸŸä¸Šé¢ä¸èƒ½åˆ’å‡ºçˆ¶æ§ä»¶çš„ä¸Šé¢ï¼Œä¸‹é¢ä¹Ÿä¸èƒ½åˆ’å‡ºçˆ¶æ§ä»¶çš„ä¸‹é¢çš„ã€‚ å¾€ä¸Šåˆ’åŠ¨ã€‚éœ€è¦åˆ¤æ–­ä¸‹å­æ§ä»¶1å³ä¸‹è§’çš„Yä¸èƒ½å°äº0ï¼Œå³ä¸èƒ½å°äºäº†çˆ¶æ§ä»¶çš„Yï¼Œè¶…è¿‡äº†åˆ™ä¿æŒçŠ¶æ€ä¸€ã€‚ å¾€ä¸‹åˆ’åŠ¨ã€‚éœ€è¦åˆ¤æ–­ä¸‹å­æ§ä»¶1å³ä¸‹è§’çš„Yä¸èƒ½å¤§äºçˆ¶æ§ä»¶é«˜åº¦å‡å»ä¸€ä¸ªå¯é€‰åŒºåŸŸçš„é«˜åº¦ï¼Œè¶…è¿‡äº†åˆ™ä¿æŒçŠ¶æ€ä¸‰ã€‚ 12345678910111213//å¾€ä¸Šæ»‘åŠ¨if (mC1Y2 &lt; 0) &#123; //é˜²æ­¢é¡¶éƒ¨è¶…è¿‡å‡º //å­æ§ä»¶1ä¸º0 mC1Y2 = 0; //å­æ§ä»¶2ä¸ºæœ€å¤§ mC2Y1 = (int) (mSelectHeight);&#125; else if (mC1Y2 &gt; mParentHeight - mSelectHeight) &#123; //é˜²æ­¢åº•éƒ¨è¶…è¿‡ //å­æ§ä»¶1ä¸ºæœ€å¤§ mC1Y2 = (int) (mParentHeight - mSelectHeight); //å­æ§ä»¶2ä¸º0 mC2Y1 = (int) (mParentHeight); æœ€åæ‰§è¡Œä¸€ä¸‹é‡ç»˜ã€‚invalidate() æœ€åæ¥ä¸€ä¸ªå®Œæ•´çš„onTouchEvent()çš„ä»£ç ï¼Œå…¶å®ä¸Šè¯‰å·²ç»è¯´å®Œäº† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public boolean onTouchEvent(MotionEvent event) &#123; //æœ‰æ•ˆè§¦æ§èŒƒå›´(Xè½´ï¼ŒYè½´å¦å¤–åˆ¤æ–­) if (mC1X1 &lt;= event.getRawX() &amp;&amp; event.getRawX() &lt;= mC1X1 + mParentWidth) &#123; switch (event.getAction()) &#123; case MotionEvent.ACTION_DOWN: //æ‰‹æŒ‡æŒ‰ä¸‹ //è®°å½•æŒ‰ä¸‹çš„è·ç¦» float beginY = event.getY(); if (beginY &lt; mC1Y2) &#123; //èµ·å§‹ç‚¹åœ¨é€‰æ‹©æ¡†ä¸Šéƒ¨ï¼Œä¸åšååº” return false; &#125; else if (beginY &gt; mC1Y2 + mSelectHeight) &#123; //èµ·å§‹ç‚¹åœ¨é€‰æ‹©æ¡†ä¸‹éƒ¨ï¼Œä¸åšååº” return false; &#125; //è®°å½•æŒ‰ä¸‹çš„ä½ç½®å’Œé€‰æ‹©åŒºåŸŸçš„ä¸Šè¾¹è·çš„å·® mDistanceY = beginY - mC1Y2; break; case MotionEvent.ACTION_MOVE: //mC1Y1å’ŒmC2Y2å§‹ç»ˆä¸å˜ //æ›´æ”¹å­æ§ä»¶åæ ‡ mC1Y2 = (int) (event.getY() - mDistanceY); mC2Y1 = (int) (event.getY() - mDistanceY + mSelectHeight); //å¾€ä¸Šæ»‘åŠ¨ if (mC1Y2 &lt; 0) &#123; //é˜²æ­¢é¡¶éƒ¨è¶…è¿‡å‡º //å­æ§ä»¶1ä¸º0 mC1Y2 = 0; //å­æ§ä»¶2ä¸ºæœ€å¤§ mC2Y1 = (int) (mSelectHeight); &#125; else if (mC1Y2 &gt; mParentHeight - mSelectHeight) &#123; //é˜²æ­¢åº•éƒ¨è¶…è¿‡ //å­æ§ä»¶1ä¸ºæœ€å¤§ mC1Y2 = (int) (mParentHeight - mSelectHeight); //å­æ§ä»¶2ä¸º0 mC2Y1 = (int) (mParentHeight); &#125; //é‡æ–°ç»˜åˆ¶ invalidate(); break; case MotionEvent.ACTION_UP: //æ‰‹æŒ‡æŠ¬èµ· break; case MotionEvent.ACTION_CANCEL: //äº‹ä»¶å–æ¶ˆ break; default: break; &#125; &#125; return true;&#125; 7.åç»­å¤„ç†ã€‚åç»­å¤„ç†çš„è¯ï¼Œå’Œé¡¹ç›®ä¸ä¸€æ ·å°±ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬é¡¹ç›®æ˜¯æŠŠå¯é€‰åŒºåŸŸçš„åæ ‡ç»å¯¹å€¼ç»™åå°ï¼Œåå°æˆªå–ã€‚demoé‡Œé¢æ˜¯åˆ©ç”¨Androidçš„æˆªå›¾ï¼Œç„¶åä¼ å»å¯é€‰åŒºåŸŸçš„åæ ‡æˆªå–å‡ºæ¥ï¼Œä½†æ˜¯è¿™æ ·åˆ†è¾¨ç‡è‚¯å®šæ¯”è¾ƒä½ï¼Œä¸å¤ªé€‚åˆåšå°é¢ã€‚ç„¶åå°±æ˜¯æˆªå–çš„è¯ï¼Œéœ€è¦æ³¨æ„ä¸‹æœ‰ä¸ªçŠ¶æ€æ é«˜åº¦ã€‚ï¼ˆè¿™é‡Œæœ‰ä¸ªå°å‘çš„åœ°æ–¹ï¼Œå°±æ˜¯Androidæˆªå›¾ç³»ç»Ÿåªæœ‰èƒ½ä¸€å¼ ï¼Œéœ€è¦é‡æ–°åŠ è½½æ‰èƒ½è·å–æ–°çš„æˆªå›¾ï¼Œå› ä¸ºé¡¹ç›®æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªï¼Œæ‰€ä»¥æ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå¦‚æœæœ‰çŸ¥é“çš„ï¼Œéº»çƒ¦èµæ•™ï¼Œæ„Ÿè°¢ï¼‰ 123456789101112131415161718192021222324252627public Bitmap getBitmap(Activity activity) &#123; View screenView = activity.getWindow().getDecorView(); screenView.setDrawingCacheEnabled(true); screenView.buildDrawingCache(); //è·å–å±å¹•æ•´å¼ å›¾ Bitmap bitmap = screenView.getDrawingCache(); //æˆªå›¾æŒ‡å®šéƒ¨åˆ† if (bitmap != null) &#123; bitmap = Bitmap.createBitmap(bitmap, mC1X1, mC1Y2 + getStatusBarHeight(), (int) mParentWidth, (int) mSelectHeight); &#125; invalidate(); return bitmap;&#125;/** * è·å–çŠ¶æ€æ é«˜åº¦ */private int getStatusBarHeight() &#123; int result = 0; int resourceId = mContext.getResources().getIdentifier(\"status_bar_height\", \"dimen\", \"android\"); if (resourceId &gt; 0) &#123; result = mContext.getResources().getDimensionPixelSize(resourceId); &#125; return result;&#125; ç»“è¯­ demoå·²ç»æ”¾åˆ°äº†githubï¼šhttps://github.com/sorgs/DragViewä¸Šé¢äº†ï¼Œå¦‚æœèƒ½å¸®åˆ°æ‚¨çš„è¯ï¼Œè¿˜éº»çƒ¦åŠ¨åŠ¨å°æŒ‡å¤´ç»™ä¸ªå°æ˜Ÿæ˜Ÿï¼Œä¸‡åˆ†æ„Ÿè°¢äº†ï¼ æœ¬äººæ‰ç–å­¦æµ…ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªè¿˜å·®ä¸€ä¸ªå¤šæœˆæ‰æ¯•ä¸šçš„åº”å±Šç”Ÿï¼Œå†™çš„æ¯”è¾ƒç®€å•ï¼Œè¯·å¤§å®¶è§è°…ã€‚å¦‚æœæœ‰ä»€ä¹ˆçº°æ¼å’Œä¸å¯¹çš„åœ°æ–¹ï¼Œæ„Ÿè°¢æŒ‡å‡ºã€‚ å¯¹è‡ªå®šä¹‰Viewå®‰åˆ©ä¸€ä¸ªå­¦ä¹ çš„åœ°æ–¹ï¼šhttp://www.gcssloop.com/customview/CustomViewIndex/ï¼ŒGcsSloopå¤§ä½¬çš„ç³»åˆ—ï¼Œå¾ˆå—æ•™ï¼ æœ€åå°±æ˜¯æˆ‘æœ€æƒ³è¯´çš„ã€‚å…¶å®å¾ˆå¤šä¸œè¥¿çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯æ…¢æ…¢é™ä¸‹å¿ƒå»åšè¿˜æ˜¯å¯ä»¥åšå‡ºæ¥çš„ã€‚è™½ç„¶è¿™ä¸ªå¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è€å¤§è¯´è®©æˆ‘ç ”ç©¶ä¸‹çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼å•Šã€‚å¿ƒé‡Œæƒ³ï¼Œè¿™ï¼Œæˆ‘æ€ä¹ˆèƒ½åšå¾—å‡ºæ¥ã€‚åæ­£ç ”ç©¶å˜›ï¼Œåšä¸å‡ºæ¥è¿˜æœ‰è€å¤§æ’‘è…°ã€‚å°±æ˜¯å°±ä¸€æ­¥ä¸€æ­¥æ¥å°è¯•ï¼Œå…ˆè®©åŠ¨èµ·æ¥ï¼Œç„¶åå†æ…¢æ…¢é è¿‘éœ€æ±‚ï¼Œæœ€åä¼˜åŒ–ã€‚æœ€ç»ˆå‘ç°è¿˜æ˜¯å¼„å‡ºæ¥äº†ã€‚å†™è¿™ç¯‡åšå®¢çš„ä¸»è¦ç›®çš„å°±æ˜¯ç»™è‡ªå·±å’Œå¤§å®¶è¯´è¿™ä¸ªé“ç†ï¼Œä¸ç•æƒ§ï¼Œä¸€æ­¥æ­¥æ¥ï¼","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"è‡ªå®šä¹‰View","slug":"è‡ªå®šä¹‰View","permalink":"http://sorgs.cn/tags/è‡ªå®šä¹‰View/"},{"name":"969","slug":"969","permalink":"http://sorgs.cn/tags/969/"},{"name":"æ»‘åŠ¨äº‹ä»¶","slug":"æ»‘åŠ¨äº‹ä»¶","permalink":"http://sorgs.cn/tags/æ»‘åŠ¨äº‹ä»¶/"}]},{"title":"JAVAç¼–ç¨‹æ€æƒ³è¯»ä¹¦ç¬”è®°-2","date":"2018-01-26T06:39:16.000Z","path":"post/45310/","text":"ç¬¬ä¸€ç« å¯¹è±¡å¯¼è®º(1.7-1.13) 1.7ä¼´éšå¤šæ€çš„å¯äº’æ¢å¯¹è±¡ åœ¨å¤„ç†ç±»å‹çš„å±‚æ¬¡ç»“æ„æ—¶ï¼Œç»å¸¸æƒ³æŠŠä¸€ä¸ªå¯¹è±¡ä¸å½“åšå®ƒæ‰€å±çš„ç‰¹å®šç±»å‹æ¥å¯¹å¾…ï¼Œè€Œæ˜¯å°†å…¶å½“åšå…¶åŸºç±»çš„å¯¹è±¡æ¥å¯¹å¾…ã€‚ è¿™æ ·çš„ä»£ç æ˜¯ä¸ä¼šå—æ·»åŠ æ–°ç±»å‹çš„å½±å“ï¼Œè€Œä¸”æ·»åŠ æ–°ç±»å‹æ˜¯æ‰©å±•ä¸€ä¸ªé¢å‘å¯¹è±¡ç¨‹åºä»¥ä¾¿å¤„ç†æ–°æƒ…å†µçš„æœ€å¸¸ç”¨æ–¹å¼ã€‚ åœ¨javaä¸­ï¼ŒåŠ¨æ€ç»‘å®šæ˜¯é»˜è®¤è¡Œä¸ºï¼Œä¸éœ€è¦æ·»åŠ é¢å¤–çš„å…³é”®å­—æ¥å®ç°å¤šæ€ã€‚ 1.8å•æ ¹ç»§æ‰¿ç»“æ„ åœ¨å•æ ¹ç»§æ‰¿ç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½å…·æœ‰ä¸€ä¸ªå…±ç”¨æ¥å£ï¼Œæ‰€ä»¥ä»–ä»¬å½’æ ¹ç»“åº•åˆ°åº•éƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»å‹ã€‚ å•æ ¹æ¥å£ä¿è¯æ‰€æœ‰å¯¹è±¡éƒ½å…·å¤‡æŸäº›åŠŸèƒ½ã€‚ å¯¹è±¡éƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨å †ä¸Šåˆ›å»ºã€‚ 1.9å®¹å™¨ ä¸åŒå®¹å™¨æä¾›äº†ä¸åŒç±»å‹çš„æ¥å£å’Œå¤–éƒ¨è¡Œä¸ºã€‚ ä¸åŒçš„å®¹å™¨å¯¹äºæŸäº›æ“ä½œå…·æœ‰ä¸åŒçš„æ•ˆç‡ã€‚ é™¤éç¡®åˆ‡çŸ¥é“æ‰€è¦å¤„ç†çš„å¯¹è±¡çš„ç±»å‹ï¼Œå¦åˆ™å‘ä¸‹è½¬å‹å‡ ä¹æ˜¯ä¸å®‰å…¨çš„ã€‚ 1.10å¯¹è±¡çš„åˆ›å»ºå’Œç”Ÿå‘½æœŸ å°†å¯¹è±¡ç½®äºå †æ ˆï¼ˆå®ƒä»¬æœ‰æ—¶å€™è¢«ç§°ä¸ºè‡ªåŠ¨å˜é‡æˆ–é™åŸŸå˜é‡ï¼‰æˆ–é™æ€å­˜å‚¨åŒºå†…æ¥å®ç°ã€‚è¿™ç§æ–¹å¼å°†å­˜å‚¨ç©ºé—´åˆ†é…å’Œé‡Šæ”¾ç½®äºä¼˜å…ˆè€ƒè™‘çš„ä½ç½®ï¼ŒæŸäº›æƒ…å†µä¸‹è¿™æ ·æ§åˆ¶éå¸¸æœ‰ä»·å€¼ã€‚ä½†æ˜¯ä¹Ÿç‰ºç‰²äº†çµæ´»æ€§ã€‚ ç¬¬äºŒç§æ–¹å¼æ˜¯åœ¨è¢«ç§°ä¸ºå †çš„å†…å­˜æ± ä¸­åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€‚è¿™ç§æ–¹å¼ä¸­ï¼ŒçŸ¥é“è¿è¡Œæ—¶æ‰çŸ¥é“éœ€è¦å¤šå°‘å¯¹è±¡ï¼Œå®ƒä»¬ç”Ÿå‘½å‘¨æœŸå¦‚ä½•ï¼Œä»¥åŠå®ƒä»¬çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆã€‚ javaå®Œå…¨é‡‡ç”¨äº†åŠ¨æ€å†…å­˜åˆ†é…æ–¹å¼ï¼Œæ¯å½“æƒ³è¦åˆ›å»ºæ–°å¯¹è±¡æ—¶ï¼Œå°±è¦ä½¿ç”¨newå…³é”®å­—æ¥æ„å»ºæ­¤å¯¹è±¡çš„åŠ¨æ€å®ä¾‹ã€‚ 1.11å¼‚å¸¸å¤„ç†ï¼šå¤„ç†é”™è¯¯ å¼‚å¸¸å¤„ç†å°†é”™è¯¯å¤„ç†ç›´æ¥ç½®äºç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæœ‰æ—¶ç”šè‡³ç½®äºæ“ä½œç³»ç»Ÿä¸­ã€‚å¼‚å¸¸æ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒä»å‡ºé”™åœ°ç‚¹è¢«â€œæŠ›å‡ºâ€ï¼Œå¹¶è¢«ä¸“é—¨è®¾è®¡ç”¨æ¥å¤„ç†ç‰¹å®šç±»å‹é”™è¯¯çš„ç›¸åº”çš„å¼‚å¸¸å¤„ç†å™¨â€œæ•è·â€ã€‚ å¼‚å¸¸æä¾›äº†ä¸€ç§ä»é”™è¯¯çŠ¶æ€è¿›è¡Œå¯é æ¢å¤çš„é€”å¾„ã€‚ å¼‚å¸¸å¤„ç†ä¸æ˜¯é¢å‘å¯¹è±¡çš„ç‰¹å¾ã€‚å¼‚å¸¸å¤„ç†åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¹‹å‰å°±å·²ç»å­˜åœ¨äº†ã€‚ 1.12å¹¶å‘ç¼–ç¨‹ åœ¨ç¨‹åºä¸­ï¼Œè¿™äº›å½¼æ­¤ç‹¬ç«‹è¿è¡Œçš„éƒ¨åˆ†ç§°ä¹‹ä¸ºçº¿ç¨‹ï¼Œä¸Šè¿°æ¦‚å¿µè¢«ç§°ä¸ºâ€œå¹¶å‘â€ã€‚ é€šå¸¸ï¼Œçº¿ç¨‹åªæ˜¯ä¸€ç§ä¸ºå•ä¸€å¤„ç†å™¨åˆ†é…æ‰§è¡Œæ—¶é—´çš„æ‰‹æ®µã€‚ 1.13Javaä¸Internet å®ƒè§£å†³äº†ä¸‡ç»´ç½‘ä¸Šçš„ç¨‹åºè®¾è®¡é—®é¢˜ã€‚","tags":[{"name":"JAVAå­¦ä¹ ","slug":"JAVAå­¦ä¹ ","permalink":"http://sorgs.cn/tags/JAVAå­¦ä¹ /"}]},{"title":"JAVAç¼–ç¨‹æ€æƒ³è¯»ä¹¦ç¬”è®°_1","date":"2018-01-25T07:08:25.000Z","path":"post/4506/","text":"ç¬¬ä¸€ç« å¯¹è±¡å¯¼è®º(1.1-1.6) 1.1æŠ½è±¡è¿‡ç¨‹ ç¨‹åºå‘˜å¿…é¡»å»ºç«‹èµ·åœ¨æœºå™¨æ¨¡å‹ï¼ˆä½äºâ€œè§£ç©ºé—´â€å†…ï¼Œè¿™æ˜¯ä½ å¯¹é—®é¢˜å»ºæ¨¡çš„åœ°æ–¹ï¼Œä¾‹å¦‚è®¡ç®—æœºï¼‰å’Œå®é™…å¾…è§£å†³é—®é¢˜çš„æ¨¡å‹ï¼ˆä½äºâ€œè§£ç©ºé—´â€å†…ï¼Œè¿™æ˜¯é—®é¢˜å­˜åœ¨çš„åœ°æ–¹ï¼Œä¾‹å¦‚ä¸€é¡¹ç‰©ä¸šï¼‰ä¹‹å‰çš„å…³è”ã€‚ é¢å‘å¯¹è±¡äº”ä¸ªåŸºæœ¬ç‰¹å¾ï¼š ä¸‡ç‰©çš†å¯¹è±¡ ç¨‹åºæ˜¯å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬é€šè¿‡å‘æ¶ˆæ¯æ¥å‘ŠçŸ¥å½¼æ­¤æ‰€è¦åšçš„ã€‚ æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„ç”±å…¶ä»–å¯¹è±¡æ‰€æ„æˆçš„å­˜å‚¨ã€‚ æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰å…¶ç±»å‹ã€‚ æŸä¸€ç‰¹å®šçš„å†…ç±»å‹çš„æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥æ¥å—åŒæ ·çš„æ¶ˆæ¯ã€‚ æ›´åŠ ç®€æ´çš„æè¿°ï¼šå¯¹è±¡å…·æœ‰çŠ¶æ€ã€è¡Œä¸ºå’Œæ ‡è¯†ã€‚è¿™æ„å‘³ç€æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥æ‹¥æœ‰å†…éƒ¨æ•°æ®ï¼ˆå®ƒä»¬ç»™å‡ºäº†è¯¥å¯¹è±¡çš„çŠ¶æ€ï¼‰å’Œæ–¹æ³•ï¼ˆå®ƒä»¬äº§ç”Ÿè¡Œä¸ºï¼‰ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥å”¯ä¸€åœ°ä¸å…¶ä»–å¯¹è±¡åŒºåˆ†å¼€æ¥ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¯ä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ã€‚ 1.2æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæ¥å£ å…·æœ‰ç›¸åŒçš„ç‰¹å¾å’Œè¡Œä¸ºçš„å¯¹è±¡æ‰€å½’å±çš„ç±»çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å…·æœ‰ç›¸åŒç‰¹å¾ï¼ˆæ•°æ®å…ƒç´ ï¼‰å’Œè¡Œä¸ºï¼ˆåŠŸèƒ½ï¼‰çš„å¯¹è±¡é›†åˆï¼Œæ‰€ä»¥ä¸€ä¸ªç±»å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ã€‚ é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡çš„æŒ‘æˆ˜ä¹‹ä¸€ï¼Œå°±æ˜¯åœ¨é—®é¢˜ç©ºé—´çš„å…ƒç´ å’Œè§£ç©ºé—´çš„å¯¹è±¡ä¹‹é—´åˆ›å»ºä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚ æ¯ä¸ªå¯¹è±¡éƒ½åªèƒ½æ»¡è¶³æŸäº›è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ç”±å¯¹è±¡çš„æ¥å£ï¼ˆinterfaceï¼‰æ‰€å®šä¹‰ï¼Œå†³å®šæ¥å£çš„ä¾¿æ˜¯ç±»å‹ã€‚ ä¸ºäº†å‘å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œéœ€è¦å£°æ˜å¯¹è±¡çš„åç§°ï¼Œå¹¶ä»¥åœ†ç‚¹è¿æ¥ä¸€ä¸ªæ¶ˆæ¯è¯·æ±‚ã€‚ 1.3æ¯ä¸ªå¯¹è±¡éƒ½æä¾›æœåŠ¡ é«˜å†…èšæ˜¯è½¯ä»¶è®¾è®¡çš„åŸºæœ¬è´¨é‡è¦æ±‚ä¹‹ä¸€ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè½¯ä»¶æ„å»ºï¼ˆä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰å¯èƒ½æ˜¯æŒ‡ä¸€ä¸ªæ–¹æ³•æˆ–ä¸€ä¸ªå¯¹è±¡åº“ï¼‰çš„å„ä¸ªæ–¹é¢â€œç»„åˆâ€å¾—å¾ˆå¥½ã€‚ 1.4è¢«éšè—çš„å…·ä½“å®ç° è®¿é—®æ§åˆ¶çš„ç¬¬ä¸€ä¸ªå­˜åœ¨åŸå› å°±æ˜¯è®©å®¢æˆ·ç«¯ç¨‹åºå‘˜æ— æ³•è§¦åŠä»–ä»¬ä¹Ÿä¸åº”è¯¥è§¦åŠçš„éƒ¨åˆ†â€”â€”è¿™äº›éƒ¨åˆ†å¯¹æ•°æ®ç±»å‹çš„å†…éƒ¨æ“ä½œæ¥è¯´æ˜¯å¿…éœ€çš„ï¼Œä½†å¹¶ä¸æ˜¯ç”¨æˆ·è§£å†³ç‰¹å®šé—®é¢˜æ‰€éœ€è¦çš„æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚ è®¿é—®æ§åˆ¶çš„ç¬¬äºŒä¸ªå­˜åœ¨åŸå› å°±æ˜¯å…è®¸åº“è®¾è®¡è€…å¯ä»¥æ”¹å˜ç±»å†…éƒ¨çš„å·¥ä½œæ–¹å¼ä¸ç”¨æ‹…å¿ƒä¼šå½±å“åˆ°å®¢æˆ·ç«¯ç¨‹åºå‘˜ã€‚ Javaç”¨ä¸‰ä¸ªå…³é”®å­—åœ¨ç±»çš„å†…éƒ¨è®¾å®šè¾¹ç•Œï¼špublicã€privateã€protectedã€‚ è¿˜æœ‰ä¸€ç§é»˜è®¤è®¿é—®æƒé™ï¼Œé€šå¸¸ç§°ä¸ºåŒ…è®¿é—®æƒé™ï¼Œç±»å¯ä»¥è®¿é—®åœ¨åŒä¸€ä¸ªåŒ…ï¼ˆåº“æ„ä»¶ï¼‰ä¸­çš„å…¶å®ƒç±»çš„æˆå‘˜ï¼Œä½†æ˜¯åœ¨åŒ…ä¹‹å¤–ï¼Œè¿™äº›æˆå‘˜å¦‚åŒæŒ‡å®šäº†privateä¸€æ ·ã€‚ 1.5å¤ç”¨å…·ä½“å®ç° å¤ç”¨æ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡æ‰€æä¾›çš„æœ€äº†ä¸èµ·çš„ä¼˜ç‚¹ä¹‹ä¸€ã€‚ 1.6 ç»§æ‰¿ ä¸€ä¸ªåŸºç±»åŒ…å«å…¶æ‰€æœ‰å¯¼å‡ºç±»å‹æ‰€å…±äº«çš„ç‰¹æ€§å’Œè¡Œä¸ºã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºç±»æ¥è¡¨ç¤ºç³»ç»Ÿä¸­æŸäº›å¯¹è±¡çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä»åŸºç±»ç±»å‹ä¸­å¯¼å‡ºå…¶ä»–ç±»å‹ï¼Œæ¥è¡¨ç¤ºæ­¤æ ¸å¿ƒå¯ä»¥è¢«å®ç°çš„å„ç§ä¸åŒæ–¹å¼ã€‚ å¯¼å‡ºç±»ä¸åŸºç±»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚ æƒ³è¦è¦†ç›–æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åœ¨å¯¼å‡ºç±»ä¸­åˆ›å»ºè¯¥æ–¹æ³•çš„æ–°å®šä¹‰å³å¯ã€‚ åˆ¤æ–­æ˜¯å¦ç»§æ‰¿ï¼Œå°±æ˜¯è¦ç¡®å®šæ˜¯å¦å¯ä»¥ç”¨is-aæ¥æè¿°æ¥æè¿°ç±»ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä½¿ä¹‹å…·æœ‰å®é™…æ„ä¹‰ã€‚","tags":[{"name":"JAVAå­¦ä¹ ","slug":"JAVAå­¦ä¹ ","permalink":"http://sorgs.cn/tags/JAVAå­¦ä¹ /"}]},{"title":"AndroidåŠ¨æ€å›¾ç‰‡é€‰æ‹©çš„ä¸€ç§ç®€å•å®ç°æ–¹å¼","date":"2018-01-20T12:20:08.000Z","path":"post/3403/","text":"å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œä»¥åè¿˜æ˜¯å†³å®šæ¯ä¸ªæœˆæ¥æ›´æ–°ä¸€éã€‚æœ¬æ¬¡åˆ°æ¥çš„æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„åœºæ™¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å‘æœ‹å‹åœˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¤šå¼ ç…§ç‰‡ï¼Œä¹Ÿå¯ä»¥åˆ é™¤ä¹‹å‰é€‰æ‹©çš„ï¼Œä½†æ˜¯æœ€å¤šä¸€èˆ¬ä¼šæœ‰ä¸ªä¸Šé™ï¼Œè¾¾åˆ°ä¸Šé™ä¹‹åä¸€èˆ¬æ·»åŠ çš„å°±æ¶ˆå¤±äº†ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç®€å•çš„å®ç°æ€è·¯ã€‚ æ•ˆæœå›¾ æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹çœ‹æ•ˆæœå›¾ é¦–å…ˆæ˜¯æ²¡æœ‰å›¾ç‰‡çš„æ—¶å€™ ç„¶åæˆ‘ä»¬é€‰æ‹©ä¸¤å¼ å›¾ç‰‡ é€‰å¯ä»¥ç‚¹å›¾ç‰‡å³ä¸Šäº¤çš„Ã—åˆ é™¤ä¸€å¼  æœ€åæ˜¯é€‰æ‹©6å¼ ï¼Œç»§ç»­æ·»åŠ æ ‡å¿—æ¶ˆå¤±ï¼ˆæˆ‘è¿™é‡Œä¸Šé™æ˜¯6å¼ ï¼Œåé¢è¯»è€…å¯ä»¥æ›´æ–°ä»£ç è‡ªå·±è®¾ç½®ä¸Šé™ï¼‰ ä»£ç å®ç° è¿™é‡Œç®€å•çš„æä¾›ä¸€ç§å®ç°æ–¹å¼ æˆ‘è¿™é‡Œæ˜¯åˆ©ç”¨RecyclerViewæ¥å®ç°ï¼Œæ¥ä¸‹æ¥å…·ä½“çœ‹ä¸‹ é¦–å…ˆæ˜¯ä¸»å¸ƒå±€æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªRecyclerView 123456789101112131415161718192021222324252627282930313233343536373839404142 &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/rl_repair\" android:layout_width=\"match_parent\" android:layout_height=\"250dp\"&gt; &lt;/android.support.v7.widget.RecyclerView&gt;``` - ç„¶åä¸»è¦é€»è¾‘ä»£ç åœ¨adapterï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹adapterçš„å¸ƒå±€ ``` xml&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"100dp\" android:layout_height=\"100dp\" android:layout_margin=\"10dp\"&gt; &lt;ImageView android:id=\"@+id/iv_add\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:scaleType=\"centerCrop\" android:src=\"@mipmap/bg_scan\"/&gt; &lt;ImageView android:id=\"@+id/iv_photo\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:scaleType=\"centerCrop\"/&gt; &lt;ImageView android:id=\"@+id/iv_remove\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_alignParentRight=\"true\" android:paddingBottom=\"5dp\" android:paddingLeft=\"5dp\" android:scaleType=\"centerCrop\" android:src=\"@mipmap/ic_delete\" android:visibility=\"visible\"/&gt;&lt;/RelativeLayout&gt; è¿™éƒ¨åˆ†ä»£ç æ²¡æœ‰ä»€ä¹ˆè¦è¯´çš„ï¼Œä¸»è¦æ˜¯ç”¨RelativeLayouté‡Œé¢åŒ…è£¹3ä¸ªImageViewï¼Œä¸€ä¸ªç”¨å›¾ç‰‡å³ä¸Šè§’æ˜¾ç¤ºçš„åˆ é™¤ï¼Œä¸€ä¸ªæ˜¯æ·»åŠ æ–°å›¾ç‰‡ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ç”¨æ¥å±•ç¤ºé€‰æ‹©çš„å›¾ç‰‡ æ¥ä¸‹æ¥æ˜¯adapterçš„é€»è¾‘éƒ¨åˆ†ä»£ç äº† 12345678910111213141516171819202122@Overridepublic void onBindViewHolder(ViewHolder holder, int position) &#123; if (mList.size() &gt;= MAX_SIZE) &#123; //æœ€å¤š6å¼  holder.ivAdd.setVisibility(View.GONE); holder.ivRemove.setVisibility(View.GONE); &#125; else &#123; holder.ivPhoto.setVisibility(View.VISIBLE); holder.ivPhoto.setVisibility(View.VISIBLE); holder.ivRemove.setVisibility(View.VISIBLE); &#125; if (getItemViewType(position) == TYPE_ADD) &#123; holder.ivRemove.setVisibility(View.GONE); holder.ivPhoto.setVisibility(View.GONE); &#125; else &#123; holder.ivRemove.setVisibility(View.VISIBLE); holder.ivAdd.setVisibility(View.GONE); holder.ivPhoto.setVisibility(View.VISIBLE); holder.ivPhoto.setImageBitmap(BitmapFactory.decodeFile(mList.get(position))); &#125;&#125; ä¸éš¾çœ‹å‡ºï¼Œè¿™é‡Œåˆ©ç”¨setVisibilityæ¥è¿›è¡Œæ“ä½œï¼Œæ›´å…·æ•°æ®æ¥æ˜¾ç¤ºé‚£äº›æˆ–è€…éšè—å“ªäº›ã€‚å½“æˆ‘ä»¬çš„æ•°ç›®å¤§äºç­‰äº6çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ é™¤å’Œæ·»åŠ éšè—èµ·æ¥ã€‚ åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±éœ€è¦æœ‰æ·»åŠ çš„å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„sizeåº”è¯¥æ˜¯ 1234@Overridepublic int getItemCount() &#123; return mList.size() + 1;&#125; æ•°ç›®åº”è¯¥è¦å¤šåŠ ä¸€ä¸ªï¼Œç„¶ååº”è¯¥æ³¨æ„åˆ°äº†æˆ‘ä»¬çš„getItemViewType()æ–¹æ³•äº†ï¼Œè¿™é‡Œæˆ‘ä»¬è¿›å…¥çœ‹ä¸‹ 12345678@Overridepublic int getItemViewType(int position) &#123; if (position == getItemCount() - 1) &#123; return TYPE_ADD; &#125; else &#123; return TYPE_PIC; &#125;&#125; æ²¡é”™ï¼Œè¿™é‡Œå°±æ˜¯ç”¨æ¥åŒºåˆ«æ˜¯é‚£ç§ç±»å‹çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸¤ä¸ªç±»å‹ 12private static final int TYPE_ADD = 1;private static final int TYPE_PIC = 2; ç„¶åæˆ‘ä»¬æ ¹æ®ä¼ å…¥çš„postionæ¥åŒºåˆ†ï¼Œå¦‚æœposition==æˆ‘ä»¬çš„æ€»æ•°-1ï¼Œé‚£å°±è¯´æ˜æˆ‘ä»¬è¿™é‡Œæ˜¾ç¤ºæ·»åŠ å›¾ç‰‡ï¼Œå¦åˆ™å°±æ˜¾ç¤ºå±•ç¤ºçš„å›¾ç‰‡ã€‚ä¸ºä»€ä¹ˆè¦å‡ä¸€ä¸ªçš„åŸå› å°±æ˜¯æœ€åæ€»æ˜¯è¦æ˜¾ç¤ºæ·»åŠ ï¼Œé™¤éè¾¾åˆ°äº†ä¸Šé™ã€‚ç„¶åå›åˆ°æˆ‘ä»¬çš„onBindViewHolder()ä»£ç ä¸­ï¼Œå°±å¾ˆç®€å•äº†ï¼Œå½“éœ€è¦å±•ç¤ºæ·»åŠ çš„æ—¶å€™ï¼Œå°±æŠŠå±•ç¤ºå›¾ç‰‡å’Œåˆ é™¤çš„GONEï¼Œå½“éœ€è¦å±•ç¤ºå›¾ç‰‡çš„æ—¶å€™ï¼Œå°±éœ€è¦æŠŠæ·»åŠ éšè—ï¼Œå…¶ä½™çš„å±•ç¤ºå‡ºæ¥ ç„¶åæˆ‘ä»¬è¿˜éœ€è¦ç›‘å¬ç‚¹å‡»äº‹ä»¶ï¼Œç”¨æ¥å¢åŠ æˆ–è€…æ˜¯åˆ é™¤ 123456789101112131415private OnItemClickListener itemClickListener;public interface OnItemClickListener &#123; /** * ç»§ç»­æ·»åŠ å›¾ç‰‡æ¥å£ */ void onItemAddClick(); /** * åˆ é™¤å·²ç»æ·»åŠ çš„å›¾ç‰‡æ¥å£ * * @param position åˆ é™¤çš„position */ void onItemRemoveClick(int position);&#125; å†™ä¸€ä¸ªç‚¹å‡»äº‹ä»¶çš„æ¥å£ï¼Œä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æ·»åŠ ï¼Œä¸€ä¸ªåˆ é™¤ ç„¶åæ³¨å†Œç›‘å¬ 12345678910111213141516171819202122@Overridepublic ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; if (context == null) &#123; context = parent.getContext(); &#125; final ViewHolder viewHolder = new ViewHolder(LayoutInflater.from(context).inflate(R.layout.item_photo, parent, false)); viewHolder.ivAdd.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; itemClickListener.onItemAddClick(); &#125; &#125;); viewHolder.ivRemove.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; itemClickListener.onItemRemoveClick(viewHolder.getAdapterPosition()); &#125; &#125;); return viewHolder;&#125; åœ¨æ„é€ å‡½æ•°å½“ä¸­æŠŠæ¥å£è¿›è¡Œæ³¨å†Œ 1234 public TakePhotoAdapter(List&lt;String&gt; mList, OnItemClickListener itemClickListener) &#123; this.mList = mList; this.itemClickListener = itemClickListener;&#125; æœ€åå°±æ˜¯æˆ‘ä»¬çš„é¡µé¢çš„é€»è¾‘ä»£ç ï¼Œå…ˆæŠŠadapterçš„æ¥å£å¼•å…¥implementsTakePhotoAdapter.OnItemClickListener ç„¶åå°±æ˜¯ä¸¤ä¸ªæ¥å£ä¸­çš„æ–¹æ³• 12345678910111213@Overridepublic void onItemAddClick() &#123; //æ·»åŠ ç…§ç‰‡ mTakePhoto = getTakePhoto(); mTakePhoto.onPickFromCapture(configCompress());&#125;@Overridepublic void onItemRemoveClick(int position) &#123; //åˆ é™¤ç…§ç‰‡ mPhotoList.remove(position); mTakePhotoAdapter.notifyDataSetChanged();&#125; å¯ä»¥çœ‹åˆ°æ¯æ¬¡å¯¹å›¾ç‰‡æ“ä½œäº†ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œåˆ·æ–°ã€‚è¿™é‡Œå›¾ç‰‡çš„æ·»åŠ å¯ä»¥ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œå¤§å®¶å¯ä»¥å»ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯TakePhotoè¿™ä¸ªåº“ã€‚ ç„¶åæˆ‘ä»¬è¿™è¾¹å¯¹RecyclerViewè¿›è¡Œæ³¨å†Œå°±OKäº† 123rlRepair.setLayoutManager(new GridLayoutManager(this, 3));mTakePhotoAdapter = new TakePhotoAdapter(mPhotoList, this);rlRepair.setAdapter(mTakePhotoAdapter); è¿™é‡Œç”¨çš„æ˜¯GridLayoutManagerï¼Œå¹¶è®¾ç½®æ¯è¡Œ3ä¸ªï¼Œè¯»è€…å¯ä»¥æ›´å…·æƒ…å†µè‡ªå·±è®¾ç½® å·®ä¸å¤šå°±æ˜¯è¿™ä¹ˆå¤šå†…å®¹äº†ï¼Œå¾ˆç®€å•çš„ä¸œè¥¿ã€‚å¦‚æœæœ‰ä¸å¯¹æˆ–è€…æ›´å¥½çš„æ–¹å¼ï¼Œæ¬¢è¿æŒ‡æ•™","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"åŠ¨æ€é€‰æ‹©å›¾ç‰‡","slug":"åŠ¨æ€é€‰æ‹©å›¾ç‰‡","permalink":"http://sorgs.cn/tags/åŠ¨æ€é€‰æ‹©å›¾ç‰‡/"},{"name":"æœ‹å‹åœˆ","slug":"æœ‹å‹åœˆ","permalink":"http://sorgs.cn/tags/æœ‹å‹åœˆ/"}]},{"title":"å…³äºMediaRecorderä¸­çš„setAudioEncoderå’ŒsetOutputFormat","date":"2017-11-18T13:44:12.000Z","path":"post/20591/","text":"å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œæœ€è¿‘å®ä¹ ä¸€ç›´æŒºå¿™çš„ã€‚æœ€è¿‘åšçš„é¡¹ç›®æœ‰å…³ä½¿ç”¨äº†å½•éŸ³ç±»MediaRecorderã€‚å…¶ä¸­æœ‰ä¸ªsetAudioEncoderè®¾ç½®ç¼–è§£ç å™¨å’ŒsetOutputFormatå’Œè¾“å‡ºæ ¼å¼ã€‚ä¸å¤ªæ˜ç™½è¿™ä¹‹é—´æœ‰ä»€ä¹ˆçº¦æŸï¼Œä½†æ˜¯æ€»è§‰å¾—ä¸å¯èƒ½æ˜¯éšä¾¿è®¾ç½®çš„ä½†æ˜¯Googleæ€ä¹ˆéƒ½æœä¸åˆ°è¿™æ–¹é¢ç›¸å…³çš„ï¼Œäºæ˜¯å»ç¨å¾®äº†è§£äº†ä¸‹ç¼–ç è§£ç å™¨çš„åŒºåˆ«ä»¥åŠå®ƒçš„è¾“å‡ºå®¹å™¨ã€‚è¿™é‡Œè‡ªå·±è®°å½•ä¸‹ï¼Œä¹Ÿæ–¹ä¾¿å¤§å®¶æœ‰ä¸ªäº†è§£ã€‚ MediaRecorder.OutputFormatå…ˆçœ‹çœ‹åŒ…å«çš„æ ¼å¼(æ€»è®¡8ä¸ª) AAC_ADTS .aac AMR_NB .3gp AMR_WB .3gp DEFAULT MPEG_2_TS .ts MPEG_4 .mp4 .m4a RAW_AMRï¼ˆæ­¤å¸¸æ•°åœ¨APIçº§åˆ«16ä¸­å·²è¢«å¼ƒç”¨ï¼‰ .3gp THREE_GPP .3gp WEBM .ogg mkv MediaRecorder.AudioEncoderå…ˆçœ‹çœ‹åŒ…å«çš„ç¼–è§£ç å™¨ï¼ˆæ€»è®¡7ä¸ªï¼‰ AACï¼ˆAACä½å¤æ‚åº¦ï¼ˆAAC-LCï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ï¼‰ AAC_ELDï¼ˆå¢å¼ºå‹ä½å»¶è¿ŸAACï¼ˆAAC-ELDï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ï¼‰ AMR_NBï¼ˆAMRï¼ˆçª„å¸¦ï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ï¼‰ AMR_WBï¼ˆAMRï¼ˆå®½å¸¦ï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ï¼‰ DEFAULT HE_AACï¼ˆé«˜æ•ˆç‡AACï¼ˆHE-AACï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ï¼‰ VORBISï¼ˆOgg VorbiséŸ³é¢‘ç¼–è§£ç å™¨ï¼‰è¿™å°±ä»‹ç»å®Œäº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥å…³é—­ç½‘é¡µäº†ã€‚æ”¾ä¸‹ç –ï¼Œè®©æˆ‘æ…¢æ…¢è¯´ï¼Œæˆ‘ä»¬ç¨å¾®æ·±å…¥çš„å»çœ‹çœ‹è¿™äº›ç¼–è§£ç çš„ä¸œè¥¿ AAC é‡‡ç”¨äº†å…¨æ–°çš„ç®—æ³•è¿›è¡Œç¼–ç ï¼Œæ›´åŠ é«˜æ•ˆï¼Œå…·æœ‰æ›´é«˜çš„â€œæ€§ä»·æ¯”â€ã€‚ ä¼˜ç‚¹ï¼šç›¸å¯¹äºmp3ï¼ŒAACæ ¼å¼çš„éŸ³è´¨æ›´ä½³ï¼Œæ–‡ä»¶æ›´å°ã€‚ ç¼ºç‚¹ï¼šAACå±äºæœ‰æŸå‹ç¼©çš„æ ¼å¼ã€‚ å…¶è®¾è®¡ç›®æ ‡æ˜¯æ›¿ä»£åŸæœ‰MP3ç¼–ç æ ‡å‡†ï¼Œåœ¨ä¸MP3åœ¨ç›¸ä¼¼çš„ç ç‡ä¸‹å¸Œæœ›è´¨é‡ä¼˜äºMP3ã€‚è¿™ä¸€ç›®æ ‡å·²è¾¾åˆ°å¹¶ä¸”ç”±ISOå’ŒIECæ ‡å‡†ç»„ç»‡æ ‡å‡†åŒ–åœ¨MPEG-2å’ŒMPEG-4ä¸­ã€‚ æ”¯æŒçš„æ–‡ä»¶ç±»å‹/å®¹å™¨æ ¼å¼ â€¢3GPP .3gp â€¢MPEG-4 .mp4 .m4a â€¢ADTSåŸå§‹AAC .aacï¼ˆåœ¨Android 3.1+ä¸­è§£ç ï¼Œåœ¨Android 4.0+ä¸­ç¼–ç ï¼Œä¸æ”¯æŒADIFï¼‰ ADTSï¼ˆAudio Data Transport Streamï¼‰ï¼šè¿™ç§æ ¼å¼çš„ç‰¹å¾æ˜¯å®ƒæœ‰ä¸€ä¸ªåŒæ­¥çš„å­—çš„æ¯”ç‰¹æµï¼Œè§£ç å™¨å¯ä»¥åœ¨è¿™ä¸ªæµä¸­ä»»ä½•å¼€å§‹ä½ç½®å¼€å§‹ã€‚ DAIFï¼šæ¨¡æ‹Ÿæ•°æ®äº¤æ¢æ¨¡å¼ â€¢MPEG-TS .ts ï¼ˆnot seekableï¼ŒAndroid 3.0+ï¼‰ ç„¶åè¿˜æœ‰å¤§è‡´3ä¸ªç‰ˆæœ¬ AAC_LC AACä½å¤æ‚åº¦ï¼ˆAAC_LCï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ è®¾è®¡ç”¨äºæ•°å­—ç”µè§†ï¼ŒAAC_LCç”¨äºå­˜å‚¨ç©ºé—´å’Œè®¡ç®—èƒ½åŠ›æœ‰é™çš„æƒ…å†µã€‚ AAC-LCæ˜¯å……åˆ†åˆ©ç”¨å¿ƒç†å£°å­¦åŸç†ï¼Œå¯¹äººç±»å¯¹éŸ³é¢‘ä¿¡å·çš„æ„ŸçŸ¥å­˜åœ¨ä¸ç›¸å¹²æ€§å’Œç»Ÿè®¡å†—ä½™çš„ç‰¹æ€§ï¼Œæœ€å¤§ç¨‹åº¦çš„å‡å°‘ç”¨äºè¡¨è¾¾ä¿¡å·çš„æ¯”ç‰¹æ•°æ®ï¼Œå®ç°éŸ³é¢‘ä¿¡å·å¿«é€Ÿæœ‰æ•ˆåœ°å‹ç¼©ï¼Œè€Œä¸å†è¿½æ±‚è¾“å‡ºä¿¡å·å’ŒåŸå§‹ä¿¡å·ç›¸ä¼¼åº¦ã€‚ é‡è¦æŠ€æœ¯ç‚¹ æ”¯æŒä»8åˆ°48 kHzçš„æ ‡å‡†é‡‡æ ·ç‡çš„å•å£°é“/ç«‹ä½“å£°/ 5.0 / 5.1å†…å®¹ã€‚ HE_AAC é«˜æ•ˆç‡AACï¼ˆHE-AACï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ HE_AACV1ï¼ˆç¼–ç å™¨ Android4.1+ï¼‰ æ”¯æŒä»8åˆ°48 kHzçš„æ ‡å‡†é‡‡æ ·ç‡çš„å•å£°é“/ç«‹ä½“å£°/ 5.0 / 5.1å†…å®¹ã€‚ HE_AACV2ï¼ˆå¢å¼ºçš„AAC+ï¼‰ æ”¯æŒä»8åˆ°48 kHzçš„æ ‡å‡†é‡‡æ ·ç‡çš„ç«‹ä½“å£°/ 5.0 / 5.1å†…å®¹ã€‚ å¯¹æ¯”ä¸AAC_LC åŒç­‰éŸ³é¢‘ï¼ŒéŸ³é¢‘æ–‡ä»¶ä½“ç§¯ï¼ˆä½ç ç‡ä¸‹æ¯”è¾ƒæ˜æ˜¾ï¼‰ï¼šAAC_LC &gt; HE_AAC ç®—æ³•å¤æ‚åº¦ï¼šAAC_LC &lt; HE_AAC æ›´åŠ è¯¦ç»†çš„æ€§èƒ½å¯¹æ¯” AAC_ELD å¢å¼ºå‹ä½å»¶è¿ŸAACï¼ˆAAC-ELDï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ ç¼–ç å™¨:ï¼ˆAndroid 4.1+ï¼‰ è§£ç å™¨ï¼šï¼ˆAndroid 4.1+ï¼‰ æ”¯æŒä»16åˆ°48 kHzçš„æ ‡å‡†é‡‡æ ·ç‡çš„å•å£°é“/ç«‹ä½“å£°å†…å®¹ èƒ½æä¾›è·ŸCDä¸€æ ·çš„éŸ³é¢‘è´¨é‡ï¼Œè®©ç”¨æˆ·è·å¾—æ— ä¸ä¼¦æ¯”çš„é€šä¿¡ä½“éªŒã€‚æ˜¯å”¯ä¸€è¢«å¹¿æ³›é‡‡ç”¨çš„å…¨é«˜æ¸…è¯­éŸ³æŠ€æœ¯ã€‚ AMR_NB AMRï¼ˆçª„å¸¦ï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ ä¸»è¦ç”¨äºç¬¬ä¸‰ä»£ç§»åŠ¨é€šä¿¡ W-CDMA ç³»ç»Ÿä¸­ AMR-NB æ”¯æŒå…«ç§é€Ÿç‡æ¨¡å¼ã€‚ä½¿å…¶ä»¥æ›´åŠ æ™ºèƒ½çš„æ–¹å¼è§£å†³ä¿¡æºå’Œä¿¡é“ç¼–ç çš„é€Ÿç‡åˆ†é…é—®é¢˜,æ ¹æ®æ— çº¿ä¿¡é“å’Œä¼ è¾“çŠ¶å†µæ¥è‡ªé€‚åº”åœ°é€‰æ‹©ä¸€ç§ç¼–ç æ¨¡å¼è¿›è¡Œä¼ è¾“,ä½¿å¾—æ— çº¿èµ„æºçš„é…ç½®ä¸åˆ©ç”¨æ›´åŠ çµæ´»æœ‰æ•ˆã€‚ æ¨¡å¼ 0(4.75kbit/s) æ¨¡å¼ 1(5.15kbit/s) æ¨¡å¼ 2(5.90kbit/s) æ¨¡å¼ 3(6.70kbit/s) æ¨¡å¼ 4(7.40kbit/s) æ¨¡å¼ 5(7.95kbit/s) æ¨¡å¼ 6(10.2kbit/s) æ¨¡å¼ 7(12.2kbit/s) åœ¨8kHzé‡‡æ ·æ—¶ä¸º4.75è‡³12.2 kbps æ”¯æŒçš„æ–‡ä»¶ç±»å‹/å®¹å™¨æ ¼å¼ 3GPP .3gp AMR_WB AMRï¼ˆå®½å¸¦ï¼‰éŸ³é¢‘ç¼–è§£ç å™¨ ä½œä¸ºç¬¬ä¸‰ä»£ç§»åŠ¨é€šä¿¡ç³»ç»Ÿä½¿ç”¨çš„è¯­éŸ³ç¼–è§£ç ç®—æ³• AMR-WB éŸ³é¢‘å¸¦å®½åœ¨ 50Hz-7000Hz,ç›¸å¯¹äº 200Hz-3400Hz ä¸ºå®½å¸¦,æ”¯æŒä¹ç§é€Ÿç‡æ¨¡å¼ æ¨¡å¼ 0(6.60kbit/s) æ¨¡å¼ 1(8.85kbit/s) æ¨¡å¼ 2(12.65kbit/s) æ¨¡å¼ 3(14.25kbit/s) æ¨¡å¼ 4(15.85kbit/s) æ¨¡å¼ 5(18.25kbit/s) æ¨¡å¼ 6(19.85kbit/s) æ¨¡å¼ 7(23.05kbit/s) æ¨¡å¼ 8(23.85kbit/s) é‡‡ç”¨çš„æ˜¯ä»£æ•°ç æ¿€åŠ±çº¿æ€§é¢„æµ‹ç¼–ç (Algebraic Code ExcitedLinear Prediction,ç®€ç§° ACELP),å…¶å·²è¢« 3GPPé€‰å®šä¸ºGSMå’Œ3Gæ— çº¿W-CDMAçš„å®½å¸¦ç¼–ç å™¨,å¹¶å°†åº”ç”¨äºIPç”µè¯ã€ç¬¬ä¸‰ä»£ç§»åŠ¨é€šä¿¡ã€ISDN å®½å¸¦ç”µè¯ã€ISDN å¯è§†ç”µè¯å’Œç”µè§†ä¼šè®®ç­‰é¢†åŸŸ,è¿™æ ‡å¿—ç€æ— çº¿å’Œæœ‰çº¿ä¸šåŠ¡ç¬¬ä¸€æ¬¡é‡‡ç”¨åŒæ ·çš„ç¼–ç å™¨ã€‚ 9ä¸ªé€Ÿç‡ä»6.60 kbit / såˆ°23.85 kbit / sé‡‡æ ·@ 16kHz æ”¯æŒçš„æ–‡ä»¶ç±»å‹/å®¹å™¨æ ¼å¼ 3GPP .3gp AMR_WBå’ŒAMR_NBæ›´å¤šè¯¦æƒ… VORBIS Ogg VorbiséŸ³é¢‘ç¼–è§£ç å™¨ã€‚ Ogg Vorbisæ˜¯ä¸€ç§æ–°çš„éŸ³é¢‘å‹ç¼©æ ¼å¼ï¼Œç±»ä¼¼äºMP3ç­‰ç°æœ‰çš„éŸ³ä¹æ ¼å¼ã€‚ å®ƒæ˜¯å®Œå…¨å…è´¹ã€å¼€æ”¾å’Œæ²¡æœ‰ä¸“åˆ©é™åˆ¶çš„ã€‚ æ”¯æŒå¤šå£°é“ã€‚ æ›´ä½çš„ç ç‡å’Œæ–‡ä»¶ä½“ç§¯ã€‚ Ogg Vorbisæ–‡ä»¶çš„æ‰©å±•åæ˜¯.oggã€‚ ç°åœ¨åˆ›å»ºçš„OGGæ–‡ä»¶å¯ä»¥åœ¨æœªæ¥çš„ä»»ä½•æ’­æ”¾å™¨ä¸Šæ’­æ”¾ï¼Œå› æ­¤ï¼Œè¿™ç§æ–‡ä»¶æ ¼å¼å¯ä»¥ä¸æ–­åœ°è¿›è¡Œå¤§å°å’ŒéŸ³è´¨çš„æ”¹è‰¯ï¼Œè€Œä¸å½±å“æ—§æœ‰çš„ç¼–ç å™¨æˆ–æ’­æ”¾å™¨ã€‚ æ”¯æŒçš„æ–‡ä»¶ç±»å‹/å®¹å™¨æ ¼å¼ â€¢Ogg .ogg â€¢Matroska .mkv ï¼ˆAndroid 4.0+ï¼‰ Matroskaæ˜¯ä¸€ç§æ–°çš„å¤šåª’ä½“å°è£…æ ¼å¼ï¼Œå®ƒå¯å°†å¤šç§ä¸åŒç¼–ç çš„è§†é¢‘åŠ16æ¡ä»¥ä¸Šä¸åŒæ ¼å¼çš„éŸ³é¢‘å’Œä¸åŒè¯­è¨€çš„å­—å¹•æµå°è£…åˆ°ä¸€ä¸ªMatroska Mediaæ–‡ä»¶å½“ä¸­ã€‚ä¹Ÿæ˜¯å…¶ä¸­ä¸€ç§å¼€æ”¾æºä»£ç çš„å¤šåª’ä½“å°è£…æ ¼å¼ã€‚æ€»ç»“è¯´æ˜ é€šè¿‡ä»¥ä¸Šæ•´ç†ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨mediaRecordçš„æ—¶å€™ï¼Œå°±ä¸ä¼šç›²ç›®å»è®¾ç½®AudioEncoderå’ŒOutputFormatäº†ï¼Œè€Œæ˜¯æ ¹æ®å®é™…æƒ…å†µæ¥ä½¿ç”¨ã€‚ è®¾ç½®çš„æ”¯æŒçš„æ–‡ä»¶ç±»å‹/å®¹å™¨æ ¼å¼è¯·å‚è€ƒGoogleå®˜æ–¹æ–‡æ¡£ã€‚ æ•´ç†çš„ç¬”è®°å¦‚æœé”™è¯¯çš„åœ°æ–¹ï¼Œè¯·ä¸€èµ·äº¤æµè®¨è®ºå…±åŒè¿›æ­¥ï¼Œè°¢è°¢ã€‚ ä»¥ä¸Šèµ„æ–™å‡æ¥è‡ªç½‘ç»œæ•´ç†ï¼Œå¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥ã€‚","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"},{"name":"MediaRecorder","slug":"MediaRecorder","permalink":"http://sorgs.cn/tags/MediaRecorder/"},{"name":"MediaRecorder.setAudioEncoder","slug":"MediaRecorder-setAudioEncoder","permalink":"http://sorgs.cn/tags/MediaRecorder-setAudioEncoder/"},{"name":"MediaRecorder.setOutputFormat","slug":"MediaRecorder-setOutputFormat","permalink":"http://sorgs.cn/tags/MediaRecorder-setOutputFormat/"},{"name":"setAudioEncoder and setOutputFormat","slug":"setAudioEncoder-and-setOutputFormat","permalink":"http://sorgs.cn/tags/setAudioEncoder-and-setOutputFormat/"}]},{"title":"ç¬¬ä¸‰æ–¹ç™»å½•ä¹‹æ”¯ä»˜å®ç™»å½•","date":"2017-08-06T13:02:00.000Z","path":"post/12778/","text":"å…¬å¸ä¸€ä¸ªéœ€æ±‚è®©åšä¸€ä¸ªæ”¯ä»˜å®çš„ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ³¨æ„ï¼Œæ˜¯ç™»å½•ä¸æ˜¯æ”¯ä»˜ã€‚ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œæˆ‘è‡ªå·±è®°å½•ä¸‹å¤§å®¶æ²¡æœ‰è¯´çš„é—®é¢˜ã€‚ é¦–å…ˆï¼Œæ”¯ä»˜å®ç™»å½•å’Œå…¶ä»–ç¬¬ä¸‰æ–¹ç™»å½•ä¸å¤ªä¸€æ ·ï¼Œç›¸æ¯”éº»çƒ¦ä¸€ç‚¹ã€‚ä¸€èˆ¬ç¬¬ä¸‰æ–¹ç™»å½•æˆ‘ä»¬ç”¨shareSDKå°±å¥½ï¼Œä½†æ˜¯æ”¯ä»˜å®ä¸è¡Œã€‚æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¤§éƒ¨åˆ†å°±æ˜¯å»è®²ä»€ä¹ˆæ”¯ä»˜ï¼Œæ²¡æœ‰æ€ä¹ˆè¯´æ€ä¹ˆç™»é™†ã€‚ è€Œä¸”å®˜æ–¹æ–‡æ¡£è¿˜æœ‰å°‘è®¸é”™è¯¯ é¦–å…ˆæ˜¯æˆ‘ä»¬å…ˆè¯·æ±‚åå°ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ªéªŒè¯ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶æ˜¯android-async-httpã€‚ ç„¶åè·å–çš„ä¿¡æ¯ç±»ä¼¼è¿™æ · ç„¶åè°ƒç”¨æ”¯ä»˜å®çš„å‡½æ•°è¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ä¹‹åï¼Œåœ¨åˆ©ç”¨handlerå‘é€åˆ°ä¸»çº¿ç¨‹è¿›è¡Œç™»å½• å¤§æ¦‚å°±æ˜¯æ€ä¹ˆå¤šå†…å®¹äº†ã€‚è¿˜æ˜¯å¾ˆåŸºç¡€çš„ä¸œè¥¿è€Œå·²","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"å±æ€§åŠ¨ç”»çš„ç ”ç©¶â€”â€”å¤šçº§èœå•å±•å¼€","date":"2017-07-26T08:33:11.000Z","path":"post/29596/","text":"å¾ˆä¹…éƒ½æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œä¹‹å‰ä¸€ç›´å¿™ç€å‚åŠ æŒ‘æˆ˜æ¯ï¼Œç„¶åå°±æ˜¯æœŸæœ«è€ƒè¯•ï¼Œå†ç„¶ååœ¨å®¤å‹çš„ä¹±å¸¦èŠ‚å¥ä¸‹å‡†å¤‡æ‰¾å®ä¹ ã€‚ç°åœ¨æ‰¾åˆ°äº†ä¸€ä»½å®ä¹ å·¥ä½œï¼Œè€å¤§è¿˜åœ¨ç»™æ–°é¡¹ç›®æ‰“æ¡†æ¶ï¼Œè®©æˆ‘å…ˆç ”ç©¶ä¸‹åŠ¨ç”»ï¼Œè¯´æ˜¯åé¢ä¼šç”¨åˆ°ï¼Œå°±å¿™é‡Œå·é—²ç©demo æ˜¯çœ‹imoocä¸Šé¢çš„ä¸€ä¸ªå¤§ç¥çš„è¯¾ç¨‹-http://www.imooc.com/learn/263ã€‚è®²çš„å¾ˆniceï¼Œç„¶åæˆ‘å°±ç»§ç»­æ·±å…¥äº†ä¸€ç‚¹ç‚¹ï¼Œå®Œå–„äº†demoè€Œå·²ã€‚æ•ˆæœå›¾ åˆ†æ é¦–å…ˆæ˜¯é‡‡ç”¨äº†å±æ€§åŠ¨ç”»çš„æ–¹å¼ åœ¨xå’Œyä¸Šé¢åšæ‰‹è„šå»å˜åŒ–åæ ‡ 1234567PropertyValuesHolder Y, X; //è®¾ç½®åŠ¨ç”» Y = PropertyValuesHolder.ofFloat(\"translationY\", y); X = PropertyValuesHolder.ofFloat(\"translationX\", x); //æ·»åŠ åŠ¨ç”»é›†åˆ ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(imageViewList.get(i), X, Y); ç„¶åæ˜¯ä¸¤ä¸ªåŠ¨ç”»ä¸€èµ· ä½¿ç”¨æŠ–åŠ¨æ•ˆæœï¼ˆä½¿ç”¨äº†BounceInterpolatorï¼‰[å¯èƒ½gifæœ‰äº›çœ‹ä¸å‡ºæ¥]12//ä¸ºæ§ä»¶å¢åŠ è‡ªç”±è½ä½“åŠ¨ç”»æ•ˆæœ animator.setInterpolator(new BounceInterpolator()); è®¡ç®—åæ ‡æˆ‘ä»¬çš„å±•å¼€æ˜¯ä¸€ä¸ªåŠåœ†çš„æ‰‡å½¢ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯åˆ©ç”¨æ•°å­¦å‡½æ•°æ¥è¿›è¡Œè®¡ç®—ï¼Œå¦‚å›¾ ä»ä¸Šé¢åˆ°ä¸‹é¢ï¼Œxæ˜¯ä»æœ€å¤§åˆ°0ï¼Œyæ˜¯ä»0åˆ°æœ€å¤§æ¯ä¸€ä¸ªç‚¹çš„åæ ‡å°±æ˜¯æ ¹æ®åœ†å¿ƒè§’æ¥è®¡ç®—123456//éœ€è¦æ‰©æ•£çš„è§’åº¦ ä»¥180åº¦ä¸ºä¾‹ float angle = (float) (Math.PI * 180 / 180); //è®¡ç®—åç§»çš„x,yåæ ‡ x = (float) (n * Math.sin(angle / (res.length - 1) * count)); y = (float) (n * Math.cos(angle / (res.length - 1) * count)); å®Œæ•´ä»£ç  å¸ƒå±€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:gravity=\"center\"&gt; &lt;ImageView android:id=\"@+id/iv_h\" style=\"@style/ImageView\" android:src=\"@mipmap/h\"/&gt; &lt;ImageView android:id=\"@+id/iv_g\" style=\"@style/ImageView\" android:src=\"@mipmap/g\"/&gt; &lt;ImageView android:id=\"@+id/iv_f\" style=\"@style/ImageView\" android:src=\"@mipmap/f\"/&gt; &lt;ImageView android:id=\"@+id/iv_e\" style=\"@style/ImageView\" android:src=\"@mipmap/e\"/&gt; &lt;ImageView android:id=\"@+id/iv_d\" style=\"@style/ImageView\" android:src=\"@mipmap/d\"/&gt; &lt;ImageView android:id=\"@+id/iv_c\" style=\"@style/ImageView\" android:src=\"@mipmap/c\"/&gt; &lt;ImageView android:id=\"@+id/iv_b\" style=\"@style/ImageView\" android:src=\"@mipmap/b\"/&gt; &lt;ImageView android:id=\"@+id/iv_a\" style=\"@style/ImageView\" android:src=\"@mipmap/a\"/&gt;&lt;/RelativeLayout&gt; æŠ½å–çš„å±æ€§ 123456&lt;style name=\"ImageView\"&gt; &lt;item name=\"android:layout_width\"&gt;50dp&lt;/item&gt; &lt;item name=\"android:layout_height\"&gt;50dp&lt;/item&gt; &lt;item name=\"android:paddingLeft\"&gt;5dp&lt;/item&gt; &lt;item name=\"android:paddingTop\"&gt;5dp&lt;/item&gt;&lt;/style&gt; é€»è¾‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121package com.sorgs.animtest;import android.animation.ObjectAnimator;import android.animation.PropertyValuesHolder;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.view.View;import android.view.animation.BounceInterpolator;import android.widget.ImageView;import android.widget.Toast;import java.util.ArrayList;import java.util.List;public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123; private int[] res = &#123;R.id.iv_a, R.id.iv_b, R.id.iv_c, R.id.iv_d, R.id.iv_e, R.id.iv_f, R.id.iv_g, R.id.iv_h&#125;; private List&lt;ImageView&gt; imageViewList = new ArrayList&lt;&gt;(); /** * èœå•æ‰“å¼€æˆ–è€…å…³é—­çš„æ ‡å¿— */ private boolean flag = true; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); for (int re : res) &#123; //å¾ªç¯æ·»åŠ æ¯ä¸ªæ§ä»¶ ImageView imageView = (ImageView) findViewById(re); //ä¸ºæ¯ä¸ªæ§ä»¶æ·»åŠ ç‚¹å‡»äº‹ä»¶ imageView.setOnClickListener(this); //å°†æ¯ä¸ªæ§ä»¶æ·»åŠ åˆ°Listä¸­ imageViewList.add(imageView); &#125; &#125; @Override public void onClick(View view) &#123; switch (view.getId()) &#123; case R.id.iv_a: if (flag) &#123; startAnim(); &#125; else &#123; emdAnim(); &#125; break; default: //ç‚¹å‡»å…¶ä»–æŒ‰é’®ï¼Œå¼¹å‡ºtoast Toast.makeText(getApplication(), \"click\" + view.getId(), Toast.LENGTH_SHORT).show(); break; &#125; &#125; /** * å…³é—­èœå•åŠ¨ç”» */ private void emdAnim() &#123; for (int i = 1; i &lt; res.length; i++) &#123; PropertyValuesHolder Y, X; //X Y éƒ½å›å½’åŸç‚¹ Y = PropertyValuesHolder.ofFloat(\"translationY\", 0); X = PropertyValuesHolder.ofFloat(\"translationX\", 0); ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(imageViewList.get(i), X, Y); //è®¾ç½®åŠ¨ç”»æ‰§è¡Œæ—¶é—´ animator.setDuration(500); //æ¯ä¸ªæ§ä»¶ä¹‹é—´çš„å»¶æ—¶ï¼Œå½¢æˆæ¯ä¸ªæŒ‰é’®ä¾æ¬¡å‡ºç° animator.setStartDelay(i * 300); //ä¸ºæ§ä»¶å¢åŠ è‡ªç”±è½ä½“åŠ¨ç”»æ•ˆæœ animator.setInterpolator(new BounceInterpolator()); //æ‰§è¡ŒåŠ¨ç”» animator.start(); //é‡ç½®flag flag = true; &#125; &#125; /** * æ‰“å¼€èœå•åŠ¨ç”» */ private void startAnim() &#123; //æ‰©æ•£çš„è·ç¦»ï¼Œè·å–æ§ä»¶çš„é«˜åº¦çš„2å€ float x, y, n = imageViewList.get(0).getMeasuredHeight() * 2; for (int i = 1; i &lt; res.length; i++) &#123; int count = res.length - i; //éœ€è¦æ‰©æ•£çš„è§’åº¦ ä»¥180åº¦ä¸ºä¾‹ float angle = (float) (Math.PI * 180 / 180); //è®¡ç®—åç§»çš„x,yåæ ‡ x = (float) (n * Math.sin(angle / (res.length - 1) * count)); y = (float) (n * Math.cos(angle / (res.length - 1) * count)); PropertyValuesHolder Y, X; //è®¾ç½®åŠ¨ç”» Y = PropertyValuesHolder.ofFloat(\"translationY\", y); X = PropertyValuesHolder.ofFloat(\"translationX\", x); //æ·»åŠ åŠ¨ç”»é›†åˆ ObjectAnimator animator = ObjectAnimator.ofPropertyValuesHolder(imageViewList.get(i), X, Y); //è®¾ç½®åŠ¨ç”»æ‰§è¡Œæ—¶é—´ animator.setDuration(500); //æ¯ä¸ªæ§ä»¶ä¹‹é—´çš„å»¶æ—¶ï¼Œå½¢æˆæ¯ä¸ªæŒ‰é’®ä¾æ¬¡å‡ºç° animator.setStartDelay(i * 300); //ä¸ºæ§ä»¶å¢åŠ è‡ªç”±è½ä½“åŠ¨ç”»æ•ˆæœ animator.setInterpolator(new BounceInterpolator()); //æ‰§è¡ŒåŠ¨ç”» animator.start(); //é‡ç½®flag flag = false; &#125; &#125;&#125;","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Sorgså¤©æ°”appå¼€å‘","date":"2017-05-20T06:02:18.000Z","path":"post/50314/","text":"çœ‹å®Œäº†éƒ­éœ–å¤§ç¥æˆ‘ç¬¬ä¸€è¡Œä»£ç ï¼ˆç¬¬äºŒç‰ˆï¼‰,æœ€åä¹¦ä¸Šé‚£ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä¹Ÿç”¨æ¥äº†å®ç°äº†ä¸€ä¸‹ã€‚ä¿®æ”¹äº†ä¸€ç‚¹ #ä¸»è¦æ˜¯å®Œæˆäº†å¤©æ°”çš„æ›´æ–°å’Œç”Ÿæ´»çš„å»ºè®® ä¿®æ”¹åå°ä¸º3ä¸ªå°æ—¶æ›´æ–° ä¿®æ”¹è¿›å…¥appé¦–å…ˆæ ¹æ®å®šä½æ¥å†³å®šå½“åœ°çš„å¤©æ°”ï¼Œä¸å†æ˜¯æ‰‹åŠ¨é€‰æ‹© ä¾§è¾¹æ å¯ä»¥é€‰æ‹©æŸ¥çœ‹ä¸­å›½ä¸åŒåŸå¸‚çš„å¤©æ°”ï¼Œç‚¹å‡»è¿˜å¯ä»¥æ ¹æ®å®šä½å›åˆ°å½“å‰åœ°åŒº åšäº†ä¸€ç‚¹ç®€å•çš„ç¾åŒ–ï¼Œå½“ç„¶èƒŒæ™¯å›¾ç‰‡è¿˜æ˜¯å¿…åº”çš„å›¾ç‰‡ï¼Œæ¯å¤©æ›´æ–° #ä»£ç å°±ä¸è´´äº†ï¼Œå…ˆçœ‹çœ‹æ•ˆæœå›¾ ç¬¬ä¸€ä¸ªå›¾æœ¬æ¥æ˜¯éœ€è¦è¿™äº›æƒé™çš„ï¼Œæ˜¯ä¸ºäº†åé¢æ¥å…¥å¹¿å‘Šå‡†å¤‡çš„ æ±‚ä¸‹è½½å•Šï¼ï¼ï¼ æœ€åè¿˜æ˜¯è¦ç»™å‡ºgithubåœ°å€ï¼Œæœ¬é¡¹ç›®å¼€æº","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Androidå¼€å‘ä¸­å±å¹•çš„é€‚é…é—®é¢˜ px pd spä¹‹é—´çš„è½¬æ¢å·¥å…·","date":"2017-03-28T02:31:28.000Z","path":"post/32369/","text":"åœ¨Androidå¼€å‘ä¸­ï¼Œç¾å·¥å¦¹å­ç»™æˆ‘çš„å›¾ç‰‡éƒ½æ˜¯pxçš„å•ä½ï¼Œä½†æ˜¯è¿™ä¸ªä½†æ˜¯è¿™ä¸ªå•ä½åœ¨ç¨‹åºä¸­å¹¶ä¸å¥½ï¼Œä¸èƒ½å¤Ÿè‡ªåŠ¨é€‚é…ã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è½¬æ¢ä¸ºdpã€‚ #å…³äºDP,PD,SPPPI = Pixels per inchï¼Œæ¯è‹±å¯¸ä¸Šçš„åƒç´ æ•°,å³ â€œåƒç´ å¯†åº¦â€ ppiçš„è¿ç®—æ–¹å¼æ˜¯ï¼šPPI = âˆšï¼ˆé•¿åº¦åƒç´ æ•°Â² + å®½åº¦åƒç´ æ•°Â²ï¼‰ / å±å¹•å¯¹è§’çº¿è‹±å¯¸æ•° dpï¼šDensity-independent pixelsï¼Œä»¥160PPIå±å¹•ä¸ºæ ‡å‡†ï¼Œåˆ™1dp=1pxï¼Œ dpå’Œpxçš„æ¢ç®—å…¬å¼ ï¼šdp*ppi/160 = pxã€‚æ¯”å¦‚1dp x 320ppi/160 = 2pxã€‚ spï¼šScale-independent pixelsï¼Œå®ƒæ˜¯å®‰å“çš„å­—ä½“å•ä½ï¼Œä»¥160PPIå±å¹•ä¸ºæ ‡å‡†ï¼Œå½“å­—ä½“å¤§å°ä¸º 100%æ—¶ï¼Œ 1sp=1pxã€‚ sp ä¸ px çš„æ¢ç®—å…¬å¼ï¼šsp*ppi/160 = px å¾—å‡ºï¼š px = dp*ppi/160dp = px / (ppi / 160) px = sp*ppi/160sp = px / (ppi / 160) dp â‰ˆ sp #ç¨‹åºæ‰€ä»¥æˆ‘å°±éœ€è¦æŒ‰è®¡ç®—æœºè®¡ç®—å’¯ã€‚ä½†æ˜¯æˆ‘æ€ä¹ˆå¯èƒ½æ‰‹åŠ¨å‘¢ï¼Œäºæ˜¯æˆ‘å°±å†™äº†ä¸€ä¸ªCè‰¹çš„å¯ä»¥æ‰§è¡Œæ–‡ä»¶ã€‚å¸®åŠ©è®¡ç®—ã€‚éƒ½æ˜¯äº›åƒåœ¾ä»£ç ã€‚ä¸æ•¢ç§è—ï¼Œæ‹¿å‡ºæ¥åˆ†äº«ï¼Œæœ‰éœ€è¦æ”¹è¿›çš„å°±éšä¾¿æ”¹ã€‚ï¼ˆæ”¹äº†ç»™æˆ‘è¯´è¯´ï¼Œä¸€èµ·ç”¨ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394#include&lt;stdlib.h&gt;#include&lt;iostream&gt;using namespace std;void PX_PD(float b) &#123; while (true) &#123; float a; cout &lt;&lt; \"è¯·è¾“å…¥pxï¼š\"; cin &gt;&gt; a; cout &lt;&lt; \"dp = \" &lt;&lt; a / b &lt;&lt; endl; &#125;&#125;void PD_PX(float b) &#123; while (true) &#123; float a; cout &lt;&lt; \"è¯·è¾“å…¥pdï¼š\"; cin &gt;&gt; a; cout &lt;&lt; \"dx = \" &lt;&lt; a * b &lt;&lt; endl; &#125;&#125;int main() &#123; cout &lt;&lt; \"------------------------------------------------------------------------------------------------------------\" &lt;&lt; endl; cout &lt;&lt; \"authorï¼šsorgs.å¦‚æœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹æ¬¢è¿æå‡ºQQï¼š1042746391\" &lt;&lt; endl &lt;&lt; \" ç”±äºå¼€å‘Androidç¨‹åºå‘˜ï¼Œç¾å·¥å¦¹å­ç»™çš„å›¾ç‰‡çš„å•ä½å’Œç¨‹åºå•ä½ä¸ä¸€è‡´ï¼Œæ‰€ä»¥äº§ç”Ÿéœ€è¦è½¬æ¢ã€‚(æ‰€æœ‰æ•°æ®åŸºäºæ ‡å‡†)\" &lt;&lt; endl; cout &lt;&lt; \"dpæ˜¯è™šæ‹Ÿåƒç´ ï¼Œåœ¨ä¸åŒçš„åƒç´ å¯†åº¦çš„è®¾å¤‡ä¸Šä¼šè‡ªåŠ¨é€‚é…,è¿™é‡Œå°±é‡‡ç”¨æ ‡å‡†çš„å°±OKã€‚ï¼ˆspå’ŒdpåŸºæœ¬ä¸€æ ·ï¼‰\" &lt;&lt; endl; cout &lt;&lt; \"åœ¨mdpiåˆ†è¾¨ç‡ï¼Œåƒç´ å¯†åº¦ä¸º160ï¼Œ1dp=1px\" &lt;&lt; endl; cout &lt;&lt; \"åœ¨hdpiåˆ†è¾¨ç‡ï¼Œåƒç´ å¯†åº¦ä¸º240ï¼Œ1dp=1.5px\" &lt;&lt; endl; cout &lt;&lt; \"åœ¨xhdpiåˆ†è¾¨ç‡ï¼Œåƒç´ å¯†åº¦ä¸º320ï¼Œ1dp=2px\" &lt;&lt; endl; cout &lt;&lt; \"åœ¨xxhdpiåˆ†è¾¨ç‡ï¼Œåƒç´ å¯†åº¦ä¸º480ï¼Œ1dp=3px\" &lt;&lt; endl; cout &lt;&lt; \"è®¡ç®—å…¬å¼ï¼š1dp*åƒç´ å¯†åº¦/160 = å®é™…åƒç´ æ•°\" &lt;&lt; endl; cout &lt;&lt; \"------------------------------------------------------------------------------------------------------------\" &lt;&lt; endl; number3: cout &lt;&lt; \"è¯·è¾“å…¥éœ€è¦è½¬åŒ–çš„å½¢å¼ï¼š1(px-&gt;dp) 2(dp-&gt;px)\" &lt;&lt; endl; int i; cin &gt;&gt; i; if (i == 1) &#123; number1: cout &lt;&lt; \"è¯·è¾“å…¥éœ€è¦è®¡ç®—çš„åˆ†è¾¨ç‡: 1(mdpi) 2(hdpi) 3(xhdpi) 4(xxhdpi)\" &lt;&lt; endl; int j; cin &gt;&gt; j; if (j == 1) &#123; PX_PD(1); &#125; if (j == 2) &#123; PX_PD(1.5); &#125; if (j == 3) &#123; PX_PD(2); &#125; if (j == 4) &#123; PX_PD(3); &#125; else &#123; cout &lt;&lt; \"è²Œä¼¼è¾“å…¥æœ‰è¯¯å‘¢\" &lt;&lt; endl; goto number1; &#125; &#125;if (i == 2) &#123; number2: cout &lt;&lt; \"è¯·è¾“å…¥éœ€è¦è®¡ç®—çš„åˆ†è¾¨ç‡: 1(mdpi) 2(hdpi) 3(xhdpi) 4(xxhdpi)\" &lt;&lt; endl; int j; cin &gt;&gt; j; if (j == 1) &#123; PX_PD(1); &#125; if (j == 2) &#123; PX_PD(1.5); &#125; if (j == 3) &#123; PX_PD(2); &#125; if (j == 4) &#123; PX_PD(3); &#125; else &#123; cout &lt;&lt; \"è²Œä¼¼è¾“å…¥æœ‰è¯¯å‘¢\" &lt;&lt; endl; goto number2; &#125; &#125; else &#123; cout &lt;&lt; \"è¾“å…¥æœ‰è¯¯å“¦ï¼\" &lt;&lt; endl; goto number3; &#125;&#125; æœ€åæ”¾ä¸Šæºç åœ°å€ï¼šhttps://github.com/sorgs/DP_PX.git","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Android studio æŠ¥é”™ error opening trace file: Permission denied (13)","date":"2017-03-04T05:46:37.000Z","path":"post/36822/","text":"å…³äºè¿™ä¸ªæŠ¥é”™ï¼Œå…¶å®æ˜¯Android 4.1ï¼ˆ16ï¼‰åœ¨Android studio 2.3äº§ç”Ÿçš„ã€‚ å…·ä½“åŸå› æ˜¯å› ä¸ºAndroid 6.0ä¹‹åçš„åŠ¨æ€ç”³è¯·æƒé™ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™å¥è¯çš„æ„æ€æ˜¯æƒé™ä¸è¶³ã€‚åœ¨Android studio å‡çº§åˆ°äº†2.3ä¹‹åï¼Œ4.1çš„æ¨¡æ‹Ÿå™¨æœ¬æ¥ä¸éœ€è¦åŠ¨æ€æƒé™çš„ï¼Œä¼°è®¡æ˜¯ä¸ªbugå§ï¼ˆä¸ªäººçŒœæµ‹ï¼‰ï¼Œå› ä¸º5.1æ˜¯å®Œç¾è¿è¡Œçš„ã€‚ å…³äºåŠ¨æ€ç”³è¯·æƒé™ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œç™¾åº¦ä¸€æœä¸€å¤§æŠŠã€‚åæ­£å…»æˆåŠ¨æ€ç”³è¯·æƒé™çš„ä¹ æƒ¯æ˜¯å¥½å¤š ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªå¤§ç¥å†™çš„åŠ¨æ€ç”³è¯·æƒé™çš„demoã€‚ https://github.com/Android-Mu/Android6.0Authority.git å…·æ–¹æ³•å¾ˆå¤šçš„ï¼Œå‚è€ƒè¿™demoå°±å¾ˆä¸é”™äº†ï¼Œå†™çš„å¾ˆå…·ä½“ã€‚ è°¨ä»¥æ­¤è®°å½•æˆ‘è°ƒè¯•ä¸€å¤©çš„bugã€‚ é¡ºä¾¿æ”¾ä¸Šæˆ‘çš„æ‹™åŠ£ä»£ç ï¼Œè§ç¬‘äº†ï¼ï¼ˆéƒ¨åˆ†ä»£ç ï¼ŒSDå¡çš„æƒé™ï¼‰ 123456789101112131415161718192021222324252627282930313233/** * æ£€æŸ¥æƒé™ */ private void CheckPermission() &#123; if (ContextCompat.checkSelfPermission(SplashActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) &#123; //æƒé™ä¸è¶³å°±éœ€è¦å»ç”³è¯·ï¼Œä¸Šä¸‹æ–‡ï¼Œéœ€è¦ç”³è¯·çš„æƒé™ï¼Œè¯·æ±‚ç ï¼ˆå”¯ä¸€å°±è¡Œï¼‰ ActivityCompat.requestPermissions(SplashActivity.this , new String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, 1); &#125; else &#123; downloadApk(); &#125; &#125; /** * å›è°ƒçš„æƒé™è¯·æ±‚ç»“æœï¼Œæ˜¯å¦åŒæ„éƒ½ä¼šè°ƒç”¨ * * @param requestCode è¯·æ±‚ç  * @param permissions ç”³è¯·çš„æƒé™ * @param grantResults ç»“æœ */ @Override public void onRequestPermissionsResult(int requestCode , @NonNull String[] permissions, @NonNull int[] grantResults) &#123; if (requestCode == 1) &#123; if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) &#123; downloadApk(); &#125; else &#123; ToastUtil.show(getApplicationContext(), \"æƒé™ä¸è¶³ï¼Œä¸èƒ½æ›´æ–°ï¼Œä¸‹æ¬¡å¼€å¯è¯·å…è®¸æƒé™ï¼Œå¦‚æ²¡æœ‰å¼¹å‡ºï¼Œè¯·åˆ°è®¾ç½®ä¸­å¿ƒå¼€å¯æƒé™\"); enterHome(); &#125; &#125; &#125;","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Windowsç½‘ç»œç¼–ç¨‹-ç®€å•çš„å¤šçº¿ç¨‹èŠå¤©å®¤","date":"2016-11-25T13:05:20.000Z","path":"post/6290/","text":"å®éªŒå®¤ç³»ç»Ÿï¼šWindows10å®éªŒå®¤IDEï¼šVS2012 åˆ›å»ºMFCæ–‡ä»¶é¡¹ç›®æ–‡ä»¶-&gt;æ–°å»º-&gt;é¡¹ç›® ç„¶åæ ¹æ®å›¾ç‰‡è¿›è¡Œæ“ä½œ æ³¨æ„çš„åœ°æ–¹ï¼š1.å–æ¶ˆunionåº“2.å‹¾é€‰ä¸ŠWindowså¥—æ¥å­—ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆ3.é€‰æ‹©Dlog æ·»åŠ æ§ä»¶ç‚¹å¼€å·¥å…·ç®± å»ºç«‹ä¸¤ä¸ªä¸»æ¡†ï¼Œä¸€ä¸ªç”¨æ¥æ¥æ”¶æ•°æ®ï¼Œä¸€ä¸ªç”¨æ¥å‘é€æ•°æ® å†åœ¨ä¸»æ¡†é‡Œé¢å»ºç«‹3ä¸ªeditï¼Œä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºå‘é€æ¥çš„æ•°æ®ï¼Œä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºè‡ªå·±å‘é€çš„æ•°æ®ï¼Œä¸‹é¢é‚£ä¸ªç”¨æ¥æ˜¾ç¤ºè¦å‘é€çš„æ•°æ® æœ€ååˆ æ‰åŸæœ‰ï¼Œå¹¶åŠ ä¸€ä¸ªæŒ‰é’®ä¸ºå‘é€ï¼Œæ·»åŠ ä¸€ä¸ªipæ§åˆ¶ ç¼–å†™ä»£ç åŠ è½½å¥—æ¥å­—æ•°æ®åº“å…ˆæ‰‹åˆ°æˆ‘ä»¬çš„cppä¸­ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰é€‰æ‹©äº†Windowså¥—æ¥å­—åº“ï¼Œæ‰€ä»¥ä¼šç»™æˆ‘ä»¬ç”Ÿæˆå¥½ æˆ‘ä»¬ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿæç¤ºæˆ‘ä»¬æ˜¯å¦åŠ è½½å¤±è´¥ 1234567CWinApp::InitInstance(); //å»åŠ è½½å¥—æ¥å­—åº“ï¼Œéœ€è¦åŒ…å«ä¸€ä¸ªAfxsock.hçš„å¤´æ–‡ä»¶ï¼Œå°±ä¸éœ€è¦å»é“¾æ¥å¥—æ¥å­—åº“ if (!AfxSocketInit()) &#123; AfxMessageBox(\"Load socket\"); //åˆ©ç”¨AfxMessageBoxå¼¹å‡ºæç¤º return FALSE; &#125; æ¥ç€æˆ‘ä»¬å»æŸ¥çœ‹æ˜¯åŒ…å«äº†å¤´æ–‡ä»¶ çœ‹åˆ°è¿™ä¸ªè¯´æ˜æ²¡æœ‰é—®é¢˜ç„¶åæˆ‘ä»¬å»å¤´æ–‡ä»¶ä¸­å»å®šä¹‰ã€‚ ç„¶åæˆ‘ä»¬å»å†™åˆå§‹åŒ–çš„å‡½æ•°ä½“ 123456789101112131415161718192021222324252627BOOL CSorgsDlg::InitSocket()&#123; //å¥—æ¥å­—æœ¬èº«çš„åˆå§‹åŒ– //æŒ‡å®šåœ°å€æ—ï¼Œç±»å‹ï¼ˆç»™äºˆUDTçš„æ•°æ®åŒ…å¥—æ¥å­—ï¼‰ï¼Œ0(ç³»ç»Ÿè‡ªå·±é€‰æ‹©åˆé€‚çš„åè®®) msocket = socket(AF_INET,SOCK_DGRAM,0);//msocketï¼šç§æœ‰æƒé™çš„å¥—æ¥å­—æè¿°ç¬¦ if (INVALID_SOCKET == msocket) //åˆ¤æ–­å¥—æ¥å­—æ˜¯å¦åˆ›å»ºå¤±è´¥ &#123; MessageBox(\"create socket false\"); return FALSE; &#125; //ä½œä¸ºæ¥æ”¶ç«¯ï¼Œéœ€è¦ç»‘å®šç«¯å£å’Œåœ°å€ä¸Š SOCKADDR_IN acceptSock; //å®šä¹‰åœ°å€ç»“æ„ä½“çš„å˜é‡ acceptSock.sin_family = AF_INET; //åœ°å€æ— acceptSock.sin_port = htons(6000);//è®¾å®šç«¯å£ ç”¨htonsè½¬æ¢ acceptSock.sin_addr.S_un.S_addr = htonl(INADDR_ANY); //æ¥å—å‘é€åˆ°æœ¬åœ°ä»»ä½•IPåœ°å€çš„æ•°æ® htonlè½¬æ¢ //è¿›è¡Œç»‘å®š int retval = 0; //å®šä¹‰æ•´ç†å˜é‡ç”¨æ¥åˆ¤æ–­ bind(msocket,(SOCKADDR *)&amp;acceptSock,sizeof(SOCKADDR)); if (SOCKET_ERROR == retval) &#123; closesocket(msocket); //å…³é—­å¥—æ¥å­— MessageBox(\"bind false\"); return FALSE; &#125; return TRUE; &#125; å†™å®Œäº†æˆ‘ä»¬çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å»è®¾ç½®åŠ è½½å®ƒçš„åœ°æ–¹ã€‚ åœ¨è¿™ä¸ªå‡½æ•°ä¸­å»è°ƒç”¨æˆ‘ä¹ˆçš„åˆå§‹åŒ–å¥—æ¥å­—å‡½æ•°1BOOL CSorgsChatDlg::OnInitDialog() æ¥æ”¶ç«¯ç°åœ¨å¼€å§‹æ¥æ”¶ç«¯çš„ç¨‹åºï¼Œä¸ºè§£å†³CreateThreadä¸­çš„LPVOIDåªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°å€¼çš„é—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå»å¤´æ–‡ä»¶ç©¿ä»¶ä¸€ä¸ªä¸€ä¸ªç»“æ„ä½“ 123456//å®šä¹‰ç»“æ„ä½“,è§£å†³CreateThreadä¸­çš„LPVOIDåªèƒ½ä¼ é€’ä¸€ä¸ªå‚æ•°å€¼çš„é—®é¢˜ struct RECVPARAM &#123; SOCKET sock;//å®šä¹‰ä¸€ä¸ªå¥—æ¥å­—ç±»å‹çš„å˜é‡ HWND hwnd;//å®šä¹‰ä¸€ä¸ªçª—å£ç±»å‹çš„å˜é‡ &#125;; å®šä¹‰å¥—æ¥å­—çš„æŒ‡é’ˆæ¥ä¸‹æ¥å»å®šä¹‰å¥—æ¥å­—çš„æŒ‡é’ˆå’Œä¸²å£å¥æŸ„ï¼ˆç°åœ¨åˆšåˆšè°ƒç”¨åˆå§‹åŒ–å¥—æ¥å­—å‡½æ•°çš„ä¸‹é¢ï¼‰ 12345678RECVPARAM *mRecvParam = new RECVPARAM; //å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ mRecvParam-&gt;sock = msocket; //åˆå§‹åŒ–æˆ‘ä»¬åˆ›å»ºçš„å¥—æ¥å­— mRecvParam-&gt;hwnd = m_hWnd; //åˆå§‹åŒ–æˆ‘ä»¬çª—å£ mhWndé‡Œé¢ä¿å­˜äº†å’Œè¿™ä¸ªç±»ç›¸å…³çš„çª—å£çš„å¥æŸ„ //è°ƒç”¨CteateThreadå¸¸è§çº¿ç¨‹ //NULL,0ï¼šå’Œè°ƒç”¨çº¿ç¨‹ä½¿ç”¨ä¸€æ ·çš„å¤§å°,çº¿ç¨‹å‡½æ•°çš„åœ°å€ï¼Œï¼ˆå¼ºè½¬ï¼‰å‚æ•°ï¼Œåˆ›å»ºçš„æ ‡è®°ï¼ˆä¸€æ—¦åˆ›å»ºç«‹å³è¿è¡Œï¼‰ï¼Œçº¿ç¨‹ID HANDLE mThread = CreateThread(NULL,0,Threadpro,(LPVOID)mRecvParam,0,NULL); CloseHandle(mThread); //å°†çº¿ç¨‹å¥æŸ„å…³é—­ åŒæ—¶é€’å‡çº¿ç¨‹ç±»å’Œå¯¹è±¡çš„ä½¿ç”¨åŸºæ•° ä¸ºäº†ä½¿ç”¨å®Œå…¨ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬å»å¤´æ–‡ä»¶è¿›è¡Œå®šä¹‰ 123456//å½“åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ã€‚è¿è¡Œæ—¶ä»£ç éœ€è¦å»è°ƒç”¨è¿™ä¸ªçº¿ç¨‹å‡½æ•°ä»è€Œå¯åŠ¨çº¿ç¨‹ //è€Œæˆ‘ä»¬ä¸ºäº†ä¸è®¾ç½®ä¸ºå…¨å±€å‡½æ•°è®¾ç½®ä¸ºCSorgsChatDlgç±»çš„æˆå‘˜å‡½æ•°ï¼ˆå®Œå…¨é¢å‘å¯¹è±¡çš„æ€æƒ³ç¼–ç¨‹ï¼‰ //è€Œè¦æƒ³è°ƒç”¨è¿™ä¸ªæˆå‘˜å‡½æ•°ï¼Œå¿…é¡»å»å®šä¹‰ä¸€ä¸ªCSorgsChatDlgçš„å¯¹è±¡ //å¯¹äºè¿è¡Œæ—¶ä»£ç æ¥è¯´ï¼Œå¹¶ä¸çŸ¥é“è¦å®šä¹‰é‚£ä¸ªå¯¹è±¡æˆ–è€…è¯´ä¸çŸ¥é“æ€ä¹ˆå»å®šä¹‰ //æ‰€ä»¥æˆ‘ä»¬å°±åƒè¿™ä¸ªæˆå‘˜å‡½æ•°è®¾ç½®ä¸ºé™æ€ static DWORD WINAPI Threadpro(LPVOID mlpvpid); //å®šä¹‰ä¸ºé™æ€ï¼Œä¸å±äºé‚£ä¸€ä¸ªå¯¹è±¡ï¼Œåªå±äºè¿™ä¸ªç±»æœ¬èº« Threadproç„¶åå¼€å§‹ç¼–å†™Threadproå‡½æ•°ä½“ å‘é€æ¶ˆæ¯çš„å‡½æ•°ç„¶åå°±æ˜¯å»ç¼–å†™å‘é€æ¶ˆæ¯çš„å‡½æ•°å…ˆå»æˆ‘ä»¬çš„MFCç•Œé¢åŒå‡»å‘é€æŒ‰é’®ï¼Œç”Ÿæˆç‚¹å‡»äº‹ä»¶æŒ‰é’®å¹¶å³é”®å±æ€§ï¼Œå»çŸ¥é“æˆ‘ä»¬çš„æ˜¾ç¤ºå‘é€å’Œæ˜¾ç¤ºæ¥æ”¶æ•°æ®çš„IDå· 123456789101112131415161718192021222324252627void CSorgsDlg::OnBnClickedButton1() &#123; DWORD dwIP; ((CIPAddressCtrl*)GetDlgItem(IDC_IPADDRESS1))-&gt;GetAddress(dwIP);//IPæ§ä»¶çš„ID SOCKADDR_IN ToSock;//å®šä¹‰åœ°å€ç»“æ„ä½“å˜é‡ ToSock.sin_family = AF_INET; //åœ°å€æ— ToSock.sin_port = htons(6000);//è®¾å®šç«¯å£ ç”¨htonsè½¬æ¢ ToSock.sin_addr.S_un.S_addr= htonl(dwIP); CString strSend; GetDlgItemText(IDC_EDIT4,strSend);//å‘é€æ¡†é‡Œé¢IDï¼Œè·å–é‡Œé¢çš„å†…å®¹ //å¥—æ¥å­—ï¼Œå‘é€çš„buffer,é•¿åº¦ï¼ˆå¤šå‘é€ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œæ ‡è®°ï¼Œåœ°å€ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œåœ°å€ç»“æ„ä½“çš„é•¿åº¦ sendto(msocket,strSend,strSend.GetLength()+1,0,(SOCKADDR*)&amp;ToSock,sizeof(SOCKADDR));//å‘é€ SetDlgItemText(IDC_EDIT4,\"\");//å‘é€ä¹‹åå°†å‘é€æ¡†çš„å†…å®¹ç½®ç©º //æ˜¾ç¤ºè‡ªå·±å‘é€æ¡†çš„æ•°æ®è®¾ç½® CString strto; GetDlgItemText(IDC_EDIT3,strto);//è·å–æ–‡æœ¬ï¼ŒIDå·ï¼Œå­˜æ”¾æ•°æ®çš„åœ°æ–¹ strto +=\"\\r\\n\"; //å¢åŠ æ¢è¡Œ strto +=\"å¸…å¸…çš„è‡ªå·±è¯´:\"; strto += strSend; SetDlgItemText(IDC_EDIT3,strto);//å°†æ•°æ®æ”¾å›ç¼–è¾‘æ¡† &#125; æ¶ˆæ¯å“åº”ç„¶åæˆ‘ä»¬åœ¨å»ç¼–å†™æ¶ˆæ¯å“åº”å‡½æ•°åœ¨å¤´æ–‡ä»¶ä¸­å†™å…¥å‡½æ•°å£°æ˜ æ¶ˆæ¯æ˜ å°„ç„¶åå»ç¼–å†™æ¶ˆæ¯æ˜ å°„ ç„¶åå»å†™å‡½æ•°ä½“ 12345678910111213141516//æ¶ˆæ¯å“åº”å‡½æ•° //LRESULTï¼Œ32ä½æ•´å½¢æ•°ï¼Œå¸¸å¸¸ç”¨äºå›è°ƒå‡½æ•° LRESULT CSorgsDlg::MRecvData(WPARAM wParam,LPARAM lParam)&#123; CString str = (char*)lParam; CString strTemp;//æ¥æ”¶ä¹…çš„æ•°æ® GetDlgItemText(IDC_EDIT2,strTemp);//è·å–æ˜¾ç¤ºå‘é€æ¡†IDå·ï¼Œå­˜æ”¾æ•°æ®çš„åœ°æ–¹ str += \"\\r\\n\"; //å¢åŠ æ¢è¡Œ str +=strTemp; SetDlgItemText(IDC_EDIT2,str);//å°†æ•°æ®æ”¾å›ç¼–è¾‘æ¡† return TRUE; &#125; è‡ªæ­¤ï¼Œæˆ‘ä»¬ä»£ç ç¼–å†™å®Œæ¯• ä¼˜åŒ–æ§ä»¶ä½¿æ˜¾ç¤ºæ¡†åˆ†è¡Œå³é”®å±æ€§æŠŠMultilineè®¾ç½®ä¸ºtrue æŒ‰é’®å›è½¦å‘é€å’Œä¸æ˜¾ç¤ºæŒ‰é’®å³é”®æŒ‰é’®å±æ€§ æµ‹è¯•è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨127.0.0.1å›ç¯åœ°å€è¿›è¡Œæµ‹è¯• è¿™æ ·å°±è¯´æ˜æ²¡æœ‰é—®é¢˜äº†","tags":[{"name":"Windowsç½‘ç»œç¼–ç¨‹","slug":"Windowsç½‘ç»œç¼–ç¨‹","permalink":"http://sorgs.cn/tags/Windowsç½‘ç»œç¼–ç¨‹/"},{"name":"èŠå¤©å®¤","slug":"èŠå¤©å®¤","permalink":"http://sorgs.cn/tags/èŠå¤©å®¤/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://sorgs.cn/tags/å¤šçº¿ç¨‹/"}]},{"title":"Androidä¸¤ä¸ªandroidä¸¤ä¸ªactivityä¹‹é—´ç›¸äº’ä¼ é€’æ•°æ®ä¹‹è£…å¤‡é€‰æ‹©ï¼ˆä¹¦ä¸Šæ¡ˆä¾‹ï¼‰","date":"2016-11-21T03:00:58.000Z","path":"post/6825/","text":"è¿™ä¸ªæ˜¯ä¹¦ä¸Šçš„ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘å°†å…¶å®Œå–„äº†ä¸€ç‚¹è€Œå·² xmlæ˜¾ç¤ºåˆ›å»ºä¸€ä¸ªxmlçš„ä¸»ç•Œé¢ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/activity_main\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:orientation=\"vertical\" android:gravity=\"center\" tools:context=\"sorgs.com.selectequipment.MainActivity\"&gt; &lt;ImageView android:id=\"@+id/pet_imgv\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_centerHorizontal=\"true\" android:layout_marginBottom=\"5dp\" android:layout_marginTop=\"30dp\" android:src=\"@drawable/body\"/&gt; &lt;TextView android:id=\"@+id/pet_dialog_tv\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_centerHorizontal=\"true\" android:layout_marginBottom=\"25dp\" android:gravity=\"center\" android:text=\"ä¸»äººï¼Œå¿«ç»™å°å®å®è´­ä¹°è£…å¤‡å§\"/&gt; &lt;TableLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_gravity=\"center\" android:layout_marginBottom=\"20dp\"&gt; &lt;TableRow android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;TextView android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"ç”Ÿå‘½å€¼ï¼š\" android:textColor=\"@android:color/black\" android:textSize=\"14sp\"/&gt; &lt;ProgressBar android:id=\"@+id/progressBar1\" style=\"?android:attr/progressBarStyleHorizontal\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_gravity=\"center\" android:layout_weight=\"2\"/&gt; &lt;TextView android:id=\"@+id/tv_life_progress\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"0\" android:gravity=\"center\" android:textColor=\"#000000\" /&gt; &lt;/TableRow&gt; &lt;TableRow android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;TextView android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"æ”»å‡»åŠ›ï¼š\" android:textColor=\"@android:color/black\" android:textSize=\"14sp\"/&gt; &lt;ProgressBar android:id=\"@+id/progressBar2\" style=\"?android:attr/progressBarStyleHorizontal\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_gravity=\"center\" android:layout_weight=\"2\"/&gt; &lt;TextView android:id=\"@+id/tv_attack_progress\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"0\" android:gravity=\"center\" android:textColor=\"#000000\" /&gt; &lt;/TableRow&gt; &lt;TableRow android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;TextView android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"æ•æ·ï¼š\" android:textColor=\"@android:color/black\" android:textSize=\"14sp\"/&gt; &lt;ProgressBar android:id=\"@+id/progressBar3\" style=\"?android:attr/progressBarStyleHorizontal\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_gravity=\"center\" android:layout_weight=\"2\"/&gt; &lt;TextView android:id=\"@+id/tv_speed_progress\" android:layout_width=\"0dip\" android:layout_height=\"wrap_content\" android:layout_weight=\"1\" android:text=\"0\" android:gravity=\"center\" android:textColor=\"#000000\" /&gt; &lt;/TableRow&gt; &lt;/TableLayout&gt; &lt;RelativeLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\"&gt; &lt;Button android:id=\"@+id/btn_master\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_alignParentLeft=\"true\" android:layout_alignParentTop=\"true\" android:onClick=\"click1\" android:drawablePadding=\"3dp\" android:text=\"ä¸»äººè´­ä¹°è£…å¤‡\" android:textSize=\"14sp\"/&gt; &lt;Button android:id=\"@+id/btn_baby\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_alignParentRight=\"true\" android:layout_alignParentTop=\"true\" android:onClick=\"click2\" android:drawablePadding=\"3dp\" android:text=\"å°å®å®è´­ä¹°è£…å¤‡\" android:textSize=\"14sp\"/&gt; &lt;/RelativeLayout&gt;&lt;/LinearLayout&gt; ç„¶ååœ¨åˆ›å»ºä¸€ä¸ªè´­ä¹°è£…å¤‡è´­ä¹°çš„é¡µé¢ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:id=\"@+id/r1\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:orientation=\"vertical\"&gt; &lt;View android:layout_width=\"30dp\" android:layout_height=\"30dp\" android:layout_centerVertical=\"true\" android:layout_alignParentLeft=\"true\"/&gt; &lt;TextView android:id=\"@+id/tv_name\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_centerVertical=\"true\" android:layout_marginLeft=\"60dp\" android:text=\"å•†å“åç§°\"/&gt; &lt;LinearLayout android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_centerInParent=\"true\" android:orientation=\"vertical\"&gt; &lt;TextView android:id=\"@+id/tv_life\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:textSize=\"13sp\" android:text=\"ç”Ÿå‘½å€¼\"/&gt; &lt;TextView android:id=\"@+id/tv_attack\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:textSize=\"13sp\" android:text=\"æ”»å‡»åŠ›\"/&gt; &lt;TextView android:id=\"@+id/tv_speed\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:textSize=\"13sp\" android:text=\"é€Ÿåº¦\"/&gt; &lt;/LinearLayout&gt;&lt;/RelativeLayout&gt; JAVAç„¶ååˆ›å»ºä¸€ä¸ªItemfnfoç±»ï¼Œç”¨æ¥å°è£…è£…å¤‡ä¿¡æ¯ æ¥ç€å†™ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package sorgs.com.domain;import java.io.Serializable;/** * Created by Administrator on 2016/11/20. */public class ItemInfo implements Serializable&#123; private String name; private int acctack; private int life; private int speed; public ItemInfo(String name, int acctack, int life, int speed)&#123; this.name = name; this.acctack = acctack; this.life = life; this.speed = speed; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAcctack() &#123; return acctack; &#125; public void setAcctack(int acctack) &#123; this.acctack = acctack; &#125; public int getLife() &#123; return life; &#125; public void setLife(int life) &#123; this.life = life; &#125; public int getSpeed() &#123; return speed; &#125; public void setSpeed(int speed) &#123; this.speed = speed; &#125; @Override public String toString() &#123; return \"[\" + \"name='\" + name + \", acctack=\" + acctack + \", life=\" + life + \", speed=\" + speed + \"]\"; &#125;&#125; ç„¶ååˆ›å»ºä¸€ä¸ªshopactivityï¼Œç”¨æ¥å±•ç¤ºä¸»äººè£…å¤‡ä¿¡æ¯çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package sorgs.com.selectequipment.sorgs.com;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.widget.TextView;import sorgs.com.domain.ItemInfo;import sorgs.com.selectequipment.R;/** * Created by Administrator on 2016/11/20. */public class ShopActivity extends Activity implements View.OnClickListener &#123; private ItemInfo itemInfo; protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_shop); itemInfo = new ItemInfo(\"é‡‘å‰‘\",100,20,20); findViewById(R.id.r1).setOnClickListener(this); TextView mLifeTV = (TextView) findViewById(R.id.tv_life); TextView mNameTV = (TextView) findViewById(R.id.tv_name); TextView mSpeedTV = (TextView) findViewById(R.id.tv_speed); TextView mAttackTV = (TextView) findViewById(R.id.tv_attack); //TextView æ˜¾ç¤ºå­—ç¬¦ä¸²ï¼Œè¿™é‡Œä¼ å…¥intå€¼ç¼–è¯‘ä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œä¼šå‡ºé”™ mLifeTV.setText(\"ç”Ÿå‘½å€¼+\"+itemInfo.getLife()); mNameTV.setText(itemInfo.getName()); mSpeedTV.setText(\"æ•æ·åº¦+\"+itemInfo.getSpeed()); mAttackTV.setText(\"æ”»å‡»åŠ›+\"+itemInfo.getAcctack()); &#125; @Override public void onClick(View view) &#123; switch (view.getId())&#123; case R.id.r1: Intent intent = new Intent(); intent.putExtra(\"equipment\",itemInfo); setResult(1,intent); //è®¾ç½®è¯·æ±‚ç  finish(); break; &#125; &#125;&#125; å†å»ºç«‹ä¸€ä¸ªshopactivity2ï¼Œç”¨æ¥æ”¾å®å®è´­ä¹°è£…å¤‡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package sorgs.com.selectequipment.sorgs.com;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.widget.TextView;import sorgs.com.domain.ItemInfo;import sorgs.com.selectequipment.R;/** * Created by Administrator on 2016/11/20. */public class ShopActivity2 extends Activity implements View.OnClickListener&#123; private ItemInfo itemInfo; protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_shop); itemInfo = new ItemInfo(\"é“¶å‰‘\",50,10,10); findViewById(R.id.r1).setOnClickListener(this); TextView mLifeTV = (TextView) findViewById(R.id.tv_life); TextView mNameTV = (TextView) findViewById(R.id.tv_name); TextView mSpeedTV = (TextView) findViewById(R.id.tv_speed); TextView mAttackTV = (TextView) findViewById(R.id.tv_attack); //TextView æ˜¾ç¤ºå­—ç¬¦ä¸²ï¼Œè¿™é‡Œä¼ å…¥intå€¼ç¼–è¯‘ä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œä¼šå‡ºé”™ mLifeTV.setText(\"ç”Ÿå‘½å€¼+\"+itemInfo.getLife()); mNameTV.setText(itemInfo.getName()); mSpeedTV.setText(\"æ•æ·åº¦+\"+itemInfo.getSpeed()); mAttackTV.setText(\"æ”»å‡»åŠ›+\"+itemInfo.getAcctack()); &#125; @Override public void onClick(View view) &#123; switch (view.getId())&#123; case R.id.r1: Intent intent = new Intent(); intent.putExtra(\"equipment\",itemInfo); setResult(2,intent); //è®¾ç½®è¯·æ±‚ç  finish(); break; &#125; &#125;&#125; æœ€åç¼–å†™æˆ‘ä»¬çš„ä¸»å‡½æ•° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101package sorgs.com.selectequipment;import android.content.Intent;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.view.View;import android.widget.ProgressBar;import android.widget.TextView;import sorgs.com.domain.ItemInfo;import sorgs.com.selectequipment.sorgs.com.ShopActivity;import sorgs.com.selectequipment.sorgs.com.ShopActivity2;public class MainActivity extends AppCompatActivity &#123; private ProgressBar mProgressBar1; private ProgressBar mProgressBar2; private ProgressBar mProgressBar3; private TextView mLifeTV; private TextView mAttackTV; private TextView mSpeedTV; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mLifeTV = (TextView) findViewById(R.id.tv_life_progress); mAttackTV = (TextView) findViewById(R.id.tv_attack_progress); mSpeedTV = (TextView) findViewById(R.id.tv_speed_progress); initProgress(); //åˆå§‹åŒ–è¿›åº¦æ¡ &#125; private void initProgress() &#123; mProgressBar1 = (ProgressBar) findViewById(R.id.progressBar1); mProgressBar2 = (ProgressBar) findViewById(R.id.progressBar2); mProgressBar3 = (ProgressBar) findViewById(R.id.progressBar3); mProgressBar1.setMax(1000); //è®¾ç½®æœ€å¤§çš„å€¼1000 mProgressBar2.setMax(1000); mProgressBar3.setMax(1000); &#125; public void click1(View view)&#123; //å¼€å¯æ–°çš„activityå¹¶ä¸”æƒ³è·å–ä»–çš„è¿”å›å€¼ Intent intent = new Intent(this, ShopActivity.class); startActivityForResult(intent,1); //è¿”å›è¯·æ±‚ç»“æœï¼Œè¯·æ±‚ç ä¸º1 &#125; public void click2(View view)&#123; //å¼€å¯æ–°çš„activityå¹¶ä¸”æƒ³è·å–ä»–çš„è¿”å›å€¼ Intent intent = new Intent(this, ShopActivity2.class); startActivityForResult(intent,2); //è¿”å›è¯·æ±‚ç»“æœï¼Œè¯·æ±‚ç ä¸º2 &#125; @Override protected void onActivityResult(int requestCode, int resultCode, Intent data) &#123;//è·å–ShopActivityçš„è£…å¤‡ä¿¡æ¯ super.onActivityResult(requestCode, resultCode, data); if (data != null)&#123; if (resultCode==1)&#123; //åˆ¤æ–­ç»“æœç æ˜¯å¦ç­‰äº1ï¼Œç­‰äº1ä¸ºä¸»äººæ·»åŠ è£…å¤‡ if (requestCode == 1)&#123; ItemInfo info = (ItemInfo) data.getSerializableExtra(\"equipment\"); updateProgress(info); //æ›´æ–°ProgressBarçš„å€¼ &#125; &#125; else if (requestCode == 2)&#123;//åˆ¤æ–­ç»“æœç æ˜¯å¦ç­‰äº2ï¼Œç­‰äº2ä¸ºå®å®æ·»åŠ è£…å¤‡ï¼Œ if (requestCode == 2)&#123; ItemInfo info = (ItemInfo) data.getSerializableExtra(\"equipment\"); updateProgress2(info); //æ›´æ–°ProgressBarçš„å€¼ &#125; &#125; &#125; &#125; private void updateProgress2(ItemInfo info) &#123; int progress1 = mProgressBar1.getProgress(); int progress2 = mProgressBar2.getProgress(); int progress3 = mProgressBar3.getProgress(); mProgressBar1.setProgress(progress1+info.getLife()); mProgressBar2.setProgress(progress2+info.getAcctack()); mProgressBar3.setProgress(progress3+info.getSpeed()); mLifeTV.setText(mProgressBar1.getProgress()+\"\"); mAttackTV.setText(mProgressBar2.getProgress()+\"\"); mSpeedTV.setText(mProgressBar3.getProgress()+\"\"); &#125; private void updateProgress(ItemInfo info) &#123; //æ›´æ–°ProgressBarçš„å€¼ int progress1 = mProgressBar1.getProgress(); int progress2 = mProgressBar2.getProgress(); int progress3 = mProgressBar3.getProgress(); mProgressBar1.setProgress(progress1+info.getLife()); mProgressBar2.setProgress(progress2+info.getAcctack()); mProgressBar3.setProgress(progress3+info.getSpeed()); mLifeTV.setText(mProgressBar1.getProgress()+\"\"); mAttackTV.setText(mProgressBar2.getProgress()+\"\"); mSpeedTV.setText(mProgressBar3.getProgress()+\"\"); &#125;&#125; é…ç½®æœ€åä¸€æ­¥ï¼Œå»é…ç½®æ¸…å•é‡Œé¢å»é…ç½®ä¸€ä¸‹ æ•ˆæœ","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Androidä¸¤ä¸ªandroidä¸¤ä¸ªactivityä¹‹é—´ç›¸äº’ä¼ é€’æ•°æ®","date":"2016-11-21T02:34:39.000Z","path":"post/50165/","text":"è¿™ä¸ªæ¡ˆä¾‹æ˜¯ä¹¦ä¸Šçš„ä¹ é¢˜ï¼Œæˆ‘å‘ç”Ÿæ¥äº†ä¸€ç‚¹æ”¹å˜è€Œå·² xmlï¼šè¿™æ˜¯ç¬¬ä¸€ä¸ªxmlï¼Œå¾ˆç®€å•çš„ä¸¤ä¸ªtvå’ŒedåŠ ä¸€ä¸ªbtn 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/activity_main\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:orientation=\"vertical\" tools:context=\"sorgs.com.datepass.MainActivity\"&gt; &lt;LinearLayout android:id=\"@+id/regisrt_username\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_centerHorizontal=\"true\" android:layout_marginLeft=\"10dp\" android:layout_marginRight=\"10dp\" android:layout_marginTop=\"22dp\" android:orientation=\"horizontal\"&gt; &lt;TextView android:layout_width=\"80dp\" android:layout_height=\"wrap_content\" android:gravity=\"right\" android:paddingRight=\"5dp\" android:text=\"ç”¨æˆ·åï¼š\"/&gt; &lt;EditText android:id=\"@+id/et_name\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"è¯·è¾“å…¥æ‚¨çš„å§“å\" android:textSize=\"14dp\"/&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:id=\"@+id/regisrt_userage\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:layout_below=\"@+id/regisrt_username\" android:layout_centerHorizontal=\"true\" android:layout_marginLeft=\"10dp\" android:layout_marginRight=\"10dp\" android:layout_marginTop=\"5dp\" android:orientation=\"horizontal\"&gt; &lt;TextView android:layout_width=\"80dp\" android:layout_height=\"wrap_content\" android:gravity=\"right\" android:paddingRight=\"5dp\" android:text=\"ç”¨æˆ·åï¼š\"/&gt; &lt;EditText android:id=\"@+id/et_age\" android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:hint=\"è¯·è¾“å…¥æ‚¨çš„å¹´é¾„\" android:textSize=\"14dp\"/&gt; &lt;/LinearLayout&gt; &lt;Button android:id=\"@+id/btn_send\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_below=\"@+id/regisrt_userage\" android:layout_centerHorizontal=\"true\" android:layout_marginTop=\"24dp\" android:text=\"å‘é€\"/&gt;&lt;/RelativeLayout&gt; å†æ¥çœ‹çœ‹ç¬¬äºŒä¸ªï¼Œå°±æ˜¾ç¤ºç¬¬ä¸€ä¸ªé¡µé¢ä¼ è¿‡æ¥çš„æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:orientation=\"vertical\"&gt; &lt;LinearLayout android:id=\"@+id/text\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\"&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:text=\"æ­å–œæ‚¨ï¼Œ\" android:textSize=\"20dp\"/&gt; &lt;TextView android:id=\"@+id/tv_1\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:textSize=\"20dp\"/&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:text=\"æ¥åˆ°è¿™ä¸ªä¸–ç•Œï¼š\" android:textSize=\"20dp\"/&gt; &lt;TextView android:id=\"@+id/tv_2\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:textSize=\"20dp\"/&gt; &lt;/LinearLayout&gt; &lt;Button android:id=\"@+id/btn_return\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_below=\"@+id/text\" android:layout_centerHorizontal=\"true\" android:layout_marginTop=\"24dp\" android:text=\"è¿”å›\"/&gt;&lt;/RelativeLayout&gt; JAVA:æ¥ä¸‹æ¥å°±æ˜¯javaçš„ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243package sorgs.com.datepass;import android.content.Intent;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.EditText;public class MainActivity extends AppCompatActivity &#123; private Button btn1; private EditText etname; private EditText etage; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); btn1 = (Button) findViewById(R.id.btn_send); etage = (EditText) findViewById(R.id.et_age); etname = (EditText) findViewById(R.id.et_name); btn1.setOnClickListener(new View.OnClickListener() &#123; //ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æäº¤æ•°æ® @Override public void onClick(View view) &#123; pssDate(); &#125; &#125;); &#125; public void pssDate()&#123; Intent intent = new Intent(this,MainActivity2.class);//åˆ›å»ºIntentå¯¹è±¡ï¼Œå¯åŠ¨MainActivity2 intent.putExtra(\"name\",etname.getText().toString().trim()); //å°†æ•°æ®å­˜å…¥Intentå¯¹è±¡ intent.putExtra(\"age\",etage.getText().toString().trim()); startActivity(intent); finish(); &#125;&#125; ç„¶åå°±æ˜¯ç¬¬äºŒä¸ªé¡µé¢çš„javaäº† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package sorgs.com.datepass;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.TextView;/** * Created by Administrator on 2016/11/20. */public class MainActivity2 extends Activity &#123; private TextView tv1; private TextView tv2; private Button btn2; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_date); tv1 = (TextView) findViewById(R.id.tv_1); tv2 = (TextView) findViewById(R.id.tv_2); btn2 = (Button) findViewById(R.id.btn_return); Intent intent1 = getIntent();//è·å–Intentå¯¹è±¡ //å–å‡ºå¯¹keyä¸­çš„å€¼ String name = intent1.getStringExtra(\"name\"); String age = intent1.getStringExtra(\"age\"); //è®¾ç½®åˆ°å¯¹çš„æ§ä»¶ä¸­ tv1.setText(name + \"!\"); tv2.setText(age + \"å¹´ã€‚\"); btn2.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; updata(); &#125; &#125;); &#125; private void updata() &#123; Intent intent2 = new Intent(this,MainActivity.class); startActivity(intent2); finish(); &#125;&#125; é…ç½®ç¬¬äºŒä¸ªé¡µé¢åšäº†ä¸€ä¸ªè·³è½¬å›ç¬¬ä¸€ä¸ªé¡µé¢çš„å¤„ç† æœ€åä¸€å®šè®°å¾—åœ¨é…ç½®é‡Œé¢é…ç½®ä¸€ä¸‹ æ¥çœ‹çœ‹æ•ˆæœ","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"androidéšå¼æ„å›¾å¼€å¯ç³»ç»Ÿç…§ç›¸æœº","date":"2016-11-20T11:21:24.000Z","path":"post/21426/","text":"ç”±äºä¹¦ä¸Šæ˜¯è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘æ˜¯ç”¨çœŸæœºï¼Œæ‰€ä»¥ç›´æ¥æ‰“å¼€ç›¸æœº å…ˆæ˜¯123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" xmlns:tools=\"http://schemas.android.com/tools\" android:id=\"@+id/activity_main\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" tools:context=\"sorgs.com.opencamera.MainActivity\"&gt; &lt;!--layout_centerHorizontalå°†æ§ä»¶ç½®äºæ°´å¹³æ–¹å‘çš„ä¸­å¿ƒä½ç½® layout_centerVerticalè®©è¿™ä¸ªç›¸å¯¹å¸ƒå±€ï¼Œå¤„äºå®ƒçˆ¶æ§ä»¶çš„å‚ç›´æ–¹å‘çš„ä¸­å¿ƒ--&gt; &lt;Button android:id=\"@+id/openCamera\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_centerHorizontal=\"true\" android:layout_centerVertical=\"true\" android:text=\"æ‰“å¼€ç›¸æœº\" /&gt;&lt;/RelativeLayout&gt; ç„¶åæ˜¯java 12345678910111213141516171819202122232425262728package sorgs.com.opencamera;import android.content.Intent;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.view.View;import android.widget.Button;public class MainActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Button button = (Button) findViewById(R.id.openCamera); button.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; Intent intent = new Intent(); intent.setAction(\"android.media.action.IMAGE_CAPTUER\"); intent.addCategory(\"android.intent.category.DEFAULT\"); startActivity(intent); &#125; &#125;); &#125;&#125; æœ€åéœ€è¦å†é…ç½®æ¸…å•é‡Œå¼„ä¸€ä¸‹ 1234567891011&lt;activity android:name=\".MainActivity\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;action android:name=\"androd.media.action.IMAGE_CAPTURE\"/&gt; &lt;category android:name=\"android.intent.category.DEFAULT\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt;","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”Android NDKå¼€å‘4ä¹‹Android studio NDKè‡ªåŠ¨ç¼–è¯‘","date":"2016-11-17T08:41:09.000Z","path":"post/16045/","text":"è¿™éƒ¨åˆ†å°±æ˜¯æœ€åçš„éƒ¨åˆ†äº†ï¼Œä¸ºä»€ä¹ˆè¦å†™Android studioå‘¢ã€‚å¤§å®¶çŸ¥é“ï¼Œeclipse åˆ°äº†ç°åœ¨ï¼Œå·²ç»ä¸è¢«Googleæ”¯æŒäº†ï¼Œæ‰€ä»¥ç°åœ¨æœ€å¥½çš„å¼€å‘å°±æ˜¯åˆ©ç”¨Android studioã€‚è™½ç„¶è¯´ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç±»ä¼¼çš„æ•™ç¨‹äº†ã€‚ä½†æ˜¯æˆ‘éƒ½ä¸€ä¸€è¯•è¿‡äº†ï¼Œå¹¶ä¸æ˜¯å¤ªè¯¦ç»†ï¼Œè¿˜æœ‰äº›å°‘è®¸é”™è¯¯ã€‚æ‰€ä»¥ï¼Œæˆ‘åœ¨è¿™é‡Œå†™å‡ºè¯¦ç»†çš„è¿‡ç¨‹ï¼Œå¤§å®¶ç¬‘ç¬‘å°±å¥½ã€‚ä½†æ˜¯æ–°ç”Ÿæˆ‘è¿™ä¸ªåŠä¸€å¥ï¼Œæœ€å¥½åšä¸€éï¼Œè¿™ä¸ªå¾ˆé‡è¦ã€‚æˆ‘ä»¬ç”¨Android studioåˆ›å»ºä¸€ä¸ªappå·¥ç¨‹ï¼Œæˆ‘è¿™å»ºç«‹çš„æ˜¯17ã€‚åˆ‡æ¢åˆ°projectæ¨¡å¼ã€‚ ç„¶åè¿™ä¸ªå·¥ç¨‹ä¸Šå³é”®ï¼Œé€‰æ‹©open module settingsç„¶åé…ç½®ç¯å¢ƒ è®¾ç½®å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å»çœ‹çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸå‘¢ ç¡®è®¤ä¹‹åï¼Œå°±è¯¥æˆ‘ä»¬å»å†™ä»£ç äº†ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ç›´æ¥æŠŠhello worldçš„textviewæ”¹ä¸ºåŠ¨äº†ä¸€ä¸‹ ä¹‹åæˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªç±» ä¹‹åå†™ä¸‹å¦‚ä¸‹ä»£ç  ä¹‹åbuildä¸€ä¸‹å·¥ç¨‹ ç„¶åå»æŸ¥çœ‹æ—¶å€™ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ å¦‚æœæœ‰çš„è¯Terminalè¾“å…¥æŒ‡ä»¤ï¼šcd app/build/intermediates/classes/debug å†è¾“å…¥ï¼šjavah -jni sorgs.com.hellondk.NDKtest çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå°±è¯´æ˜OKäº†ã€‚ç„¶ååœ¨src/mainä¸‹æ–°å»ºæ–‡ä»¶å¤¹jni,æŠŠç”Ÿæˆçš„.hæ–‡ä»¶ç§»åˆ°jniæ–‡ä»¶å¤¹ä¸‹é¢å»ï¼Œæ–°å»ºä¸€ä¸ªcç±»éšä¾¿å–ä¸€ä¸ªåå­— ä¸€å®šä¸è¦é€‰è¿™ä¸ª å†™ä¸Šè¿™äº›ä»£ç  123456#include \"sorgs_com_hellondk_NDKtest.h\" JNIEXPORT jstring JNICALL Java_sorgs_com_hellondk_NDKtest_getString (JNIEnv *env, jobject obj)&#123; return (*env)-&gt;NewStringUTF(env,\"you are successful!\"); &#125; ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å»gradle.propertiesæ–‡ä»¶æœ«å°¾æ·»åŠ android.useDeprecatedNdk=true å†ç„¶å ç„¶ååœ¨appæ–‡ä»¶ä¸‹å¾—build.gradle -&gt;defaultConfigæ‹¬å·å†…æ·»åŠ å¦‚ä¸‹ä»£ç  123ndk &#123; moduleName \"test\" //ç”Ÿæˆçš„soåå­—ï¼Œä¸€å®šè¦å’ŒSoçš„åç§°ä¸€è‡´ï¼Œè¿™é‡Œå°±æ˜¯test) abiFilters \"armeabi\", \"armeabi-v7a\", \"x86\" //è¾“å‡ºæŒ‡å®šä¸‰ç§abiä½“ç³»ç»“æ„ä¸‹çš„soåº“ï¼Œéšä¾¿å†™ä¸€ä¸ªå°±è¡Œï¼Œä¸»è¦æ˜¯çœ‹æ¨¡æ‹Ÿå™¨ã€‚ä¹Ÿå¯ä»¥éƒ½å†™ä¸Š&#125; ç„¶åå†å»ä¸»å‡½æ•°å†™ä»£ç äº† ç„¶åbuildä¸€ä¸‹ï¼Œå»å°è¯•è¿è¡Œçœ‹çœ‹æ•ˆæœ","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"},{"name":"ndk","slug":"ndk","permalink":"http://sorgs.cn/tags/ndk/"},{"name":"gcc","slug":"gcc","permalink":"http://sorgs.cn/tags/gcc/"},{"name":"sdk","slug":"sdk","permalink":"http://sorgs.cn/tags/sdk/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”Android NDKå¼€å‘3ä¹‹ä½¿ç”¨ndk-buildå·¥å…·æ‰‹åŠ¨ç¼–è¯‘","date":"2016-11-17T08:35:10.000Z","path":"post/31148/","text":"åšè¿™ä¸ªä¹‹å‰ï¼Œå¿…é¡»æŠŠandroid.batçš„ç¯å¢ƒé…ç½®è¿›å» ç„¶åæˆ‘ä»¬ä½¿ç”¨android listçœ‹çœ‹Android SDKç§æ‰€æœ‰çš„SDKç‰ˆæœ¬ æˆ‘åœ¨è¿™é‡Œé€‰æ‹©äº†Android-17è¾“å…¥å¦‚ä¸‹å‘½ä»¤1android create project -n NDKtest -p NDTtest -t android-17 -k com.sorgs.NDKtest -a MyActiviry è¿™ä¸ªå‘½ä»¤å¯ä»¥æ ¹æ®é»˜è®¤Activityæ–‡ä»¶åè‡ªåŠ¨ç”Ÿæˆjavaæ–‡ä»¶ï¼Œå¹¶ç”ŸæˆAndroidMenifest.xml ä¹‹åæˆ‘ä»¬åœ¨è·Ÿç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹jniã€‚ç„¶åæŠŠCæ–‡ä»¶æ”¾è¿›å»ã€‚ç„¶åå¼€å§‹ç¼–å†™Android.mkè¿™é‡Œè¯´æ˜ä¸€ä¸‹ndk-buildä½¿ç”¨Android.mkå’ŒApplication.mkä½œä¸ºè„šæœ¬æ–‡ä»¶Application.mkæ˜¯å¯é€‰çš„ï¼Œæ˜¯ç”¨æ¥æè¿°åŸç”Ÿç¨‹åºæœ¬èº«ç”¨åˆ°çš„ä¸€äº›ç‰¹æ€§ã€‚Android.mkæ–‡ä»¶æ˜¯å·¥ç¨‹çš„ç¼–è¯‘è„šæœ¬ï¼Œæè¿°äº†ç¼–è¯‘åŸç”Ÿç¨‹åºæ‰€éœ€çš„ç¼–è¯‘é€‰é¡¹ã€å¤´æ–‡ä»¶ã€æºæ–‡ä»¶ä»¥åŠä¾èµ–åº“æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæš‚æ—¶åªéœ€è¦ç¼–å†™Android.mk 12345678&lt;span style=\"font-size:14px;color:#ff9900;\"&gt;&lt;strong&gt;LOCAL_PATH := $(call my-dir) include $(CLEAR_VARS) LOCAL_ARM_MODE := arm LOCAL_MODULE := NDKtest LOCAL_SRC_FILES := NDKtest.c include $(BUILD_EXECUTABLE)&lt;/strong&gt;&lt;/span&gt; ç„¶åæŠŠå®ƒä¹Ÿæ”¾åˆ°jnié‡Œé¢ ç„¶åæˆ‘ä»¬åˆ°NDKtestçš„ç›®å½•ä¸‹ï¼Œè¾“å…¥ndk-buildä¹‹åç­‰å¾…å‘½ä»¤çš„å®Œæˆã€‚å®Œæˆä¹‹åä¼šåœ¨libs/armeabiç­‰ä¸€ç³»åˆ—çš„æ–‡ä»¶å¤¹é‡Œç”ŸæˆNDKtestå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ç„¶åæˆ‘ä»¬æŠŠæ–‡ä»¶pushåˆ°æ‰‹æœºä¸­å» æƒ³è¦è¿è¡Œå®ƒï¼Œå°±çš„ç»™å®ƒæƒé™ã€‚ ä½¿ç”¨ä¹‹å‰çš„ adb shell /data/NDKtestå‘½ä»¤æˆ–è€…åœ¨adb shellé‡Œé¢ä½¿ç”¨./NDKtestéƒ½å¯ä»¥ï¼ æ€»ç»“ï¼šåœ¨è¿™ç¯‡é‡Œé¢ï¼Œéš¾åº¦ä¸ç®—å¤ªå¤§ã€‚é‡è¦çš„æ˜¯è¦ä¼šåªè¦é…ç½®å¥½ç¯å¢ƒï¼Œä¼šä¸€äº›åŸºæœ¬çš„Linuxå‘½ä»¤å°±æ˜¯OKçš„ã€‚å‰©ä¸‹çš„å°±æ˜¯å¤šå»æ€è€ƒäº†ã€‚æ¯”å¦‚æˆ‘åœ¨æˆåŠŸä¹‹å‰ï¼Œå¤±è´¥äº†å¾ˆå¤šæ¬¡ã€‚å–„äºæ€è€ƒæ‰èƒ½è§£å†³é—®é¢˜ã€‚æœ€åç»™å‡ºä¸‹è½½çš„åœ°æ–¹ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼šé“¾æ¥ï¼šhttp://pan.baidu.com/s/1hsHjRik å¯†ç ï¼šuqvh","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"},{"name":"ndk","slug":"ndk","permalink":"http://sorgs.cn/tags/ndk/"},{"name":"gcc","slug":"gcc","permalink":"http://sorgs.cn/tags/gcc/"},{"name":"sdk","slug":"sdk","permalink":"http://sorgs.cn/tags/sdk/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”Android NDKå¼€å‘1ç¯å¢ƒçš„é…ç½®åŠä»‹ç»","date":"2016-11-17T08:29:38.000Z","path":"post/3280/","text":"æœ‰å¥è¯ï¼Œå«åšå¼€å‘çš„èƒ½åŠ›å†³å®šé€†å‘çš„èƒ½åŠ›ã€‚ä¸ºäº†æ›´å¥½çš„å»ç ”ç©¶soï¼Œæˆ‘æ•´ç†äº†éè™«å¤§ä¾ çš„ä¹¦çš„NDKå¼€å‘ã€‚æŠŠä¹¦ä¸­çš„è€ç‰ˆæœ¬æ›´æ–°ä¸€ä¸‹ï¼Œå¹¶æŠŠä¸æ¸…æ¥šçš„åœ°æ–¹ææ¸…æ¥šã€‚å†™ä¸€ä¸ªNDKç³»ç±»çš„åŸºç¡€æ•™ç¨‹ã€‚å¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¿˜è¯·å¤§ç¥æ‰¶æ­£ã€‚è™½ç„¶çœ‹èµ·æ¥è¿™äº›å¾ˆç®€å•ï¼Œä½†æ˜¯å®é™…åŠ¨æ‰‹å»åš åˆ†åˆ«ä¸ºï¼š1.ç¯å¢ƒçš„é…ç½®2.åˆ©ç”¨gccç¼–è¯‘å™¨ï¼ˆäº¤å‰å·¥å…·é“¾ï¼‰æ‰‹åŠ¨ç¼–è¯‘å’ŒLinux Ubuntuç³»ç»Ÿä¸‹çš„äº¤å‰å·¥å…·é“¾æ‰‹åŠ¨ç¼–è¯‘3.ä½¿ç”¨ndk-buildå·¥å…·æ‰‹åŠ¨ç¼–è¯‘å’Œ.Android studio NDKç¼–è¯‘ ä¸€.ä½¿ç”¨çš„ç³»ç»Ÿ Windows10å·¥å…·ï¼šjava version â€œ1.8.0_60â€ NDKï¼šandroid-ndk-r13 Android studio 1.5.0 SDKJavaçš„è¯ï¼Œç›´æ¥ç™¾åº¦å³å¯NDKå’ŒAndroid studioç»™ä¸€ä¸ªä¸‹çš„åœ°æ–¹ï¼šä¸€ä¸ªå®‰å“å·¥å…·é›†åˆçš„ç½‘ç«™ï¼šhttp://androiddevtools.cn/ ä½¿ç”¨çš„ç³»ç»ŸLinux ubuntu-16.04å·¥å…·ï¼šjava version â€œ1.8.0_60â€ NDKï¼šandroid-ndk-r13 SDK äºŒ.é…ç½®ç¯å¢ƒ å‚ç…§æˆ‘çš„æ–¹å¼æŠŠSDKï¼ŒJAVAï¼ŒDNKçš„ç¯å¢ƒé…ç½®å¸¦ç¯å¢ƒå˜é‡ä¸­å»ã€‚ æˆåŠŸçš„æ•ˆæœå›¾ï¼š javaçš„ å…¶å®Windowsçš„ç¯å¢ƒæ˜¯å¾ˆå¥½è£…çš„ï¼Œåªè¦æ˜¯Linuxï¼ŒçœŸæ˜¯å„ç§ç™¾åº¦ã€‚å…³äºJavaçš„è¯ï¼Œè¯·å‚è€ƒè¿™é‡Œï¼šhttp://blog.csdn.net/qq_24349189/article/details/53000869ç„¶åå°±æ˜¯NDKç¯å¢ƒé¦–å…ˆè¿˜æ˜¯å»ç»™çš„ç½‘å€æŠŠåŒ…ä¸‹ä¸‹æ¥ï¼Œç„¶åæˆ‘ä»¬æ”¾åˆ°Linuxä¸‹é¢ï¼Œä½¿ç”¨1sorgs@sorgs-VirtualBox:$ sudo unzip android-ndk-r13-linux-x86_64.zip ä¹‹åæŠŠç¯å¢ƒé…ç½®è¿›å»ä½¿ç”¨1sorgs@sorgs-VirtualBox:/home/tools$ sudo gedit /etc/profile å†™ä¸Šè¿™ä¸ª ç„¶åæ‰§è¡Œ1sorgs@sorgs-VirtualBox:/home/tools$ sudo source /etc/profile ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆä¹‹åæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦æˆåŠŸå¯ä»¥è¾“å…¥makeå’Œndk-build å·²ç»æˆåŠŸ","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"},{"name":"ndk","slug":"ndk","permalink":"http://sorgs.cn/tags/ndk/"},{"name":"gcc","slug":"gcc","permalink":"http://sorgs.cn/tags/gcc/"},{"name":"linux","slug":"linux","permalink":"http://sorgs.cn/tags/linux/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”Android NDKå¼€å‘2ä¹‹Windowsä¸‹çš„gccæ‰‹åŠ¨ç¼–è¯‘ï¼ˆäº¤å‰è¿ç¼–è¯‘ï¼‰å’Œåˆ©Linux Ubuntuç³»ç»Ÿä¸‹çš„äº¤å‰å·¥å…·é“¾æ‰‹åŠ¨ç¼–è¯‘","date":"2016-11-17T08:18:25.000Z","path":"post/33150/","text":"ä¸€ã€äº¤å‰å·¥å…·é“¾è¿™äº›å·¥å…·éƒ½åœ¨NDKçš„è·¯å¾„ä¸‹ï¼šE:\\Android\\android-ndk-r13\\toolchains\\arm-linux-androideabi-4.9\\prebuilt\\windows-x86_64\\binè¿™äº›å·¥å…·çš„å‰ç¼€å‡ä¸ºarm-linux-androideabiï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä»–ä»¬æ¥ç¼–å†™NDKåŸç”Ÿç¨‹åºWindowså’ŒLinuxå¹³å°ä½¿ç”¨çš„gccéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå‘½ä»¤å‚æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼šarm-linux-androideabi-addr2line //å°†ç¨‹åºåœ°å€è½¬æ¢ä¸ºæ–‡ä»¶åå’Œè¡Œå·arm-linux-androideabi-ar // å»ºç«‹ã€ä¿®æ”¹ã€æå–å½’æ¡£æ–‡ä»¶arm-linux-androideabi-as //gasæ±‡ç¼–å™¨arm-linux-androideabi-c++ //å·¥å…·é“¾ä¸­arm-linux-androideabi-g++.exeçš„ä¸€ä¸ªæ‹·è´arm-linux-androideabi-c++filt //è¿æ¥å™¨ä½¿ç”¨å®ƒè¿‡æ»¤ç¬¦å·ï¼Œé˜²æ­¢é‡è½½å‡½æ•°å†²çªarm-linux-androideabi-cpp //C++ç¨‹åºç¼–è¯‘å·¥å…·arm-linux-androideabi-g++ //C++ç¨‹åºç¼–è¯‘å·¥å…·arm-linux-androideabi-gcc-4.9.x //å·¥å…·é“¾ä¸­arm-linux-androideabi-gcc.exeçš„ä¸€ä¸ªæ‹·è´arm-linux-androideabi-gcc //Cç¨‹åºç¼–è¯‘å·¥å…·arm-linux-androideabi-gcov //ç¨‹åºè¦†ç›–åº¦æµ‹é‡å·¥å…·ï¼Œè®°å½•ä»£ç çš„æ‰§è¡Œè·¯å¾„arm-linux-androideabi-gdb //è°ƒè¯•å·¥å…·arm-linux-androideabi-gprof //ç¨‹åºæ€§èƒ½æµ‹é‡å·¥å…·arm-linux-androideabi-ld //è¿æ¥å™¨ï¼Œç”¨äºç”Ÿæˆå¯æ‰§è¡Œç¨‹åºarm-linux-androideabi-nm //åˆ—å‡ºç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·arm-linux-androideabi-objcopy //å¤åˆ¶ç›®æ ‡æ–‡ä»¶ä¸­çš„å†…å®¹åˆ°å¦ä¸€ç§ç±»å‹çš„ç›®æ ‡æ–‡ä»¶ä¸­arm-linux-androideabi-objdump //è¾“å‡ºç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯arm-linux-androideabi-ranlib //äº§ç”Ÿå½’æ¡£æ–‡ä»¶ç´¢å¼•ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°è¿™ä¸ªå½’æ¡£æ–‡ä»¶ä¸­arm-linux-androideabi-readelf //æ˜¾ç¤ºelfæ ¼å¼å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯arm-linux-androideabi-run //ARMç¨‹åºæ¨¡æ‹Ÿå™¨arm-linux-androideabi-size //åˆ—å‡ºç›®æ ‡æ–‡ä»¶æ¯ä¸€æ®µçš„å¤§å°åŠæ€»ä½“çš„å¤§å°arm-linux-androideabi-strings //è¾“å‡ºç›®æ ‡æ–‡ä»¶çš„å¯æ‰“å°å­—ç¬¦ä¸²arm-linux-androideabi-strip //å»é™¤ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·ä¿¡æ¯ä»¥ä¸Šæ‘˜å½•ä¹‹ã€ŠAndroidè½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æã€‹ äºŒã€ç¼–å†™C++ç¨‹åºæˆ‘è¿™é‡Œä¹ æƒ¯ä½¿ç”¨VS2012ï¼Œå¤§å®¶å¯ä»¥æŒ‰è‡ªå·±çš„ä¹ æƒ¯ã€‚è®°äº‹æœ¬éƒ½å¯ä»¥ã€‚ 1234#include &lt;stdio.h&gt; void main()&#123; printf(\"Hello,you are successful ï¼\"); &#125; ä¸‰ã€ç¼–å†™makefile æ³¨æ„ï¼š1.æ–œæ çš„æ–¹å‘ï¼ˆåƒä¸‡ä¸è¦å¼„åäº†ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼ï¼ï¼ï¼‰ 2.æŠŠæˆ‘makefileä¸­ çš„//ä»¥åŠåé¢çš„å†…å®¹åˆ é™¤ï¼ 3.ä¸€å®šè®°å¾—å…ˆé…ç½®ç¯å¢ƒæœ€åç»™è¿™ä¸ªmakefileæ–‡æ¡£ 1234567891011121314151617181920212223242526272829303132NDK_ROOT=E:/Android/android-ndk-r13 TOOLCHAINS_ROOT=$(NDK_ROOT)/toolchains/arm-linux-androideabi-4.9/prebuilt/windows-x86_64 TOOLCHAINS_PREFIX=$(TOOLCHAINS_ROOT)/bin/arm-linux-androideabi TOOLCHAINS_INCLUDE=$(TOOLCHAINS_ROOT)/lib/gcc/arm-linux-androideabi/4.9.x/include-fixed PLATFORM_ROOT=$(NDK_ROOT)/platforms/android-17/arch-arm PLATFORM_INCLUDE=$(PLATFORM_ROOT)/usr/include PLATFORM_LIB=$(PLATFORM_ROOT)/usr/lib MODULE_NAME=HelloNDK RM=del FLAGS=-I$(TOOLCHAINS_INCLUDE) \\ -I$(PLATFORM_INCLUDE) \\ -L$(PLATFORM_LIB) \\ -nostdlib \\ -lgcc \\ -Bdynamic \\ -lc OBJS=$(MODULE_NAME).o \\ $(PLATFORM_LIB)/crtbegin_dynamic.o \\ $(PLATFORM_LIB)/crtend_android.o all: $(TOOLCHAINS_PREFIX)-gcc $(FLAGS) -c $(MODULE_NAME).c -o $(MODULE_NAME).o $(TOOLCHAINS_PREFIX)-gcc $(FLAGS) $(OBJS) -o $(MODULE_NAME) clean: $(RM) *.o install: adb push $(MODULE_NAME) /data/local/ adb shell chmod 755 /data/local/$(MODULE_NAME) å››ã€ç¼–è¯‘æˆ‘ä»¬æŠŠè¿™äº›ä¸œè¥¿å¼„å¥½äº†æ”¾åˆ°æ¡Œé¢ä¸Šçš„æ–‡ä»¶å¤¹gccNDKtestã€‚ç„¶åcmdå‘½ä»¤æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹ç„¶åmakeçœ‹åˆ°æ˜¯è¿™ä¸ªæ ·å­ï¼Œå°±è¯´æ˜æ²¡æœ‰é—®é¢˜äº† æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦çœ‹æ•ˆæœï¼Œå°±éœ€è¦ä¸€ä¸ªAndroidçš„æ‰‹æœºæˆ–è€…æ¨¡æ‹Ÿå™¨äº†ã€‚ä¾æ¬¡è¾“å…¥ make installadb shell /data/local/HelloNDK å°±å¯ä»¥çœ‹åˆ°æ•ˆæœå›¾äº† äº”ã€Linuxå’ŒWindowså·®ä¸å¤šï¼Œé‡ç‚¹æ˜¯ç¯å¢ƒéœ€è¦é…ç½®å¥½æˆ‘ç›´æ¥æŠŠWindowsé‡Œé¢çš„Cæ”¾è¿›å»ï¼Œå†ç¼–å†™makefilemakefileå¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132NDK_ROOT=/home/tools/android-ndk-r13 TOOLCHAINS_ROOT=$(NDK_ROOT)/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 TOOLCHAINS_PREFIX=$(TOOLCHAINS_ROOT)/bin/arm-linux-androideabi TOOLCHAINS_INCLUDE=$(TOOLCHAINS_ROOT)/lib/gcc/arm-linux-androideabi/4.9.x/include-fixed PLATFORM_ROOT=$(NDK_ROOT)/platforms/android-17/arch-arm PLATFORM_INCLUDE=$(PLATFORM_ROOT)/usr/include PLATFORM_LIB=$(PLATFORM_ROOT)/usr/lib MODULE_NAME=HelloNDK RM=rm -rf FLAGS=-I$(TOOLCHAINS_INCLUDE) \\ -I$(PLATFORM_INCLUDE) \\ -L$(PLATFORM_LIB) \\ -nostdlib \\ -lgcc \\ -Bdynamic \\ -lc OBJS=$(MODULE_NAME).o \\ $(PLATFORM_LIB)/crtbegin_dynamic.o \\ $(PLATFORM_LIB)/crtend_android.o all: $(TOOLCHAINS_PREFIX)-gcc $(FLAGS) -c $(MODULE_NAME).c -o $(MODULE_NAME).o $(TOOLCHAINS_PREFIX)-gcc $(FLAGS) $(OBJS) -o $(MODULE_NAME) clean: $(RM) *.o install: adb push $(MODULE_NAME) /data/local/ adb shell chmod 755 /data/local/$(MODULE_NAME) ç„¶åæ”¾åˆ°Linuxä¸‹é¢å»ï¼Œåˆ°è¿™ä¸ªæ–‡ä»¶çš„ç›®å½•ä¸‹makeå°±OKçš„ã€‚å‘½ä»¤æ˜¯ sorgs@sorgs-VirtualBox:/home/tools/gccNDKtest$ sudo make è¿™ä¸ªå°±è¯´æ˜ç¼–è¯‘æˆåŠŸäº†ã€‚å› ä¸ºæˆ‘è¿™Linuxæ˜¯è™šæ‹Ÿæœºï¼Œæ‰€ä»¥ä¸å¥½ç”¨æ‰‹æœºçœŸæ˜¯å»æµ‹è¯•æ‰€ä»¥æ‰‹ç»­çš„æµ‹è¯•å°±åœ¨Windowsä¸Šæµ‹è¯•çš„ï¼Œæ•ˆæœå’Œä¸Šé¢çš„ä¸€æ ·ã€‚ å…­ã€æ€»ç»“è™½ç„¶çœ‹èµ·æ¥è¿™å¾ˆç®€å•ï¼Œä½†æ˜¯å®é™…ä¸Šè‡ªå·±ä¸å»åŠ¨æ‰‹ï¼Œæ°¸è¿œä¸çŸ¥é“è¿™ç‚¹ç‚¹ä¸œè¥¿æ¥çš„å¤šä¹ˆè‰°è¾›ï¼Œå„ç§ç™¾åº¦æŸ¥ã€‚å…¶å®è¿™ä¸ªè¿˜é—ç•™äº†ä¸€ä¸ªé—®é¢˜ã€‚æœ¬æ¥è¯´å¥½çš„NDKç”¨gccç¼–è¯‘ï¼Œæ˜¯å¯ä»¥ç¼–è¯‘C++çš„ï¼Œä½†æ˜¯æˆ‘å†™äº†ä¸€ä¸ªC++ã€‚ä¸ç®¡æ€ä¹ˆä¿®æ”¹makefileéƒ½è¦æŠ¥é”™ã€‚è¿™ä¸ªé—®é¢˜æˆ‘æŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œéƒ½æ²¡æœ‰ç»“æœã€‚æˆ‘åœ¨æƒ³ç­‰ä¸‹ï¼Œæœ‰ç©ºäº†ï¼Œå»é—®é—®æˆ‘ä»¬çš„è€å¸ˆï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç»™å‡ºç­”æ¡ˆã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œå†å›æ¥æ›´æ–°ï¼Œç¼–å†™ä¸€ä¸ªC++çš„ä»£ç å°è¯•ç¼–è¯‘ã€‚ç„¶åå°±æ˜¯Linuxï¼Œæˆ‘çš„å¤©å•Šã€‚æˆ‘ä¹‹å‰éƒ½æ²¡æœ‰å­¦è¿‡è¿™ä¸ªï¼Œç„¶åä¸ºäº†å†™å‡ºæ¥æ¥å°è¯•ï¼Œæ‰å¼€å§‹ç ”ç©¶ã€‚å„ç§æŠ¥é”™ï¼Œå„ç§é‡è£…ã€‚ä½ ä¸å»åŠ¨æ‰‹ï¼Œæ°¸è¿œä¸çŸ¥é“è¿™é‡Œé¢çš„è¾›é…¸å’Œæ™šä¸Šè¿ç»­å‡ å¤©ç†¬å¤œåˆ°12ç‚¹çš„æ±—æ°´ä»¥åŠæˆåŠŸä¹‹åçš„å–œæ‚¦ã€‚æ‰€ä»¥è¯´ï¼Œä¸è¦çœ‹ç€ç®€å•ï¼Œè¦å®é™…å»åšåšï¼é“¾æ¥ï¼šhttp://pan.baidu.com/s/1boNj4IF å¯†ç ï¼šw4ec","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"},{"name":"ndk","slug":"ndk","permalink":"http://sorgs.cn/tags/ndk/"},{"name":"gcc","slug":"gcc","permalink":"http://sorgs.cn/tags/gcc/"}]},{"title":"Linux ubuntuçš„vboxå’Œæœ¬æœºWindowsæ–‡ä»¶å…±äº«ä»¥åŠLinuxä¸­çš„javaç¯å¢ƒé…ç½®","date":"2016-11-17T08:12:37.000Z","path":"post/33593/","text":"å®éªŒç¯å¢ƒï¼šæœ¬æœºWindows10Vbox5.1.8 r111374Linuxï¼šubuntu ä¸€ã€å…±äº«æ–‡ä»¶è®¾ç½®å®‰è£…å°±ä¸ç”¨è¯´æ˜äº†ï¼Œå®‰è£…å®Œäº†éœ€è¦å†LinuxæŠŠå¢å¼ºå·¥å…·è£…å¥½å®‰è£…å®ŒLinuxä¹‹åï¼Œåœ¨Windowsæœ¬æœºçš„Eç›˜æ–°å»ºä¸€ä¸ªshareæ–‡ä»¶å¤¹ä¹‹ååœ¨VBOXé‡Œé¢è®¾ç½®æŒ‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ ç„¶åæ‰“å¼€Linuxåœ¨ç»ˆç«¯é‡Œé¢è¾“å…¥å‘½ä»¤ï¼š12sudo mkdir /home/shared //æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹sudo mount -t vboxsf share /home/shared //æŠŠWindowsçš„share æ–‡ä»¶å¤¹åŠ è½½åˆ°sharedé‡Œæ¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼š1.sharedå’Œshareä¸ä¸€æ ·ã€‚ä¸ç„¶ä¼šæœ‰å¦‚ä¸‹é”™è¯¯ï¼š/sbin/mount.vboxsf: mounting failed with the error: Protocol error2.æ¯æ¬¡å¼€æœºéƒ½éœ€è¦è¾“å…¥è¿™å‘½ä»¤3.ä¸æƒ³æ¯æ¬¡å¼€æœºéƒ½è¾“çš„è¯ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥è¿™æ ·æ“ä½œã€‚æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼š1sorgs@sorgs-VirtualBox:~$ sudo nano /etc/rc.local ç„¶ååœ¨æœ€åä¸€è¡ŒåŠ ä¸Šï¼š1mount -t vboxsf share /home/shared æ„æ€å°±æ˜¯å¼€æœºå°±æ‰§è¡Œè¿™å¥è¯ç„¶åæˆ‘ä»¬å»æ”¾ä¸€ä¸ªæ–‡ä»¶åˆ°æœ¬æœºçš„shareé‡Œé¢ï¼Œå»Linuxçœ‹çœ‹æ—¶å€™åŠ è½½è¿›å»äº† è¿™å°±è¯´æ˜åŠ è½½è¿›å»äº† äºŒã€javaç¯å¢ƒé…ç½®è®¾ç½®ä¹‹å‰éœ€è¦å…ˆåˆ ä¸€ä¸‹ç³»ç»ŸåŸæ¥è‡ªå¸¦çš„ï¼Œä¸ç®¡æœ‰æ²¡æœ‰1root@sorgs-VirtualBox:/home/sorgs# apt-get purge openjdk-\\* ç¡®è®¤ï¼šYï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œå¸è½½å®Œæˆï¼ç„¶åæ›´å…·è‡ªå·±çš„ç³»ç»Ÿå»å®˜ç½‘ä¸‹ä¸€ä¸ªjdk.gzhttp://www.oracle.com/technetwork/java/javase/downloads/index.htmlæˆ‘æ˜¯é€‰æ‹©åœ¨æœ¬æœºä¸Šä¸‹å¥½äº†ï¼Œé€šè¿‡å…±äº«å¼„è¿›å»çš„ã€‚ä¸ªäººè§‰å¾—æ–¹ä¾¿ã€‚ç„¶åæå–å‡ºæ¥1root@sorgs-VirtualBox:/mnt/shared# tar -xvf jdk-8u112-linux-64.gz -C /usr/local ä¹‹ååœ¨ä½¿ç”¨ VI æ‰“å¼€ /etc/profile æ–‡ä»¶ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š1root@sorgs-VirtualBox:/mnt/shared# vi /etc/profile åœ¨æ–‡ä»¶çš„æœ€åä½ç½®ï¼Œå†™å…¥ Java çš„ç¯å¢ƒå˜é‡1234JAVA_HOME=/usr/local/jdk1.8.0_112PATH=$PATH:$HOME/bin:$JAVA_HOME/binexport JAVA_HOMEexport PATH escè¿”å›ï¼Œè¾“å…¥ :wq ä¿å­˜æ–‡ä»¶ã€‚å†åˆ†åˆ«è¾“å…¥ä¸€ä¸‹å‘½ä»¤123456root@sorgs-VirtualBox:/mnt/shared# update-alternatives --install &quot;/usr/bin/java&quot; &quot;java&quot; &quot;/usr/local/jdk1.8.0_112/bin/java&quot; 1root@sorgs-VirtualBox:/mnt/shared# update-alternatives --install &quot;/usr/bin/javac&quot; &quot;javac&quot; &quot;/usr/local/jdk1.8.0_112/bin/javac&quot; 1root@sorgs-VirtualBox:/mnt/shared# update-alternatives --install &quot;/usr/bin/javaws&quot; &quot;javaws&quot; &quot;/usr/local/jdk1.8.0_112/bin/javaws&quot; 1root@sorgs-VirtualBox:/mnt/shared# update-alternatives --set java /usr/local/jdk1.8.0_112/bin/javaroot@sorgs-VirtualBox:/mnt/shared# update-alternatives --set javac /usr/local/jdk1.8.0_112/bin/javacroot@sorgs-VirtualBox:/mnt/shared# update-alternatives --set javaws /usr/local/jdk1.8.0_112/bin/javaws æœ€åæˆ‘ä»¬æ¥æµ‹è¯•çœ‹çœ‹ï¼šjava -version è¿™å°±è¯´æ˜å·²ç»é…ç½®æˆåŠŸäº†ï¼","tags":[{"name":"linux","slug":"linux","permalink":"http://sorgs.cn/tags/linux/"},{"name":"windows","slug":"windows","permalink":"http://sorgs.cn/tags/windows/"},{"name":"java","slug":"java","permalink":"http://sorgs.cn/tags/java/"},{"name":"æ–‡ä»¶å…±äº«","slug":"æ–‡ä»¶å…±äº«","permalink":"http://sorgs.cn/tags/æ–‡ä»¶å…±äº«/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”åœ¨soé‡Œå¯¹æ¸¸æˆçš„ä¿®æ”¹","date":"2016-11-17T08:04:57.000Z","path":"post/47975/","text":"è¿™é‡Œè¿˜æ˜¯åˆ©ç”¨é¬¼å“¥çš„æä¾›çš„æ ·æœ¬ï¼Œå¤©å¤©æ¶ˆè”ç›Ÿ è¿™é‡Œæˆ‘å°±ä¸ç©äº†ï¼Œç›´æ¥AKçœ‹çœ‹ã€‚è¿™æ˜¯ä¸€ä¸ªç§»åŠ¨çš„æ”¯ä»˜ï¼Œç›´æ¥æœç´¢OnBillingFinishæ¥çœ‹çœ‹æºç ã€‚ æˆ‘ä»¬ä»è¿™é‡Œå°±å¾ˆè½»æ¾çŸ¥é“äº†ï¼Œå…³é”®å°±è¿™è¿™ä¸ªparamIntã€‚å¦‚æœç­‰äº102æˆ–è€…104æˆ–è€…1001ï¼Œæˆ‘ä»¬å°±è´­ä¹°æˆåŠŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨è¿™ifä¹‹å‰ï¼Œç»™paramIntä¸€ä¸ªå€¼ä¹Ÿå°±æ˜¯OKçš„ã€‚ åƒè¿™æ ·ä¿®æ”¹å°±æ˜¯OKçš„ã€‚æˆ‘ä»¬ä»Šå¤©çš„ä»»åŠ¡æ˜¯ä»soæ¥çœ‹çœ‹ï¼Œé‚£ä¹ˆç»§ç»­è·Ÿå…¥ã€‚æˆ‘ä»¬çœ‹åˆ°åœ¨ifé‡Œé¢ï¼Œæœ‰è°ƒç”¨PopStarã€‚æˆ‘ä»¬è¿‡å»çœ‹çœ‹ã€‚åœ¨è¿™ä¸ªç±»çš„å¼€å§‹ï¼Œæœ‰è¿™ä¸ªï¼Œä¹Ÿæ˜¯ä¸ªå…³é”®ï¼Œå…ˆè®°ä½ã€‚ è¯´æ˜ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨çš„xinxinçš„soã€‚æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹çœ‹ã€‚çœ‹åˆ°äº†å…³é”®çš„æ–¹æ³• è¿™é‡Œçœ‹åˆ°äº†å»æ‰çš„soï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»IDAé‡Œé¢çœ‹çœ‹äº†ã€‚ç›´æ¥æœç´¢æˆ‘ä»¬åˆšåˆšè°ƒç”¨ã€‚åŒå‡»è¿‡å»ã€‚ æ‰¾åˆ°å…³é”®çš„åœ°æ–¹ã€‚ ç„¶ååŒå‡»è¿‡å»çœ‹çœ‹ã€‚ è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ï¼Œé¬¼å“¥çš„æ•™ç¨‹ä¹Ÿæ˜¯åœ¨è¿™é‡Œä¿®æ”¹çš„ã€‚å¯ä»¥ç›´æ¥æŠŠA41EE è¿™å¥æ”¹ä¸ºmov R0ï¼Œ#FFä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆæˆ‘æ²¡æœ‰å®éªŒå“ˆï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»è¯•è¯•ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥çš„å“ˆï¼‰æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ä¸Šé¢æœ‰ä¸ªgetå»è·å–é‚£æˆ‘ä»¬è¿›å»çœ‹çœ‹F5ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åæ­£æ˜¯è¿”å›äº†ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯æˆ‘ä»¬è¦çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡ŒåŠ¨æ‰‹è„š è¿™é‡Œæ˜¯ä¸€ç§æ–¹å¼ï¼Œç„¶åæˆ‘ä»¬è¿˜çœ‹åˆ°æœ‰setï¼Œå°±æ˜¯å»è®¾ç½®é‡‘å¸ã€‚é‚£æˆ‘ä»¬å»çœ‹çœ‹åŒæ ·F5ä¹‹åï¼Œçœ‹åˆ°è¿”å›çš„ä¸œè¥¿ æ¥ä¸‹æ¥ä½¿ç”¨æ— åä¾ çš„SHä¾ç„¶ä½¿ç”¨ä»…åŠ è½½çš„æ–¹å¼ã€‚ æ”¹ä¸º255ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤æ¬¡é“å…·ä¹‹å ç„¶åå°±ä¸€ç›´ä¿æŒè¿™ä¸ªæ•°æ®äº†ã€‚è¯´æ˜æˆ‘ä»¬ä¿®æ”¹æˆåŠŸçš„","tags":[{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"http://sorgs.cn/tags/åç¼–è¯‘/"},{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"},{"name":"soä¿®æ”¹","slug":"soä¿®æ”¹","permalink":"http://sorgs.cn/tags/soä¿®æ”¹/"},{"name":"æ¸¸æˆ","slug":"æ¸¸æˆ","permalink":"http://sorgs.cn/tags/æ¸¸æˆ/"},{"name":"IDA","slug":"IDA","permalink":"http://sorgs.cn/tags/IDA/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”åˆå…¥soå¹¶è¿˜åŸåˆ†æå‡ºä»£ç ","date":"2016-11-17T07:55:37.000Z","path":"post/64124/","text":"å¾ˆä¹…æ²¡æœ‰å‡ºåŸºç¡€æ•™ç¨‹äº†ï¼Œè¿™é‡Œåšä¸€ä¸ªé¬¼å“¥çš„soçš„ä½œä¸šå§ã€‚å¾ˆåŸºç¡€çš„ä¸œè¥¿ï¼Œç®—æ˜¯æ•™å­¦å¸–å­å§ã€‚å¤§ç‰›è·¯è¿‡å§ã€‚è¿™é‡Œæ„Ÿè°¢é¬¼å“¥çš„apkå’Œæ— åä¾ çš„è½¯ä»¶ é¦–å…ˆæˆ‘ä»¬æ‰“å¼€é¬¼å“¥æä¾›çš„apkçœ‹çœ‹ã€‚ å…¶ä½™æ²¡æœ‰å‘ç°ä»€ä¹ˆï¼Œæˆ‘ä»¬ç›´æ¥AKæ¥çœ‹çœ‹å§ã€‚ ç›´æ¥çœ‹çœ‹Javaçš„ä»£ç  1234567protected void onCreate(Bundle paramBundle) &#123; super.onCreate(paramBundle); setContentView(2130903040); this.tview = ((TextView)findViewById(2131230720)); this.tview.setText(JniGg.ggPrintHello() + JniGg.VipLevel(5)); &#125; æˆ‘ä»¬å‘ç°å¾€soé‡Œä¼ å…¥äº†ä¸€ä¸ªå¾ˆé‡è¦çš„å‚æ•°5ï¼Œè¿™ç‚¹æ˜¯ä¸ªå…³é”®ã€‚æˆ‘ä»¬å…ˆè®°ä½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ‰“å¼€soçš„ä½ç½®ï¼Œæ‹–å…¥IDAäº†ã€‚ å³é”®ï¼Œæ‰“å¼€æ–‡ä»¶è·¯å¾„-ã€‹æ‰“å¼€æ–‡ä»¶ä½ç½®ï¼Œå¤åˆ¶åˆ°æ¡Œé¢å»ºä¸€ä¸ªtestçš„æ–‡ä»¶å¤¹ã€‚æ‹–å…¥IDAçœ‹çœ‹ã€‚ è¿™é‡Œï¼Œæˆ‘å–œæ¬¢å…ˆçœ‹çœ‹è¾“å‡ºã€‚ï¼ˆçœ‹ä¸ªäººä¹ æƒ¯å§ï¼‰ è¿™é‡Œæœ‰ä¸ªviplevelå¯¹å§ï¼Œå¾ˆæ˜æ˜¾äº†ã€‚æˆ‘ä»¬åŒå‡»è¿‡å» å‡ ç§ç­‰çº§éƒ½å‡ºæ¥äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŒ‰ä¸‹ç©ºæ ¼åˆ‡æ¢è§†å›¾ è¿™é‡Œå°±éå¸¸çš„æ¸…æ™°äº†ï¼Œå¯¹å§ã€‚ï¼ˆè¿™é‡Œè¿˜æ˜¯éœ€è¦æ‡‚å¾—ä¸€äº›armæ±‡ç¼–çŸ¥è¯†çš„ï¼‰ æˆ‘ä»¬ä»”ç»†åˆ†æä¸‹ä¸‹ã€‚ç„¶åæˆ‘å†™åœ¨äº†å›¾ä¸Š è¿™é‡Œå°±æ˜¯å’Œè¾“å…¥çš„æ•°å­—æœ‰å…³æˆ‘æ•´ç†å‡ºæ¥çš„æ˜¯è¿™æ ·çš„ï¼šgold vip 1silvery vip 2copper vip 3normal user otheråˆ†æå®Œäº†ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¯¥æ€ä¹ˆä¿®æ”¹äº†é‚£ä¹ˆæ–¹æ³•ä¸€ï¼šä¿®æ”¹samliï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£ä¸ªç©¿è¿›å»çš„å‚æ•°äº†ã€‚ è¿™æ ·æ±‡ç¼–å°±OKäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä»Šå¤©æ˜¯å¯¹soè¿›è¡Œæ“ä½œã€‚æ–¹æ³•äºŒï¼šPUSH {R3,LR}è¿™ä¸ªä¸èƒ½åŠ¨ï¼Œé‚£æˆ‘ä»¬å°±åªæœ‰åŠ¨ç¬¬ä¸€ä¸ªæ¯”è¾ƒäº†ã€‚å‰©ä¸‹æˆ‘ä»¬è¯•è¯•ï¼Œso helperï¼ˆæ— åä¾ å¤§å“¥çš„ä½œå“ï¼‰æ‹–è¿›å»ï¼Œç„¶åä»…åŠ è½½ è¿™é‡Œæœ€é‡ç‚¹æ˜¯æŒ‡ä»¤é•¿åº¦äº†ã€‚å…¶å®æˆ‘ä»¬åˆ©ç”¨00000C44å‡å»00000C42å°±çŸ¥é“æ˜¯2äº†ã€‚è¿™é‡Œå·²ç»æ”¹ä¸ºäº†èµ‹å€¼ï¼Œé‚£ä¹ˆä¸‹é¢é‚£ä¸ªæ¯”è¾ƒå°±æ²¡æœ‰ç”¨äº†ï¼Œç›´æ¥nopæ‰ã€‚ ç„¶åç‚¹å‡»ç¼–è¯‘ï¼Œå»æ›¿æ¢æ‰ä¹‹å‰çš„soæ–‡ä»¶ï¼Œè®°å¾—åå­—è¦æ”¹ä¸ºåŸæ¥é‚£ä¸ªã€‚ æ–¹æ³•ä¸‰å°±æ˜¯æŠŠæ‰€æœ‰çš„æ¯”è¾ƒæ”¹ä¸ºNopï¼Œå°±æ˜¯æ‰§è¡Œæ¯ä¸ªæ¯”è¾ƒï¼Œç›´æ¥åˆ°åé¢çš„gold vipã€‚è¿™ä¸ªå¤§å®¶å°±è‡ªå·±å°è¯•ä¸€ä¸‹ä¸‹ã€‚å…¶å®è¿˜æœ‰å‡ ç§æ–¹æ³•ï¼Œæœ‰ç‚¹æ€è·¯ï¼Œä½†æ˜¯æ²¡å»ç ”ç©¶ã€‚æœ€åç»™å‡ºè¿˜åŸå‡ºæ¥çš„å‡½æ•°ï¼ˆæ²¡å®Œå…¨è¿˜åŸï¼Œåªè¿˜åŸè¿™éƒ¨åˆ†ï¼‰","tags":[{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"http://sorgs.cn/tags/ç ´è§£/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"http://sorgs.cn/tags/åç¼–è¯‘/"},{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"},{"name":"soä¿®æ”¹","slug":"soä¿®æ”¹","permalink":"http://sorgs.cn/tags/soä¿®æ”¹/"},{"name":"IDA","slug":"IDA","permalink":"http://sorgs.cn/tags/IDA/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”æ‰‹æ¸¸ä¸­çš„å†…è´­ç ´è§£ï¼ˆç«æŸ´äººè”ç›Ÿæœ€æ–°ç‰ˆ1.9.2 BBå¼¹ ï¼‰","date":"2016-11-16T14:53:25.000Z","path":"post/2575/","text":"æœ€è¿‘å­¦åˆ°äº†ä¸€äº›å†…è´­çš„ç ´è§£æ–¹å¼ï¼Œå°±æ¥è¯•è¯•æ‰‹ã€‚ç„¶åæ‰¾ä¸ªäº†æ¯”è¾ƒç«çˆ†çš„æ¸¸æˆBBå¼¹ï¼Œæ‰¾ä¸ªä¸ªæ²¡å£³çš„å°±æ¥ç»ƒä¹ ã€‚è¿™äº›ä¸œè¥¿éƒ½æ˜¯å¤§ç¥å†™çƒ‚äº†çš„ä¸œè¥¿äº†ï¼Œæˆ‘è¿™é‡Œåªæ˜¯å†™å‡ºæˆ‘è‡ªå·±æ‰¾ä¸åˆ°æ–¹æ³•çš„æ—¶å€™çš„æ€è·¯ã€‚å‹¿ç¬‘ã€‚ ä¸€ã€BBå¼¹BBå¼¹çš„è¯æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬é¦–å…ˆå¼„åˆ°æ¨¡æ‹Ÿå™¨ä¸Šçœ‹çœ‹æ˜¯ä»€ä¹ˆæ”¯ä»˜ã€‚ æˆ‘ä»¬å‘ç°æ”¯ä»˜å®å’Œè¯è´¹éƒ½å¯ä»¥ã€‚é‚£è¯´æ˜æˆ‘ä»¬æœ‰å¾ˆå¤šç§æ–¹æ³•å»ç ´è§£å†…è´­äº†ã€‚æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯å–æ¶ˆå°±ä¸ºè´­ä¹°ï¼ æˆ‘ä»¬å…ˆç”¨æ”¯ä»˜å®çš„ è¯¥å›¾ä¸ºå¼•ç”¨çš„ã€‚ æˆ‘ä»¬ç›´æ¥æœç´¢0x1771 æŠŠå®ƒæ”¹ä¸º0x1771 -&gt; :sswitch_0 å°±è¡Œäº†ã€‚ ç„¶åå†æ¥è¯•è¯•è¯è´¹çš„ï¼Œæˆ‘ä»¬ç›´æ¥æ‰€æœç´¢paysuccess åˆ†åˆ«ç‚¹è¿›å»çœ‹çœ‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344.class public interface abstract Lcn/egame/terminal/paysdk/EgamePayListener; .super Ljava/lang/Object; .source \"EgamePayListener.java\" # virtual methods .method public abstract payCancel(Ljava/util/Map;)V .annotation system Ldalvik/annotation/Signature; value = &#123; \"(\", \"Ljava/util/Map\", \"&lt;\", \"Ljava/lang/String;\", \"Ljava/lang/String;\", \"&gt;;)V\" &#125; .end annotation .end method .method public abstract payFailed(Ljava/util/Map;I)V .annotation system Ldalvik/annotation/Signature; value = &#123; \"(\", \"Ljava/util/Map\", \"&lt;\", \"Ljava/lang/String;\", \"Ljava/lang/String;\", \"&gt;;I)V\" &#125; .end annotation .end method .method public abstract paySuccess(Ljava/util/Map;)V .annotation system Ldalvik/annotation/Signature; value = &#123; \"(\", \"Ljava/util/Map\", \"&lt;\", \"Ljava/lang/String;\", \"Ljava/lang/String;\", \"&gt;;)V\" &#125; .end annotation .end method æ˜¾ç„¶çœ‹ä¸å‡ºå¤ªå¤šçš„ä¿¡æ¯ç¬¬äºŒå¤„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129.class Lcom/zplay/bbtan/plug/EgamePlug$2$1; .super Ljava/lang/Object; .source \"EgamePlug.java\" # interfaces .implements Lcn/egame/terminal/paysdk/EgamePayListener; # annotations .annotation system Ldalvik/annotation/EnclosingMethod; value = Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;run()V .end annotation .annotation system Ldalvik/annotation/InnerClass; accessFlags = 0x0 name = null .end annotation # instance fields .field final synthetic this$1:Lcom/zplay/bbtan/plug/EgamePlug$2; # direct methods .method constructor &lt;init&gt;(Lcom/zplay/bbtan/plug/EgamePlug$2;)V .locals 0 .prologue .line 1 iput-object p1, p0, Lcom/zplay/bbtan/plug/EgamePlug$2$1;-&gt;this$1:Lcom/zplay/bbtan/plug/EgamePlug$2; .line 79 invoke-direct &#123;p0&#125;, Ljava/lang/Object;-&gt;&lt;init&gt;()V return-void .end method # virtual methods .method public paySuccess(Ljava/util/Map;)V .locals 2 .param p1, \"params\" # Ljava/util/Map; .prologue .line 90 sget-object v0, Lcom/dubo/android/JniMsgType;-&gt;RechargeFail:Lcom/dubo/android/JniMsgType; invoke-virtual &#123;v0&#125;, Lcom/dubo/android/JniMsgType;-&gt;ordinal()I move-result v0 iget-object v1, p0, Lcom/zplay/bbtan/plug/EgamePlug$2$1;-&gt;this$1:Lcom/zplay/bbtan/plug/EgamePlug$2; # getter for: Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;this$0:Lcom/zplay/bbtan/plug/EgamePlug; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;access$0(Lcom/zplay/bbtan/plug/EgamePlug$2;)Lcom/zplay/bbtan/plug/EgamePlug; move-result-object v1 # getter for: Lcom/zplay/bbtan/plug/EgamePlug;-&gt;_sku:Ljava/lang/String; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug;-&gt;access$1(Lcom/zplay/bbtan/plug/EgamePlug;)Ljava/lang/String; move-result-object v1 invoke-static &#123;v0, v1&#125;, Lcom/dubo/android/PlatformMessage;-&gt;SendPlatformMessage(ILjava/lang/String;)V .line 91 return-void .end method .method public payFailed(Ljava/util/Map;I)V .locals 2 .param p1, \"params\" # Ljava/util/Map; .param p2, \"errorInt\" # I .prologue .line 86 sget-object v0, Lcom/dubo/android/JniMsgType;-&gt;RechargeFail:Lcom/dubo/android/JniMsgType; invoke-virtual &#123;v0&#125;, Lcom/dubo/android/JniMsgType;-&gt;ordinal()I move-result v0 iget-object v1, p0, Lcom/zplay/bbtan/plug/EgamePlug$2$1;-&gt;this$1:Lcom/zplay/bbtan/plug/EgamePlug$2; # getter for: Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;this$0:Lcom/zplay/bbtan/plug/EgamePlug; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;access$0(Lcom/zplay/bbtan/plug/EgamePlug$2;)Lcom/zplay/bbtan/plug/EgamePlug; move-result-object v1 # getter for: Lcom/zplay/bbtan/plug/EgamePlug;-&gt;_sku:Ljava/lang/String; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug;-&gt;access$1(Lcom/zplay/bbtan/plug/EgamePlug;)Ljava/lang/String; move-result-object v1 invoke-static &#123;v0, v1&#125;, Lcom/dubo/android/PlatformMessage;-&gt;SendPlatformMessage(ILjava/lang/String;)V .line 87 return-void .end method .method public payCancel(Ljava/util/Map;)V .locals 2 .param p1, \"params\" # Ljava/util/Map; .prologue .line 82 sget-object v0, Lcom/dubo/android/JniMsgType;-&gt;Recharge:Lcom/dubo/android/JniMsgType; invoke-virtual &#123;v0&#125;, Lcom/dubo/android/JniMsgType;-&gt;ordinal()I move-result v0 iget-object v1, p0, Lcom/zplay/bbtan/plug/EgamePlug$2$1;-&gt;this$1:Lcom/zplay/bbtan/plug/EgamePlug$2; # getter for: Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;this$0:Lcom/zplay/bbtan/plug/EgamePlug; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug$2;-&gt;access$0(Lcom/zplay/bbtan/plug/EgamePlug$2;)Lcom/zplay/bbtan/plug/EgamePlug; move-result-object v1 # getter for: Lcom/zplay/bbtan/plug/EgamePlug;-&gt;_sku:Ljava/lang/String; invoke-static &#123;v1&#125;, Lcom/zplay/bbtan/plug/EgamePlug;-&gt;access$1(Lcom/zplay/bbtan/plug/EgamePlug;)Ljava/lang/String; move-result-object v1 invoke-static &#123;v0, v1&#125;, Lcom/dubo/android/PlatformMessage;-&gt;SendPlatformMessage(ILjava/lang/String;)V .line 83 return-void .end method è¿™é‡Œå°±å¾ˆå…³é”®äº†ã€‚è¿™ä¸ªçœ‹èµ·æ¥çœ¼èŠ±çš„è¯ï¼Œæˆ‘ä»¬çœ‹çœ‹Javaçš„ æˆ‘ä»¬æƒŠå¥‡çš„å‘ç°ï¼Œè¿™å‡ ä¸ªæˆåŠŸï¼Œå–æ¶ˆå’Œå¤±è´¥çš„ä»£ç åªæœ‰ä¸€å¤„ä¸åŒã€‚ æ–¹æ³•ä¸€ï¼šé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠå–æ¶ˆçš„RechargeFailæ¢æˆRechargeå°±OKäº†ã€‚ æ–¹æ³•äºŒï¼šæˆ‘ä»¬å¯ä»¥æŠŠpaySuccesså’ŒpayCancelçš„å‡½æ•°åè°ƒæ¢ã€‚ä¹Ÿå°±è¯´è¯´ï¼Œæˆ‘ä»¬ç‚¹äº†å–æ¶ˆï¼Œå´è°ƒç”¨çš„æ˜¯paySuccessé‡Œé¢çš„ä»£ç ã€‚OKã€‚BBå¼¹å°±ç®€å•çš„ç ´è§£äº†ã€‚ äºŒã€ç«æŸ´äººè”ç›Ÿç ´è§£BBå¼¹ä¹‹åï¼Œæˆ‘æœ¬ä»¥ä¸ºå†…è´­ç ´è§£èµ·æ¥å¾ˆç®€å•ã€‚ä¹Ÿå¾ˆå¥½ç©ï¼Œç„¶åé€›å¾çˆ±çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¸€ç¯‡ç ´è§£ç«æŸ´äººçš„å¸–å­ã€‚æˆ‘ä¹Ÿå°±å»ä¸‹äº†ä¸ªå®˜æ–¹ç‰ˆæœ¬å»è¯•è¯•ç ´è§£ã€‚ï¼ˆç‰ˆæœ¬æ¯”å¸–å­çš„é«˜ï¼Œå¸–å­åœ°å€ï¼šhttp://www.52pojie.cn/thread-522841-1-1.htmlï¼‰ è¿™ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯ã€‚è¿™ä¸ªæ¸¸æˆåœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ‰“ä¸å¼€ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œç›´æ¥åç¼–è¯‘ã€‚ å‘ç°äº†è¿™ä¸ªæ¸¸æˆçš„è´­ä¹°æ–¹å¼å¾ˆå¤šï¼Œç§»åŠ¨ï¼Œç”µä¿¡ï¼Œè”é€šï¼Œæ”¯ä»˜å®éƒ½æœ‰ã€‚ç„¶åè¿˜æ˜¯æŒ‰ç…§ä¹‹å‰ç ´è§£BBå¼¹çš„æ–¹å¼å»ç ´è§£ã€‚ å´å‘ç°æ ¹æœ¬ä¸è¡Œã€‚æŠŠå–æ¶ˆçš„RechargeFailæ¢æˆRechargeï¼Œä¸è¡Œ æŠŠæ”¯ä»˜å®çš„ä»£ç æ¢æ‰ä¹Ÿä¸è¡Œã€‚ äºæ˜¯è®¤çœŸå‚è€ƒäº†åˆšåˆšé‚£ä¸ªå¸–å­ï¼Œå‘ç°å¾ˆå¤šä»£ç å·²ç»è¢«åŸä½œè€…æ”¹äº†ã€‚é‚£å°±åªæœ‰è‡ªå·±ç ”ç©¶äº† è¿™é‡Œå°±æ˜¯é‡ç‚¹äº†ï¼Œæˆ‘æ¥è¯´è¯´æˆ‘è‡ªå·±çš„æ€è·¯ã€‚åæ¥å‘ç°è¿™ä¸ªæ¸¸æˆå‘çˆ¹çš„åªèƒ½ç§»åŠ¨è´­ä¹°ã€‚ é¦–å…ˆæ˜¯ä½å…¥å£å»çœ‹çœ‹ç„¶ååœ¨è¿™ä¸ªå‡½æ•°å»çœ‹çœ‹ç§»åŠ¨è´­ä¹°çš„å‡½æ•°ã€‚ ç„¶åç‚¹è¿‡å»çœ‹çœ‹ï¼Œå‘ç°ä¿¡æ¯ä¸æ˜¯å¤ªå¤šã€‚ 12345678910111213141516171819202122232425262728293031323334353637.method private payInYidong()V .locals 6 .prologue const/4 v1, 0x1 .line 735 sget v0, Lcom/DBGame/DiabloLOL/DiabloLOL;-&gt;sCMCC_OPEN:I if-nez v0, :cond_0 .line 736 const-string v0, \"\\u6b63\\u5728\\u5904\\u7406,\\u8bf7\\u7a0d\\u540e.....\" invoke-static &#123;v0&#125;, Lcom/DBGame/Common/BLHelper;-&gt;showShieldLayer(Ljava/lang/String;)V .line 738 :cond_0 iget-object v0, p0, Lcom/DBGame/DiabloLOL/DiabloLOL;-&gt;PAY_CODE_MM:[Ljava/lang/String; iget v2, p0, Lcom/DBGame/DiabloLOL/DiabloLOL;-&gt;mPayIndex:I aget-object v3, v0, v2 const/4 v4, 0x0 iget-object v5, p0, Lcom/DBGame/DiabloLOL/DiabloLOL;-&gt;payCallback:Lcn/cmgame/billing/api/GameInterface$IPayCallback; move-object v0, p0 move v2, v1 invoke-static/range &#123;v0 .. v5&#125;, Lcn/cmgame/billing/api/GameInterface;-&gt;doBilling(Landroid/content/Context;ZZLjava/lang/String;Ljava/lang/String;Lcn/cmgame/billing/api/GameInterface$IPayCallback;)V .line 739 return-void .end method ä½†æ˜¯æˆ‘ä»¬å¥½åƒå‘ç°äº†payCallbackè¿™ä¸ªä¸œè¥¿ã€‚æ„Ÿè§‰åˆä»·å€¼ã€‚æˆ‘ä»¬æœç´¢çœ‹çœ‹ã€‚ å‘ç°äº†ä¸¤å¤„ï¼Œæœ‰ç”¨çš„æ˜¯ç¬¬ä¸€å¤„çš„ã€‚äºæ˜¯æˆ‘ä»¬è¿‡å»çœ‹çœ‹ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±çœ‹å‡ºæ¥äº† 12345678910111213141516171819202122232425262728293031package com.DBGame.DiabloLOL; import cn.cmgame.billing.api.GameInterface.IPayCallback; import com.DBGame.Common.BLHelper; class DiabloLOL$4 implements GameInterface.IPayCallback &#123; DiabloLOL$4(DiabloLOL paramDiabloLOL) &#123;&#125; public void onResult(int paramInt, String paramString, Object paramObject) &#123; switch (paramInt) &#123; default: new StringBuilder().append(\"è´­ä¹°é“å…·ï¼š[\").append(this.this$0.PAY_NAME[DiabloLOL.access$800(this.this$0)]).append(\"] å–æ¶ˆï¼\").toString(); &#125; for (;;) &#123; BLHelper.closeShieldLayer(); return; if (!\"10\".equals(paramObject.toString())) &#123; new StringBuilder().append(\"è´­ä¹°é“å…·ï¼š[\").append(this.this$0.PAY_NAME[DiabloLOL.access$800(this.this$0)]).append(\"] æˆåŠŸï¼\").toString(); BLHelper.purchaseComplete(this.this$0.PRO_ID_Str[DiabloLOL.access$800(this.this$0)], 1); continue; new StringBuilder().append(\"è´­ä¹°é“å…·ï¼š[\").append(this.this$0.PAY_NAME[DiabloLOL.access$800(this.this$0)]).append(\"] å¤±è´¥ï¼\").toString(); &#125; &#125; &#125; &#125; ä¹Ÿå°±è¯´packed-switch p1, :pswitch_data_0ï¼Œç„¶åpswitch_data_0å°±è´­ä¹°æˆåŠŸã€‚ ç›´æ¥æ¥ä¸ªgotoå¤§å‘ã€‚OKäº†æ•™ç¨‹å°±åˆ°è¿™é‡Œäº†ï¼Œæœ¬ç ´è§£åªä¸ºå­¦ä¹ äº¤æµã€‚ æä¾›æ ·æœ¬BBå¼¹ï¼šhttps://yunpan.cn/cMN8KD5h2IUg2 è®¿é—®å¯†ç  9456ç«æŸ´äººå»å®˜ç½‘ä¸‹å°±æ˜¯äº†æˆæœ¬ï¼šBBå¼¹ï¼šhttps://yunpan.cn/cM4jkAt4u7m5n è®¿é—®å¯†ç  5c1bç«æŸ´äººï¼šhttps://yunpan.cn/cMN89LIBLqjPq è®¿é—®å¯†ç  67a6","tags":[{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"http://sorgs.cn/tags/ç ´è§£/"},{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"},{"name":"æ¸¸æˆ","slug":"æ¸¸æˆ","permalink":"http://sorgs.cn/tags/æ¸¸æˆ/"},{"name":"æ”¯ä»˜","slug":"æ”¯ä»˜","permalink":"http://sorgs.cn/tags/æ”¯ä»˜/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”åŒæ­¥å®¶æ•™ç‹åŠå…¶å‡çº§ç‰ˆçš„ç ´è§£","date":"2016-11-16T14:45:30.000Z","path":"post/40324/","text":"ä¸€æœ‹å‹è®©æˆ‘æ¥ç ´è§£ä¸‹ä¸€è½¯ä»¶ï¼Œæˆ‘æ‹¿æ¥ä¸€çœ‹æ˜¯è¿™ç©æ„ã€‚æˆ‘ä»¥ä¸ºå¾ˆéš¾ï¼Œç»“æœå‘ç°æ²¡å£³ã€‚å…´è¶£å°±æ¥äº†ï¼Œå¼„äº†ä¸€å¤©ï¼Œå°±å¼„å‡ºæ¥äº†ã€‚è¿™é‡ŒæŠŠè¿‡ç¨‹å’Œæ€è·¯åˆ†äº«ä¸€ä¸‹ã€‚å…¶å®å¾ˆç®€å•ï¼Œå¤§ç¥ä¸€çœ‹å°±çŸ¥é“ã€‚å› ä¸ºè¿™ä¸ªæ²¡åŠ å£³ï¼Œåªæ˜¯åŠ äº†æ··æ·†çš„ã€‚è¿™ç®—æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ç ´è§£ç©ç©æ•´æ•´çš„apkäº†ã€‚ç„¶åæˆ‘ä»¬å°±å¼€å§‹å§ã€‚ ä¸€ã€å·¥å…·è¿™æ¬¡æˆ‘ç”¨çš„æ˜¯AndroidKillerï¼Œæ„Ÿè§‰å¾ˆä¸é”™çš„æ ·å­ç„¶åå°±æ˜¯æˆ‘æ¯æ¬¡éƒ½è¦ç”¨çš„è“å  äºŒã€åŒæ­¥å®¶æ•™ç‹1.çœ‹æƒ…å†µè€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆæ‹–è“å çœ‹çœ‹æƒ…å†µ éšä¾¿è¾“äº†123ï¼Œå‡ºç°äº†æ¿€æ´»ç é”™è¯¯ã€‚æˆ‘ä»¬è®°ä¸‹æ¥ 2.åç¼–è¯‘è¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œå‰é¢è¯´çš„å¤Ÿå¤šäº†ã€‚ç›´æ¥æ‹–è¿›å»ï¼Œåç¼–è¯‘å°±OKã€‚ 3.ä¿®æ”¹æˆ‘ä»¬å…ˆå»string.xmlä¸­æ²¡æœ‰ä¿¡æ¯ï¼Œç„¶åè½¬ç æœç´¢æ¿€æ´»ç é”™è¯¯ æˆ‘ä»¬è·³è¿‡å»ï¼Œçœ‹çœ‹æºç ã€‚å³é”®ï¼ŒæŸ¥çœ‹-æŸ¥çœ‹æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;span style=\"font-size:14px;\"&gt;package com.school.app.activity.login; import android.os.Handler; import android.os.Message; import android.widget.Button; import android.widget.EditText; import android.widget.TextView; import com.school.app.utils.SharedPreHandler; class LoginActivity$3 extends Handler &#123; LoginActivity$3(LoginActivity paramLoginActivity, String paramString) &#123;&#125; public void handleMessage(Message paramMessage) &#123; try &#123; if (paramMessage.obj != null) &#123; paramMessage = ((String)paramMessage.obj).split(\"&amp;\"); if (paramMessage[0].equals(\"yes\")) &#123; SharedPreHandler.getShared().setSharedPreKey(\"activation_code\", this.val$text); SharedPreHandler.getShared().setSharedPreKey(\"activation_deviceId\", LoginActivity.access$1(this.this$0)); SharedPreHandler.getShared().setSharedPreKey(\"activation_model\", LoginActivity.access$2(this.this$0)); if (paramMessage[1].equals(\"-1\")) &#123;&#125; for (paramMessage = \"æ¿€æ´»æˆåŠŸ\";; paramMessage = String.format(LoginActivity.access$3(this.this$0), new Object[] &#123; paramMessage[1], paramMessage[2] &#125;)) &#123; SharedPreHandler.getShared().setSharedPreKey(\"activation_msg\", paramMessage); LoginActivity.access$4(this.this$0); this.this$0.finish(); return; &#125; &#125; &#125; return; &#125; catch (Exception paramMessage) &#123; paramMessage.printStackTrace(); this.this$0.title.setText(\"æ¿€æ´»ç é”™è¯¯\"); this.this$0.back.setVisibility(0); this.this$0.exit.setVisibility(0); this.this$0.yes.setVisibility(8); this.this$0.clear.setVisibility(8); this.this$0.edit.setVisibility(8); &#125; &#125; &#125; &lt;/span&gt; æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°æ¿€æ´»ç å‡ºé”™çš„å­—æ ·ã€‚å†æ¥åˆ†æä¸€ä¸‹javaä»£ç ã€‚æˆ‘ä»¬å‘ç°æ¿€æ´»ç é”™è¯¯å¹¶æ²¡æœ‰è·³è½¬åˆ°è¿™é‡Œï¼Œä½†æ˜¯ä¹‹å‰çš„ä»£ç å´æœ‰ä¸ª :cond_1è·³è½¬è¿™é‡Œæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬æ˜æ˜¾çŸ¥é“æ˜¯åŠ äº†æ··æ·†çš„ã€‚é‚£æˆ‘ä»¬åªæœ‰ä»æ¿€æ´»æˆåŠŸå»çœ‹çœ‹ä¸‹æ‰‹äº†ã€‚å†æ¬¡æœç´¢ å‘ç°æœ‰ä¸¤å¤„åˆšåˆšè¿™å‡ºçœ‹è¿‡äº†ï¼Œæˆ‘ä»¬å»çœ‹çœ‹å¦ä¸€å¤„çš„æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596package com.school.app.service; import android.app.Service; import android.content.BroadcastReceiver; import android.content.Context; import android.content.Intent; import android.os.Handler; import android.os.IBinder; import android.os.Message; import android.widget.Toast; import com.school.app.activity.login.LoginActivity; import com.school.app.utils.CommTool; import com.school.app.utils.SharedPreHandler; public class TimeCountService extends Service &#123; private static final long sMinute = 1L; private Handler mHandler = new Handler() &#123; public void handleMessage(Message paramAnonymousMessage) &#123; try &#123; if ((paramAnonymousMessage.obj != null) &amp;&amp; (((String)paramAnonymousMessage.obj).contains(\"stop\"))) &#123; SharedPreHandler.getShared().setSharedPreKey(\"activation_code\", \"\"); SharedPreHandler.getShared().setSharedPreKey(\"activation_msg\", \"\"); paramAnonymousMessage = new Intent(); paramAnonymousMessage.setFlags(268435456); paramAnonymousMessage.setClass(TimeCountService.this, LoginActivity.class); TimeCountService.this.startActivity(paramAnonymousMessage); &#125; return; &#125; catch (Exception paramAnonymousMessage) &#123; paramAnonymousMessage.printStackTrace(); &#125; &#125; &#125;; private MyReceiver myReceiver; private long time; private void requestLoginInfo() &#123; if (CommTool.isNetworkAvailable(this)) &#123; String str = SharedPreHandler.getShared().getSharedStrPreKey(\"activation_code\", \"\"); CommTool.getActivationCode(SharedPreHandler.getShared().getSharedStrPreKey(\"activation_deviceId\", \"\"), SharedPreHandler.getShared().getSharedStrPreKey(\"activation_model\", \"\"), str, this.mHandler); &#125; &#125; private void stopTimeCountService() &#123; Intent localIntent = new Intent(); localIntent.setClass(this, TimeCountService.class); stopService(localIntent); &#125; public IBinder onBind(Intent paramIntent) &#123; return null; &#125; public void onCreate() &#123; super.onCreate(); &#125; public void onDestroy() &#123; super.onDestroy(); if (this.myReceiver != null) &#123; unregisterReceiver(this.myReceiver); &#125; &#125; public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2) &#123; String str = SharedPreHandler.getShared().getSharedStrPreKey(\"activation_msg\", \"\"); if ((!str.equals(\"\")) &amp;&amp; (!str.equals(\"æ¿€æ´»æˆåŠŸ\"))) &#123; Toast.makeText(this, str, 1).show(); &#125; requestLoginInfo(); return super.onStartCommand(paramIntent, paramInt1, paramInt2); &#125; class MyReceiver extends BroadcastReceiver &#123; MyReceiver() &#123;&#125; public void onReceive(Context paramContext, Intent paramIntent) &#123;&#125; &#125; &#125; è¿™é‡Œçš„è¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¸…æ™°çœ‹åˆ°æ¿€æ´»çš„åªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åToastå‡ºæ¥çš„ï¼Œé‚£æˆ‘ä»¬å»ä¿®æ”¹å‰é¢é‚£ä¸€å¤„çš„è·³è½¬è¯•è¯•ã€‚åœ¨ç ”ç©¶ä¸€ä¸‹ä¹‹å‰çš„æºç ï¼Œå‘ç°å¾ˆæ··ä¹±ã€‚ä½†æ˜¯æ˜ç¡®çŸ¥é“ï¼Œæœ‰ä¸ªåœ°æ–¹ä¼šè·³è½¬æ¥éªŒè¯ã€‚çš„ç¡®å¾ˆæ··ä¹±ï¼Œæˆ‘ç ”ç©¶äº†åŠå¤©ï¼Œæ‰åœ¨è¿™ä¸ªåœ°æ–¹ç ´è§£å‡ºæ¥ã€‚è¿™ä¸ªä¸å†™å‡ºå‡ºæ¥è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæˆ‘è‡ªå·±ä¹Ÿä¸æ˜¯å¤ªæ¸…æ¥šã€‚æˆ‘æ˜¯è‡ªå·±ä¸æ¸…æ¥šï¼Œå°±ç»ä¸è¯¯äººå­å¼Ÿçš„ï¼Œè¿™é‡Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°è¯•ã€‚è¿™é‡Œç»™å¤§å®¶å°±è¯´å¦ä¸€ä¸ªç®€å•ç‚¹çš„ã€‚æˆ‘æƒ³èµ·æ¥wnagzihxainå¤§ç¥å†™çš„ç§»åŠ¨æ¶æ„APPåˆ†æçš„å¿ƒå¾—åˆ†äº«äºæ˜¯æƒ³åˆ°äº†è¿™ä¸ªæ€è·¯ã€‚ä»å…¥å£å»çœ‹çœ‹ å…¶å®è¿™ä¸ªå·¥å…·æŒºå¥½çš„ï¼Œç›´æ¥æŠŠå…¥å£å†™è¿™äº†ï¼Œéƒ½ä¸ç”¨æˆ‘ä»¬å»AndroidManifest.xmlé‡Œé¢æ‰¾äº†å¥½å§ï¼Œç›´æ¥ç‚¹è¿‡ã€‚çœ‹çœ‹æºç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.school.app.activity; import android.content.Intent; import android.os.Bundle; import android.support.v4.app.FragmentActivity; import com.school.app.activity.login.LoginActivity; import com.school.app.service.TimeCountService; import com.school.app.utils.SharedPreHandler; public class MainActivity extends FragmentActivity &#123; private void startCountTimeService() &#123; Intent localIntent = new Intent(); localIntent.setClass(this, TimeCountService.class); startService(localIntent); &#125; public boolean isActivationCode() &#123; if (SharedPreHandler.getShared().getSharedStrPreKey(\"activation_code\", \"\").equals(\"\")) &#123; Intent localIntent = new Intent(); localIntent.setClass(this, LoginActivity.class); startActivityForResult(localIntent, 10085); return false; &#125; startCountTimeService(); return true; &#125; protected void onActivityResult(int paramInt1, int paramInt2, Intent paramIntent) &#123; if ((paramInt1 == 10085) &amp;&amp; (paramInt2 == 10086)) &#123; finish(); &#125; super.onActivityResult(paramInt1, paramInt2, paramIntent); &#125; protected void onCreate(Bundle paramBundle) &#123; super.onCreate(paramBundle); setContentView(2130903040); isActivationCode(); &#125; protected void onRestart() &#123; super.onRestart(); &#125; &#125; ä»”ç»†ä¸€çœ‹ï¼Œè¿™ä¸å¤ªç®€å•äº†ä¹ˆã€‚å¤§æ¦‚æ„æ€å°±æ˜¯è·³è¿‡å»éªŒè¯ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸å»éªŒè¯ï¼Œä¸å°±å®Œäº†ä¹ˆã€‚æœ‰äº†æ€è·¯ï¼Œå°±ç›´æ¥ä¸Šæ‰‹ï¼Œæ‰¾åˆ°åœ°æ–¹ã€‚ 4.éªŒè¯è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œä¿®æ”¹å®Œäº†ä¿å­˜ã€‚æ‰“å¼€å°±ç›´æ¥æ²¡æœ‰éªŒè¯äº†ã€‚ ä¸‰ã€å­¦ä¹ å¹³å°(ç»¼åˆç‰ˆ)è¿™ä¸ªæ€ä¹ˆè¯´å‘¢ï¼Œç®—æˆ‘æ˜¯æŠ•æœºå–å·§å§ã€‚å› ä¸ºå°±ä¸Šä¸Šé¢é‚£ä¸ªçš„å‡çº§ç‰ˆã€‚æ›´å¤æ‚ã€‚æˆ‘ä¼°è®¡è¦æ˜¯æ²¡æœ‰å‰é¢é‚£ä¸ªï¼Œåé¢è¿™ä¸ªæˆ‘ä¹Ÿè®¸è¿˜ä¸èƒ½å¼„å‡ºæ¥å‘¢ã€‚å®³ç¾åŒæ ·æ‰¾åˆ°è·³è½¬éªŒè¯çš„åœ°æ–¹ï¼Œç»™ä¿®æ”¹æ‰ã€‚ è¿˜æ˜¯æ”¹ä¸ºnezå°±OKäº† æ­¤å¤„ï¼Œæ²¡æœ‰å¤ªå¤šçš„æŠ€æœ¯å«é‡ã€‚å†™è¿™ä¸ªçš„ä¸»è¦ç›®çš„ä¸€æ˜¯è®°è®°è‡ªå·±ç¬¬ä¸€æ¬¡ç ´è§£å®Œæ•´çš„apkï¼Œç„¶åå°±æ˜¯å†™ç‚¹æ¢ä¸ªæ€è·¯çš„æ–¹å¼ã€‚ æœ€åç»™å‡ºä¸¤ä¸ªapkçš„ä¸‹è½½åœ°å€ï¼š https://yunpan.cn/cMeIDvXGmzBjP è®¿é—®å¯†ç  1603 https://yunpan.cn/cMeIpjDyebQPw è®¿é—®å¯†ç  2eae æœ€åéœ€è¦è¿™ä¸¤ä¸ªç ´è§£çš„appçš„è¯ï¼Œå°±å»å¾çˆ±æœç´¢å§ï¼Œæˆ‘æŠŠç ´è§£å¥½çš„åœ¨å¾çˆ±å‘è¿‡å¸–å­ã€‚","tags":[{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"http://sorgs.cn/tags/ç ´è§£/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"http://sorgs.cn/tags/åç¼–è¯‘/"},{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"},{"name":"åŒæ­¥å­¦ä¹ ","slug":"åŒæ­¥å­¦ä¹ ","permalink":"http://sorgs.cn/tags/åŒæ­¥å­¦ä¹ /"},{"name":"AndroidKiller","slug":"AndroidKiller","permalink":"http://sorgs.cn/tags/AndroidKiller/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”å·§ç”¨è“å å’ŒAndroid Studioè¿›è¡ŒåŠ¨æ€è°ƒè¯•","date":"2016-11-16T14:36:33.000Z","path":"post/15334/","text":"æˆ‘ä»¬çŸ¥é“å¾ˆå¤šapkå…‰æ˜¯é™æ€è°ƒè¯•æ—¶è¿œè¿œæ»¡è¶³ä¸äº†æˆ‘ä»¬å¯¹apkçš„åˆ†æï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¥ä¸€æ³¢é™æ€è°ƒè¯•ã€‚æ­¤å¤„ä¸ºä¸ªäººç¬”è®°ï¼Œä¹Ÿä¸ºå…¥é—¨å°ç™½å¼•è·¯ï¼Œè¿™é‡Œå°±ä¸çœ‹ç»“æœäº†ï¼Œä¸»è¦æ˜¯æ•™å¤§å®¶æ€ä¹ˆç»“åˆè°ƒè¯•ã€‚èµ·å› æ˜¯æ˜¨å¤©åˆšçœ‹äº†åŠ¨æ€è°ƒè¯•çš„æ–¹æ³•ï¼Œæˆ‘å°±æƒ³æ¥è¯•è¯•ã€‚ç»“æœç”µè„‘ä¸Šåªæœ‰Android studioã€‚å¥½å§ï¼Œé‚£æˆ‘å°±ç™¾åº¦äº†Android studioçš„è°ƒè¯•ã€‚ç„¶åç”¨æ¨¡æ‹Ÿå™¨ï¼Œç»“æœé‚£ä¸ªæ¨¡æ‹Ÿå™¨å¤ªæ¼ç«äº†ï¼Œæ…¢æ­»äººï¼Œè¿˜å¡ã€‚ï¼ˆå­¦ç”Ÿå…šï¼Œåªèƒ½è‹¦é€¼ç”¨ä½é…ç¬”è®°æœ¬ï¼‰ç„¶åèº«è¾¹å”¯ä¸€ä¸€æ ¹æ•°æ®çº¿å±…ç„¶ç½¢å·¥ã€‚æ²¡åŠæ³•ï¼Œåæ¥çªç„¶æƒ³èµ·æ¥ï¼Œè“å æ¨¡æ‹Ÿå™¨å¾ˆå¿«äº†ï¼Œå¯ä¸å¯ä»¥è¯•è¯•ã€‚äºæ˜¯å°±æœ‰äº†ä¸‹æ–‡ã€‚å¥½äº†ï¼Œä¸åºŸè¯äº†ï¼Œè¿›å…¥æ­£é¢˜ã€‚ ä¸€ã€å·¥å…·æ¯«æ— ç–‘é—®ï¼šAndroid studioï¼ˆé™„å¸¦SDKï¼Œè¿™ä¸ªä¸å¤šè¯´ï¼‰ è“å ç„¶åæœ‰ä¸ªå¤§å®¶å¯èƒ½å¤§å®¶ä¸çŸ¥é“çš„ä¸œè¥¿ smalidea è¿™ä¸ªç™¾åº¦ä¸€å¤§å †ã€‚æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œè‡ªå·±å»ä¸‹ä¸€ä¸ªå°±æ˜¯äº†ç„¶åä¸€ä¸ªåç¼–è¯‘çš„å·¥å…· jeb apkIDE AndroidKillerç­‰ç­‰ï¼Œéƒ½å¯ä»¥æˆ‘ç”¨çš„æ˜¯jeb äºŒã€ç¯å¢ƒ1javaé‚£äº›ç¯å¢ƒæˆ‘æƒ³è¿™ä¸ªä¸åº”è¯¥è¯´äº†ï¼Œç„¶åå°±æ˜¯adbçš„ç¯å¢ƒï¼Œæœ€å¥½æ˜¯åŠ åˆ°ç¯å¢ƒé…ç½®ä¸­å»ï¼Œæ–¹ä¾¿ï¼Œçœäº‹ã€‚ 2smalidea è¿™ä¸ªæ˜¯é…ç½®åˆ°Android studioçš„ï¼Œé…ç½®äº†æ‰èƒ½çœ‹smaliæ–‡ä»¶å…·ä½“æ­¥éª¤ï¼š ç„¶åé€‰æ‹©ä½ æœ¬åœ°smalideaæ–‡ä»¶ï¼Œè¿™é‡Œè¯´ä¸€å¥ï¼Œæœ€å¥½ä¸è¦æœ‰ä¸­æ–‡è·¯å¾„ã€‚ä¹Ÿè¡Œä¸ä¸€å®šä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯ä¸ä¸€å®šä¸ä¼šå‡ºé—®é¢˜ã€‚ è¿™ä¸ªæ ·å­å°±æ˜¯OKäº†ä¸€èˆ¬ä¼šé‡å¯ä¸€ä¸‹Android studio ä¸‰ã€å‡†å¤‡è¿™éƒ¨åˆ†æ˜¯åç¼–è¯‘å‡ºæ–‡ä»¶ï¼Œç„¶åå¯¼å…¥åˆ°Android studioä¸­å»ã€‚æˆ‘è¿™é‡Œç”¨çš„jebåç¼–è¯‘çš„ï¼Œå„ä½è¯·ç”¨è‡ªå·±å–œæ¬¢çš„ï¼Œéƒ½å¯ä»¥å“ˆã€‚ çœ‹åˆ°åç¼–è¯‘æˆåŠŸï¼Œæˆ‘ä»¬å°±å»æŠŠæ–‡ä»¶æå–å‡ºæ¥è¿™é‡Œæœ€å¥½æ˜¯ä¹Ÿæ˜¯ä¸è¦æ”¾ä¸­æ–‡è·¯å¾„æœ€å¥½æ¥æ¥ä¸‹æ¯”è¾ƒé‡è¦ï¼Œä¸€æ­¥ä¸€æ­¥æ“ä½œã€‚ ç„¶åé€‰æ‹©æˆ‘ä»¬æ”¾è¿›å»çš„åç¼–è¯‘çš„æ–‡ä»¶å¤¹ ç„¶åç‚¹é‚£ä¸ªä¸‰è§’ æ·»åŠ ä¸€ä¸ªremoteåå­—éšä¾¿å–ï¼Œç«¯å£å·ä¸º8700 ä¹‹åæˆ‘ä»¬æ‰“å¼€cmdã€‚è¿›è¡Œadbçš„å®‰è£…adb install -r apkçš„ä½ç½®\\apkå…¨å çœ‹åˆ°succeå°±çŸ¥é“æˆåŠŸäº†ï¼Œè“å ä¹Ÿä¼šæœ‰æç¤ºçš„ï¼ˆä¸€ç›´é»˜è®¤è“å æ˜¯å¼€å¯çš„ï¼Œæ²¡å¼€çš„æˆ‘å°±æ— è¯­äº†ï¼‰ ç„¶åè¿›å»è°ƒè¯•çŠ¶æ€adb shell am start -D -n packageName/ActivityName è“å ä¹Ÿä¼šè¿™æ ·æ˜¾ç¤º è¯´æ˜è¿›å…¥äº†è°ƒè¯•çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™åƒä¸‡ä¸è¦å»ç‚¹Force Close å››ã€è¿›å…¥è°ƒè¯•è¿›å…¥è°ƒè¯•ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦å»monitorçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦ç«¯å£å·ç»™æ­£ç¡®äº†ã€‚ ç‚¹å‡»æˆ‘ä»¬éœ€è¦è°ƒè¯•çš„apkåŒ…åï¼ŒæŠŠ8700ç«¯å£ç»™å®ƒç„¶åæˆ‘ä»¬å°±å¯ä»¥è°ƒè¯•äº†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å»æºç çœ‹çœ‹æˆ‘ä»¬åœ¨å“ªé‡Œä¸‹æ–­ç‚¹äº†ã€‚è¿™é‡Œå°±ä¸å¤šè¯´äº†æˆ‘ç›´æ¥ç‚¹æ–­ç‚¹äº†ã€‚åœ¨è¿™è¡Œä»£ç å‰é¢ç‚¹ä¸€ä¸‹ï¼Œå°±æ–­å¥½äº† ç„¶åç‚¹ä¸Šé¢é‚£ä¸ªå°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº† ä¸‹é¢æ˜¯æˆ‘ä»¬çš„ä¿¡æ¯åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹åŠ ï¼Œè¿›è¡Œæ·»åŠ å¯„å­˜å™¨ æœ€åå°±å¯ä»¥è¿›è¡Œè°ƒè¯•ï¼Œçœ‹çœ‹å¯„å­˜å™¨çš„å€¼çš„å˜åŒ–äº†ã€‚F7æ˜¯è¿›å…¥æ–¹æ³•ï¼ŒF8æ˜¯å•æ­¥ã€‚","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"},{"name":"åŠ¨æ€è°ƒè¯•","slug":"åŠ¨æ€è°ƒè¯•","permalink":"http://sorgs.cn/tags/åŠ¨æ€è°ƒè¯•/"},{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"http://sorgs.cn/tags/ç ´è§£/"},{"name":"åç¼–è¯‘","slug":"åç¼–è¯‘","permalink":"http://sorgs.cn/tags/åç¼–è¯‘/"},{"name":"è°ƒè¯•","slug":"è°ƒè¯•","permalink":"http://sorgs.cn/tags/è°ƒè¯•/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”é‚£äº›æœä¸åˆ°çš„ä¸­æ–‡æ€ä¹ˆåŠ","date":"2016-11-16T14:25:36.000Z","path":"post/9560/","text":"è¯¥crackmeä¸ºå¾çˆ±åŸ¹è®­æ•™ç¨‹çš„è¯¾åä½œä¸šï¼Œç®€å•åˆ°çˆ†ï¼Œå¤§ç¥è¯·è·¯è¿‡ 1.æºapkåºŸè¯ä¸å¤šè¯´ï¼Œè“å çœ‹çœ‹é”™è¯¯æç¤ºã€‚ è®°ä½æˆ‘ä»¬çš„é”™è¯¯ä¿¡æ¯ã€‚ 2.åç¼–è¯‘é¦–å…ˆå»string.xmlä¸­ 123456789101112131415161718192021222324&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;resources&gt; &lt;string name=\"abc_action_mode_done\"&gt;Done&lt;/string&gt; &lt;string name=\"abc_action_bar_home_description\"&gt;Navigate home&lt;/string&gt; &lt;string name=\"abc_action_bar_up_description\"&gt;Navigate up&lt;/string&gt; &lt;string name=\"abc_action_menu_overflow_description\"&gt;More options&lt;/string&gt; &lt;string name=\"abc_toolbar_collapse_description\"&gt;Collapse&lt;/string&gt; &lt;string name=\"abc_action_bar_home_description_format\"&gt;%1$s, %2$s&lt;/string&gt; &lt;string name=\"abc_action_bar_home_subtitle_description_format\"&gt;%1$s, %2$s, %3$s&lt;/string&gt; &lt;string name=\"abc_searchview_description_search\"&gt;Search&lt;/string&gt; &lt;string name=\"abc_search_hint\"&gt;Searchâ€¦&lt;/string&gt; &lt;string name=\"abc_searchview_description_query\"&gt;Search query&lt;/string&gt; &lt;string name=\"abc_searchview_description_clear\"&gt;Clear query&lt;/string&gt; &lt;string name=\"abc_searchview_description_submit\"&gt;Submit query&lt;/string&gt; &lt;string name=\"abc_searchview_description_voice\"&gt;Voice search&lt;/string&gt; &lt;string name=\"abc_activitychooserview_choose_application\"&gt;Choose an app&lt;/string&gt; &lt;string name=\"abc_activity_chooser_view_see_all\"&gt;See all&lt;/string&gt; &lt;string name=\"abc_shareactionprovider_share_with_application\"&gt;Share with %s&lt;/string&gt; &lt;string name=\"abc_shareactionprovider_share_with\"&gt;Share with&lt;/string&gt; &lt;string name=\"status_bar_notification_info_overflow\"&gt;999+&lt;/string&gt; &lt;string name=\"app_name\"&gt;CrackMe&lt;/string&gt; &lt;string name=\"hello_world\"&gt;Hello world!&lt;/string&gt; &lt;string name=\"action_settings\"&gt;Settings&lt;/string&gt; &lt;/resources&gt; çœ‹å§ï¼Œæ²¡æœ‰å¯ç”¨ä¿¡æ¯ã€‚é‚£ä¹ˆæˆ‘çœ‹å°±åªæœ‰æœç´¢äº†å™» ä»€ä¹ˆæƒ…å†µã€‚æ²¡æœ‰ï¼Ÿï¼Ÿï¼Ÿæ‡µé€¼äº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æ¥è¯•è¯•unicode æŠŠæˆ‘ä»¬éœ€è¦è½¬æ¢çš„å†™è¿™é‡Œã€‚ ç‚¹åç‚¹å‡»è½¬æ¢ä¸ºunicode æœ€åä¸€æ­¥ï¼ŒæŠŠè½¬åŒ–å¥½çš„ï¼Œæ”¾åˆ°æœç´¢å†…å®¹å»ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœæœçœ‹çœ‹å§ã€‚ è¿™ä¸‹å°±å‡ºæ¥äº†ï¼ŒåŒå‡»è¿‡å»ã€‚ ç„¶åå¾€ä¸Šæ‰¾æ‰¾è·³è½¬ã€‚ æˆ‘ä»¬å»çœ‹çœ‹å…³é”®çš„ç±»æºç ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…³é”®å°±æ˜¯é‚£ä¸ªif&lt;30,è¯•æƒ³æˆ‘ä»¬æ€ä¹ˆå¯èƒ½å¤§äº30å‘¢ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¿®æ”¹ä¸ºå°äº30ã€‚æˆ–è€…è¯´ï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡è¿™ä¸ªifã€‚ å¥½å§ï¼Œé‚£æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚ 1ï¼‰.æŠŠgeæ”¹ä¸ºleï¼Œæ”¹ä¸ºå°äº 2ï¼‰ç›´æ¥gotoæ— æ¡ä»¶è·³è½¬æˆ‘ä»¬å¯ä»¥ç›´æ¥è®©gotoå»è·³è¿‡è¿™ä¸ªifè¯­å¥å— 3.éªŒè¯ç¼–è¯‘ç”Ÿæˆæ‹–è“å  ç›´æ¥ç‚¹å‡»å‡çº§ï¼Œç„¶åé‡å¯ OKï¼Œå·²ç»æˆåŠŸç ´è§£ã€‚ apkä¸‹è½½ https://yunpan.cn/cMqFIzEa2y4UT è®¿é—®å¯†ç  93db åè®°:è¿™äº›éƒ½æ˜¯å¾ˆç®€å•ï¼Œå¾ˆåŸºç¡€çš„apkã€‚è¿™ä¸ªå°±æ˜¯å­¦ä¹ ä¸€ä¸‹éƒ½ä¸åˆ°ä¸­æ–‡æ€ä¹ˆåŠã€‚è¿™é‡Œä¹Ÿå°±æ˜¯è‡ªå·±åšåšç¬”è®°ï¼Œå¾ˆç®€å•çš„ä¸œè¥¿ã€‚","tags":[{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"},{"name":"è½¬ç ","slug":"è½¬ç ","permalink":"http://sorgs.cn/tags/è½¬ç /"}]},{"title":"A ndroidé€†å‘åŸºç¡€ç¬”è®°â€”Dalvikå­—èŠ‚ç å°è®°_const/4 v2, 0x1","date":"2016-11-16T09:23:32.000Z","path":"post/10311/","text":"è¿™å‡ å¤©è®¤çœŸç ”è¯»äº†ä¸€ä¸‹dalvikå­—èŠ‚ç ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œå¯¹ä»¥åçš„Androidé€†å‘åˆ†æå¾ˆé‡è¦ã€‚æˆ‘æ˜¯å­¦è¿‡æ±‡ç¼–çš„ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯ä¸æ˜¯å¤ªæ‡‚ã€‚è¿™ç©æ„ä¹Ÿå¤ªä¹±äº†å§ã€‚ç„¶åæˆ‘æœ‰äº›çœ‹ä¸æ‡‚ï¼Œå°±ç™¾åº¦ä¸€é˜µï¼Œä¹Ÿæ²¡æœ‰ç»“æœã€‚å°±è‡ªå·±ç ”ç©¶äº†ä¸‹ä¸‹ï¼ŒæŠŠè‡ªå·±ä¸æ‡‚çš„åœ°æ–¹å†™å‡ºæ¥ã€‚ä¸å¯¹çš„åœ°æ–¹ï¼Œå¤§å®¶è¯·æŒ‡å‡ºã€‚æˆ‘ä¸»è¦æ˜¯é›†ä¸­åœ¨èµ‹å€¼å“ªé‡Œã€‚æˆ‘å¼€å§‹æ²¡å¼„æ‡‚ï¼Œåæ¥æ‰æ˜ç™½è¿‡æ¥ã€‚const/4 v1, 0x1 è¿™é‡Œå¤§å®¶åº”è¯¥çŸ¥é“ v1=1ã€‚ä½†æ˜¯çœŸçœŸæ­£æ­£æƒ³è¿‡ä¸ºä»€ä¹ˆï¼Ÿä¹Ÿè®¸å¾ˆå¤šäººéƒ½çŸ¥é“ï¼Œè¿™é‡Œæ˜¯å†™ç»™ä¸çŸ¥é“çš„ã€‚é¦–å…ˆ4ä»£è¡¨4å­—èŠ‚ï¼Œé‚£ä¹ˆå°±æ˜¯4ä½çš„ã€‚æ‰€ä»¥å‘¢ v1=04+1=1const/16 v2, 0x10 è¿™é‡Œçš„è¯ï¼Œ16å­—èŠ‚ï¼Œé‚£ä¹ˆ16ä½å¯¹å§ã€‚æ‰€ä»¥v2 = 116+0 = 16const/16 v3, 0x28 16å­—èŠ‚ï¼Œ16ä½ã€‚v3 = 2*16+8 = 40ï¼›è¿™é‡Œå°±è§£é‡Šå®Œäº†ã€‚åé¢ç»™ç‚¹dalvikçš„å®ä¾‹å§ã€‚123456789101112131415161718192021.local 4 //æœ¬åœ°4ä¸ªå¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„v0,v1,v2,v3const/4 v2, 0x1 //4å­—èŠ‚å¸¸é‡ v2=1const/16 v1, 0x10 //16å­—èŠ‚å¸¸é‡ v1=16:local v1, \"length\":I //int length=v1if-nez v1ï¼Œï¼šcond_1 //å¦‚æœv1ä¸ç­‰äº0ï¼Œè¿™è·³è½¬è‡³cond_1:cond_0 //cond_0æ ‡ç­¾:goto_0 //goto_0æ ‡ç­¾return v2 //è¿”å›v2çš„å€¼:cond_1 //å¼€å§‹æ‰§è¡Œcond_1æ ‡ç­¾ä»£ç const/4 v0,0x0 //4å­—èŠ‚å¸¸é‡ v0=0:local v0, \"i\":I //int i=v0:goto_1 //å¼€å§‹æ‰§è¡Œgoto_1æ ‡ç­¾ä»£ç if-lt v0, v1, :cond_2 //å¦‚æœv0å°äºv1,åˆ™è·³è½¬è‡³cond_2const/16 v3,0x28 //å¦‚æœv0å¤§äºç­‰äºv1ï¼Œåˆ™æ‰§è¡Œä¸‹é¢è¯­å¥ï¼š 16å­—èŠ‚å¸¸é‡v3=40if-le v1,v3, :cond_0 //å¦‚æœv1å°äºç­‰äºv3,åˆ™è·³è½¬è‡³cond_0,å³è¿”å›v2çš„å€¼const/4 v2, 0x0 //å¦‚æœv1å¤§äºv3,åˆ™4å­—èŠ‚å¸¸é‡v2=0goto:goto_0 //è·³è½¬è‡³goto_0,å³è¿”å›v2çš„å€¼:cond_2 //cond_2æ ‡ç­¾xor-int/lit8 v1, v1, 0x3b //å°†ç¬¬äºŒä¸ªv1å¯„å­˜å™¨ä¸­çš„å€¼ä¸0x3bï¼ˆ59ï¼‰è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°çš„å€¼èµ‹å€¼ç»™ç¬¬ä¸€ä¸ªv1å¯„å­˜å™¨ä¸­add-int/lit8 v0, v0, 0x1 //å°†ç¬¬äºŒä¸ªv0å¯„å­˜å™¨ä¸­çš„å€¼åŠ ä¸Š0x1(1)ï¼Œæ‰€å¾—çš„å€¼æ”¾å…¥ç¬¬ä¸€ä¸ªv0å¯„å­˜å™¨ä¸­goto:goto_1 //è·³è½¬å€¼goto_1æ ‡ç­¾ ç¿»è¯‘æˆjavaä»£ç å°±æ˜¯ 123456789101112int v2 = 1; int v1 = 16; if (v1 != 0)&#123; for (int v0 = 0; v0 &lt; v1;)&#123; v1 = v1 ^ 59; v0++; &#125; if (v1 &gt; 40)&#123; v2 = 0; &#125; &#125; return v2;","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”ç»­åŠ›ç ´è§£ä¸‰ä¸ªAndroidç¨‹åº","date":"2016-11-16T09:03:08.000Z","path":"post/50997/","text":"è¿™ä¸ªé¦–å…ˆæ„Ÿè°¢é±¼Cè®ºå›çš„cbså¤§ç¥ï¼Œæˆ‘æ˜¯çœ‹äº†ä»–çš„è§†é¢‘ã€‚è‡ªå·±å†åŠ¨æ‰‹ç ´è§£ä»–ç»™å‡ºè¿™ä¸‰ä¸ªå°ç¨‹åºã€‚çœŸå¿ƒè¿™æ ·æ— ç§æŠŠæŠ€æœ¯åˆ†äº«ç»™å¤§å®¶çš„äººçœŸçš„ä¸å¤šã€‚å†æ¬¡æ„Ÿè°¢ä»–ã€‚è¿™é‡Œæˆ‘å°±æˆ‘è‡ªå·±ç ´è§£çš„ä¸‰ä¸ªå°ç¨‹åºè‡ªå·±åšåšç¬”è®°å§ï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åæŸ¥çœ‹ï¼Œä¹Ÿæ–¹ä¾¿åˆšåˆšå…¥é—¨çš„ç«¥é‹ã€‚è¿™äº›éƒ½æ˜¯äº›æ²¡å•¥æŠ€æœ¯å«é‡çš„ä¸œè¥¿ï¼Œå¤§ç¥è¯·é£˜è¿‡ã€‚ ä¸€ã€è®¤è¯†æ–°å·¥å…·è¿™é‡Œæˆ‘å…ˆç»™å‡ºä¸€ä¸ªæ–°çš„å·¥å…·ã€‚jebã€‚ç»™ä¸ªæˆ‘æ‰¾çš„ã€‚åˆ†åˆ«æœ‰32å’Œ64çš„ã€‚https://yunpan.cn/cMuBpvug7qjc2 è®¿é—®å¯†ç  da4aè¿˜æ˜¯ç…§ä¾‹ç»™ä¸ªæ ·å›¾ äºŒã€Crackme031.æŸ¥çœ‹åŸapkè¿˜æ˜¯æ‹–æ‹½åˆ°è“å é‡Œé¢çœ‹çœ‹å§ã€‚ æˆ‘ä»¬çœ‹åˆ°é”™è¯¯çš„æç¤ºæ˜¯Bad boyã€‚é‚£å°±è®©æˆ‘ä»¬å¼€å¿ƒçš„æ‰“å¼€apkIDEå§ 2.åç¼–è¯‘åç¼–è¯‘ä¹‹åæ‰“å¼€strings.xmlã€‚å‘ç°ï¼Œæ²¡æœ‰Bad boyã€‚1234567891011&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;resources&gt; &lt;string name=\"app_name\"&gt;Android Crackme03 - [by deurus]&lt;/string&gt; &lt;string name=\"app_name2\"&gt;About Crackme03&lt;/string&gt; &lt;string name=\"textoPrueba2\"&gt;This is the third crackme of the Android collection crackmes, in this, the crackme take another phone values and with our name make something. For this reason, the crackme dont run in the emulator, only in the phone. Good luck for all!.&lt;/string&gt; &lt;string name=\"textodeurus\"&gt;by deurus [29-10-10] [Made in Basque Country]&lt;/string&gt; &lt;string name=\"imei\" /&gt; &lt;string name=\"temp\"&gt;Enter Name&lt;/string&gt; &lt;string name=\"labelserial\"&gt;Enter Serial&lt;/string&gt; &lt;string name=\"line\"&gt;--------------------------------------&lt;/string&gt; &lt;/resources&gt; é‚£æˆ‘ä»¬å°±åªèƒ½çœ‹çœ‹smalié‡Œé¢çš„ä¸œè¥¿äº†ã€‚æœç´¢ç»“æœåªæœ‰ä¸€å¤„ï¼Œè¿˜å¥½ã€‚ åŒå‡»è¿‡å»ï¼Œå¹¶å¾€ä¸Šæ‰¾è·³è½¬ã€‚ç»“æœå‘ç°ï¼Œè¿™ä»£ç æœ‰æ··æ·†ã€‚æ²¡æœ‰åŠæ³•äº†ï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¯¥æˆ‘ä»¬çš„jebä¸Šäº†ã€‚ ç‚¹å‡»File-Openï¼Œç„¶åé€‰æ‹©æˆ‘ä»¬çš„Crackme03ã€‚ç„¶åç‚¹åˆ°Decompiled Javaé€‰é¡¹å¡ã€‚åŒå‡»å·¦è¾¹çš„HelloAndroidã€‚æˆ‘ä»¬æƒŠå–œçš„å‘ç°è¿™ä¸æ˜¯æºç ä¹ˆï¼Ÿ å…¶å®ä¸æ˜¯å“ˆã€‚åªæ˜¯å¾ˆç±»ä¼¼äº†ã€‚è€Œå·²ã€‚å…¶å®ï¼Œè¿™é‡Œçš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç”¨jebå“ˆã€‚ç›´æ¥ç”¨apkIDEå¸¦ä¸€ä¸ªä¸œè¥¿ã€‚ ç‚¹å‡»æ‰“å¼€ï¼Œé€‰æ‹©æ‰“å¼€ã€‚ä¹Ÿæ˜¯ä¸€æ ·çš„ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package com.example.helloandroid; import android.app.Activity; import android.content.Context; import android.content.Intent; import android.os.Bundle; import android.telephony.TelephonyManager; import android.view.View; import android.view.View$OnClickListener; import android.widget.TextView; import android.widget.Toast; public class HelloAndroid extends Activity &#123; private View$OnClickListener pulsarBoton; private View$OnClickListener pulsarBotonabout; public HelloAndroid() &#123; super(); this.pulsarBotonabout = new View$OnClickListener() &#123; public void onClick(View v) &#123; HelloAndroid.this.setContentView(2130903041); Intent v0 = new Intent(); v0.setClass(HelloAndroid.this, prueba2.class); HelloAndroid.this.startActivity(v0); HelloAndroid.this.finish(); &#125; &#125;; this.pulsarBoton = new View$OnClickListener() &#123; public void onClick(View v) &#123; String v10 = HelloAndroid.this.findViewById(2131034116).getText().toString(); int v11 = v10.length(); String v12 = \"\"; String v15 = HelloAndroid.this.findViewById(2131034118).getText().toString(); if(v11 &gt;= 4) &#123; goto label_29; &#125; try &#123; Toast.makeText(HelloAndroid.this.getApplicationContext(), \"Min 4 chars\", 1).show (); return; label_29: int v5; for(v5 = 0; v5 &lt; v10.length(); ++v5) &#123; v12 = String.valueOf(v12) + v10.charAt(v5); &#125; v12 = String.valueOf(Integer.parseInt(v12.substring(0, 5)) ^ 438294); Object v8 = HelloAndroid.this.getSystemService(\"phone\"); String v6 = ((TelephonyManager)v8).getDeviceId(); String v16 = ((TelephonyManager)v8).getSimSerialNumber(); String v19 = v6.substring(0, 6); if(!String.valueOf(v12) + \"-\" + String.valueOf(((long)(Integer.parseInt(v19) ^ Integer .parseInt(v16.substring(0, 6))))) + \"-\" + v19.equals(v15)) &#123; goto label_114; &#125; Toast.makeText(HelloAndroid.this.getApplicationContext(), \"God boy\", 1).show(); return; label_114: Toast.makeText(HelloAndroid.this.getApplicationContext(), \"Bad boy \", 1).show(); return; &#125; catch(Exception v22) &#123; Toast.makeText(HelloAndroid.this.getApplicationContext(), \"Another Error Ocurred :(\" , 1).show(); return; &#125; &#125; &#125;; &#125; public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); this.setContentView(2130903040); Object v3 = this.getSystemService(\"phone\"); String v2 = ((TelephonyManager)v3).getDeviceId(); new TextView(((Context)this)); this.findViewById(2131034112).setText(\"HardwareID 01: \" + v2); String v5 = ((TelephonyManager)v3).getSimSerialNumber(); new TextView(((Context)this)); this.findViewById(2131034113).setText(\"HardwareID 02: \" + v5); String v8 = v2.substring(0, 6); String v9 = v5.substring(0, 6); Integer.parseInt(v8); Integer.parseInt(v9); new TextView(((Context)this)); this.findViewById(2131034116).setText(\"\"); this.findViewById(2131034120).setOnClickListener(this.pulsarBotonabout); this.findViewById(2131034119).setOnClickListener(this.pulsarBoton); &#125; &#125; æˆ‘ä»¬å¾ˆå®¹æ˜“çš„å‘ç°Bad boyï¼Œä¸Šé¢æœ‰God boyã€‚çŒœæµ‹å°±çŸ¥é“è¿™å°±æ˜¯æ­£ç¡®ä¿¡æ¯ã€‚ é‚£å°±è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä»£ç ã€‚æˆ‘ä»¬å‘ç°ä¸Šé¢æœ‰ä¸ªgoto label_114; å°±ä»è¿™ä¸ªå°±è·³è½¬åˆ°Bad boyã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¾—è®©å®ƒä¸è·³è½¬ï¼Œå¯¹å§ã€‚å¤§è‡´çŸ¥é“é‚£é‡Œä¹‹åå›åˆ°apkIDEã€‚æˆ‘ä»¬å¾€ä¸Šæ‰¾è¯­å¥å—ï¼Œå‘ç°äº† ï¼šcond_2é‚£æˆ‘ä»¬æœç´¢è¿™ä¸ªã€‚åˆ°äº†è¿™é‡Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£ä¸ªè·³è½¬ã€‚ OK,æˆ‘ä»¬æœæ–­æ”¹ä¸ºnezï¼Œä¿å­˜ï¼Œç”Ÿæˆã€‚ 3.éªŒè¯æ‹–æ‹½åˆ°è“å ï¼Œæ‰“å¼€ã€‚ä¸é”™ï¼ŒGod boyå’Œæˆ‘ä»¬è§é¢ è¿™ä¸ªæˆ‘ä»¬å°±æ˜¯KOäº†ã€‚ ä¸‰ã€CrackMe-F1F21.æŸ¥çœ‹åŸapkæ— éœ€å¤šè¯´ï¼Œè¿›è“å  è¿™ä¸æ˜¯æ˜¯å†™çš„EditViewï¼Œå±…ç„¶ä¸æ˜¯hintå±æ€§ï¼Œè¡¨ç¤ºæ— è¯­ã€‚æ‡‚çš„å°±æ‡‚ï¼Œä¸æ‡‚ä¹Ÿä¸é‡è¦ã€‚è¿™é‡Œæ‰¯è¿œäº†ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚æ—¢ç„¶æœ‰ä¸œè¥¿ï¼Œæˆ‘å°±æ‡’å¾—è¾“äº†ã€‚ç›´æ¥éªŒè¯ æˆ‘ä»¬çŸ¥é“äº†é”™è¯¯ä»£ç å°±æ˜¯Lisence Uncorrect.ã€‚ 2.åæ±‡ç¼–apkIDEï¼Œå¸¸è§„æ“ä½œã€‚ç…§æ ·ï¼Œstring.xmlæ²¡æœ‰ä¿¡æ¯ã€‚åªæœ‰smalié‡Œé¢æœç´¢ä¸€æ³¢ã€‚ åŒå‡»è¿‡å»ã€‚æ‰¾æ‰¾è·³è½¬ã€‚è¿™é‡Œç»™å‡ºä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272.class Lcom/mstar/test/LisenceCheck$1; .super Ljava/lang/Object; .source \"LisenceCheck.java\" # interfaces .implements Landroid/view/View$OnClickListener; # annotations .annotation system Ldalvik/annotation/EnclosingClass; value = Lcom/mstar/test/LisenceCheck; .end annotation .annotation system Ldalvik/annotation/InnerClass; accessFlags = 0x0 name = null .end annotation # instance fields .field final synthetic this$0:Lcom/mstar/test/LisenceCheck; # direct methods .method constructor &lt;init&gt;(Lcom/mstar/test/LisenceCheck;)V .locals 0 .prologue .line 1 iput-object p1, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; .line 51 invoke-direct &#123;p0&#125;, Ljava/lang/Object;-&gt;&lt;init&gt;()V return-void .end method # virtual methods .method public onClick(Landroid/view/View;)V .locals 10 .param p1, \"v\" # Landroid/view/View; .prologue const/4 v9, 0x0 const-string v8, \"\" .line 53 check-cast p1, Landroid/widget/Button; .end local p1 # \"v\":Landroid/view/View; iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; iget-object v6, v6, Lcom/mstar/test/LisenceCheck;-&gt;mbutton:Landroid/widget/Button; if-ne p1, v6, :cond_5 .line 55 new-instance v4, Ljava/lang/String; const-string v6, \"\" invoke-direct &#123;v4, v8&#125;, Ljava/lang/String;-&gt;&lt;init&gt;(Ljava/lang/String;)V .line 56 .local v4, \"s1\":Ljava/lang/String; iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; iget-object v6, v6, Lcom/mstar/test/LisenceCheck;-&gt;meditun:Landroid/widget/EditText; invoke-virtual &#123;v6&#125;, Landroid/widget/EditText;-&gt;getText()Landroid/text/Editable; move-result-object v6 invoke-interface &#123;v6&#125;, Landroid/text/Editable;-&gt;toString()Ljava/lang/String; move-result-object v4 .line 57 new-instance v5, Ljava/lang/String; const-string v6, \"\" invoke-direct &#123;v5, v8&#125;, Ljava/lang/String;-&gt;&lt;init&gt;(Ljava/lang/String;)V .line 58 .local v5, \"s2\":Ljava/lang/String; iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; iget-object v6, v6, Lcom/mstar/test/LisenceCheck;-&gt;meditsn:Landroid/widget/EditText; invoke-virtual &#123;v6&#125;, Landroid/widget/EditText;-&gt;getText()Landroid/text/Editable; move-result-object v6 invoke-interface &#123;v6&#125;, Landroid/text/Editable;-&gt;toString()Ljava/lang/String; move-result-object v5 .line 60 const/4 v1, 0x0 .local v1, \"i\":I const/4 v2, 0x0 .line 62 .local v2, \"k1\":I const/4 v1, 0x0 :goto_0 invoke-virtual &#123;v4&#125;, Ljava/lang/String;-&gt;length()I move-result v6 if-lt v1, v6, :cond_1 .line 69 :cond_0 xor-int/lit16 v2, v2, 0x5678 .line 72 const/4 v3, 0x0 .line 73 .local v3, \"k2\":I const/4 v1, 0x0 :goto_1 invoke-virtual &#123;v5&#125;, Ljava/lang/String;-&gt;length()I move-result v6 if-lt v1, v6, :cond_3 .line 78 xor-int/lit16 v3, v3, 0x1234 .line 80 if-ne v2, v3, :cond_4 .line 81 iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; invoke-virtual &#123;v6&#125;, Lcom/mstar/test/LisenceCheck;-&gt;getApplicationContext()Landroid/content/Context; move-result-object v6 const-string v7, \"Lisence Correct\\uff01\" invoke-static &#123;v6, v7, v9&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast; move-result-object v6 invoke-virtual &#123;v6&#125;, Landroid/widget/Toast;-&gt;show()V .line 92 .end local v1 # \"i\":I .end local v2 # \"k1\":I .end local v3 # \"k2\":I .end local v4 # \"s1\":Ljava/lang/String; .end local v5 # \"s2\":Ljava/lang/String; :goto_2 return-void .line 64 .restart local v1 # \"i\":I .restart local v2 # \"k1\":I .restart local v4 # \"s1\":Ljava/lang/String; .restart local v5 # \"s2\":Ljava/lang/String; :cond_1 invoke-virtual &#123;v4, v1&#125;, Ljava/lang/String;-&gt;charAt(I)C move-result v0 .line 65 .local v0, \"ch\":C const/16 v6, 0x41 if-lt v0, v6, :cond_0 .line 66 const/16 v6, 0x5a if-le v0, v6, :cond_2 const/16 v6, 0x20 sub-int v6, v0, v6 int-to-char v0, v6 .line 67 :cond_2 add-int/2addr v2, v0 .line 62 add-int/lit8 v1, v1, 0x1 goto :goto_0 .line 74 .end local v0 # \"ch\":C .restart local v3 # \"k2\":I :cond_3 invoke-virtual &#123;v5, v1&#125;, Ljava/lang/String;-&gt;charAt(I)C move-result v0 .line 75 .restart local v0 # \"ch\":C const/16 v6, 0x30 sub-int v6, v0, v6 int-to-char v0, v6 .line 76 mul-int/lit8 v6, v3, 0xa add-int v3, v6, v0 .line 73 add-int/lit8 v1, v1, 0x1 goto :goto_1 .line 83 .end local v0 # \"ch\":C :cond_4 iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; invoke-virtual &#123;v6&#125;, Lcom/mstar/test/LisenceCheck;-&gt;getApplicationContext()Landroid/content/Context; move-result-object v6 const-string v7, \"Lisence Uncorrect\\uff01\" invoke-static &#123;v6, v7, v9&#125;, Landroid/widget/Toast;-&gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast; move-result-object v6 invoke-virtual &#123;v6&#125;, Landroid/widget/Toast;-&gt;show()V goto :goto_2 .line 88 .end local v1 # \"i\":I .end local v2 # \"k1\":I .end local v3 # \"k2\":I .end local v4 # \"s1\":Ljava/lang/String; .end local v5 # \"s2\":Ljava/lang/String; :cond_5 iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; iget-object v6, v6, Lcom/mstar/test/LisenceCheck;-&gt;meditun:Landroid/widget/EditText; const-string v7, \"\" invoke-virtual &#123;v6, v8&#125;, Landroid/widget/EditText;-&gt;setText(Ljava/lang/CharSequence;)V .line 89 iget-object v6, p0, Lcom/mstar/test/LisenceCheck$1;-&gt;this$0:Lcom/mstar/test/LisenceCheck; iget-object v6, v6, Lcom/mstar/test/LisenceCheck;-&gt;meditsn:Landroid/widget/EditText; const-string v7, \"\" invoke-virtual &#123;v6, v8&#125;, Landroid/widget/EditText;-&gt;setText(Ljava/lang/CharSequence;)V goto :goto_2 .end method è¿˜æ˜¯ä¸€ç‰‡å¤§ä¹±ï¼Œè¿˜æ˜¯ç”¨jebã€‚ çœ‹æˆ‘æ¡†å‡ºæ¥çš„åœ°æ–¹ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœå‰é¢ä¸ç­‰äºåé¢è¿™ä¸€æ®µï¼Œé‚£ä¹ˆå°±è·³è½¬åˆ°ä¸‹é¢å»ï¼ŒToastå‡ºæ¥é”™è¯¯ã€‚OKï¼Œæˆ‘ä»¬å›åˆ°smalié‡Œé¢ï¼Œå»æ‰¾è¿™ä¸ªè·³è½¬ã€‚å…¶å®å¤§èƒ†ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥åœ¨é”™è¯¯çš„ä¸Šé¢çœ‹åˆ°:cond_4ã€‚ç„¶åæœç´ è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ç¨³ä¸€ç‚¹ï¼Œçœ‹çœ‹ç±»ä¼¼çš„æºç ï¼Œæ‰¾æ‰¾æ€è·¯ã€‚æœç´¢:cond_4ï¼ŒåŒå‡»è¿‡å» neå°±æ˜¯ç­‰äºï¼Œé‚£æˆ‘ä»¬æ”¹æˆç­‰äºå°±OKäº†ã€‚eqæ”¹ä¸Šã€‚ 3.éªŒè¯ä¿å­˜ï¼Œç”Ÿæˆapkã€‚æ‹–è“å ã€‚ åˆæ˜¯æˆ‘ä»¬ç†Ÿæ‚‰åˆæ¿€åŠ¨çš„æ­£ç¡®Toastã€‚ å››ã€EX05011.åŸapkä¸åºŸè¯ï¼Œä¸Šè“å ã€‚çœ‹çœ‹é”™è¯¯æç¤º è¿™é‡Œæ˜¯ç›´æ¥ä¸ç”¨è¾“ä»€ä¹ˆï¼Œç›´æ¥æ¥errorâ€“ 2.åç¼–è¯‘æ¥çœ‹çœ‹æˆ‘ä»¬çš„apkIDEæ€ä¹ˆè¯´ã€‚ ä¸ç”¨å¤šæƒ³ã€‚ä¾ç„¶é‚£ä¸ªé—®é¢˜ã€‚stringæ²¡ä¿¡æ¯ã€‚é‚£æˆ‘ä»¬å°±æœç´¢errorâ€“çœ‹çœ‹ åªæœ‰ä¸€å¤„ç»“æœå°±æ˜¯æå¥½çš„ï¼ŒåŒå‡»è¿‡å»æ‰¾è·³è½¬ã€‚æ˜¾ç„¶æ²¡æœ‰ä»€ä¹ˆå¯ç”¨ä¿¡æ¯ã€‚è¿˜æ˜¯çœ‹çœ‹ç±»æºç å§ã€‚ 123456789101112131415161718192021222324252627282930package irdc.ex05_01; import android.text.util.Linkify; import android.view.KeyEvent; import android.view.View; import android.view.View.OnKeyListener; import android.widget.TextView; import android.widget.Toast; class EX05_01$1 implements View.OnKeyListener &#123; EX05_01$1(EX05_01 paramEX05_01) &#123;&#125; public boolean onKey(View paramView, int paramInt, KeyEvent paramKeyEvent) &#123; if (\"gogo\".equals(\"11\")) &#123; EX05_01.access$0(this.this$0).setText(\"gogo\"); Toast.makeText(this.this$0, \"right++\", 1).show(); &#125; for (;;) &#123; Linkify.addLinks(EX05_01.access$0(this.this$0), 7); return false; EX05_01.access$0(this.this$0).setText(\"gogo\"); Toast.makeText(this.this$0, \"error--\", 1).show(); &#125; &#125; &#125; è¿™ä¸ªå¾ˆæ¸…æ™°æ˜äº†ã€‚ä»£ç å¾ˆå°‘ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°æ€è·¯çš„åœ°æ–¹ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œæ„æ€å°±æ˜¯â€œgogoâ€ç­‰äºâ€œ11â€æ‰ä¼šè·³è½¬åˆ°æ­£ç¡®çš„åœ°æ–¹ã€‚ä½†æ˜¯æ€ä¹ˆå¯èƒ½â€œgogoâ€ç­‰äºâ€œ11â€å‘¢ã€‚è¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥ä¿®æ”¹ä¸ºä¸ç­‰äºå°±OKäº†ã€‚å›åˆ°apkIDEï¼Œæ‰¾åˆ°è·³è½¬åˆ°é”™è¯¯çš„åœ°æ–¹ã€‚ é‚£ä¹ˆå°±ç›´æ¥æŠŠeqzæ”¹ä¸ºnezã€‚è®©å®ƒä¸ç­‰äº 3.éªŒè¯ä¿å­˜ï¼Œç”Ÿæˆï¼Œæ‹–è“å ã€‚ æ‰“å®Œæ”¶å·¥ï¼ï¼ï¼ è¿™ä¸‰ä¸ªappéƒ½ä¸æ˜¯å¾ˆéš¾ã€‚ä½†æ˜¯ä¸»è¦çš„ç›®çš„å°±æ˜¯ç»ƒç»ƒæ‰‹ï¼Œç„¶åå»ç†ç†æ€è·¯ã€‚å„ä½çœ‹å®˜ï¼Œçœ‹çš„å¼€å¿ƒå°±ç»™ä¸ªäº”æ˜Ÿå¥½è¯„ã€‚ è¿˜æ˜¯æœ€åç»™å‡ºä¸‰ä¸ªapkä¸‹è½½åœ°å€å§ https://yunpan.cn/cMu6crr4vXq5t è®¿é—®å¯†ç  21bc","tags":[{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"}]},{"title":"Androidé€†å‘å®ä¾‹ç¬”è®°â€”ç ´è§£ç¬¬ä¸€ä¸ªAndroidç¨‹åº_crackme02","date":"2016-11-16T08:46:17.000Z","path":"post/24104/","text":"æœ¬å®ä¾‹æ¥æºäºã€ŠAndroidè½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æã€‹è¿™æœ¬ä¹¦ï¼Œä½œè€…æ˜¯çœ‹é›ªçš„éè™«ï¼Œæ„Ÿè°¢æä¾›è¿™ä¹ˆå¥½çš„ä¹¦å’Œå®ä¾‹ã€‚ ä¸€ã€å·¥å…·å¹²ä»€ä¹ˆéƒ½å¾—ä¸€ä¸ªå¥½å·¥å…·å¯¹å§ã€‚ 1.apkIDEåç¼–è¯‘å‘¢ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯apkIDEï¼ˆapkæ”¹ä¹‹ç†ï¼‰ï¼Œå·¥å…·çš„è¯è‡ªå·±ç™¾åº¦å§ã€‚ä¸ªäººä¸å–œæ¬¢ç•™ä¸€äº›ä¸éœ€è¦çš„ä¸œè¥¿åœ¨ç½‘ç›˜é‡Œï¼Œéš¾å¾—æ•´ç†ï¼Œç™¾åº¦ä¸€å¤§å †ã€‚æˆ‘è¿™é‡Œå°±ç»™ä¸€ä¸ªå®˜ç½‘å§ï¼Œå…å¾—æœ‰äº›ç«¥é‹æ‰¾é”™äº†åœ°æ–¹ã€‚ç°åœ¨è¿™ä¸‹ä¸‹è½½ç½‘ç«™ä¸€ä¸å°å¿ƒï¼Œä»€ä¹ˆå…¨å®¶ç¦éƒ½æ¥äº†ã€‚å¥½äº†ï¼Œæ‰¯å¾—æœ‰ç‚¹è¿œäº†ã€‚æˆ‘ç”¨çš„å°±æ˜¯æœ€æ–°ç‰ˆï¼Œæˆ‘ä¸ªäººå°±å–œæ¬¢æœ€æ–°ç‰ˆã€‚ï¼ˆæœ€æ–°ç‰ˆå¯èƒ½æœ‰äº›é—®é¢˜ï¼‰http://www.popotu.com/popo/apkide.htmlä¸Šä¸ªæ ·å›¾ï¼š 2.è“å åªè¦æ˜¯æ¨¡æ‹Ÿå™¨éƒ½å¯ä»¥ï¼Œæˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªå¥½ç”¨ã€‚éšä¾¿æ‰¾ä¸€ä¸ªéƒ½è¡Œã€‚å®˜ç½‘ï¼šhttp://www.bluestacks.cn/ æ ·å›¾ï¼š äºŒã€æŸ¥çœ‹æºç¨‹åºè¿™é‡Œæˆ‘ä»¬ç›´æ¥æ‹–æ‹½crackme02åˆ°è“å ä¸­ï¼Œå®‰è£…ã€‚ ç„¶åæˆ‘ä»¬ç‚¹å¼€çœ‹çœ‹æ•ˆæœã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·¦ä¸Šè§’æœ‰ä¸ªç¨‹åºæœªæ³¨å†Œã€‚æˆ‘ä»¬éšä¾¿è¾“å…¥å­—ç¬¦ï¼Œç‚¹å‡»æ³¨å†Œã€‚å‘ç°Toastæç¤ºæˆ‘ä»¬ï¼Œæ— æ•ˆç”¨æˆ·åæˆ–æ³¨å†Œç ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±è¯¥ä¸Šæˆ‘ä»¬çš„å·¥å…·äº† ä¸‰ã€åç¼–è¯‘1.å·¥å…·çš„ä½¿ç”¨è¿™é‡Œè¯¦ç»†ä»‹ç»ä¸€ä¸‹apkIDEçš„ä½¿ç”¨ã€‚æ‰“å¼€apkIDE ç‚¹å‡»é¡¹ç›®ï¼Œç„¶åç‚¹å‡»æ‰“å¼€apkï¼Œé€‰æ‹©æˆ‘ä»¬çš„crackme02ã€‚çœ‹è¾“å‡ºæ¡†çš„è¿›åº¦ï¼Œä¹‹åå°±å¯ä»¥è¿›è¡Œæˆ‘ä»¬çš„æ“ä½œäº†ã€‚ åç¼–è¯‘ä¹‹åçš„æ–‡ä»¶ç›®å½• å…¶ä¸­smaliä¸­å­˜æ”¾çš„æ˜¯åæ±‡ç¼–çš„ä»£ç ã€‚resæ˜¯æ‰€æœ‰çš„èµ„æºæ–‡ä»¶ã€‚éƒ½ä¸å¼€å‘ç›®å½•ä¸€è‡´ã€‚ 2.strings.xmlæˆ‘ä»¬çŸ¥é“åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸€äº›å­—ç¬¦æ”¾åˆ°strings.xmlæ–‡ä»¶ä¸­å»ã€‚è¿™é‡Œæˆ‘å°±æ‰“å¼€strings.xmlæ–‡ä»¶ã€‚æ–‡ä»¶åœ¨ï¼šres-values-strings.xml ç°åœ¨æˆ‘ä»¬çœ‹çœ‹strings.xmlä¸­çš„å†…å®¹ 1234567891011121314151617&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;resources&gt; &lt;string name=\"app_name\"&gt;Crackme0201&lt;/string&gt; &lt;string name=\"hello_world\"&gt;Hello world!&lt;/string&gt; &lt;string name=\"menu_settings\"&gt;Settings&lt;/string&gt; &lt;string name=\"title_activity_main\"&gt;crackme02&lt;/string&gt; &lt;string name=\"info\"&gt;Androidç¨‹åºç ´è§£æ¼”ç¤ºå®ä¾‹&lt;/string&gt; &lt;string name=\"username\"&gt;ç”¨æˆ·åï¼š&lt;/string&gt; &lt;string name=\"sn\"&gt;æ³¨å†Œç ï¼š&lt;/string&gt; &lt;string name=\"register\"&gt;æ³¨ å†Œ&lt;/string&gt; &lt;string name=\"hint_username\"&gt;è¯·è¾“å…¥ç”¨æˆ·å&lt;/string&gt; &lt;string name=\"hint_sn\"&gt;è¯·è¾“å…¥16ä½çš„æ³¨å†Œç &lt;/string&gt; &lt;string name=\"unregister\"&gt;ç¨‹åºæœªæ³¨å†Œ&lt;/string&gt; &lt;string name=\"registered\"&gt;ç¨‹åºå·²æ³¨å†Œ&lt;/string&gt; &lt;string name=\"unsuccessed\"&gt;æ— æ•ˆç”¨æˆ·åæˆ–æ³¨å†Œç &lt;/string&gt; &lt;string name=\"successed\"&gt;æ­å–œæ‚¨ï¼æ³¨å†ŒæˆåŠŸ&lt;/string&gt; &lt;/resources&gt; æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°ï¼ŒToastæç¤ºæˆ‘ä»¬é”™è¯¯çš„åœ°æ–¹ 3.public.xmlæˆ‘ä»¬çŸ¥é“æ¯ä¸ªå­—ç¬¦éƒ½æœ‰å”¯ä¸€çš„intç±»å‹çš„ç´¢å¼•å€¼ã€‚äºæ˜¯æˆ‘ä»¬æ‰“å¼€strings.xmlä¸Šé¢çš„public.xmlæ–‡ä»¶ã€‚123456789101112131415161718192021222324252627282930&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;resources&gt; &lt;public type=\"drawable\" name=\"ic_launcher\" id=\"0x7f020001\" /&gt; &lt;public type=\"drawable\" name=\"ic_action_search\" id=\"0x7f020000\" /&gt; &lt;public type=\"layout\" name=\"activity_main\" id=\"0x7f030000\" /&gt; &lt;public type=\"dimen\" name=\"padding_small\" id=\"0x7f040000\" /&gt; &lt;public type=\"dimen\" name=\"padding_medium\" id=\"0x7f040001\" /&gt; &lt;public type=\"dimen\" name=\"padding_large\" id=\"0x7f040002\" /&gt; &lt;public type=\"string\" name=\"app_name\" id=\"0x7f050000\" /&gt; &lt;public type=\"string\" name=\"hello_world\" id=\"0x7f050001\" /&gt; &lt;public type=\"string\" name=\"menu_settings\" id=\"0x7f050002\" /&gt; &lt;public type=\"string\" name=\"title_activity_main\" id=\"0x7f050003\" /&gt; &lt;public type=\"string\" name=\"info\" id=\"0x7f050004\" /&gt; &lt;public type=\"string\" name=\"username\" id=\"0x7f050005\" /&gt; &lt;public type=\"string\" name=\"sn\" id=\"0x7f050006\" /&gt; &lt;public type=\"string\" name=\"register\" id=\"0x7f050007\" /&gt; &lt;public type=\"string\" name=\"hint_username\" id=\"0x7f050008\" /&gt; &lt;public type=\"string\" name=\"hint_sn\" id=\"0x7f050009\" /&gt; &lt;public type=\"string\" name=\"unregister\" id=\"0x7f05000a\" /&gt; &lt;public type=\"string\" name=\"registered\" id=\"0x7f05000b\" /&gt; &lt;public type=\"string\" name=\"unsuccessed\" id=\"0x7f05000c\" /&gt; &lt;public type=\"string\" name=\"successed\" id=\"0x7f05000d\" /&gt; &lt;public type=\"style\" name=\"AppTheme\" id=\"0x7f060000\" /&gt; &lt;public type=\"menu\" name=\"activity_main\" id=\"0x7f070000\" /&gt; &lt;public type=\"id\" name=\"textView1\" id=\"0x7f080000\" /&gt; &lt;public type=\"id\" name=\"edit_username\" id=\"0x7f080001\" /&gt; &lt;public type=\"id\" name=\"edit_sn\" id=\"0x7f080002\" /&gt; &lt;public type=\"id\" name=\"button_register\" id=\"0x7f080003\" /&gt; &lt;public type=\"id\" name=\"menu_settings\" id=\"0x7f080004\" /&gt; &lt;/resources&gt; æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„unsuccessedã€‚å¦‚æœè§‰å¾—å¾ˆéš¾æ‰¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœç´¢åŠŸèƒ½å°±æ¥äº†ã€‚åœ¨æœç´¢å†…å®¹é‡Œé¢å†™ä¸Šunsuccessedï¼Œç„¶åæœç´¢èŒƒå›´é€‰æ‹©é€‰ä¸­çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œå·¦è¾¹æˆ‘ä»¬é€‰æ‹©public.xmlã€‚ç„¶åç‚¹å‡»æœç´¢å…¨éƒ¨ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æœç´¢ç»“æœæ˜¾ç¤ºäº†å‡ºæ¥ï¼Œæˆ‘ä»¬åŒå‡»è¿™ä¸€è¡Œï¼Œå°±ä¼šè·³åˆ°æˆ‘ä»¬æ‰€éœ€è¦æ‰¾çš„ä½ç½®ã€‚ ç„¶åæˆ‘ä»¬è®°ä½idï¼š0x7f05000cã€‚ 3.smaliè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜å¾—ä½¿ç”¨æˆ‘ä»¬çš„æœç´¢ã€‚æ–¹æ³•ç±»ä¼¼ï¼Œä¸åœ¨èµ˜è¿°ã€‚æˆ‘ä»¬è¦é€‰æ‹©æœç´¢smail æˆ‘ä»¬å‘ç°æœ‰ä¸¤å¤„ã€‚ç¬¬ä¸€å¤„const v1, 0x7f05000cäºæ˜¯æˆ‘ä»¬åŒå‡»è¿‡å»ã€‚ç„¶åå¾€ä¸Šæ‰¾è·³è½¬çš„åœ°æ–¹ã€‚ move-result v0 if-nez v0, :cond_0 è¿™é‡Œç¬¬ä¸€è¡Œä»£ç è¿”å›çš„ç»“æœå­˜åˆ°v0ä¸­å»ï¼Œç¬¬äºŒè¡Œæ˜¯å¯¹v0è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœå€¼ä¸º0ï¼Œå°±å¾€ä¸‹è¿è¡Œï¼Œä¹Ÿå°±æ˜¯å¼¹å‡ºæœªæ³¨å†Œçš„åœ°æ–¹ã€‚å¦‚æœä¸ä¸º0ï¼Œå°±è·³è½¬åˆ°cond_0å¤„ã€‚ é‚£ä¹ˆä¹Ÿå°±æ˜¯è¿™é‡Œå¦‚æœè·³è½¬æˆåŠŸå°±ä¼šè·³è½¬ï¼Œé‚£ä¹ˆç¨‹åºå°±æ˜¯æˆåŠŸã€‚ å››ã€ä¿®æ”¹smaliè¿™é‡Œæ˜¯nezï¼Œä¸ç­‰äº0ï¼Œé‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸ºeqzï¼Œç­‰äº0ã€‚ é‡ç‚¹ä¸­çš„é‡ç‚¹ï¼Œä¿®æ”¹å®Œä¹‹åï¼Œä¸€å®šè®°å¾—ä¿å­˜ã€‚ä¸ç„¶å¯èƒ½ç¼–è¯‘é”™è¯¯æˆ–è€…ï¼Œæ²¡æœ‰ç¼–è¯‘ä¿®æ”¹åçš„ä»£ç ã€‚ ç„¶åæˆ‘ä»¬ç‚¹å‡»ç¼–è¯‘ï¼Œç¼–è¯‘ç”Ÿæˆapk çœ‹è¾“å‡ºæ¡†çš„è¿›åº¦å’Œæ–‡ä»¶è·¯å¾„ï¼Œæˆ‘ä»¬å°±å»æŸ¥æ‰¾æˆ‘ä»¬çš„apkã€‚ä¸€èˆ¬æ¥è¯´å°±åœ¨åŸapkæ—è¾¹ã€‚é‡æ–°ç¼–è¯‘ç­¾ååçš„apkåå­—å‰é¢ä¼šåŠ ä¸ŠApkIDE_ äº”ã€éªŒè¯é‡æ–°ç¼–è¯‘å¥½çš„apkæˆ‘ä»¬éœ€è¦æ¥éªŒè¯ä¸€ä¸‹æ˜¯å¦æˆåŠŸã€‚æˆ‘ä»¬æ‹–æ‹½åˆ°è“å ä¸­ï¼Œå®‰è£…æ‰“å¼€ã€‚ è¿™é‡Œå‘ç°æˆ‘ä»¬å·²ç»ç ´è§£æˆåŠŸäº†ã€‚ æœ€åç»™å‡ºapkçš„ä¸‹è½½å§ã€‚https://yunpan.cn/cMuPerPjatc6S è®¿é—®å¯†ç  24ceè¯´çš„æœ‰é”™è¯¯æˆ–è€…ä¸å¯¹çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£è®¨è®ºã€‚","tags":[{"name":"Androidé€†å‘å®ä¾‹","slug":"Androidé€†å‘å®ä¾‹","permalink":"http://sorgs.cn/tags/Androidé€†å‘å®ä¾‹/"}]},{"title":"Androidé€†å‘åŸºç¡€ç¬”è®°â€”åˆè¯†é€†å‘","date":"2016-11-16T08:24:13.000Z","path":"post/15339/","text":"ï¼ˆæœ¬ç¬”è®°æ¥æºäºå¾çˆ±ä»¥åŠå¾çˆ±å›å‹ï¼ŒåŠ ä¸Šæœ¬äººè‡ªå·±çš„æ•´ç†ï¼‰ ä¸€.åˆè¯† APKã€Dalvikå­—èŠ‚ç ä»¥åŠSmali1. apkæ˜¯ä»€ä¹ˆï¼Ÿapkå®è´¨ä¸Šæ˜¯ä¸€ä¸ªzipå‹ç¼©åŒ…ï¼Œå°†apkåç¼€ä¿®æ”¹ä¸ºzipï¼Œè§£å‹ä¹‹åå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨ç»“æ„ï¼š 2. apk çš„ç»„æˆassetsï¼š èµ„æºç›®å½•1 assets å’Œ res éƒ½æ˜¯èµ„æºç›®å½•ä½†æœ‰æ‰€åŒºåˆ«ï¼š res ç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶åœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆç´¢å¼•æ–‡ä»¶ï¼ˆR.javaï¼‰ï¼Œåœ¨Javaä»£ç ä¸­ç”¨R.xxx.yyyæ¥å¼•ç”¨ï¼›è€Œassetç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶ä¸éœ€è¦ç”Ÿæˆç´¢å¼•ï¼Œåœ¨Java ä»£ç ä¸­éœ€è¦ç”¨AssetManageræ¥è®¿é—®ï¼› ä¸€èˆ¬æ¥è¯´ï¼Œé™¤äº†éŸ³é¢‘å’Œè§†é¢‘èµ„æºï¼ˆéœ€è¦æ”¾åœ¨rawæˆ–assetä¸‹ï¼‰ï¼Œä½¿ç”¨Javaå¼€å‘çš„Androidå·¥ç¨‹ä½¿ç”¨åˆ°çš„èµ„æºæ–‡ä»¶éƒ½ä¼šæ”¾åœ¨resä¸‹ï¼› ä½¿ç”¨C++æ¸¸æˆå¼•æ“ï¼ˆæˆ–ä½¿ç”¨ Lua Unity3Dç­‰ï¼‰çš„èµ„æºæ–‡ä»¶å‡éœ€è¦æ”¾åœ¨ assets ä¸‹ã€‚ libï¼š so åº“å­˜æ”¾ä½ç½®ï¼Œä¸€èˆ¬ç”±NDKç¼–è¯‘å¾—åˆ°ï¼Œå¸¸è§äºä½¿ç”¨æ¸¸æˆå¼•æ“æˆ– JNI nativeè°ƒç”¨çš„å·¥ç¨‹ä¸­ META-INFï¼š å­˜æ”¾å·¥ç¨‹ä¸€äº›å±æ€§æ–‡ä»¶ï¼Œä¾‹å¦‚ Manifest.MF resï¼š èµ„æºç›®å½•2 AndroidManifest.xmlï¼š Androidå·¥ç¨‹çš„åŸºç¡€é…ç½®å±æ€§æ–‡ä»¶ classes.dexï¼š Javaä»£ç ç¼–è¯‘å¾—åˆ°çš„ Dalvik VM èƒ½ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶ resources.arscï¼š å¯¹res ç›®å½•ä¸‹çš„èµ„æºçš„ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œä¿å­˜äº†åŸå·¥ç¨‹ä¸­ strings.xmlç­‰æ–‡ä»¶å†… apktool.yml - é‡æ–°æ‰“åŒ…å¿…é¡»æ–‡ä»¶ lib - native åŠ¨æ€åº“ so META-INF -ç­¾å 3. Dalvikå­—èŠ‚ç ï¼ˆé‡ç‚¹æ¥äº†ï¼‰Dalvik æ˜¯ google ä¸“é—¨ä¸º Android æ“ä½œç³»ç»Ÿè®¾è®¡çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œç»è¿‡æ·±åº¦ä¼˜åŒ–ã€‚è™½ç„¶ Android ä¸Šçš„ç¨‹åºæ˜¯ä½¿ç”¨java æ¥å¼€å‘çš„ï¼Œä½†æ˜¯ Dalvik å’Œæ ‡å‡†çš„ java è™šæ‹Ÿæœº JVM è¿˜æ˜¯ä¸¤å›äº‹ã€‚ Dalvik VM æ˜¯åŸºäºå¯„å­˜å™¨çš„ï¼Œè€Œ JVM æ˜¯åŸºäºæ ˆçš„ï¼› Dalvikæœ‰ä¸“å±çš„æ–‡ä»¶æ‰§è¡Œæ ¼å¼ dex ï¼ˆdalvik executableï¼‰ï¼Œè€Œ JVM åˆ™æ‰§è¡Œçš„æ˜¯ java å­—èŠ‚ç ã€‚ Dalvik VM æ¯” JVM é€Ÿåº¦æ›´å¿«ï¼Œå ç”¨ç©ºé—´æ›´å°‘ã€‚ é€šè¿‡ Dalvik çš„å­—èŠ‚ç æˆ‘ä»¬ä¸èƒ½ç›´æ¥çœ‹åˆ°åŸæ¥çš„é€»è¾‘ä»£ç ï¼Œè¿™æ—¶éœ€è¦å€ŸåŠ©å¦‚ Apktool æˆ– dex2jar+jd-gui å·¥å…·æ¥å¸®åŠ©æŸ¥çœ‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æœ€ç»ˆä¿®æ”¹ APK éœ€è¦æ“ä½œçš„æ–‡ä»¶æ˜¯ .smali æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¯¼å‡ºæ¥çš„ Java æ–‡ä»¶é‡æ–°ç¼–è¯‘ã€‚ 4. Smaliï¼ˆç ´è§£çš„é‡ç‚¹ã€‚å¥½å§è¿˜æ˜¯é‡ç‚¹ï¼‰1ï¼‰Smaliï¼ŒBaksmaliåˆ†åˆ«æ˜¯æŒ‡å®‰å“ç³»ç»Ÿé‡Œçš„ Java è™šæ‹Ÿæœºï¼ˆDalvikï¼‰æ‰€ä½¿ç”¨çš„ä¸€ç§ dex æ ¼å¼æ–‡ä»¶çš„æ±‡ç¼–å™¨ï¼Œåæ±‡ç¼–å™¨ã€‚å…¶è¯­æ³•æ˜¯ä¸€ç§å®½æ¾å¼çš„ Jasmin/dedexer è¯­æ³•ï¼Œè€Œä¸”å®ƒå®ç°äº† .dex æ ¼å¼æ‰€æœ‰åŠŸèƒ½ï¼ˆæ³¨è§£ï¼Œè°ƒè¯•ä¿¡æ¯ï¼Œçº¿è·¯ä¿¡æ¯ç­‰ï¼‰ å½“æˆ‘ä»¬å¯¹ APK æ–‡ä»¶è¿›è¡Œåç¼–è¯‘åï¼Œä¾¿ä¼šç”Ÿæˆæ­¤ç±»æ–‡ä»¶ã€‚åœ¨Davlikå­—èŠ‚ç ä¸­ï¼Œå¯„å­˜å™¨éƒ½æ˜¯32ä½çš„ï¼Œèƒ½å¤Ÿæ”¯æŒä»»ä½•ç±»å‹ï¼Œ64ä½ç±»ï¼ˆLong/Doubleï¼‰ç”¨2ä¸ªå¯„å­˜å™¨è¡¨ç¤ºï¼›Dalvikå­—èŠ‚ç æœ‰ä¸¤ç§ç±»å‹ï¼šåŸå§‹ç±»å‹ï¼›å¼•ç”¨ç±»å‹ï¼ˆåŒ…æ‹¬å¯¹è±¡å’Œæ•°ç»„ï¼‰ 2ï¼‰åŸå§‹ç±»å‹ï¼šBâ€”byte Câ€”char Dâ€”double Fâ€”float Iâ€”int Jâ€”long Sâ€”short Vâ€”void Zâ€”boolean [XXXâ€”array Lxxx/yyyâ€”object è¿™é‡Œè§£æä¸‹æœ€åä¸¤é¡¹ï¼Œæ•°ç»„çš„è¡¨ç¤ºæ–¹å¼æ˜¯ï¼šåœ¨åŸºæœ¬ç±»å‹å‰åŠ ä¸Šå‰ä¸­æ‹¬å·â€œ[â€ï¼Œä¾‹å¦‚ int æ•°ç»„å’Œ float æ•°ç»„åˆ†åˆ«è¡¨ç¤ºä¸ºï¼š[Iã€[Fï¼› å¯¹è±¡çš„è¡¨ç¤ºåˆ™ä»¥ L ä½œä¸ºå¼€å¤´ï¼Œæ ¼å¼æ˜¯ LpackageName/objectName;ï¼ˆæ³¨æ„å¿…é¡»æœ‰ä¸ªåˆ†å·è·Ÿåœ¨æœ€åï¼‰ï¼Œä¾‹å¦‚ String å¯¹è±¡åœ¨ smali ä¸­ä¸ºï¼šLjava/lang/String;å…¶ä¸­ java/lang å¯¹åº” java.langåŒ…ï¼ŒString å°±æ˜¯å®šä¹‰åœ¨è¯¥åŒ…ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚ å†…éƒ¨ç±»åˆå¦‚ä½•åœ¨ smali ä¸­ï¼šLpackageName/objectName$subObjectName;ä¹Ÿå°±æ˜¯åœ¨å†…éƒ¨ç±»å‰åŠ â€œ$â€ç¬¦å·ã€‚ 3ï¼‰æ–¹æ³•çš„å®šä¹‰Func-Name (Para-Type1Para-Type2Para-Type3â€¦)Return-Typeæ³¨æ„å‚æ•°ä¸å‚æ•°ä¹‹é—´æ²¡æœ‰ä»»ä½•åˆ†éš”ç¬¦ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š A ()V è¿™å°±æ˜¯void A()ã€‚ B (II)Z è¿™ä¸ªåˆ™æ˜¯boolean B(int, int)ã€‚ C (Z[I[ILjava/lang/String;J)Ljava/lang/String; è¿™æ˜¯String C (boolean, int[], int[], String, long) ã€‚ 4ï¼‰SmaliåŸºæœ¬è¯­æ³•.field private isFlag:z å®šä¹‰å˜é‡ .method æ–¹æ³• .parameter æ–¹æ³•å‚æ•° .prologue æ–¹æ³•å¼€å§‹ .line 123 æ­¤æ–¹æ³•ä½äºç¬¬123è¡Œ invoke-super è°ƒç”¨çˆ¶å‡½æ•° const/high16 v0, 0x7fo3 æŠŠ0x7fo3èµ‹å€¼ç»™v0 invoke-direct è°ƒç”¨å‡½æ•° return-void å‡½æ•°è¿”å›void .end method å‡½æ•°ç»“æŸ new-instance åˆ›å»ºå®ä¾‹ iput-object å¯¹è±¡èµ‹å€¼ iget-object è°ƒç”¨å¯¹è±¡ invoke-static è°ƒç”¨é™æ€å‡½æ•° 5ï¼‰æ¡ä»¶è·³è½¬åˆ†æ”¯â€œif-eq vA, vB, :cond**â€ å¦‚æœvAç­‰äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-ne vA, vB, :cond**â€ å¦‚æœvAä¸ç­‰äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-lt vA, vB, :cond**â€ å¦‚æœvAå°äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-ge vA, vB, :cond**â€ å¦‚æœvAå¤§äºç­‰äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-gt vA, vB, :cond**â€ å¦‚æœvAå¤§äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-le vA, vB, :cond**â€ å¦‚æœvAå°äºç­‰äºvBåˆ™è·³è½¬åˆ°:cond** â€œif-eqz vA, :cond**â€ å¦‚æœvAç­‰äº0åˆ™è·³è½¬åˆ°:cond** â€œif-nez vA, :cond**â€ å¦‚æœvAä¸ç­‰äº0åˆ™è·³è½¬åˆ°:cond** â€œif-ltz vA, :cond**â€ å¦‚æœvAå°äº0åˆ™è·³è½¬åˆ°:cond** â€œif-gez vA, :cond**â€ å¦‚æœvAå¤§äºç­‰äº0åˆ™è·³è½¬åˆ°:cond** â€œif-gtz vA, :cond**â€ å¦‚æœvAå¤§äº0åˆ™è·³è½¬åˆ°:cond** â€œif-lez vA, :cond**â€ å¦‚æœvAå°äºç­‰äº0åˆ™è·³è½¬åˆ°:cond** äºŒ.Smali æ–‡ä»¶1. Smaliä¸­çš„åŒ…ä¿¡æ¯.class public Lcom/aaaaa; ï¼ˆå®ƒæ˜¯com.aaaaaè¿™ä¸ªpackageä¸‹çš„ä¸€ä¸ªç±»ï¼‰ .super Lcom/bbbbb; ï¼ˆç»§æ‰¿è‡ªcom.bbbbbè¿™ä¸ªç±»ï¼‰ .source â€œccccc.javaâ€ ï¼ˆä¸€ä¸ªç”±ccccc.javaç¼–è¯‘å¾—åˆ°çš„smaliæ–‡ä»¶ï¼‰ 2. Smaliä¸­çš„å£°æ˜1234567#annotations.annotation system Ldalvik/annotation/MemberClasses;value = &#123;Lcom/aaa$qqq;,Lcom/aaa$www;&#125;.end annotation //è¿™ä¸ªå£°æ˜æ˜¯å†…éƒ¨ç±»çš„å£°æ˜ï¼šaaaè¿™ä¸ªç±»å®ƒæœ‰ä¸¤ä¸ªæˆå‘˜å†…éƒ¨ç±»â€”â€”qqqå’Œwwwï¼Œå†…éƒ¨ç±»å°†åœ¨åé¢å°èŠ‚ä¸­ä¼šæœ‰æåŠã€‚ 3.å…³äºå¯„å­˜å™¨å¯„å­˜å™¨æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿåœ¨ smali é‡Œçš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»ç»è¿‡å¯„å­˜å™¨æ¥è¿›è¡Œï¼šæœ¬åœ°å¯„å­˜å™¨ç”¨ v å¼€å¤´ï¼Œæ•°å­—ç»“å°¾çš„ç¬¦å·æ¥è¡¨ç¤ºï¼Œå¦‚v0ã€v1ã€v2ã€â€¦ å‚æ•°å¯„å­˜å™¨åˆ™ä½¿ç”¨ p å¼€å¤´ï¼Œæ•°å­—ç»“å°¾çš„ç¬¦å·æ¥è¡¨ç¤ºï¼Œå¦‚p0ã€p1ã€p2ã€â€¦ ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œp0 ä¸ä¸€å®šæ˜¯å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåœ¨é static å‡½æ•°ä¸­ï¼Œp0 ä»£æŒ‡â€œthisâ€ï¼Œp1 è¡¨ç¤ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œp2 ä»£è¡¨å‡½æ•°ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ è€Œåœ¨ static å‡½æ•°ä¸­ p0 æ‰å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå› ä¸º Java çš„ static æ–¹æ³•ä¸­æ²¡æœ‰ this æ–¹æ³•ã€‚ 4. å¯„å­˜å™¨ç®€å•å®ä¾‹åˆ†æconst/4 v0, 0x1 iput-boolean v0, p0, Lcom/aaa;-&gt;IsRegistered:Z æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä¸¤å¥ smali ä»£ç ï¼Œé¦–å…ˆå®ƒä½¿ç”¨äº† v0 æœ¬åœ°å¯„å­˜å™¨ï¼Œå¹¶æŠŠå€¼ 0x1 å­˜åˆ° v0 ä¸­ï¼Œç„¶åç¬¬äºŒå¥ç”¨ iput-boolean è¿™ä¸ªæŒ‡ä»¤æŠŠ v0 ä¸­çš„å€¼å­˜æ”¾åˆ° com.aaa.IsRegistered è¿™ä¸ªæˆå‘˜å˜é‡ä¸­ã€‚ å³ç›¸å½“äºï¼šthis.IsRegistered= true;ï¼ˆä¸Šé¢è¯´è¿‡ï¼Œåœ¨éstaticå‡½æ•°ä¸­p0ä»£è¡¨çš„æ˜¯â€œthisâ€ï¼Œåœ¨è¿™é‡Œå°±æ˜¯com.aaa å®ä¾‹ï¼‰ã€‚ ## 5. Smaliä¸­çš„æˆå‘˜å˜é‡æˆå‘˜å˜é‡æ ¼å¼æ˜¯ï¼š.field public/private [static] [final] varName:&lt;ç±»å‹&gt;ã€‚ å¯¹äºä¸åŒçš„æˆå‘˜å˜é‡ä¹Ÿæœ‰ä¸åŒçš„æŒ‡ä»¤ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè·å–çš„æŒ‡ä»¤æœ‰ï¼šigetã€sgetã€iget-booleanã€sget-booleanã€iget-objectã€sget-objectç­‰ã€‚ æ“ä½œçš„æŒ‡ä»¤æœ‰ï¼šiputã€sputã€iput-booleanã€sput-booleanã€iput-objectã€sput-objectç­‰ã€‚ æ²¡æœ‰â€œ-objectâ€åç¼€çš„è¡¨ç¤ºæ“ä½œçš„æˆå‘˜å˜é‡å¯¹è±¡æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¸¦â€œ-objectâ€è¡¨ç¤ºæ“ä½œçš„æˆå‘˜å˜é‡æ˜¯å¯¹è±¡ç±» å‹ï¼Œç‰¹åˆ«åœ°ï¼Œboolean ç±»å‹åˆ™ä½¿ç”¨å¸¦â€œ-booleanâ€çš„æŒ‡ä»¤æ“ä½œã€‚ 6. Smaliæˆå‘˜å˜é‡æŒ‡ä»¤ç®€æ1) ç®€æä¸€sget-object v0, Lcom/aaa;-&gt;ID:Ljava/lang/String; sget-objectå°±æ˜¯ç”¨æ¥è·å–å˜é‡å€¼å¹¶ä¿å­˜åˆ°ç´§æ¥ç€çš„å‚æ•°çš„å¯„å­˜å™¨ä¸­ï¼Œæœ¬ä¾‹ä¸­ï¼Œå®ƒè·å–IDè¿™ä¸ªStringç±»å‹çš„æˆå‘˜å˜é‡å¹¶æ”¾åˆ°v0è¿™ä¸ªå¯„å™¨ä¸­ã€‚ æ³¨æ„ï¼šå‰é¢éœ€è¦è¯¥å˜é‡æ‰€å±çš„ç±»çš„ç±»å‹ï¼Œåé¢éœ€è¦åŠ ä¸€ä¸ªå†’å·å’Œè¯¥æˆå‘˜å˜é‡çš„ç±»å‹ï¼Œä¸­é—´æ˜¯â€œ-&gt;â€è¡¨ç¤ºæ‰€å±å…³ç³»ã€‚ 2) ç®€æäºŒiget-object v0, p0, Lcom/aaa;-&gt;view:Lcom/aaa/view; å¯ä»¥çœ‹åˆ°iget-objectæŒ‡ä»¤æ¯”sget-objectå¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯è¯¥å˜é‡æ‰€åœ¨ç±»çš„å®ä¾‹ï¼Œåœ¨è¿™é‡Œå°±æ˜¯p0å³â€œthisâ€ã€‚ è·å–arrayçš„è¯æˆ‘ä»¬ç”¨agetå’Œaget-objectï¼ŒæŒ‡ä»¤ä½¿ç”¨å’Œä¸Šè¿°ä¸€è‡´ 3) ç®€æä¸‰ï¼ˆputæŒ‡ä»¤çš„ä½¿ç”¨å’ŒgetæŒ‡ä»¤æ˜¯ç»Ÿä¸€çš„ï¼‰12const/4 v3, 0x0sput-object v3, Lcom/aaa;-&gt;timer:Lcom/aaa/timer; ç›¸å½“äºï¼šthis.timer= null; æ³¨æ„ï¼Œè¿™é‡Œå› ä¸ºæ˜¯èµ‹å€¼object æ‰€ä»¥æ˜¯null 4) ç®€æå››123.local v0, args:Landroid/os/Message;const/4 v1, 0x12iput v1, v0, Landroid/os/Message;-&gt;what:I ç›¸å½“äºï¼šargs.what = 18;ï¼ˆargs æ˜¯ Message çš„å®ä¾‹ï¼‰ ä¸‰.Smaliå‡½æ•°åˆ†æ1. Smaliä¸­å‡½æ•°çš„è°ƒç”¨1ï¼‰smaliä¸­çš„å‡½æ•°å’Œæˆå‘˜å˜é‡ä¸€æ ·ä¹Ÿåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«ä¸ºdirectå’Œvirtualä¹‹åˆ†ã€‚direct methodå’Œvirtualmethodçš„åŒºåˆ«ï¼šç®€å•æ¥è¯´ï¼Œdirect method å°±æ˜¯ private å‡½æ•°ï¼Œå…¶ä½™çš„ public å’Œ protected å‡½æ•°éƒ½å±äº virtual methodã€‚ æ‰€ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œæœ‰invoke-directï¼Œinvoke-virtualï¼Œå¦å¤–è¿˜æœ‰invoke-staticã€invoke-superä»¥åŠinvokeinterfaceç­‰å‡ ç§ä¸åŒçš„æŒ‡ä»¤ã€‚å½“ç„¶å…¶å®è¿˜æœ‰invoke-XXX/range æŒ‡ä»¤çš„ï¼Œè¿™æ˜¯å‚æ•°å¤šäº4ä¸ªçš„æ—¶å€™è°ƒç”¨çš„æŒ‡ä»¤ã€‚ 2ï¼‰invoke-staticï¼šç”¨äºè°ƒç”¨staticå‡½æ•°ï¼Œä¾‹å¦‚ï¼š1invoke-static &#123;&#125;, Lcom/aaa;-&gt;CheckSignature()Z è¿™é‡Œæ³¨æ„åˆ° invoke-static åé¢æœ‰ä¸€å¯¹å¤§æ‹¬å·â€œ{}â€ï¼Œå…¶å®æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹+å‚æ•°åˆ—è¡¨ï¼Œç”±äºè¿™ä¸ªæ–¹æ³•æ—¢ä¸éœ€å‚æ•°ä¹Ÿæ˜¯staticçš„ï¼Œæ‰€ä»¥{}å†…ä¸ºç©º å†çœ‹ä¸€ä¸ªï¼š12const-string v0, \"NDKLIB\"invoke-static &#123;v0&#125;, Ljava/lang/System;-&gt;loadLibrary(Ljava/lang/String;)V è¿™ä¸ªæ˜¯è°ƒç”¨ static void System.loadLibrary(String) æ¥åŠ è½½ NDK ç¼–è¯‘çš„ so åº“ç”¨çš„æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¿™é‡Œ v0 å°±æ˜¯å‚æ•°â€NDKLIBâ€äº†ã€‚ 3ï¼‰invoke-superï¼šè°ƒç”¨çˆ¶ç±»æ–¹æ³•ç”¨çš„æŒ‡ä»¤ï¼Œä¸€èˆ¬ç”¨äºè°ƒç”¨onCreateã€onDestroyç­‰æ–¹æ³•ã€‚ 4ï¼‰invoke-directï¼šè°ƒç”¨privateå‡½æ•°ï¼š1invoke-direct &#123;p0&#125;, Landroid/app/TabActivity;-&gt;()V è¿™é‡Œinit()å°±æ˜¯å®šä¹‰åœ¨TabActivityä¸­çš„ä¸€ä¸ªprivateå‡½æ•° 5ï¼‰invoke-virtualï¼šç”¨äºè°ƒç”¨ protected æˆ– public å‡½æ•°ï¼ŒåŒæ ·æ³¨æ„ä¿®æ”¹smaliæ—¶ä¸è¦é”™ç”¨ invoke-directæˆ– invoke-staticï¼š12sget-object v0, Lcom/dddd;-&gt;bbb:Lcom/ccc;invoke-virtual &#123;v0, v1&#125;, Lcom/ccc;-&gt;Messages(Ljava/lang/Object;)V v0æ˜¯bbb:Lcom/ccc v1æ˜¯ä¼ é€’ç»™Messagesæ–¹æ³•çš„Ljava/lang/Objectå‚æ•°ã€‚ 6ï¼‰invoke-xxxxx/rangeï¼šå½“æ–¹æ³•çš„å‚æ•°å¤šäº5ä¸ªæ—¶ï¼ˆå«5ä¸ªï¼‰ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ä»¥ä¸Šçš„æŒ‡ä»¤ï¼Œè€Œæ˜¯åœ¨åé¢åŠ ä¸Šâ€œ/rangeâ€ï¼Œrangeè¡¨ç¤ºèŒƒå›´ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿæœ‰æ‰€ä¸åŒï¼š12invoke-direct/range &#123;v0 .. v5&#125;, Lcmb/pb/ui/PBContainerActivity;-&gt;h(ILjava/lang/CharSequence;Ljava/lang/String;Landroid/content/ éœ€è¦ä¼ é€’v0åˆ°v5ä¸€å…±6ä¸ªå‚æ•°ï¼Œè¿™æ—¶å€™å¤§æ‹¬å·å†…çš„å‚æ•°é‡‡ç”¨çœç•¥å½¢å¼ï¼Œä¸”éœ€è¦è¿ç»­ã€‚ 2. Smaliä¸­å‡½æ•°è¿”å›ç»“æœæ“ä½œåœ¨Javaä»£ç ä¸­è°ƒç”¨å‡½æ•°å’Œè¿”å›å‡½æ•°ç»“æœå¯ä»¥ç”¨ä¸€æ¡è¯­å¥å®Œæˆï¼Œè€Œåœ¨Smalié‡Œåˆ™éœ€è¦åˆ†å¼€æ¥å®Œæˆï¼Œåœ¨ä½¿ç”¨ä¸Šè¿°æŒ‡ä»¤åï¼Œå¦‚æœè°ƒç”¨çš„å‡½æ•°è¿”å›évoidï¼Œé‚£ä¹ˆè¿˜éœ€è¦ç”¨åˆ°move-resultï¼ˆè¿”å›åŸºæœ¬æ•°æ®ç±»å‹ï¼‰å’Œmove-result-objectï¼ˆè¿”å›å¯¹è±¡ï¼‰æŒ‡ä»¤ï¼š123const-string v0, \"Eric\"invoke-static &#123;v0&#125;, Lcmb/pbi;-&gt;t(Ljava/lang/String;)Ljava/lang/String;move-result-object v2 v2ä¿å­˜çš„å°±æ˜¯è°ƒç”¨tæ–¹æ³•è¿”å›çš„Stringå­—ç¬¦ä¸²ã€‚ 3. Smaliä¸­å‡½æ•°å®ä½“åˆ†æâ€“ifå‡½æ•°åˆ†æ12345678910111213.method private ifRegistered()Z.locals 2 //åœ¨è¿™ä¸ªå‡½æ•°ä¸­æœ¬åœ°å¯„å­˜å™¨çš„ä¸ªæ•°.prologueconst/4 v0, 0x1 // v0èµ‹å€¼ä¸º1.local v0, tempFlag:Zif-eqz v0, :cond0 // åˆ¤æ–­v0æ˜¯å¦ç­‰äº0ï¼Œç­‰äº0åˆ™è·³åˆ°cond0æ‰§è¡Œconst/4 v1, 0x1 // ç¬¦åˆæ¡ä»¶åˆ†æ”¯:goto_0 //æ ‡ç­¾return v1 //è¿”å›v1çš„å€¼:cond_0 //æ ‡ç­¾const/4 v1, 0x0 // cond_0åˆ†æ”¯goto :goto0 //è·³åˆ°goto0æ‰§è¡Œ å³è¿”å›v1çš„å€¼ è¿™é‡Œå¯ä»¥æ”¹æˆreturn v1 ä¹Ÿæ˜¯ä¸€æ ·çš„.end method","tags":[{"name":"Androidé€†å‘åŸºç¡€","slug":"Androidé€†å‘åŸºç¡€","permalink":"http://sorgs.cn/tags/Androidé€†å‘åŸºç¡€/"}]},{"title":"Android æœ€æœ€æœ€ç®€å•çš„æµè§ˆå™¨ä»£ç ","date":"2016-11-16T08:09:07.000Z","path":"post/12244/","text":"å­¦äº†WebViewä¹‹åï¼Œå¿ƒè¡€æ¥æ½®ï¼Œå†™äº†è¿™ä¸ªç®€æ˜“çš„æµè§ˆå™¨ã€‚è™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯ä¹ŸæŸ¥äº†ä¸å°‘æ²¡å­¦åˆ°ä¸œè¥¿ã€‚å¤§ç¥å°±å¿½ç•¥å§ã€‚è¿™é‡Œåˆ†äº«å‡ºæ¥ï¼Œç»™éœ€è¦çš„äººå‚è€ƒå‚è€ƒã€‚ é¦–å…ˆæ˜¯æˆ‘ä»¬çš„xml123456789101112131415161718192021222324252627282930313233343536373839&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\" android:background=\"#F5F5DC\" android:orientation=\"vertical\"&gt; &lt;LinearLayout android:layout_width=\"wrap_content\" android:orientation=\"horizontal\" android:layout_height=\"wrap_content\"&gt; &lt;EditText android:id=\"@+id/text\" android:autoText=\"true\" android:singleLine=\"true\" android:selectAllOnFocus=\"true\" android:layout_marginTop=\"20dp\" android:layout_width=\"300dp\" android:layout_height=\"40dp\" android:textColor=\"#FFA500\" android:hint=\"@string/url\" android:layout_gravity=\"left|top\"/&gt; &lt;Button android:id=\"@+id/button\" android:layout_marginTop=\"20dp\" android:layout_width=\"60dp\" android:layout_height=\"40dp\" android:text=\"@string/next\" android:textColor=\"#FAEBD7\" android:layout_gravity=\"right|top\" /&gt; &lt;/LinearLayout&gt; &lt;WebView android:id=\"@+id/webview\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"/&gt; &lt;/LinearLayout&gt; ä»£ç ç®€å•ï¼Œå°±æ˜¯LinearLayoué‡Œé¢å†å¥—ä¸€ä¸ªLinearLayouï¼ŒåŠ ä¸Šä¸€ä¸ªedittextå’Œbuttonã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªWebViewã€‚edittexté‡Œé¢æœ‰äº›å±æ€§è™½ç„¶æˆ‘å†™äº†ï¼Œä½†æ˜¯æ²¡æ„Ÿè§‰å‡ºæ¥ç”¨å¤„ã€‚android:autoText=â€trueâ€ã€‚è‡ªåŠ¨è¡¥å…¨ï¼Œæˆ‘æ„Ÿè§‰æ²¡æœ‰ç”¨å¤„ã€‚android:singleLine=â€trueâ€è¿™ä¸ªå‘¢å°±æ˜¯å•è¡Œæ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº›ç½‘å€å¾ˆé•¿ï¼Œæˆ‘ä»¬åªæ˜¾ç¤ºä¸€è¡Œå°±è¡Œäº†ã€‚è¿™ä¸ªä¸ºåé¢çš„å®æ—¶æ˜¾ç¤ºç½‘å€æœ‰ç”¨çš„ã€‚android:selectAllOnFocus=â€trueâ€è¿™ä¸ªå‘¢å°±æ˜¯è·å–ç„¦ç‚¹ï¼Œä¾¿äºåé¢ç‚¹edittextå¯ä»¥å…¨é€‰ã€‚ æœ€åæ˜¯é‡ç‚¹å•¦ï¼Œçœ‹çœ‹Javaçš„ä»£ç ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package com.sorgs.administrator.webview; import android.app.Activity; import android.app.ProgressDialog; import android.os.Bundle; import android.view.KeyEvent; import android.view.View; import android.webkit.WebChromeClient; import android.webkit.WebSettings; import android.webkit.WebView; import android.webkit.WebViewClient; import android.widget.Button; import android.widget.EditText; import android.widget.Toast; public class MainActivity extends Activity &#123; private String url = null; private WebView webView; private ProgressDialog dialog; private EditText text; private Button button; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Toast.makeText(this,\"æ¬¢è¿ä½¿ç”¨ç®€æ˜“æµè§ˆå™¨_by sorgs\",Toast.LENGTH_SHORT).show(); //å¼¹å‡ºæ¬¢è¿ init(); &#125; private void init() &#123; webView = (WebView) findViewById(R.id.webview); text = (EditText) findViewById(R.id.text); button = (Button) findViewById(R.id.button); webView.loadUrl(url); button.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; String str = text.getText().toString(); //å»è·å–textä¸­è¾“å…¥çš„ç½‘å€ url = \"http://\"+ str; webView.loadUrl(url); //è®¾ç½®åˆ°webViewä¸­å» &#125; &#125;); //è¦†ç›–WebViewé»˜è®¤é€šè¿‡ç¬¬ä¸‰æ–¹æˆ–è€…æ˜¯ç³»ç»Ÿæµè§ˆå™¨æ‰“å¼€ç½‘é¡µçš„è¡Œä¸ºï¼Œä½¿ç½‘é¡µå¯ä»¥å†WebViewä¸­æ‰“å¼€ webView.setWebViewClient(new WebViewClient() &#123; @Override public boolean shouldOverrideUrlLoading(WebView view, String url) &#123; //è¿”å›å€¼æ˜¯trueçš„æ—¶å€™æ§åˆ¶ç½‘é¡µåœ¨WebViewä¸­å»æ‰“å¼€ï¼Œå¦‚æœä¸ºfalseè°ƒç”¨ç³»ç»Ÿæµè§ˆå™¨æˆ–è€…ç¬¬ä¸‰æ–¹æµè§ˆå™¨æ‰“å¼€ view.loadUrl(url); return true; &#125;//WebViewClientå¸®åŠ©WebViewå»å¤„ç†ä¸€äº›é¡µé¢æ§åˆ¶å’Œè¯·æ±‚é€šçŸ¥ &#125;); //å¯ç”¨æ”¯æŒjavaScript WebSettings settings = webView.getSettings(); settings.setJavaScriptEnabled(true); //WebViewåŠ è½½é¡µé¢ä¼˜å…ˆä½¿ç”¨ç¼“å­˜åŠ è½½ settings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); webView.setWebChromeClient(new WebChromeClient() &#123; @Override public void onProgressChanged(WebView view, int newProgress) &#123; //newProgress 1-100ä¹‹é—´çš„æ•´æ•° if (newProgress == 100) &#123; //ç½‘é¡µåŠ è½½å®Œæ¯•,å…³é—­ProgressDialog closeDialo(); &#125; else &#123; //ç½‘é¡µæ­£åœ¨åŠ è½½ï¼Œæ‰“å¼€ProgressDialog openDialog(newProgress); text.setText(webView.getUrl()); //å®æ—¶æ˜¾ç¤ºå½“å‰ç½‘å€ text.requestFocus(); //æŠŠè¾“å…¥ç„¦ç‚¹æ”¾åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ§ä»¶ä¸Š text.setSelectAllOnFocus(true); //ç‚¹å‡»ä¹‹åå°±è¢«å…¨é€‰ &#125; &#125; private void closeDialo() &#123; if (dialog != null &amp;&amp; dialog.isShowing()) &#123; dialog.dismiss(); dialog = null; &#125; &#125; private void openDialog(int newProgress) &#123; if (dialog == null) &#123; dialog = new ProgressDialog(MainActivity.this); dialog.setTitle(\"åŠ è½½ä¸­...\"); dialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL); dialog.setProgress(newProgress); dialog.show(); &#125; else &#123; dialog.setProgress(newProgress); &#125; &#125; &#125;); &#125; @Override //æ”¹å†™ç‰©ç†æŒ‰é”®â€”â€”è¿”å›çš„é€»è¾‘ public boolean onKeyDown(int keyCode, KeyEvent event) &#123; if(keyCode == KeyEvent.KEYCODE_BACK)&#123; if(webView.canGoBack())&#123; webView.goBack(); //è¿”å›ä¸Šä¸€é¡µé¢ return true; &#125;else &#123; System.exit(0); &#125; &#125; return super.onKeyDown(keyCode,event); &#125; &#125; ä»£ç ä¸­å‘¢å¾ˆå¤šæ³¨é‡Šå†™çš„å¾ˆè¯¦ç»†äº†ã€‚è¿™ä¸ªå°±ä¸åœ¨èµ˜è¿°äº†ã€‚ æœ€åæ¥å‡ å¼ æ•ˆæœå›¾å¥½å•¦ã€‚","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"è‡ªå·±ç¬¬ä¸€ä¸ªAndroidä½œå“ï¼ŒAndroidè®¡ç®—å™¨","date":"2016-11-16T00:40:48.000Z","path":"post/37302/","text":"å†™æ­¤æ—¶ä¸ºäº†è®°å½•è‡ªå·±çš„å¼€å‘å†ç¨‹ï¼Œæ–¹ä¾¿ä»¥åçš„æŸ¥è¯¢ã€‚äºŒåˆ™è¿ç®—ï¼ˆèƒ½åŠ›æœ‰é™ï¼Œä¹Ÿæ²¡æœ‰æƒ³å¾€æ›´æ·±å¤„å†™ï¼‰ï¼Œèœé¸Ÿçº§åˆ«ï¼Œä»£ç ä¸ºå‚è€ƒæ…•è¯¾ç½‘ä¸Šï¼Œå¬è¯¾ä»£ç ï¼Œå¹¶åŠ ä¸Šè‡ªå·±çš„ç†è§£å’Œå‚è€ƒçš„ä¸€äº›åšå®¢ï¼æœ‰é—®é¢˜çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ï¼Œæ„Ÿæ¿€ä¸å°½ï¼å¼€å‘å·¥å…·ä¸ºAndroid studioã€‚ï¼ˆç¬¬ä¸€æ¬¡å†™åšå®¢ï¼Œå¯è¯»æ€§ä¼°è®¡å¾ˆå·®ï¼‰ åºŸè¯ä¸å¤šè¯´ï¼Œä»£ç è½®ä¸Šæ¥ï¼ˆé¡ºåºæŒ‰æ…•è¯¾è€å¸ˆè®²è§£é¡ºåºï¼‰ 1.å…ˆæ˜¯xmlï¼ˆUIå§ï¼‰&#160;&#160;æ•ˆæœå›¾ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291&lt;EditText android:layout_width=\"fill_parent\" android:layout_marginTop=\"20dp\" android:layout_height=\"70dip\" android:id=\"@+id/et_input\" android:background=\"@color/white\" android:editable=\"false\" android:gravity=\"right|bottom\" /&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"20dp\" android:orientation=\"horizontal\" android:gravity=\"center_horizontal\" &gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"C\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_clear\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"DEL\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_del\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"Ã·\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_divide\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"Ã—\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_multiply\" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"10dp\" android:orientation=\"horizontal\" android:gravity=\"center_horizontal\" &gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"7\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_7\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"8\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_8\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"9\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_9\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"-\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_minus\" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:layout_marginTop=\"10dp\" android:orientation=\"horizontal\" android:gravity=\"center_horizontal\" &gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"4\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_4\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"5\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_5\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"6\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_6\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"+\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:layout_marginLeft=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_plus\" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\" android:gravity=\"center_horizontal\" android:layout_marginTop=\"10dp\"&gt; &lt;LinearLayout android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:orientation=\"vertical\"&gt; &lt;LinearLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\"&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"1\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_1\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"2\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:layout_marginLeft=\"10dp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_2\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\"3\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:layout_marginLeft=\"10dp\" android:id=\"@+id/btn_3\" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\" android:layout_marginTop=\"10dp\"&gt; &lt;Button android:layout_width=\"150dp\" android:layout_height=\"70dp\" android:text=\"0\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_0\" /&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"70dp\" android:text=\".\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:background=\"@drawable/white_select\" android:textSize=\"20sp\" android:layout_marginLeft=\"10dp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_point\" /&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; &lt;Button android:layout_width=\"70dp\" android:layout_height=\"150dp\" android:text=\"=\" android:background=\"@drawable/orange_select\" android:layout_marginLeft=\"10dp\" android:paddingRight=\"10dp\" android:paddingBottom=\"10dp\" android:textSize=\"20sp\" android:gravity=\"right|bottom\" android:id=\"@+id/btn_equal\"/&gt; &lt;/LinearLayout&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_gravity=\"bottom|center\" android:editable=\"false\" android:text=\"èƒ½åŠ›æœ‰é™ï¼Œåªèƒ½è¿›è¡ŒäºŒåˆ™è¿ç®—â€”â€”by sorgs\" android:textSize=\"16dp\" android:textColor=\"@color/black\" android:layout_marginTop=\"30dp\" android:background=\"@color/sandybrown\" android:id=\"@+id/textureView\" /&gt; xmlé‡Œé¢æ³¨é‡Šä¸å¤šï¼Œæƒ³å¿…ä¹Ÿä¸éœ€å¤ªå¤šè§£é‡Šï¼Œéƒ½æ˜¯å¾ˆç®€å•å¸ƒå±€å’Œæ§ä»¶ã€‚å…¶ä¸­æœ‰ä¸ªèƒŒæ™¯é¢œè‰²çš„é—®é¢˜éœ€è¦è¯¦ç»†è¯´æ˜ 1.å­˜æ”¾é¢œè‰² é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨value/ä¸‹æ·»åŠ ä¸€ä¸ªcolors.xmlæ–‡ä»¶ç”¨æ¥å­˜æ”¾æˆ‘ä»¬éœ€è¦çš„é¢œè‰²ä¸ç„¶ä½ å…¨ç”¨#xxxxxxå¾—å¤šç´¯ï¼Œè€Œä¸”è¿˜ä¸è¿˜ç”¨é¢œè‰²ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç™¾åº¦ï¼Œæœ‰é…å¥½çš„é¢œè‰²çš„ä»£ç ã€‚æˆ‘ä»¬ç›´æ¥å¤åˆ¶åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œç„¶åå¼•ç”¨ã€‚ å»ºç«‹xmlä¸ºäº†åœ¨æ–¹ä¾¿æˆ‘ä»¬å¸ƒå±€å’Œé¢œè‰²çš„æ­é…ï¼Œä¹Ÿæ˜¯åœ¨æ…•è¯¾è€å¸ˆé‚£é‡Œå­¦äº†ä¸€æ‹›ã€‚å¯ä»¥åœ¨res/drawableä¸‹é¢å»ºç«‹xmlã€‚ æˆ‘ä»¬æ¥ä¾æ¬¡çœ‹çœ‹è¿™äº›æ–‡ä»¶éƒ½æ˜¯æ€ä¹ˆåšçš„ã€‚ ###ï¼ˆ1ï¼‰.ashend_bg.xmlï¼ˆå‡ ä¸ª_bgéƒ½æ˜¯é¢œè‰²ä¸ä¸€æ ·ï¼Œæ„ä¹‰å·®ä¸å¤šï¼‰ç›®çš„æ˜¯æä¾›èƒŒæ™¯é¢œè‰²ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä¸è¦é¢œè‰²ã€‚ç›´æ¥åœ¨xmlä¸­æ·»åŠ é¢œè‰²ï¼Œè¿™ä¸ªä¸»è¦æ˜¯æä¾›åœ†è§’ 12345&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;corners android:radius=\"5dp\"/&gt; &lt;solid android:color=\"@color/beige\" /&gt; &lt;/shape&gt; æ­¤å¤„ä½¿ç”¨shapeã€‚ï¼ˆè¿™é‡Œæœ‰æ›´åŠ å®Œç¾çš„è§£é‡Š http://www.cnblogs.com/cyanfei/archive/2012/07/27/2612023.htmlï¼‰ ï¼ˆ2ï¼‰.orange_select.xmlï¼ˆselectä¹Ÿæ˜¯é¢œè‰²ä¸ä¸€æ ·ï¼Œå†…å®¹å·®ä¸å¤šï¼‰ç›®çš„æ˜¯ä¸ºäº†æŒ‰é’®æä¾›é¢œè‰²å’Œç‚¹å‡»æ—¶ä¼šæœ‰å¦å¤–ä¸€ç§é¢œè‰² 12345678&lt;span style=\"font-size:18px;\"&gt;&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;selector xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt; &lt;item android:drawable=\"@drawable/ashend_bg\" android:state_pressed=\"true\"/&gt; &lt;item android:drawable=\"@drawable/orange_bg\"/&gt; &lt;/selector&gt;&lt;/span&gt; æ­¤å¤„ä½¿ç”¨selectï¼ˆè¯¦ç»†ç”¨æ³•è¯·å‚è€ƒhttp://blog.csdn.net/shakespeare001/article/details/7788400/ï¼‰ 2.ç„¶åæ˜¯æˆ‘ä»¬çš„Activity(ä»£ç éƒ½å¾ˆç®€å•ï¼Œè®¤çœŸå­¦äº†javaéƒ½ä¸ä¼šçœ‹ä¸æ‡‚ï¼Œè€Œä¸”æ³¨é‡Šå¾ˆè¯¦ç»†ã€‚åªæœ‰å‡ å¤„éœ€è¦è§£é‡Šä¸‹ä¸‹çš„)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200package com.sorgs.administrator.caclulatordemo; import android.app.Activity; import android.os.Bundle; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; import android.widget.EditText; import android.widget.Toast; public class MainActivity extends Activity implements OnClickListener&#123; ` Button btn_0;//0æ•°å­—æŒ‰é’® Button btn_1;//1æ•°å­—æŒ‰é’® Button btn_2;//2æ•°å­—æŒ‰é’® Button btn_3;//3æ•°å­—æŒ‰é’® Button btn_4;//4æ•°å­—æŒ‰é’® Button btn_5;//5æ•°å­—æŒ‰é’® Button btn_6;//6æ•°å­—æŒ‰é’® Button btn_7;//7æ•°å­—æŒ‰é’® Button btn_8;//8æ•°å­—æŒ‰é’® Button btn_9;//9æ•°å­—æŒ‰é’® Button btn_point;//å°æ•°ç‚¹æŒ‰é’® Button btn_clear;//æ¸…é™¤æŒ‰é’® Button btn_del;//åˆ é™¤æŒ‰é’® Button btn_plus;//åŠ å¥½æŒ‰é’® Button btn_minus;//å‡å·æŒ‰é’® Button btn_divide;//é™¤å·æŒ‰é’® Button btn_multiply;//ä¹˜å·æŒ‰é’® Button btn_equle;//ç­‰äºæŒ‰é’® //ä»¥ä¸Šå»ºç«‹æŒ‰é’® EditText et_input;//æ˜¾ç¤ºè¾“å‡ºå†…å®¹çš„æ˜¾ç¤ºå± boolean clear_flag;//æ¸…ç©ºæ ‡è¯†ï¼Œç”¨äºç­‰å·ä¹‹åæ¸…ç©º @Override protected void onCreate(Bundle savedInstanceState)&#123; super.onCreate(savedInstanceState); setContentView(R.layout.content_main);//æ§åˆ¶xmlä¸ºcontent_main btn_0 = (Button) findViewById(R.id.btn_0); btn_1 = (Button) findViewById(R.id.btn_1); btn_2 = (Button) findViewById(R.id.btn_2); btn_3 = (Button) findViewById(R.id.btn_3); btn_4 = (Button) findViewById(R.id.btn_4); btn_5 = (Button) findViewById(R.id.btn_5); btn_6 = (Button) findViewById(R.id.btn_6); btn_7 = (Button) findViewById(R.id.btn_7); btn_8 = (Button) findViewById(R.id.btn_8); btn_9 = (Button) findViewById(R.id.btn_9); btn_point = (Button) findViewById(R.id.btn_point); btn_del = (Button) findViewById(R.id.btn_del); btn_plus = (Button) findViewById(R.id.btn_plus); btn_clear = (Button) findViewById(R.id.btn_clear); btn_minus = (Button) findViewById(R.id.btn_minus); btn_multiply = (Button) findViewById(R.id.btn_multiply); btn_divide = (Button) findViewById(R.id.btn_divide); btn_equle = (Button) findViewById(R.id.btn_equal); //ä»¥ä¸Šæ˜¯å®ä¾‹åŒ–æŒ‰é’® et_input = (EditText) findViewById(R.id.et_input);//å®ä¾‹åŒ–æ˜¾ç¤ºå± btn_0.setOnClickListener(this); btn_1.setOnClickListener(this); btn_2.setOnClickListener(this); btn_3.setOnClickListener(this); btn_4.setOnClickListener(this); btn_5.setOnClickListener(this); btn_6.setOnClickListener(this); btn_7.setOnClickListener(this); btn_8.setOnClickListener(this); btn_9.setOnClickListener(this); btn_point.setOnClickListener(this); btn_del.setOnClickListener(this); btn_plus.setOnClickListener(this); btn_clear.setOnClickListener(this); btn_minus.setOnClickListener(this); btn_multiply.setOnClickListener(this); btn_divide.setOnClickListener(this); btn_equle.setOnClickListener(this); //ä»¥ä¸Šè®¾ç½®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ &#125; @Override public void onClick(View v) &#123; String str = et_input.getText().toString(); //å–å‡ºæ˜¾ç¤ºå±å†…å®¹ switch (v.getId())&#123; //åˆ¤æ–­ç‚¹çš„æ˜¯é‚£ä¸ªæŒ‰é’® case R.id.btn_0: //å»ºç«‹æ•°å­—0â€”9å’Œ. case R.id.btn_1: case R.id.btn_2: case R.id.btn_3: case R.id.btn_4: case R.id.btn_5: case R.id.btn_6: case R.id.btn_7: case R.id.btn_8: case R.id.btn_9: case R.id.btn_point: if(clear_flag)&#123; // clear_flag =false; str = \"\"; //è®¡ç®—ä¸‹ä¸€ä¸ªæ—¶å€™ï¼Œåº”å°†åŸæ¥çš„è®¾ç½®ä¸ºç©º et_input.setText(\"\"); &#125; et_input.setText(str+((Button)v).getText()); //å°†ç‚¹å‡»çš„æ–‡å­—æ·»åŠ åˆ°è¾“å…¥æ¡†é‡Œé¢ï¼ˆstråŸæ¥è¾“å…¥æ¡†ä¸­å†…å®¹ï¼‰ break; case R.id.btn_plus: //å»ºç«‹+-Ã—Ã· case R.id.btn_minus: case R.id.btn_multiply: case R.id.btn_divide: if(clear_flag)&#123; clear_flag =false; str = \"\"; //è®¡ç®—ä¸‹ä¸€ä¸ªæ—¶å€™ï¼Œåº”å°†åŸæ¥çš„è®¾ç½®ä¸ºç©º et_input.setText(\"\"); &#125; et_input.setText(str+\" \"+((Button)v).getText()+\" \");//å°†ç‚¹å‡»çš„è¿ç®—ç¬¦æ·»åŠ åˆ°è¾“å…¥æ¡†å‰åæœ‰â€œ â€ç”¨äºåŒºåˆ« break; case R.id.btn_del: //å»ºç«‹åˆ é™¤ if(clear_flag)&#123; clear_flag= false; str = \"\"; //è®¡ç®—ä¸‹ä¸€ä¸ªæ—¶å€™ï¼Œåº”å°†åŸæ¥çš„è®¾ç½®ä¸ºç©º et_input.setText(\"\"); &#125;else if (str != null &amp;&amp;!str.equals(\"\")) &#123; //å¦‚æœæ˜¾ç¤ºå±é‡Œé¢ä¸æ˜¯NULLä¹Ÿä¸æ˜¯ç©º et_input.setText(str.substring(0,str.length()-1)); //ä»åé¢é•¿åº¦å‡ä¸€ &#125; break; case R.id.btn_clear: //å»ºç«‹æ¸…é™¤ clear_flag = false; str = \"\"; //è®¡ç®—ä¸‹ä¸€ä¸ªæ—¶å€™ï¼Œåº”å°†åŸæ¥çš„è®¾ç½®ä¸ºç©º et_input.setText(\"\"); //å°†æ˜¾ç¤ºå±å†…å®¹ç½®ç©º break; case R.id.btn_equal: //å»ºç«‹ç­‰äº getResult(); //è·å–ç»“ç®—ç»“æœ break; &#125; &#125; //è¿›è¡Œè®¡ç®— private void getResult()&#123; String exp = et_input.getText().toString(); //å–å‡ºæ˜¾ç¤ºå±å†…å®¹å¹¶è½¬åŒ–ä¸ºString if (exp == null||exp.equals(\"\"))&#123;//å¦‚æœå†…å®¹ä¸ºnullå’Œç©ºï¼Œç›´æ¥è¿”å› return; &#125; if(!exp.contains(\" \"))&#123;//å¦‚æœä¸åŒ…å«ç©ºæ ¼ï¼ˆè¿ç®—ç¬¦å‰é¢æœ‰ç©ºæ ¼ï¼‰ï¼Œç›´æ¥è¿”å›ï¼ˆæ¯”å¦‚ç‚¹äº†æ•°å­—ï¼Œæ²¡æœ‰è¿ç®—ç¬¦ï¼‰ return; &#125; if(clear_flag)&#123; clear_flag = false; return; &#125; clear_flag = true; double result = 0; //å®šä¹‰ä¸€ä¸ªdoubleçš„result=0 String s1 = exp.substring(0,exp.indexOf(' '));//æˆªå–è¿ç®—ç¬¦å‰é¢çš„å­—ç¬¦ String op = exp.substring(exp.indexOf(' ')+1,exp.indexOf(' ')+2);//æˆªå–è¿ç®—ç¬¦ String s2 = exp.substring(exp.indexOf(' ')+3);//æˆªå–è¿ç®—ç¬¦åé¢çš„å­—ç¬¦ if(!s1.equals(\"\")&amp;&amp;!s2.equals(\"\"))&#123; //å¦‚æœS1æˆ–è€…S2ä¸ä¸ºç©º double d1 = Double.parseDouble(s1); //å¼ºåˆ¶å°†S1è½¬æ¢ä¸ºdoubleç±»å‹ double d2 = Double.parseDouble(s2); //å¼ºåˆ¶å°†S2è½¬æ¢ä¸ºdoubleç±»å‹ if(op.equals(\"+\"))&#123; //å¦‚æœopä¸ºå››ä¸­æƒ…å†µçš„æ–¹æ¡ˆ result = d1+d2; &#125;else if(op.equals(\"-\"))&#123; result = d1-d2; &#125;else if(op.equals(\"Ã—\"))&#123; result = d1*d2; &#125;else if(op.equals(\"Ã·\"))&#123; if(d2==0)&#123; Toast.makeText(MainActivity.this, \"é™¤æ•°ä¸èƒ½ä¸º0ï¼ï¼ï¼\",Toast.LENGTH_LONG).show(); et_input.setText(\"0\"); &#125;else&#123; result = d1/d2; &#125; &#125; if(!s1.contains(\".\")&amp;&amp;!s2.contains(\".\")&amp;&amp;!op.equals(\"Ã·\"))&#123; //å¦‚æœæ²¡æœ‰å°æ•°ç‚¹åˆ™ä¸ºintç±»å‹ä¸”opä¸ä¸ºÃ· int r = (int)result; //å¼ºåˆ¶è½¬æ¢ä¸ºintç±»å‹ et_input.setText(r+\"\"); &#125;else&#123; //å…¶ä¸­å«æœ‰å°æ•°ç‚¹ï¼Œåˆ™è¾“å‡ºdoubleç±»å‹ et_input.setText(result+\"\"); &#125; &#125;else if(!s1.equals(\"\")&amp;&amp;s2.equals(\"\"))&#123; //S1ä¸ä¸ºç©ºï¼ŒS2ä¸ºç©º double d1 = Double.parseDouble(s1); result = d1; Toast.makeText(MainActivity.this, \"ä¸å…·å¤‡è¿ç®—\",Toast.LENGTH_LONG).show(); et_input.setText(result+\"\"); //ä¸è¿›è¡Œè®¡ç®—,è¿”å›S1 &#125;else if(s1.equals(\"\")&amp;&amp;!s2.equals(\"\"))&#123; //S1ä¸ºç©ºï¼ŒS2ä¸ä¸ºç©º double d2 = Double.parseDouble(s2); if(op.equals(\"+\"))&#123; result = 0+d2; &#125;else if(op.equals(\"-\"))&#123; result = 0-d2; &#125;else if(op.equals(\"Ã—\"))&#123; result = 0; &#125;else if(op.equals(\"Ã·\"))&#123; result = 0; &#125; if(!s2.contains(\".\"))&#123; int r = (int)result; et_input.setText(r+\"\"); &#125;else&#123; et_input.setText(result+\"\"); &#125; &#125;else&#123; et_input.setText(\"\"); &#125; &#125; &#125; è¿™é‡Œé‡‡ç”¨æ¶ˆæ¯æ˜¾ç¤ºçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸ªäººè§‰å¾—è¿™æ ·å¾ˆå¥½çœ‹ã€‚1Toast.makeText(MainActivity.this, \"é™¤æ•°ä¸èƒ½ä¸º0ï¼ï¼ï¼\",Toast.LENGTH_LONG).show(); æ•ˆæœå›¾ï¼š Toast.makeTextçš„æ–¹æ³•ä¹Ÿä¸åœ¨èµ˜è¿°äº†ï¼Œå› ä¸ºå¾ˆå¤šåšå®¢éƒ½æœ‰å†™ï¼ˆhttp://www.cnblogs.com/ycxyyzw/archive/2013/03/12/2955845.htmlï¼‰","tags":[{"name":"Androidå¼€å‘","slug":"Androidå¼€å‘","permalink":"http://sorgs.cn/tags/Androidå¼€å‘/"}]},{"title":"è¿˜æ˜¯æ¥ä¸ªHelloå§","date":"2016-11-15T02:07:01.000Z","path":"post/52407/","text":"è¿˜æ˜¯æ¥ä¸ªHelloå§&#160; &#160; &#160; &#160;æ£é¼“äº†å¥½å‡ å¤©ï¼Œç»ˆäºæŠŠæˆ‘çš„åšå®¢ç»™å»ºç«‹äº†èµ·æ¥åœ¨ï¼ŒçœŸæ˜¯å¿ƒç´¯å•Šã€‚ &#160; &#160; &#160; &#160;ä»æœ€æœ€æœ€å¼€å§‹çš„è´­ä¹°è…¾è®¯äº‘çš„å­¦ç”Ÿä»€ä¹ˆä¸œä¸œå¼€å§‹ï¼Œå‘ç°WordPressä¸æ˜¯å¤ªçœ‹çœ‹ï¼Œè¿™å°±å¾ˆå°´å°¬äº†ï¼Œäºæ˜¯å°±å‘ç°è£…é€¼çš„hexoå¼ºåŠ›é©±åŠ¨è¿˜ä¸å¤šï¼Œè¿˜ä¸èŠ±é’±ã€‚å°±æäº†è¿‡æ¥ã€‚ &#160; &#160; &#160; &#160;ä»æœ€æœ€æœ€å¼€å§‹çš„GitHubå¼€å§‹éƒ¨ç½²ï¼Œç»“æœå›½å†…è®¿é—®å¤ªæ…¢äº†ï¼Œçœ‹åˆ°ç½‘ä¸Šå¾ˆå¤šè¯´è¿˜å¯ä»¥éƒ¨ç½²åˆ°codingä¸Šé¢ï¼Œå‘ç°ä¸æ˜¯å¤ªå¥½å¼„ï¼Œäºæ˜¯å†åŠ ä¸Šéƒ¨ç½²åˆ°ä¸ƒç‰›ä¸Šã€‚è™½ç„¶ç¡®å®å¾ˆæ˜¯éº»çƒ¦ï¼Œä½†æ˜¯ä¿è¯äº†æ•°æ®çš„å®‰å…¨äº›ã€‚ç‹¡å…”ä¸‰çªŸå˜›ã€‚ &#160; &#160; &#160; &#160;æœ€åå¤§å®¶å¯¹hexoè£…é€¼éƒ¨ç½²ä¸æ‡‚çš„ï¼Œå¯ä»¥æ¥é—®é—®æˆ‘ï¼Œæˆ‘æœ‰æ—¶é—´ä¸€å®šè€å¿ƒè§£ç­”çš„ &#160; &#160; &#160; &#160;æœ€åå‘¢ï¼Œæˆ‘çš„CSDNçš„åšå®¢åœ¨è¿™é‡Œã€‚æˆ‘ä¼šé€æ¸æŠŠæˆ‘çš„åšå®¢æ¬è¿‡æ¥çš„å“ˆå“ˆå“ˆï¼ï¼","tags":[{"name":"æ‚è®°","slug":"æ‚è®°","permalink":"http://sorgs.cn/tags/æ‚è®°/"}]}]